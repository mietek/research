module ListOrnaments where

open import Prelude
open import Fin
open import List


--------------------------------------------------------------------------------


infix 4 _âŠ‡âŸ¨_âŸ©_
data _âŠ‡âŸ¨_âŸ©_ {X P} : {Î Îâ€² : List X} â†’ All P Îâ€² â†’ Îâ€² âŠ‡ Î â†’ All P Î â†’ Set
  where
    done : âˆ™ âŠ‡âŸ¨ done âŸ© âˆ™

    drop : âˆ€ {A Î Îâ€²} â†’ {Î· : Îâ€² âŠ‡ Î}
                         {x : P A} {Î¾ : All P Î} {Î¾â€² : All P Îâ€²}
                      â†’ Î¾â€² âŠ‡âŸ¨ Î· âŸ© Î¾
                      â†’ Î¾â€² , x âŠ‡âŸ¨ drop Î· âŸ© Î¾

    keep : âˆ€ {A Î Îâ€²} â†’ {Î· : Îâ€² âŠ‡ Î}
                         {x : P A} {Î¾ : All P Î} {Î¾â€² : All P Îâ€²}
                      â†’ Î¾â€² âŠ‡âŸ¨ Î· âŸ© Î¾
                      â†’ Î¾â€² , x âŠ‡âŸ¨ keep Î· âŸ© Î¾ , x


botâŠ‡â—‡ : âˆ€ {X P} â†’ {Î : List X} {Î¾ : All P Î}
                â†’ Î¾ âŠ‡âŸ¨ botâŠ‡ âŸ© âˆ™
botâŠ‡â—‡ {Î¾ = âˆ™}     = done
botâŠ‡â—‡ {Î¾ = Î¾ , x} = drop botâŠ‡â—‡


idâŠ‡â—‡ : âˆ€ {X P} â†’ {Î : List X} {Î¾ : All P Î}
               â†’ Î¾ âŠ‡âŸ¨ idâŠ‡ âŸ© Î¾
idâŠ‡â—‡ {Î¾ = âˆ™}     = done
idâŠ‡â—‡ {Î¾ = Î¾ , x} = keep idâŠ‡â—‡


_âˆ˜âŠ‡â—‡_ : âˆ€ {X P} â†’ {Î Îâ€² Îâ€³ : List X} {Î·â‚ : Îâ€² âŠ‡ Î} {Î·â‚‚ : Îâ€³ âŠ‡ Îâ€²}
                   {Î¾ : All P Î} {Î¾â€² : All P Îâ€²} {Î¾â€³ : All P Îâ€³}
                â†’ Î¾â€² âŠ‡âŸ¨ Î·â‚ âŸ© Î¾ â†’ Î¾â€³ âŠ‡âŸ¨ Î·â‚‚ âŸ© Î¾â€²
                â†’ Î¾â€³ âŠ‡âŸ¨ Î·â‚ âˆ˜âŠ‡ Î·â‚‚ âŸ© Î¾
`Î·â‚      âˆ˜âŠ‡â—‡ done     = `Î·â‚
`Î·â‚      âˆ˜âŠ‡â—‡ drop `Î·â‚‚ = drop (`Î·â‚ âˆ˜âŠ‡â—‡ `Î·â‚‚)
drop `Î·â‚ âˆ˜âŠ‡â—‡ keep `Î·â‚‚ = drop (`Î·â‚ âˆ˜âŠ‡â—‡ `Î·â‚‚)
keep `Î·â‚ âˆ˜âŠ‡â—‡ keep `Î·â‚‚ = keep (`Î·â‚ âˆ˜âŠ‡â—‡ `Î·â‚‚)


--------------------------------------------------------------------------------


infix 4 _âˆ‹âŸ¨_âŸ©_
data _âˆ‹âŸ¨_âŸ©_ {X P} : âˆ€ {A} â†’ {Î : List X} â†’ All P Î â†’ Î âˆ‹ A â†’ P A â†’ Set
  where
    zero : âˆ€ {Î A} â†’ {Î¾ : All P Î} {x : P A}
                   â†’ Î¾ , x âˆ‹âŸ¨ zero âŸ© x

    suc : âˆ€ {B Î A} â†’ {ğ’¾ : Î âˆ‹ A}
                       {y : P B} {Î¾ : All P Î} {x : P A}
                    â†’ Î¾ âˆ‹âŸ¨ ğ’¾ âŸ© x
                    â†’ Î¾ , y âˆ‹âŸ¨ suc ğ’¾ âŸ© x


renâˆ‹â—‡ : âˆ€ {X P A} â†’ {Î Îâ€² : List X} {Î· : Îâ€² âŠ‡ Î} {ğ’¾ : Î âˆ‹ A}
                     {Î¾ : All P Î} {Î¾â€² : All P Îâ€²} {x : P A}
                  â†’ Î¾â€² âŠ‡âŸ¨ Î· âŸ© Î¾ â†’ Î¾ âˆ‹âŸ¨ ğ’¾ âŸ© x
                  â†’ Î¾â€² âˆ‹âŸ¨ renâˆ‹ Î· ğ’¾ âŸ© x
renâˆ‹â—‡ done      `ğ’¾       = `ğ’¾
renâˆ‹â—‡ (drop `Î·) `ğ’¾       = suc (renâˆ‹â—‡ `Î· `ğ’¾)
renâˆ‹â—‡ (keep `Î·) zero     = zero
renâˆ‹â—‡ (keep `Î·) (suc `ğ’¾) = suc (renâˆ‹â—‡ `Î· `ğ’¾)


--------------------------------------------------------------------------------


data Allâ—‡ {X P} (`P : âˆ€ {A : X} â†’ P A â†’ Set) : âˆ€ {Î} â†’ All P Î â†’ Set
  where
    âˆ™ : Allâ—‡ `P âˆ™

    _,_ : âˆ€ {Î A} â†’ {Î¾ : All P Î} {x : P A}
                  â†’ Allâ—‡ `P Î¾ â†’ `P x
                  â†’ Allâ—‡ `P (Î¾ , x)


lookupâ—‡ : âˆ€ {X P A} â†’ {Î : List X} {x : P A}
                       {Î¾ : All P Î} {ğ’¾ : Î âˆ‹ A}
                       {`P : âˆ€ {A} â†’ P A â†’ Set}
                    â†’ Allâ—‡ `P Î¾ â†’ Î¾ âˆ‹âŸ¨ ğ’¾ âŸ© x
                    â†’ `P x
lookupâ—‡ (`Î¾ , `x) zero     = `x
lookupâ—‡ (`Î¾ , `y) (suc `ğ’¾) = lookupâ—‡ `Î¾ `ğ’¾


mapAllâ—‡ : âˆ€ {X P} â†’ {Î : List X} {Q : X â†’ Set}
                     {f : âˆ€ {A} â†’ P A â†’ Q A} {Î¾ : All P Î}
                     {`P : âˆ€ {A} â†’ P A â†’ Set} {`Q : âˆ€ {A} â†’ Q A â†’ Set}
                  â†’ (âˆ€ {A} â†’ {x : P A} â†’ `P x â†’ `Q (f x)) â†’ Allâ—‡ `P Î¾
                  â†’ Allâ—‡ `Q (mapAll f Î¾)
mapAllâ—‡ `f âˆ™         = âˆ™
mapAllâ—‡ `f (`Î¾ , `x) = mapAllâ—‡ `f `Î¾ , `f `x



--------------------------------------------------------------------------------
