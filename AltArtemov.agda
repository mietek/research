{-

An implementation of the Alt-ArtÃ«mov system Î»âˆ
==============================================

MiÃ«tek Bak  <mietek@bak.io>


Work in progress.  Checked with Agda 2.4.2.5.

For easy editing with Emacs agda-mode, add to your .emacs file:

'(agda-input-user-translations
   (quote
    (("i" "âŠƒ")  ("ii" "â«—")  ("e" "âŠ¢")   ("ee" "âŠ©")  ("n" "Â¬")
     ("." "Â·")  (":" "âˆ¶")    (".:" "âˆ´")   (":." "âˆµ")   ("::" "âˆ·")
     ("s" "ğ¬")  ("t" "ğ­")    ("x" "ğ±")    ("y" "ğ²")    ("N" "â„•")
     ("v" "ğ‘£")  ("v0" "ğ‘£â°")  ("v1" "ğ‘£Â¹")  ("v2" "ğ‘£Â²")  ("vn" "ğ‘£â¿")
     ("l" "ğœ†")  ("l0" "ğœ†â°")  ("l1" "ğœ†Â¹")  ("l2" "ğœ†Â²")  ("ln" "ğœ†â¿")
     ("o" "âˆ˜")  ("o0" "âˆ˜â°")  ("o1" "âˆ˜Â¹")  ("o2" "âˆ˜Â²")  ("on" "âˆ˜â¿")
     ("p" "ğ‘")  ("p0" "ğ‘â°")  ("p1" "ğ‘Â¹")  ("p2" "ğ‘Â²")  ("pn" "ğ‘â¿")
     ("1" "ğœ‹â‚€") ("10" "ğœ‹â‚€â°") ("11" "ğœ‹â‚€Â¹") ("12" "ğœ‹â‚€Â²") ("1n" "ğœ‹â‚€â¿")
     ("2" "ğœ‹â‚") ("20" "ğœ‹â‚â°") ("21" "ğœ‹â‚Â¹") ("22" "ğœ‹â‚Â²") ("2n" "ğœ‹â‚â¿")
     ("u" "â‡‘")  ("u0" "â‡‘â°")  ("u1" "â‡‘Â¹")  ("u2" "â‡‘Â²")  ("un" "â‡‘â¿")
     ("d" "â‡“")  ("d0" "â‡“â°")  ("d1" "â‡“Â¹")  ("d2" "â‡“Â²")  ("dn" "â‡“â¿"))))


[1]: Alt, J., ArtÃ«mov, S. (2001) Reflective Î»-calculus,
     Proceedings of the 2001 International Seminar on Proof Theory in
     Computer Science (PTCSâ€™01), Lecture Notes in Computer Science,
     vol. 2183, pp. 22â€“37.
     http://dx.doi.org/10.1007/3-540-45504-3_2

-}


module AltArtemov where

open import Data.Nat
  using (â„• ; zero ; suc)

open import Data.Product
  using (Î£ ; projâ‚ ; projâ‚‚)
  renaming (_,_ to âŸ¨_,_âŸ©)

infixl 9 !_ ğ‘£_
infixl 8 ğœ‹â‚€_ ğœ‹â‚€Â²_ ğœ‹â‚_ ğœ‹â‚Â²_
infixl 7 _âˆ˜_ _âˆ˜Â²_
infixr 6 â‡‘_ â‡‘Â²_ â‡“_ â‡“Â²_
infixr 5 ğœ†_Â·_ ğœ†Â²_Â·_
infixr 4 _âˆ¶_ _âˆ·_
infixr 3 Â¬_
infixl 2 _,_ _âˆ§_
infixr 1 _âŠƒ_ _â«—_
infixr 0 _âŠ¢_ âŠ©_


-- --------------------------------------------------------------------------
--
-- Type and term constructors


Var : Set
Var = â„•


mutual
  data Ty : Set where
    -- Falsehood
    âŠ¥ : Ty

    -- Implication
    _âŠƒ_ : Ty â†’ Ty â†’ Ty

    -- Conjunction
    _âˆ§_ : Ty â†’ Ty â†’ Ty

    -- Explicit provability
    _âˆ¶_ : Tm â†’ Ty â†’ Ty


  data Tm : Set where
    -- Variable
    ğ‘£_ : Var â†’ Tm

    -- Abstraction (âŠƒI)
    ğœ†[_]_Â·_ : â„• â†’ Var â†’ Tm â†’ Tm

    -- Application (âŠƒE)
    _âˆ˜[_]_ : Tm â†’ â„• â†’ Tm â†’ Tm

    -- Pairing (âˆ§I)
    ğ‘[_]âŸ¨_,_âŸ© : â„• â†’ Tm â†’ Tm â†’ Tm

    -- First projection (âˆ§Eâ‚€)
    ğœ‹â‚€[_]_ : â„• â†’ Tm â†’ Tm

    -- Second projection (âˆ§Eâ‚)
    ğœ‹â‚[_]_ : â„• â†’ Tm â†’ Tm

    -- ArtÃ«movâ€™s â€œproof checkerâ€
    !_ : Tm â†’ Tm

    -- Reification
    â‡‘[_]_ : â„• â†’ Tm â†’ Tm

    -- Reflection
    â‡“[_]_ : â„• â†’ Tm â†’ Tm


-- --------------------------------------------------------------------------
--
-- Example types


-- Truth
âŠ¤ : Ty
âŠ¤ = âŠ¥ âŠƒ âŠ¥

-- Negation
Â¬_ : Ty â†’ Ty
Â¬ A = A âŠƒ âŠ¥

-- Equivalence
_â«—_ : Ty â†’ Ty â†’ Ty
A â«— B = A âŠƒ B âˆ§ B âŠƒ A


-- --------------------------------------------------------------------------
--
-- Simplified notation for level 1 and 2 term constructors


ğœ†_Â·_ : Var â†’ Tm â†’ Tm
ğœ† x Â· t = ğœ†[ 1 ] x Â· t

_âˆ˜_ : Tm â†’ Tm â†’ Tm
t âˆ˜ s = t âˆ˜[ 1 ] s

ğ‘âŸ¨_,_âŸ© : Tm â†’ Tm â†’ Tm
ğ‘âŸ¨ t , s âŸ© = ğ‘[ 1 ]âŸ¨ t , s âŸ©

ğœ‹â‚€_ : Tm â†’ Tm
ğœ‹â‚€ t = ğœ‹â‚€[ 1 ] t

ğœ‹â‚_ : Tm â†’ Tm
ğœ‹â‚ t = ğœ‹â‚[ 1 ] t

â‡‘_ : Tm â†’ Tm
â‡‘ t = â‡‘[ 1 ] t

â‡“_ : Tm â†’ Tm
â‡“ t = â‡“[ 1 ] t


ğœ†Â²_Â·_ : Var â†’ Tm â†’ Tm
ğœ†Â² xâ‚‚ Â· tâ‚‚ = ğœ†[ 2 ] xâ‚‚ Â· tâ‚‚

_âˆ˜Â²_ : Tm â†’ Tm â†’ Tm
tâ‚‚ âˆ˜Â² sâ‚‚ = tâ‚‚ âˆ˜[ 2 ] sâ‚‚

ğ‘Â²âŸ¨_,_âŸ© : Tm â†’ Tm â†’ Tm
ğ‘Â²âŸ¨ tâ‚‚ , sâ‚‚ âŸ© = ğ‘[ 2 ]âŸ¨ tâ‚‚ , sâ‚‚ âŸ©

ğœ‹â‚€Â²_ : Tm â†’ Tm
ğœ‹â‚€Â² tâ‚‚ = ğœ‹â‚€[ 2 ] tâ‚‚

ğœ‹â‚Â²_ : Tm â†’ Tm
ğœ‹â‚Â² tâ‚‚ = ğœ‹â‚[ 2 ] tâ‚‚

â‡‘Â²_ : Tm â†’ Tm
â‡‘Â² tâ‚‚ = â‡‘[ 2 ] tâ‚‚

â‡“Â²_ : Tm â†’ Tm
â‡“Â² tâ‚‚ = â‡“[ 2 ] tâ‚‚


-- --------------------------------------------------------------------------
--
-- Generic vectors


data Vec (X : Set) : â„• â†’ Set where
  []  : Vec X zero
  _âˆ·_ : âˆ€{n} â†’ X â†’ Vec X n â†’ Vec X (suc n)


append : âˆ€{n} {X : Set}
        â†’ Vec X n â†’ X â†’ Vec X (suc n)
append []      y = y âˆ· []
append (x âˆ· ğ±) y = x âˆ· append ğ± y

foldr : âˆ€{n} {X : Set} (Y : â„• â†’ Set)
      â†’ (âˆ€{k} â†’ X â†’ Y k â†’ Y (suc k)) â†’ Y zero â†’ Vec X n â†’ Y n
foldr Y f yâ‚€ []      = yâ‚€
foldr Y f yâ‚€ (x âˆ· ğ±) = f x (foldr Y f yâ‚€ ğ±)

ixMap : âˆ€{n} {X Y : Set}
      â†’ (â„• â†’ X â†’ Y) â†’ Vec X n â†’ Vec Y n
ixMap {zero}  f []      = []
ixMap {suc n} f (x âˆ· ğ±) = f (suc n) x âˆ· ixMap f ğ±

ixZipWith : âˆ€{n} {X Y Z : Set}
          â†’ (â„• â†’ X â†’ Y â†’ Z) â†’ Vec X n â†’ Vec Y n â†’ Vec Z n
ixZipWith {zero}  f []      []       = []
ixZipWith {suc n} f (x âˆ· ğ±) (y âˆ· ğ²) = f (suc n) x y âˆ· ixZipWith f ğ± ğ²


map : âˆ€{n} {X Y : Set}
    â†’ (X â†’ Y) â†’ Vec X n â†’ Vec Y n
map f = ixMap (Î» _ x â†’ f x)

zipWith : âˆ€{n} {X Y Z : Set}
        â†’ (X â†’ Y â†’ Z) â†’ Vec X n â†’ Vec Y n â†’ Vec Z n
zipWith f = ixZipWith (Î» _ x y â†’ f x y)


-- --------------------------------------------------------------------------
--
-- Vector notation for level n type assertions


Vars : â„• â†’ Set
Vars = Vec Var

Tms : â„• â†’ Set
Tms = Vec Tm


*â¿_âˆ·_ : âˆ€{n} â†’ Tms n â†’ Ty â†’ Ty
*â¿ ğ­ âˆ· A = foldr (Î» _ â†’ Ty) _âˆ¶_ A ğ­

ğ‘£â¿_âˆ·_ : âˆ€{n} â†’ Vars n â†’ Ty â†’ Ty
ğ‘£â¿ ğ± âˆ· A = *â¿ (map ğ‘£_ ğ±) âˆ· A

ğœ†â¿_Â·_âˆ·_ : âˆ€{n} â†’ Vars n â†’ Tms n â†’ Ty â†’ Ty
ğœ†â¿ ğ± Â· ğ­ âˆ· A = *â¿ (ixZipWith ğœ†[_]_Â·_ ğ± ğ­) âˆ· A

_âˆ˜â¿_âˆ·_ : âˆ€{n} â†’ Tms n â†’ Tms n â†’ Ty â†’ Ty
ğ­ âˆ˜â¿ ğ¬ âˆ· A = *â¿ (ixZipWith (Î» n t s â†’ t âˆ˜[ n ] s) ğ­ ğ¬) âˆ· A

ğ‘â¿âŸ¨_,_âŸ©âˆ·_ : âˆ€{n} â†’ Tms n â†’ Tms n â†’ Ty â†’ Ty
ğ‘â¿âŸ¨ ğ­ , ğ¬ âŸ©âˆ· A = *â¿ (ixZipWith ğ‘[_]âŸ¨_,_âŸ© ğ­ ğ¬) âˆ· A

ğœ‹â‚€â¿_âˆ·_ : âˆ€{n} â†’ Tms n â†’ Ty â†’ Ty
ğœ‹â‚€â¿ ğ­ âˆ· A = *â¿ (ixMap ğœ‹â‚€[_]_ ğ­) âˆ· A

ğœ‹â‚â¿_âˆ·_ : âˆ€{n} â†’ Tms n â†’ Ty â†’ Ty
ğœ‹â‚â¿ ğ­ âˆ· A = *â¿ (ixMap ğœ‹â‚[_]_ ğ­) âˆ· A

â‡‘â¿_âˆ·_ : âˆ€{n} â†’ Tms n â†’ Ty â†’ Ty
â‡‘â¿ ğ­ âˆ· A = *â¿ (ixMap â‡‘[_]_ ğ­) âˆ· A

â‡“â¿_âˆ·_ : âˆ€{n} â†’ Tms n â†’ Ty â†’ Ty
â‡“â¿ ğ­ âˆ· A = *â¿ (ixMap â‡“[_]_ ğ­) âˆ· A


-- --------------------------------------------------------------------------
--
-- Typing contexts


data Cx : â„• â†’ Set where
  âˆ…   : Cx zero
  _,_ : âˆ€{m} â†’ Cx m â†’ Ty â†’ Cx (suc m)


data _âˆˆ_  : âˆ€{m} â†’ Ty â†’ Cx m â†’ Set where
  Z  : âˆ€{m} {Î“ : Cx m} {A : Ty}
     â†’ A âˆˆ (Î“ , A)

  S_ : âˆ€{m} {Î“ : Cx m} {A B : Ty}
     â†’ A âˆˆ Î“
     â†’ A âˆˆ (Î“ , B)


-- --------------------------------------------------------------------------
--
-- Typing judgment


data _âŠ¢_ {m : â„•} (Î“ : Cx m) : Ty â†’ Set where
  Mğ‘£â¿  : âˆ€{n} {ğ­ : Tms n} {A : Ty}
       â†’ *â¿ ğ­ âˆ· A âˆˆ Î“
       â†’ Î“ âŠ¢ *â¿ ğ­ âˆ· A

  Mğœ†â¿  : âˆ€{n} {ğ± : Vars n} {ğ­ : Tms n} {A B : Ty}
       â†’ Î“ , ğ‘£â¿ ğ± âˆ· A âŠ¢ *â¿ ğ­ âˆ· B
       â†’ Î“ âŠ¢ ğœ†â¿ ğ± Â· ğ­ âˆ· (A âŠƒ B)

  Mâˆ˜â¿  : âˆ€{n} {ğ­ ğ¬ : Tms n} {A B : Ty}
       â†’ Î“ âŠ¢ *â¿ ğ­ âˆ· (A âŠƒ B)    â†’ Î“ âŠ¢ *â¿ ğ¬ âˆ· A
       â†’ Î“ âŠ¢ ğ­ âˆ˜â¿ ğ¬ âˆ· B

  Mğ‘â¿  : âˆ€{n} {ğ­ ğ¬ : Tms n} {A B : Ty}
       â†’ Î“ âŠ¢ *â¿ ğ­ âˆ· A          â†’ Î“ âŠ¢ *â¿ ğ¬ âˆ· B
       â†’ Î“ âŠ¢ ğ‘â¿âŸ¨ ğ­ , ğ¬ âŸ©âˆ· (A âˆ§ B)

  Mğœ‹â‚€â¿ : âˆ€{n} {ğ­ : Tms n} {A B : Ty}
       â†’ Î“ âŠ¢ *â¿ ğ­ âˆ· (A âˆ§ B)
       â†’ Î“ âŠ¢ ğœ‹â‚€â¿ ğ­ âˆ· A

  Mğœ‹â‚â¿ : âˆ€{n} {ğ­ : Tms n} {A B : Ty}
       â†’ Î“ âŠ¢ *â¿ ğ­ âˆ· (A âˆ§ B)
       â†’ Î“ âŠ¢ ğœ‹â‚â¿ ğ­ âˆ· B

  Mâ‡‘â¿  : âˆ€{n} {ğ­ : Tms n} {u : Tm} {A : Ty}
       â†’ Î“ âŠ¢ *â¿ ğ­ âˆ· (u âˆ¶ A)
       â†’ Î“ âŠ¢ â‡‘â¿ ğ­ âˆ· (! u âˆ¶ u âˆ¶ A)

  Mâ‡“â¿  : âˆ€{n} {ğ­ : Tms n} {u : Tm} {A : Ty}
       â†’ Î“ âŠ¢ *â¿ ğ­ âˆ· (u âˆ¶ A)
       â†’ Î“ âŠ¢ â‡“â¿ ğ­ âˆ· A


âŠ©_  : Ty â†’ Set
âŠ© A = âˆ€{m} {Î“ : Cx m} â†’ Î“ âŠ¢ A


-- --------------------------------------------------------------------------
--
-- Simplified notation for level 0 typing rules


Mğ‘£â°  : âˆ€{A m} {Î“ : Cx m}
     â†’ A âˆˆ Î“
     â†’ Î“ âŠ¢ A
Mğ‘£â° = Mğ‘£â¿ {ğ­ = []}

Mğœ†â°  : âˆ€{A B m} {Î“ : Cx m}
     â†’ Î“ , A âŠ¢ B
     â†’ Î“ âŠ¢ A âŠƒ B
Mğœ†â° = Mğœ†â¿ {ğ± = []} {ğ­ = []}

Mâˆ˜â°  : âˆ€{A B m} {Î“ : Cx m}
     â†’ Î“ âŠ¢ A âŠƒ B    â†’ Î“ âŠ¢ A
     â†’ Î“ âŠ¢ B
Mâˆ˜â° = Mâˆ˜â¿ {ğ­ = []} {ğ¬ = []}

Mğ‘â°  : âˆ€{A B m} {Î“ : Cx m}
     â†’ Î“ âŠ¢ A        â†’ Î“ âŠ¢ B
     â†’ Î“ âŠ¢ A âˆ§ B
Mğ‘â° = Mğ‘â¿ {ğ­ = []} {ğ¬ = []}

Mğœ‹â‚€â° : âˆ€{A B m} {Î“ : Cx m}
     â†’ Î“ âŠ¢ A âˆ§ B
     â†’ Î“ âŠ¢ A
Mğœ‹â‚€â° = Mğœ‹â‚€â¿ {ğ­ = []}

Mğœ‹â‚â° : âˆ€{A B m} {Î“ : Cx m}
     â†’ Î“ âŠ¢ A âˆ§ B
     â†’ Î“ âŠ¢ B
Mğœ‹â‚â° = Mğœ‹â‚â¿ {ğ­ = []}

Mâ‡‘â°  : âˆ€{u A m} {Î“ : Cx m}
     â†’ Î“ âŠ¢ u âˆ¶ A
     â†’ Î“ âŠ¢ ! u âˆ¶ u âˆ¶ A
Mâ‡‘â° = Mâ‡‘â¿ {ğ­ = []}

Mâ‡“â°  : âˆ€{u A m} {Î“ : Cx m}
     â†’ Î“ âŠ¢ u âˆ¶ A
     â†’ Î“ âŠ¢ A
Mâ‡“â° = Mâ‡“â¿ {ğ­ = []}


-- --------------------------------------------------------------------------
--
-- Simplified notation for level 1 typing rules


Mğ‘£Â¹  : âˆ€{t A m} {Î“ : Cx m}
     â†’ (t âˆ¶ A) âˆˆ Î“
     â†’ Î“ âŠ¢ t âˆ¶ A
Mğ‘£Â¹{t} = Mğ‘£â¿ {ğ­ = t âˆ· []}

Mğœ†Â¹  : âˆ€{x t A B m} {Î“ : Cx m}
     â†’ Î“ , ğ‘£ x âˆ¶ A âŠ¢ t âˆ¶ B
     â†’ Î“ âŠ¢ ğœ† x Â· t âˆ¶ (A âŠƒ B)
Mğœ†Â¹ {x} {t} = Mğœ†â¿ {ğ± = x âˆ· []} {ğ­ = t âˆ· []}

Mâˆ˜Â¹  : âˆ€{t s A B m} {Î“ : Cx m}
     â†’ Î“ âŠ¢ t âˆ¶ (A âŠƒ B)    â†’ Î“ âŠ¢ s âˆ¶ A
     â†’ Î“ âŠ¢ t âˆ˜ s âˆ¶ B
Mâˆ˜Â¹ {t} {s} = Mâˆ˜â¿ {ğ­ = t âˆ· []} {ğ¬ = s âˆ· []}

Mğ‘Â¹  : âˆ€{t s A B m} {Î“ : Cx m}
     â†’ Î“ âŠ¢ t âˆ¶ A          â†’ Î“ âŠ¢ s âˆ¶ B
     â†’ Î“ âŠ¢ ğ‘âŸ¨ t , s âŸ© âˆ¶ (A âˆ§ B)
Mğ‘Â¹ {t} {s} = Mğ‘â¿ {ğ­ = t âˆ· []} {ğ¬ = s âˆ· []}

Mğœ‹â‚€Â¹ : âˆ€{t A B m} {Î“ : Cx m}
     â†’ Î“ âŠ¢ t âˆ¶ (A âˆ§ B)
     â†’ Î“ âŠ¢ ğœ‹â‚€ t âˆ¶ A
Mğœ‹â‚€Â¹ {t} = Mğœ‹â‚€â¿ {ğ­ = t âˆ· []}

Mğœ‹â‚Â¹ : âˆ€{t A B m} {Î“ : Cx m}
     â†’ Î“ âŠ¢ t âˆ¶ (A âˆ§ B)
     â†’ Î“ âŠ¢ ğœ‹â‚ t âˆ¶ B
Mğœ‹â‚Â¹ {t} = Mğœ‹â‚â¿ {ğ­ = t âˆ· []}

Mâ‡‘Â¹  : âˆ€{t u A m} {Î“ : Cx m}
     â†’ Î“ âŠ¢ t âˆ¶ u âˆ¶ A
     â†’ Î“ âŠ¢ â‡‘ t âˆ¶ ! u âˆ¶ u âˆ¶ A
Mâ‡‘Â¹ {t} = Mâ‡‘â¿ {ğ­ = t âˆ· []}

Mâ‡“Â¹  : âˆ€{t u A m} {Î“ : Cx m}
     â†’ Î“ âŠ¢ t âˆ¶ u âˆ¶ A
     â†’ Î“ âŠ¢ â‡“ t âˆ¶ A
Mâ‡“Â¹ {t} = Mâ‡“â¿ {ğ­ = t âˆ· []}


-- --------------------------------------------------------------------------
--
-- Simplified notation for level 2 typing rules


Mğ‘£Â²  : âˆ€{tâ‚‚ tâ‚ A m} {Î“ : Cx m}
     â†’ (tâ‚‚ âˆ¶ tâ‚ âˆ¶ A) âˆˆ Î“
     â†’ Î“ âŠ¢ tâ‚‚ âˆ¶ tâ‚ âˆ¶ A
Mğ‘£Â² {tâ‚‚} {tâ‚} = Mğ‘£â¿ {ğ­ = tâ‚‚ âˆ· tâ‚ âˆ· []}

Mğœ†Â²  : âˆ€{xâ‚‚ xâ‚ tâ‚‚ tâ‚ A B m} {Î“ : Cx m}
     â†’ Î“ , ğ‘£ xâ‚‚ âˆ¶ ğ‘£ xâ‚ âˆ¶ A âŠ¢ tâ‚‚ âˆ¶ tâ‚ âˆ¶ B
     â†’ Î“ âŠ¢ ğœ†Â² xâ‚‚ Â· tâ‚‚ âˆ¶ ğœ† xâ‚ Â· tâ‚ âˆ¶ (A âŠƒ B)
Mğœ†Â² {xâ‚‚} {xâ‚} {tâ‚‚} {tâ‚} = Mğœ†â¿ {ğ± = xâ‚‚ âˆ· xâ‚ âˆ· []} {ğ­ = tâ‚‚ âˆ· tâ‚ âˆ· []}

Mâˆ˜Â²  : âˆ€{tâ‚‚ tâ‚ sâ‚‚ sâ‚ A B m} {Î“ : Cx m}
     â†’ Î“ âŠ¢ tâ‚‚ âˆ¶ tâ‚ âˆ¶ (A âŠƒ B)    â†’ Î“ âŠ¢ sâ‚‚ âˆ¶ sâ‚ âˆ¶ A
     â†’ Î“ âŠ¢ tâ‚‚ âˆ˜Â² sâ‚‚ âˆ¶ tâ‚ âˆ˜ sâ‚ âˆ¶ B
Mâˆ˜Â² {tâ‚‚} {tâ‚} {sâ‚‚} {sâ‚} = Mâˆ˜â¿ {ğ­ = tâ‚‚ âˆ· tâ‚ âˆ· []} {ğ¬ = sâ‚‚ âˆ· sâ‚ âˆ· []}

Mğ‘Â²  : âˆ€{tâ‚‚ tâ‚ sâ‚‚ sâ‚ A B m} {Î“ : Cx m}
     â†’ Î“ âŠ¢ tâ‚‚ âˆ¶ tâ‚ âˆ¶ A          â†’ Î“ âŠ¢ sâ‚‚ âˆ¶ sâ‚ âˆ¶ B
     â†’ Î“ âŠ¢ ğ‘Â²âŸ¨ tâ‚‚ , sâ‚‚ âŸ© âˆ¶ ğ‘âŸ¨ tâ‚ , sâ‚ âŸ© âˆ¶ (A âˆ§ B)
Mğ‘Â² {tâ‚‚} {tâ‚} {sâ‚‚} {sâ‚} = Mğ‘â¿ {ğ­ = tâ‚‚ âˆ· tâ‚ âˆ· []} {ğ¬ = sâ‚‚ âˆ· sâ‚ âˆ· []}

Mğœ‹â‚€Â² : âˆ€{tâ‚‚ tâ‚ A B m} {Î“ : Cx m}
     â†’ Î“ âŠ¢ tâ‚‚ âˆ¶ tâ‚ âˆ¶ (A âˆ§ B)
     â†’ Î“ âŠ¢ ğœ‹â‚€Â² tâ‚‚ âˆ¶ ğœ‹â‚€ tâ‚ âˆ¶ A
Mğœ‹â‚€Â² {tâ‚‚} {tâ‚} = Mğœ‹â‚€â¿ {ğ­ = tâ‚‚ âˆ· tâ‚ âˆ· []}

Mğœ‹â‚Â² : âˆ€{tâ‚‚ tâ‚ A B m} {Î“ : Cx m}
     â†’ Î“ âŠ¢ tâ‚‚ âˆ¶ tâ‚ âˆ¶ (A âˆ§ B)
     â†’ Î“ âŠ¢ ğœ‹â‚Â² tâ‚‚ âˆ¶ ğœ‹â‚ tâ‚ âˆ¶ B
Mğœ‹â‚Â² {tâ‚‚} {tâ‚} = Mğœ‹â‚â¿ {ğ­ = tâ‚‚ âˆ· tâ‚ âˆ· []}

Mâ‡‘Â²  : âˆ€{tâ‚‚ tâ‚ u A m} {Î“ : Cx m}
     â†’ Î“ âŠ¢ tâ‚‚ âˆ¶ tâ‚ âˆ¶ u âˆ¶ A
     â†’ Î“ âŠ¢ â‡‘Â² tâ‚‚ âˆ¶ â‡‘ tâ‚ âˆ¶ ! u âˆ¶ u âˆ¶ A
Mâ‡‘Â² {tâ‚‚} {tâ‚} = Mâ‡‘â¿ {ğ­ = tâ‚‚ âˆ· tâ‚ âˆ· []}

Mâ‡“Â²  : âˆ€{tâ‚‚ tâ‚ u A m} {Î“ : Cx m}
     â†’ Î“ âŠ¢ tâ‚‚ âˆ¶ tâ‚ âˆ¶ u âˆ¶ A
     â†’ Î“ âŠ¢ â‡“Â² tâ‚‚ âˆ¶ â‡“ tâ‚ âˆ¶ A
Mâ‡“Â² {tâ‚‚} {tâ‚} = Mâ‡“â¿ {ğ­ = tâ‚‚ âˆ· tâ‚ âˆ· []}


-- --------------------------------------------------------------------------
--
-- Example terms for level 0, 1, and 2 IKS combinators


-- S4: A âŠƒ A
eIâ° : âˆ€{A}
    â†’ âŠ© A âŠƒ A
eIâ° = Mğœ†â° (Mğ‘£â° Z)

-- S4: â–¡(A âŠƒ A)
eIÂ¹ : âˆ€{A x}
    â†’ âŠ© ğœ† x Â· ğ‘£ x
        âˆ¶ (A âŠƒ A)
eIÂ¹ = Mğœ†Â¹ (Mğ‘£Â¹ Z)

-- S4: â–¡â–¡(A âŠƒ A)
eIÂ² : âˆ€{A x u}
    â†’ âŠ© ğœ†Â² u Â· ğ‘£ u
        âˆ¶ ğœ† x Â· ğ‘£ x
          âˆ¶ (A âŠƒ A)
eIÂ² = Mğœ†Â² (Mğ‘£Â² Z)


-- S4: A âŠƒ B âŠƒ A
eKâ° : âˆ€{A B}
    â†’ âŠ© A âŠƒ B âŠƒ A
eKâ° = Mğœ†â° (Mğœ†â° (Mğ‘£â° (S Z)))

-- S4: â–¡(A âŠƒ B âŠƒ A)
eKÂ¹ : âˆ€{A B x y}
    â†’ âŠ© ğœ† x Â· ğœ† y Â· ğ‘£ x
        âˆ¶ (A âŠƒ B âŠƒ A)
eKÂ¹ = Mğœ†Â¹ (Mğœ†Â¹ (Mğ‘£Â¹ (S Z)))

-- S4: â–¡â–¡(A âŠƒ B âŠƒ A)
eKÂ² : âˆ€{A B x y u v}
    â†’ âŠ© ğœ†Â² u Â· ğœ†Â² v Â· ğ‘£ u
        âˆ¶ ğœ† x Â· ğœ† y Â· ğ‘£ x
          âˆ¶ (A âŠƒ B âŠƒ A)
eKÂ² = Mğœ†Â² (Mğœ†Â² (Mğ‘£Â² (S Z)))


-- S4: (A âŠƒ B âŠƒ C) âŠƒ (A âŠƒ B) âŠƒ A âŠƒ C
eSâ° : âˆ€{A B C}
    â†’ âŠ© (A âŠƒ B âŠƒ C) âŠƒ (A âŠƒ B) âŠƒ A âŠƒ C
eSâ° = Mğœ†â° (Mğœ†â° (Mğœ†â° (Mâˆ˜â° (Mâˆ˜â° (Mğ‘£â° (S S Z))
                              (Mğ‘£â° Z))
                    (Mâˆ˜â° (Mğ‘£â° (S Z))
                         (Mğ‘£â° Z)))))

-- S4: â–¡((A âŠƒ B âŠƒ C) âŠƒ (A âŠƒ B) âŠƒ A âŠƒ C)
eSÂ¹ : âˆ€{A B C f g x}
    â†’ âŠ© ğœ† f Â· ğœ† g Â· ğœ† x Â· (ğ‘£ f âˆ˜ ğ‘£ x) âˆ˜ (ğ‘£ g âˆ˜ ğ‘£ x)
        âˆ¶ ((A âŠƒ B âŠƒ C) âŠƒ (A âŠƒ B) âŠƒ A âŠƒ C)
eSÂ¹ = Mğœ†Â¹ (Mğœ†Â¹ (Mğœ†Â¹ (Mâˆ˜Â¹ (Mâˆ˜Â¹ (Mğ‘£Â¹ (S S Z))
                              (Mğ‘£Â¹ Z))
                    (Mâˆ˜Â¹ (Mğ‘£Â¹ (S Z))
                         (Mğ‘£Â¹ Z)))))

-- S4: â–¡â–¡((A âŠƒ B âŠƒ C) âŠƒ (A âŠƒ B) âŠƒ A âŠƒ C)
eSÂ² : âˆ€{A B C f g x p q u}
    â†’ âŠ© ğœ†Â² p Â· ğœ†Â² q Â· ğœ†Â² u Â· (ğ‘£ p âˆ˜Â² ğ‘£ u) âˆ˜Â² (ğ‘£ q âˆ˜Â² ğ‘£ u)
        âˆ¶ ğœ† f Â· ğœ† g Â· ğœ† x Â· (ğ‘£ f âˆ˜ ğ‘£ x) âˆ˜ (ğ‘£ g âˆ˜ ğ‘£ x)
          âˆ¶ ((A âŠƒ B âŠƒ C) âŠƒ (A âŠƒ B) âŠƒ A âŠƒ C)
eSÂ² = Mğœ†Â² (Mğœ†Â² (Mğœ†Â² (Mâˆ˜Â² (Mâˆ˜Â² (Mğ‘£Â² (S S Z))
                              (Mğ‘£Â² Z))
                    (Mâˆ˜Â² (Mğ‘£Â² (S Z))
                         (Mğ‘£Â² Z)))))


-- --------------------------------------------------------------------------
--
-- Example terms for S4 axioms


-- S4: â–¡(A âŠƒ B) âŠƒ â–¡A âŠƒ â–¡B
axKâ° : âˆ€{A B f x}
     â†’ âŠ© (f âˆ¶ (A âŠƒ B)) âŠƒ x âˆ¶ A âŠƒ (f âˆ˜ x) âˆ¶ B
axKâ° = Mğœ†â° (Mğœ†â° (Mâˆ˜Â¹ (Mğ‘£â° (S Z))
                     (Mğ‘£â° Z)))

-- S4: â–¡(â–¡(A âŠƒ B) âŠƒ â–¡A âŠƒ â–¡B)
axKÂ¹ : âˆ€{A B f x p u}
     â†’ âŠ© ğœ† p Â· ğœ† u Â· ğ‘£ p âˆ˜Â² ğ‘£ u
         âˆ¶ (f âˆ¶ (A âŠƒ B) âŠƒ x âˆ¶ A âŠƒ (f âˆ˜ x) âˆ¶ B)
axKÂ¹ = Mğœ†Â¹ (Mğœ†Â¹ (Mâˆ˜Â² (Mğ‘£Â¹ (S Z))
                     (Mğ‘£Â¹ Z)))

-- S4: â–¡A âŠƒ A
axTâ° : âˆ€{A x}
     â†’ âŠ© x âˆ¶ A âŠƒ A
axTâ° = Mğœ†â° (Mâ‡“â° (Mğ‘£Â¹ Z))

-- S4: â–¡A âŠƒ â–¡â–¡A
ax4â° : âˆ€{A x}
     â†’ âŠ© x âˆ¶ A âŠƒ ! x âˆ¶ x âˆ¶ A
ax4â° = Mğœ†â° (Mâ‡‘â° (Mğ‘£Â¹ Z))


-- --------------------------------------------------------------------------
--
-- Terms for example 1, p. 28 [1]


-- S4: â–¡(â–¡A âŠƒ A)
e11 : âˆ€{A x y}
    â†’ âŠ© ğœ† y Â· â‡“ ğ‘£ y
        âˆ¶ (x âˆ¶ A âŠƒ A)
e11 = Mğœ†Â¹ (Mâ‡“Â¹ (Mğ‘£Â² Z))

-- S4: â–¡(â–¡A âŠƒ â–¡â–¡A)
e12 : âˆ€{A x y}
    â†’ âŠ© ğœ† y Â· â‡‘ ğ‘£ y
        âˆ¶ (x âˆ¶ A âŠƒ ! x âˆ¶ x âˆ¶ A)
e12 = Mğœ†Â¹ (Mâ‡‘Â¹ (Mğ‘£Â² Z))

-- S4: â–¡â–¡(A âŠƒ B âŠƒ A âˆ§ B)
e13 : âˆ€{A B x y u v}
    â†’ âŠ© ğœ†Â² u Â· ğœ†Â² v Â· ğ‘Â²âŸ¨ ğ‘£ u , ğ‘£ v âŸ©
        âˆ¶ ğœ† x Â· ğœ† y Â· ğ‘âŸ¨ ğ‘£ x , ğ‘£ y âŸ©
          âˆ¶ (A âŠƒ B âŠƒ A âˆ§ B)
e13 = Mğœ†Â² (Mğœ†Â² (Mğ‘Â² (Mğ‘£Â² (S Z))
                    (Mğ‘£Â² Z)))

-- S4: â–¡(â–¡A âŠƒ â–¡B âŠƒ â–¡â–¡(A âˆ§ B))
e14 : âˆ€{A B x y u v}
    â†’ âŠ© ğœ† u Â· ğœ† v Â· â‡‘ ğ‘Â²âŸ¨ ğ‘£ u , ğ‘£ v âŸ©
        âˆ¶ (x âˆ¶ A âŠƒ y âˆ¶ B âŠƒ ! ğ‘âŸ¨ x , y âŸ© âˆ¶ ğ‘âŸ¨ x , y âŸ© âˆ¶ (A âˆ§ B))
e14 = Mğœ†Â¹ (Mğœ†Â¹ (Mâ‡‘Â¹ (Mğ‘Â² (Mğ‘£Â¹ (S Z))
                         (Mğ‘£Â¹ Z))))


-- --------------------------------------------------------------------------
--
-- Additional example terms


-- S4: â–¡(â–¡A âŠƒ â–¡B âŠƒ â–¡(A âˆ§ B))
ex1 : âˆ€{A B x y u v}
    â†’ âŠ© ğœ† u Â· ğœ† v Â· ğ‘Â²âŸ¨ ğ‘£ u , ğ‘£ v âŸ©
        âˆ¶ (x âˆ¶ A âŠƒ y âˆ¶ B âŠƒ ğ‘âŸ¨ x , y âŸ© âˆ¶ (A âˆ§ B))
ex1 = Mğœ†Â¹ (Mğœ†Â¹ (Mğ‘Â² (Mğ‘£Â¹ (S Z))
                    (Mğ‘£Â¹ Z)))

-- S4: â–¡(â–¡A âˆ§ â–¡B âŠƒ â–¡â–¡(A âˆ§ B))
ex2 : âˆ€{A B x y u}
    â†’ âŠ© ğœ† u Â· â‡‘ ğ‘Â²âŸ¨ ğœ‹â‚€ ğ‘£ u , ğœ‹â‚ ğ‘£ u âŸ©
        âˆ¶ (x âˆ¶ A âˆ§ y âˆ¶ B âŠƒ ! ğ‘âŸ¨ x , y âŸ© âˆ¶ ğ‘âŸ¨ x , y âŸ© âˆ¶ (A âˆ§ B))
ex2 = Mğœ†Â¹ (Mâ‡‘Â¹ (Mğ‘Â² (Mğœ‹â‚€Â¹ (Mğ‘£Â¹ Z))
                    (Mğœ‹â‚Â¹ (Mğ‘£Â¹ Z))))

-- S4: â–¡(â–¡A âˆ§ â–¡B âŠƒ â–¡(A âˆ§ B))
ex3 : âˆ€{A B x y u}
    â†’ âŠ© ğœ† u Â· ğ‘Â²âŸ¨ ğœ‹â‚€ ğ‘£ u , ğœ‹â‚ ğ‘£ u âŸ©
        âˆ¶ (x âˆ¶ A âˆ§ y âˆ¶ B âŠƒ ğ‘âŸ¨ x , y âŸ© âˆ¶ (A âˆ§ B))
ex3 = Mğœ†Â¹ (Mğ‘Â² (Mğœ‹â‚€Â¹ (Mğ‘£Â¹ Z))
               (Mğœ‹â‚Â¹ (Mğ‘£Â¹ Z)))


-- --------------------------------------------------------------------------
--
-- Terms for example 2, pp. 31â€“32 [1]


e2 : âˆ€{A xâ‚ƒ xâ‚‚ xâ‚}
   â†’ âŠ© ğœ†Â² xâ‚ƒ Â· â‡“Â² â‡‘Â² ğ‘£ xâ‚ƒ
       âˆ¶ ğœ† xâ‚‚ Â· â‡“ â‡‘ ğ‘£ xâ‚‚
         âˆ¶ (xâ‚ âˆ¶ A âŠƒ xâ‚ âˆ¶ A)
e2 = Mğœ†Â² (Mâ‡“Â² (Mâ‡‘Â² (Mğ‘£Â² Z)))

e2â€² : âˆ€{A xâ‚ƒ xâ‚‚ xâ‚}
    â†’ âŠ© ğœ†Â² xâ‚ƒ Â· ğ‘£ xâ‚ƒ
        âˆ¶ ğœ† xâ‚‚ Â· ğ‘£ xâ‚‚
          âˆ¶ (xâ‚ âˆ¶ A âŠƒ xâ‚ âˆ¶ A)
e2â€² = Mğœ†Â² (Mğ‘£Â² Z)


-- --------------------------------------------------------------------------
--
-- Weakening


data _â‰²_ : âˆ€{m mâ€²} â†’ Cx m â†’ Cx mâ€² â†’ Set where
  base : âˆ… â‰² âˆ…

  drop : âˆ€{A m mâ€²} {Î“ : Cx m} {Î“â€² : Cx mâ€²}
       â†’ Î“ â‰² Î“â€²
       â†’ Î“ â‰² (Î“â€² , A)

  keep : âˆ€{A m mâ€²} {Î“ : Cx m} {Î“â€² : Cx mâ€²}
       â†’ Î“ â‰² Î“â€²
       â†’ (Î“ , A) â‰² (Î“â€² , A)


âˆ…â‰²Î“ : âˆ€{m} {Î“ : Cx m} â†’ âˆ… â‰² Î“
âˆ…â‰²Î“ {Î“ = âˆ…}     = base
âˆ…â‰²Î“ {Î“ = Î“ , A} = drop âˆ…â‰²Î“


Î“â‰²Î“ : âˆ€{m} {Î“ : Cx m} â†’ Î“ â‰² Î“
Î“â‰²Î“ {Î“ = âˆ…}     = base
Î“â‰²Î“ {Î“ = Î“ , A} = keep Î“â‰²Î“


wkâˆˆ : âˆ€{A m mâ€²} {Î“ : Cx m} {Î“â€² : Cx mâ€²}
    â†’ Î“ â‰² Î“â€²    â†’ A âˆˆ Î“
    â†’ A âˆˆ Î“â€²
wkâˆˆ base     ()
wkâˆˆ (keep P) Z     = Z
wkâˆˆ (keep P) (S i) = S (wkâˆˆ P i)
wkâˆˆ (drop P) i     = S (wkâˆˆ P i)


wkâŠ¢ : âˆ€{A m mâ€²} {Î“ : Cx m} {Î“â€² : Cx mâ€²}
    â†’ Î“ â‰² Î“â€²    â†’ Î“ âŠ¢ A
    â†’ Î“â€² âŠ¢ A
wkâŠ¢ P (Mğ‘£â¿  {ğ­ = ğ­} i)         = Mğ‘£â¿  {ğ­ = ğ­} (wkâˆˆ P i)
wkâŠ¢ P (Mğœ†â¿  {ğ± = ğ±} {ğ­} D)     = Mğœ†â¿  {ğ± = ğ±} {ğ­} (wkâŠ¢ (keep P) D)
wkâŠ¢ P (Mâˆ˜â¿  {ğ­ = ğ­} {ğ¬} Dâ‚œ Dâ‚›) = Mâˆ˜â¿  {ğ­ = ğ­} {ğ¬} (wkâŠ¢ P Dâ‚œ) (wkâŠ¢ P Dâ‚›)
wkâŠ¢ P (Mğ‘â¿  {ğ­ = ğ­} {ğ¬} Dâ‚œ Dâ‚›) = Mğ‘â¿  {ğ­ = ğ­} {ğ¬} (wkâŠ¢ P Dâ‚œ) (wkâŠ¢ P Dâ‚›)
wkâŠ¢ P (Mğœ‹â‚€â¿ {ğ­ = ğ­} D)         = Mğœ‹â‚€â¿ {ğ­ = ğ­} (wkâŠ¢ P D)
wkâŠ¢ P (Mğœ‹â‚â¿ {ğ­ = ğ­} D)         = Mğœ‹â‚â¿ {ğ­ = ğ­} (wkâŠ¢ P D)
wkâŠ¢ P (Mâ‡‘â¿  {ğ­ = ğ­} D)         = Mâ‡‘â¿  {ğ­ = ğ­} (wkâŠ¢ P D)
wkâŠ¢ P (Mâ‡“â¿  {ğ­ = ğ­} D)         = Mâ‡“â¿  {ğ­ = ğ­} (wkâŠ¢ P D)


-- --------------------------------------------------------------------------
--
-- Contraction


data _â‰³_ : âˆ€{m mâ€²} â†’ Cx m â†’ Cx mâ€² â†’ Set where
  base : âˆ… â‰³ âˆ…

  once : âˆ€{A m mâ€²} {Î“ : Cx m} {Î“â€² : Cx mâ€²}
       â†’ Î“ â‰³ Î“â€²
       â†’ (Î“ , A) â‰³ (Î“â€² , A)

  more : âˆ€{A m mâ€²} {Î“ : Cx m} {Î“â€² : Cx mâ€²}
       â†’ Î“ â‰³ Î“â€²
       â†’ (Î“ , A , A) â‰³ (Î“â€² , A)


cnâˆˆ : âˆ€{A m mâ€²} {Î“ : Cx m} {Î“â€² : Cx mâ€²}
    â†’ Î“ â‰³ Î“â€²    â†’ A âˆˆ Î“
    â†’ A âˆˆ Î“â€²
cnâˆˆ base     ()
cnâˆˆ (once P) Z     = Z
cnâˆˆ (once P) (S i) = S (cnâˆˆ P i)
cnâˆˆ (more P) Z     = Z
cnâˆˆ (more P) (S i) = cnâˆˆ (once P) i


cnâŠ¢ : âˆ€{A m mâ€²} {Î“ : Cx m} {Î“â€² : Cx mâ€²}
    â†’ Î“ â‰³ Î“â€²    â†’ Î“ âŠ¢ A
    â†’ Î“â€² âŠ¢ A
cnâŠ¢ P (Mğ‘£â¿  {ğ­ = ğ­} i)         = Mğ‘£â¿  {ğ­ = ğ­} (cnâˆˆ P i)
cnâŠ¢ P (Mğœ†â¿  {ğ± = ğ±} {ğ­} D)     = Mğœ†â¿  {ğ± = ğ±} {ğ­} (cnâŠ¢ (once P) D)
cnâŠ¢ P (Mâˆ˜â¿  {ğ­ = ğ­} {ğ¬} Dâ‚œ Dâ‚›) = Mâˆ˜â¿  {ğ­ = ğ­} {ğ¬} (cnâŠ¢ P Dâ‚œ) (cnâŠ¢ P Dâ‚›)
cnâŠ¢ P (Mğ‘â¿  {ğ­ = ğ­} {ğ¬} Dâ‚œ Dâ‚›) = Mğ‘â¿  {ğ­ = ğ­} {ğ¬} (cnâŠ¢ P Dâ‚œ) (cnâŠ¢ P Dâ‚›)
cnâŠ¢ P (Mğœ‹â‚€â¿ {ğ­ = ğ­} D)         = Mğœ‹â‚€â¿ {ğ­ = ğ­} (cnâŠ¢ P D)
cnâŠ¢ P (Mğœ‹â‚â¿ {ğ­ = ğ­} D)         = Mğœ‹â‚â¿ {ğ­ = ğ­} (cnâŠ¢ P D)
cnâŠ¢ P (Mâ‡‘â¿  {ğ­ = ğ­} D)         = Mâ‡‘â¿  {ğ­ = ğ­} (cnâŠ¢ P D)
cnâŠ¢ P (Mâ‡“â¿  {ğ­ = ğ­} D)         = Mâ‡“â¿  {ğ­ = ğ­} (cnâŠ¢ P D)


-- --------------------------------------------------------------------------
--
-- Exchange


data _â‰ˆ_ : âˆ€{m} â†’ Cx m â†’ Cx m â†’ Set where
  base : âˆ… â‰ˆ âˆ…

  just : âˆ€{A m} {Î“ Î“â€² : Cx m}
       â†’ Î“ â‰ˆ Î“â€²
       â†’ (Î“ , A) â‰ˆ (Î“â€² , A)

  same : âˆ€{A B m} {Î“ Î“â€² : Cx m}
       â†’ Î“ â‰ˆ Î“â€²
       â†’ (Î“ , A , B) â‰ˆ (Î“â€² , A , B)

  diff : âˆ€{A B m} {Î“ Î“â€² : Cx m}
       â†’ Î“ â‰ˆ Î“â€²
       â†’ (Î“ , B , A) â‰ˆ (Î“â€² , A , B)


exâˆˆ : âˆ€{A m} {Î“ Î“â€² : Cx m}
    â†’ Î“ â‰ˆ Î“â€²    â†’ A âˆˆ Î“
    â†’ A âˆˆ Î“â€²
exâˆˆ base     ()
exâˆˆ (just P) Z         = Z
exâˆˆ (just P) (S i)     = S (exâˆˆ P i)
exâˆˆ (same P) Z         = Z
exâˆˆ (same P) (S Z)     = S Z
exâˆˆ (same P) (S (S i)) = S (S (exâˆˆ P i))
exâˆˆ (diff P) Z         = S Z
exâˆˆ (diff P) (S Z)     = Z
exâˆˆ (diff P) (S (S i)) = S (S (exâˆˆ P i))


exâŠ¢ : âˆ€{A m} {Î“ Î“â€² : Cx m}
    â†’ Î“ â‰ˆ Î“â€²    â†’ Î“ âŠ¢ A
    â†’ Î“â€² âŠ¢ A
exâŠ¢ P (Mğ‘£â¿  {ğ­ = ğ­} i)         = Mğ‘£â¿  {ğ­ = ğ­} (exâˆˆ P i)
exâŠ¢ P (Mğœ†â¿  {ğ± = ğ±} {ğ­} D)     = Mğœ†â¿  {ğ± = ğ±} {ğ­} (exâŠ¢ (just P) D)
exâŠ¢ P (Mâˆ˜â¿  {ğ­ = ğ­} {ğ¬} Dâ‚œ Dâ‚›) = Mâˆ˜â¿  {ğ­ = ğ­} {ğ¬} (exâŠ¢ P Dâ‚œ) (exâŠ¢ P Dâ‚›)
exâŠ¢ P (Mğ‘â¿  {ğ­ = ğ­} {ğ¬} Dâ‚œ Dâ‚›) = Mğ‘â¿  {ğ­ = ğ­} {ğ¬} (exâŠ¢ P Dâ‚œ) (exâŠ¢ P Dâ‚›)
exâŠ¢ P (Mğœ‹â‚€â¿ {ğ­ = ğ­} D)         = Mğœ‹â‚€â¿ {ğ­ = ğ­} (exâŠ¢ P D)
exâŠ¢ P (Mğœ‹â‚â¿ {ğ­ = ğ­} D)         = Mğœ‹â‚â¿ {ğ­ = ğ­} (exâŠ¢ P D)
exâŠ¢ P (Mâ‡‘â¿  {ğ­ = ğ­} D)         = Mâ‡‘â¿  {ğ­ = ğ­} (exâŠ¢ P D)
exâŠ¢ P (Mâ‡“â¿  {ğ­ = ğ­} D)         = Mâ‡“â¿  {ğ­ = ğ­} (exâŠ¢ P D)


-- --------------------------------------------------------------------------
--
-- Theorem 1 (Internalisation principle), p. 29 [1]


prefix : âˆ€{m} â†’ Vars m â†’ Cx m â†’ Cx m
prefix []      âˆ…       = âˆ…
prefix (x âˆ· ğ±) (Î“ , A) = prefix ğ± Î“ , ğ‘£ x âˆ¶ A


postulate fresh : Var    -- XXX: Fix this!


inâˆˆ : âˆ€{A m} {ğ± : Vars m} {Î“ : Cx m}
    â†’ A âˆˆ Î“
    â†’ Î£ Var (Î» x â†’ (ğ‘£ x âˆ¶ A) âˆˆ prefix ğ± Î“)
inâˆˆ {ğ± = []}    ()
inâˆˆ {ğ± = x âˆ· _} Z     = âŸ¨ x , Z âŸ©
inâˆˆ {ğ± = _ âˆ· ğ±} (S i) = let âŸ¨ y , j âŸ© = inâˆˆ {ğ± = ğ±} i
                        in
                          âŸ¨ y , S j âŸ©


inâŠ¢ : âˆ€{A m} {ğ± : Vars m} {Î“ : Cx m}
    â†’ Î“ âŠ¢ A
    â†’ Î£ (Vars m â†’ Tm) (Î» t â†’ prefix ğ± Î“ âŠ¢ t ğ± âˆ¶ A)

inâŠ¢ {ğ± = ğ±} (Mğ‘£â¿ {ğ­ = ğ­} i)
    = let âŸ¨ x , j âŸ© = inâˆˆ {ğ± = ğ±} i
      in
        âŸ¨ (Î» _ â†’ ğ‘£ x)
        , Mğ‘£â¿ {ğ­ = ğ‘£ x âˆ· ğ­} j
        âŸ©

inâŠ¢ {ğ± = ğ±} (Mğœ†â¿ {n} {ğ± = ğ²} {ğ­} D)
    = let xâ‚˜â‚Šâ‚      = fresh
          âŸ¨ s , C âŸ© = inâŠ¢ {ğ± = xâ‚˜â‚Šâ‚ âˆ· ğ±} D
      in
        âŸ¨ (Î» ğ± â†’ ğœ†[ suc n ] xâ‚˜â‚Šâ‚ Â· s (xâ‚˜â‚Šâ‚ âˆ· ğ±))
        , Mğœ†â¿ {ğ± = xâ‚˜â‚Šâ‚ âˆ· ğ²} {ğ­ = s (xâ‚˜â‚Šâ‚ âˆ· ğ±) âˆ· ğ­} C
        âŸ©

inâŠ¢ {ğ± = ğ±} (Mâˆ˜â¿ {n} {ğ­} {ğ¬} Dâ‚œ Dâ‚›)
    = let âŸ¨ sâ‚œ , Câ‚œ âŸ© = inâŠ¢ {ğ± = ğ±} Dâ‚œ
          âŸ¨ sâ‚› , Câ‚› âŸ© = inâŠ¢ {ğ± = ğ±} Dâ‚›
      in
        âŸ¨ (Î» ğ± â†’ sâ‚œ ğ± âˆ˜[ suc n ] sâ‚› ğ±)
        , Mâˆ˜â¿ {ğ­ = sâ‚œ ğ± âˆ· ğ­} {ğ¬ = sâ‚› ğ± âˆ· ğ¬} Câ‚œ Câ‚›
        âŸ©

inâŠ¢ {ğ± = ğ±} (Mğ‘â¿ {n} {ğ­} {ğ¬} Dâ‚œ Dâ‚›)
    = let âŸ¨ sâ‚œ , Câ‚œ âŸ© = inâŠ¢ {ğ± = ğ±} Dâ‚œ
          âŸ¨ sâ‚› , Câ‚› âŸ© = inâŠ¢ {ğ± = ğ±} Dâ‚›
      in
        âŸ¨ (Î» ğ± â†’ ğ‘[ suc n ]âŸ¨ sâ‚œ ğ± , sâ‚› ğ± âŸ©)
        , Mğ‘â¿ {ğ­ = sâ‚œ ğ± âˆ· ğ­} {ğ¬ = sâ‚› ğ± âˆ· ğ¬} Câ‚œ Câ‚›
        âŸ©

inâŠ¢ {ğ± = ğ±} (Mğœ‹â‚€â¿ {n} {ğ­} D)
    = let âŸ¨ s , C âŸ© = inâŠ¢ {ğ± = ğ±} D
      in
        âŸ¨ (Î» ğ± â†’ ğœ‹â‚€[ suc n ] s ğ±)
        , Mğœ‹â‚€â¿ {ğ­ = s ğ± âˆ· ğ­} C
        âŸ©

inâŠ¢ {ğ± = ğ±} (Mğœ‹â‚â¿ {n} {ğ­} D)
    = let âŸ¨ s , C âŸ© = inâŠ¢ {ğ± = ğ±} D
      in
        âŸ¨ (Î» ğ± â†’ ğœ‹â‚[ suc n ] s ğ±)
        , Mğœ‹â‚â¿ {ğ­ = s ğ± âˆ· ğ­} C
        âŸ©

inâŠ¢ {ğ± = ğ±} (Mâ‡‘â¿ {n} {ğ­} D)
    = let âŸ¨ s , C âŸ© = inâŠ¢ {ğ± = ğ±} D
      in
        âŸ¨ (Î» ğ± â†’ â‡‘[ suc n ] s ğ±)
        , Mâ‡‘â¿ {ğ­ = s ğ± âˆ· ğ­} C
        âŸ©

inâŠ¢ {ğ± = ğ±} (Mâ‡“â¿ {n} {ğ­} D)
    = let âŸ¨ s , C âŸ© = inâŠ¢ {ğ± = ğ±} D
      in
        âŸ¨ (Î» ğ± â†’ â‡“[ suc n ] s ğ±)
        , Mâ‡“â¿ {ğ­ = s ğ± âˆ· ğ­} C
        âŸ©


-- --------------------------------------------------------------------------
--
-- Constructive necessitation


nec : âˆ€{A}
    â†’ âˆ… âŠ¢ A
    â†’ Î£ Tm (Î» t â†’ âŠ© t âˆ¶ A)
nec D = let âŸ¨ s , C âŸ© = inâŠ¢ D
        in
          âŸ¨ s [] , wkâŠ¢ âˆ…â‰²Î“ C âŸ©


eIÂ¹â€² : âˆ€{A}
     â†’ Î£ Tm (Î» t â†’ âŠ© t âˆ¶ (A âŠƒ A))
eIÂ¹â€² = nec eIâ°

eIÂ²â€² : âˆ€{x A}
     â†’ Î£ Tm (Î» t â†’ âŠ© t âˆ¶ ğœ† x Â· ğ‘£ x âˆ¶ (A âŠƒ A))
eIÂ²â€² = nec eIÂ¹

eIÂ³â€² : âˆ€{u x A}
     â†’ Î£ Tm (Î» t â†’ âŠ© t âˆ¶ ğœ†Â² u Â· ğ‘£ u âˆ¶ ğœ† x Â· ğ‘£ x âˆ¶ (A âŠƒ A))
eIÂ³â€² = nec eIÂ²


eIÂ²â€³ : âˆ€{A}
     â†’ Î£ Tm (Î» t â†’ âŠ© t âˆ¶ ğœ† fresh Â· ğ‘£ fresh âˆ¶ (A âŠƒ A))    -- XXX: Fix this!
eIÂ²â€³ = nec (projâ‚‚ (eIÂ¹â€²))

eIÂ³â€³ : âˆ€{A}
     â†’ Î£ Tm (Î» t â†’ âŠ© t âˆ¶ ğœ†Â² fresh Â· ğ‘£ fresh âˆ¶ ğœ† fresh Â· ğ‘£ fresh âˆ¶ (A âŠƒ A))    -- XXX: Fix this!
eIÂ³â€³ = nec (projâ‚‚ (eIÂ²â€²))
