{-

An implementation of the Alt-ArtÃ«mov system Î»âˆ

MiÃ«tek Bak <mietek@bak.io>

Checked with Agda 2.4.2.5

For easy editing with Emacs agda-mode, add to your .emacs file:
 '(agda-input-user-translations
   (quote 
    (("N" "â„•")
     ("not" "Â¬") ("imp" "âŠƒ") ("iff" "âŠƒâŠ‚") ("ent" "âŠ¢") ("thm" "âŠ©") 
     ("x" "ğ’™") ("y" "ğ’š") ("t" "ğ’•") ("s" "ğ’”") ("A" "ğ‘¨")
     ("*n" "â‹†â¿") (",n" ",â¿")
     ("v" "ğ‘£") ("v2" "ğ‘£Â²") ("vn" "ğ‘£â¿")
     ("l" "ğœ†") ("l2" "ğœ†Â²") ("ln" "ğœ†â¿") ("." "ï¼")
     ("o2" "âˆ˜Â²") ("on" "âˆ˜â¿")
     ("p" "ğ‘") ("p2" "ğ‘Â²") ("pn" "ğ‘â¿")
     ("1" "ğœ‹â‚€") ("12" "ğœ‹â‚€Â²") ("1n" "ğœ‹â‚€â¿")
     ("2" "ğœ‹â‚") ("12" "ğœ‹â‚Â²") ("2n" "ğœ‹â‚â¿")
     ("u" "â‡‘") ("u2" "â‡‘Â²") ("un" "â‡‘â¿")
     ("d" "â‡“") ("d2" "â‡“Â²") ("dn" "â‡“â¿"))))

Alt, J., ArtÃ«mov, S. (2001) Reflective Î»-calculus, Proceedings of the
2001 International Seminar on Proof Theory in Computer Science (PTCSâ€™01),
Lecture Notes in Computer Science, vol. 2183, pp. 22â€“37.
http://dx.doi.org/10.1007/3-540-45504-3_2

-}

{-# OPTIONS --no-termination-check #-}    -- XXX: Temporary! Only for Theorem 1!

module AltArtemov where

open import Data.Nat using (â„• ; zero ; suc)
open import Data.Product using (Î£ ; _,_ ; projâ‚ ; projâ‚‚ ; _Ã—_)

infixl 9 _âˆ˜_ _âˆ˜Â²_ _âˆ˜^[_]_
infixr 8 ğ‘£_ !_ â‡“_ â‡‘_ â‡“Â²_ â‡‘Â²_ â‡“^[_]_ â‡‘^[_]_ 
infixr 7 ğœ†_ï¼_ ğœ†Â²_ï¼_ ğœ†^[_]_ï¼_
infixr 6 _âˆ¶_ _âˆ·_
infixr 5 Â¬_
infixl 4 _âˆ§_
infixr 3 _âŠƒ_ _âŠƒâŠ‚_
infixl 2 _,_
infixr 1 _âˆˆ_ _âŠ†_
infixr 0 _âŠ¢_ âŠ©_


------------------------------------------------------------------------------

-- Generic lists

data List (X : Set) : Set where
  âˆ…   :                        List X
  _,_ : (L : List X) (x : X) â†’ List X

data _âˆˆ_ {X : Set} (x : X) : List X â†’ Set where
  Z : {L : List X}         â†’ x âˆˆ L , x
  S : {L : List X} {y : X} â†’ x âˆˆ L â†’ x âˆˆ L , y


-- Generic vectors

data Vec (X : Set) : â„• â†’ Set where
  âˆ…   :                                  Vec X zero
  _âˆ·_ : (xâ‚™ : X) {n : â„•} (ğ’™ : Vec X n) â†’ Vec X (suc n)

foldl : {n : â„•} {X Y : Set}
      â†’ (f : Y â†’ X â†’ Y) (ğ’™ : Vec X n) (y : Y) â†’ Y
foldl f âˆ…        y = y
foldl f (xâ‚™ âˆ· ğ’™) y = f (foldl f ğ’™ y) xâ‚™

foldr : {n : â„•} {X Y : Set}
      â†’ (f : X â†’ Y â†’ Y) (ğ’™ : Vec X n) (y : Y) â†’ Y
foldr f âˆ…        y = y
foldr f (xâ‚™ âˆ· ğ’™) y = f xâ‚™ (foldr f ğ’™ y)

map# : {n : â„•} {X Y : Set}
     â†’ (f : â„• â†’ X â†’ Y) (ğ’™ : Vec X n) â†’ Vec Y n
map# {zero}  f âˆ…        = âˆ…
map# {suc n} f (xâ‚™ âˆ· ğ’™) = f (suc n) xâ‚™ âˆ· map# f ğ’™

map : {n : â„•} {X Y : Set}
    â†’ (f : X â†’ Y) (ğ’™ : Vec X n) â†’ Vec Y n
map f ğ’™ = map# (Î» _ x â†’ f x) ğ’™

map2# : {n : â„•} {X Y Z : Set}
      â†’ (f : â„• â†’ X â†’ Y â†’ Z) (ğ’™ : Vec X n) (ğ’š : Vec Y n) â†’ Vec Z n
map2# {zero}  f âˆ…        âˆ…        = âˆ…
map2# {suc n} f (xâ‚™ âˆ· ğ’™) (yâ‚™ âˆ· ğ’š) = f (suc n) xâ‚™ yâ‚™ âˆ· map2# f ğ’™ ğ’š

map2 : {n : â„•} {X Y Z : Set}
     â†’ (f : X â†’ Y â†’ Z) (ğ’™ : Vec X n) (ğ’š : Vec Y n) â†’ Vec Z n
map2 f ğ’™ ğ’š = map2# (Î» _ x y â†’ f x y) ğ’™ ğ’š


------------------------------------------------------------------------------

-- Untyped syntax

mutual

  -- Variables

  Var : Set
  Var = â„•


  -- Term constructors

  data Tm : Set where
    ğ‘£_         : (x : Var)                  â†’ Tm    -- Variable
    ğœ†^[_]_ï¼_   : (n : â„•) (x : Var) (t : Tm) â†’ Tm    -- Abstraction
    _âˆ˜^[_]_    : (t : Tm) (n : â„•) (s : Tm)  â†’ Tm    -- Application
    ğ‘^[_]âŸ¨_,_âŸ© : (n : â„•) (t s : Tm)         â†’ Tm    -- Pairing
    ğœ‹â‚€^[_]_    : (n : â„•) (t : Tm)           â†’ Tm    -- Left projection
    ğœ‹â‚^[_]_    : (n : â„•) (t : Tm)           â†’ Tm    -- Right projection
    !_         : (t : Tm)                   â†’ Tm    -- Proof checking
    â‡‘^[_]_     : (n : â„•) (t : Tm)           â†’ Tm    -- Reification
    â‡“^[_]_     : (n : â„•) (t : Tm)           â†’ Tm    -- Reflection


  -- Type constructors

  data Ty : Set where
    âŠ¥   :                     Ty    -- Falsehood
    _âŠƒ_ : (A B : Ty)        â†’ Ty    -- Implication
    _âˆ§_ : (A B : Ty)        â†’ Ty    -- Conjunction
    _âˆ¶_ : (x : Tm) (A : Ty) â†’ Ty    -- Provability


-- Additional types

âŠ¤ : Ty                    -- Truth
âŠ¤ = âŠ¥ âŠƒ âŠ¥

Â¬_ : (A : Ty) â†’ Ty        -- Negation
Â¬ A = A âŠƒ âŠ¥

_âŠƒâŠ‚_ : (A B : Ty) â†’ Ty    -- Equivalence
A âŠƒâŠ‚ B = A âŠƒ B âˆ§ B âŠƒ A


------------------------------------------------------------------------------

-- Typing contexts

Cx : Set
Cx = List Ty


-- Vectors

VVar : â„• â†’ Set
VVar n = Vec Var n

VTm : â„• â†’ Set
VTm n = Vec Tm n

VTy : â„• â†’ Set
VTy n = Vec Ty n


-- Vector notation for nesting contexts

_,â¿_ : (Î“ : Cx) {n : â„•} (ğ‘¨ : VTy n) â†’ Cx
_,â¿_ Î“ ğ‘¨ = foldl _,_ ğ‘¨ Î“

_,,â¿_âˆ¶_ : {n : â„•} (Î“ : Cx) (ğ’™ : VVar n) (ğ‘¨ : VTy n) â†’ Cx
Î“ ,,â¿ âˆ…        âˆ¶ âˆ…        = Î“
Î“ ,,â¿ (xâ‚™ âˆ· ğ’™) âˆ¶ (Aâ‚™ âˆ· ğ‘¨) = (Î“ ,,â¿ ğ’™ âˆ¶ ğ‘¨) , (ğ‘£ xâ‚™ âˆ¶ Aâ‚™)


-- Vector notation for nesting terms inside types

â‹†â¿_âˆ¶_ : {n : â„•} (ğ’• : VTm n) (A : Ty) â†’ Ty
â‹†â¿ ğ’• âˆ¶ A = foldr _âˆ¶_ ğ’• A


-- Vector notation for nesting term constructors inside types

ğ‘£â¿_âˆ¶_ : {n : â„•} (ğ’™ : VVar n) (A : Ty) â†’ Ty
ğ‘£â¿ ğ’™ âˆ¶ A = â‹†â¿ (map ğ‘£_ ğ’™) âˆ¶ A

ğœ†â¿_ï¼_âˆ¶_ : {n : â„•} (ğ’™ : VVar n) (ğ’• : VTm n) (A : Ty) â†’ Ty
ğœ†â¿ ğ’™ ï¼ ğ’• âˆ¶ A = â‹†â¿ (map2# ğœ†^[_]_ï¼_ ğ’™ ğ’•) âˆ¶ A

_âˆ˜â¿_âˆ¶_ : {n : â„•} (ğ’• ğ’” : VTm n) (A : Ty) â†’ Ty
ğ’• âˆ˜â¿ ğ’” âˆ¶ A = â‹†â¿ (map2# (Î» n t s â†’ t âˆ˜^[ n ] s) ğ’• ğ’”) âˆ¶ A

ğ‘â¿âŸ¨_,_âŸ©âˆ¶_ : {n : â„•} (ğ’• ğ’” : VTm n) (A : Ty) â†’ Ty
ğ‘â¿âŸ¨ ğ’• , ğ’” âŸ©âˆ¶ A = â‹†â¿ (map2# ğ‘^[_]âŸ¨_,_âŸ© ğ’• ğ’”) âˆ¶ A

ğœ‹â‚€â¿_âˆ¶_ : {n : â„•} (ğ’• : VTm n) (A : Ty) â†’ Ty
ğœ‹â‚€â¿ ğ’• âˆ¶ A = â‹†â¿ (map# ğœ‹â‚€^[_]_ ğ’•) âˆ¶ A

ğœ‹â‚â¿_âˆ¶_ : {n : â„•} (ğ’• : VTm n) (A : Ty) â†’ Ty
ğœ‹â‚â¿ ğ’• âˆ¶ A = â‹†â¿ (map# ğœ‹â‚^[_]_ ğ’•) âˆ¶ A

â‡‘â¿_âˆ¶_ : {n : â„•} (ğ’• : VTm n) (A : Ty) â†’ Ty
â‡‘â¿ ğ’• âˆ¶ A = â‹†â¿ (map# â‡‘^[_]_ ğ’•) âˆ¶ A

â‡“â¿_âˆ¶_ : {n : â„•} (ğ’• : VTm n) (A : Ty) â†’ Ty
â‡“â¿ ğ’• âˆ¶ A = â‹†â¿ (map# â‡“^[_]_ ğ’•) âˆ¶ A


-- Typing rules

data _âŠ¢_ (Î“ : Cx) : Ty â†’ Set where
  Rğ‘£â¿  : {n : â„•} {ğ’™ : VVar n} {A : Ty}
       â†’ ğ‘£â¿ ğ’™ âˆ¶ A âˆˆ Î“
       â†’ Î“ âŠ¢ ğ‘£â¿ ğ’™ âˆ¶ A

  Rğœ†â¿  : {n : â„•} {ğ’™ : VVar n} {ğ’• : VTm n} {A B : Ty}
       â†’ Î“ , ğ‘£â¿ ğ’™ âˆ¶ A âŠ¢ â‹†â¿ ğ’• âˆ¶ B
       â†’ Î“ âŠ¢ ğœ†â¿ ğ’™ ï¼ ğ’• âˆ¶ (A âŠƒ B)

  Râˆ˜â¿  : {n : â„•} {ğ’• ğ’” : VTm n} {A B : Ty}
       â†’ Î“ âŠ¢ â‹†â¿ ğ’• âˆ¶ (A âŠƒ B)    â†’ Î“ âŠ¢ â‹†â¿ ğ’” âˆ¶ A
       â†’ Î“ âŠ¢ ğ’• âˆ˜â¿ ğ’” âˆ¶ B

  Rğ‘â¿  : {n : â„•} {ğ’• ğ’” : VTm n} {A B : Ty}
       â†’ Î“ âŠ¢ â‹†â¿ ğ’• âˆ¶ A    â†’ Î“ âŠ¢ â‹†â¿ ğ’” âˆ¶ B
       â†’ Î“ âŠ¢ ğ‘â¿âŸ¨ ğ’• , ğ’” âŸ©âˆ¶ (A âˆ§ B)

  Rğœ‹â‚€â¿ : {n : â„•} {ğ’• : VTm n} {A B : Ty}
       â†’ Î“ âŠ¢ â‹†â¿ ğ’• âˆ¶ (A âˆ§ B)
       â†’ Î“ âŠ¢ ğœ‹â‚€â¿ ğ’• âˆ¶ A

  Rğœ‹â‚â¿ : {n : â„•} {ğ’• : VTm n} {A B : Ty}
       â†’ Î“ âŠ¢ â‹†â¿ ğ’• âˆ¶ (A âˆ§ B)
       â†’ Î“ âŠ¢ ğœ‹â‚â¿ ğ’• âˆ¶ B

  Râ‡‘â¿  : {n : â„•} {ğ’• : VTm n} {u : Tm} {A : Ty}
       â†’ Î“ âŠ¢ â‹†â¿ ğ’• âˆ¶ (u âˆ¶ A)
       â†’ Î“ âŠ¢ â‡‘â¿ ğ’• âˆ¶ (! u âˆ¶ u âˆ¶ A)

  Râ‡“â¿  : {n : â„•} {ğ’• : VTm n} {u : Tm} {A : Ty}
       â†’ Î“ âŠ¢ â‹†â¿ ğ’• âˆ¶ (u âˆ¶ A)
       â†’ Î“ âŠ¢ â‡“â¿ ğ’• âˆ¶ A


-- Theorems

âŠ©_  : (A : Ty) â†’ Set
âŠ© A = {Î“ : Cx} â†’ Î“ âŠ¢ A


------------------------------------------------------------------------------

-- Simple notation for level 0 typing rules

Rğ‘£â° : {A : Ty} {Î“ : Cx}
    â†’ A âˆˆ Î“
    â†’ Î“ âŠ¢ A
Rğ‘£â° = Rğ‘£â¿ {ğ’™ = âˆ…}

Rğœ†â° : {A B : Ty} {Î“ : Cx}
    â†’ Î“ , A âŠ¢ B
    â†’ Î“ âŠ¢ A âŠƒ B
Rğœ†â° = Rğœ†â¿ {ğ’™ = âˆ…} {ğ’• = âˆ…}

Râˆ˜â° : {A B : Ty} {Î“ : Cx}
    â†’ Î“ âŠ¢ A âŠƒ B    â†’ Î“ âŠ¢ A
    â†’ Î“ âŠ¢ B
Râˆ˜â° = Râˆ˜â¿ {ğ’• = âˆ…} {ğ’” = âˆ…}

Rğ‘â° : {A B : Ty} {Î“ : Cx}
    â†’ Î“ âŠ¢ A    â†’ Î“ âŠ¢ B
    â†’ Î“ âŠ¢ A âˆ§ B
Rğ‘â° = Rğ‘â¿ {ğ’• = âˆ…} {ğ’” = âˆ…}

Rğœ‹â‚€â° : {A B : Ty} {Î“ : Cx}
     â†’ Î“ âŠ¢ A âˆ§ B
     â†’ Î“ âŠ¢ A
Rğœ‹â‚€â° = Rğœ‹â‚€â¿ {ğ’• = âˆ…}

Rğœ‹â‚â° : {A B : Ty} {Î“ : Cx}
     â†’ Î“ âŠ¢ A âˆ§ B
     â†’ Î“ âŠ¢ B
Rğœ‹â‚â° = Rğœ‹â‚â¿ {ğ’• = âˆ…}

Râ‡‘â° : {u : Tm} {A : Ty} {Î“ : Cx}
    â†’ Î“ âŠ¢ u âˆ¶ A
    â†’ Î“ âŠ¢ ! u âˆ¶ u âˆ¶ A
Râ‡‘â° = Râ‡‘â¿ {ğ’• = âˆ…}

Râ‡“â° : {u : Tm} {A : Ty} {Î“ : Cx}
    â†’ Î“ âŠ¢ u âˆ¶ A
    â†’ Î“ âŠ¢ A
Râ‡“â° = Râ‡“â¿ {ğ’• = âˆ…}


-- Simple level 0 examples

exmIâ° : {x : Var} {A : Ty}
      â†’ âŠ© A âŠƒ A
exmIâ° = Rğœ†â° (Rğ‘£â° Z)


exmKâ° : {x y : Var} {A B : Ty}
      â†’ âŠ© A âŠƒ B âŠƒ A
exmKâ° = Rğœ†â° (Rğœ†â° (Rğ‘£â° (S Z)))


exmSâ° : {f g x : Var} {A B C : Ty}
      â†’ âŠ© (A âŠƒ B âŠƒ C) âŠƒ (A âŠƒ B) âŠƒ A âŠƒ C
exmSâ° = Rğœ†â° (Rğœ†â° (Rğœ†â° (Râˆ˜â° (Râˆ˜â° (Rğ‘£â° (S (S Z)))
                                (Rğ‘£â° Z))
                           (Râˆ˜â° (Rğ‘£â° (S Z))
                                (Rğ‘£â° Z)))))


------------------------------------------------------------------------------

-- Simple notation for level 1 terms

ğœ†_ï¼_ : (x : Var) (t : Tm) â†’ Tm
ğœ† x ï¼ t = ğœ†^[ 1 ] x ï¼ t

_âˆ˜_ : (t s : Tm) â†’ Tm
t âˆ˜ s = t âˆ˜^[ 1 ] s

ğ‘âŸ¨_,_âŸ© : (t s : Tm) â†’ Tm
ğ‘âŸ¨ t , s âŸ© = ğ‘^[ 1 ]âŸ¨ t , s âŸ©

ğœ‹â‚€_ : (t : Tm) â†’ Tm
ğœ‹â‚€ t = ğœ‹â‚€^[ 1 ] t

ğœ‹â‚_ : (t : Tm) â†’ Tm
ğœ‹â‚ t = ğœ‹â‚^[ 1 ] t

â‡‘_ : (t : Tm) â†’ Tm
â‡‘ t = â‡‘^[ 1 ] t

â‡“_ : (t : Tm) â†’ Tm
â‡“ t = â‡“^[ 1 ] t


-- Simple notation for level 1 typing rules

Rğ‘£ : {x : Var} {A : Ty} {Î“ : Cx}
   â†’ ğ‘£ x âˆ¶ A âˆˆ Î“
   â†’ Î“ âŠ¢ ğ‘£ x âˆ¶ A
Rğ‘£ {x} = Rğ‘£â¿ {ğ’™ = x âˆ· âˆ…}

Rğœ† : {x : Var} {t : Tm} {A B : Ty} {Î“ : Cx}
   â†’ Î“ , (ğ‘£ x âˆ¶ A) âŠ¢ t âˆ¶ B
   â†’ Î“ âŠ¢ ğœ† x ï¼ t âˆ¶ (A âŠƒ B)
Rğœ† {x} {t} = Rğœ†â¿ {ğ’™ = x âˆ· âˆ…} {ğ’• = t âˆ· âˆ…}

Râˆ˜ : {t s : Tm} {A B : Ty} {Î“ : Cx}
   â†’ Î“ âŠ¢ t âˆ¶ (A âŠƒ B)    â†’ Î“ âŠ¢ s âˆ¶ A
   â†’ Î“ âŠ¢ t âˆ˜ s âˆ¶ B
Râˆ˜ {t} {s} = Râˆ˜â¿ {ğ’• = t âˆ· âˆ…} {ğ’” = s âˆ· âˆ…}

Rğ‘ : {t s : Tm} {A B : Ty} {Î“ : Cx}
   â†’ Î“ âŠ¢ t âˆ¶ A    â†’ Î“ âŠ¢ s âˆ¶ B
   â†’ Î“ âŠ¢ ğ‘âŸ¨ t , s âŸ© âˆ¶ (A âˆ§ B)
Rğ‘ {t} {s} = Rğ‘â¿ {ğ’• = t âˆ· âˆ…} {ğ’” = s âˆ· âˆ…}

Rğœ‹â‚€ : {t : Tm} {A B : Ty} {Î“ : Cx}
    â†’ Î“ âŠ¢ t âˆ¶ (A âˆ§ B)
    â†’ Î“ âŠ¢ ğœ‹â‚€ t âˆ¶ A
Rğœ‹â‚€ {t} = Rğœ‹â‚€â¿ {ğ’• = t âˆ· âˆ…}

Rğœ‹â‚ : {t : Tm} {A B : Ty} {Î“ : Cx}
    â†’ Î“ âŠ¢ t âˆ¶ (A âˆ§ B)
    â†’ Î“ âŠ¢ ğœ‹â‚ t âˆ¶ B
Rğœ‹â‚ {t} = Rğœ‹â‚â¿ {ğ’• = t âˆ· âˆ…}

Râ‡‘ : {t u : Tm} {A : Ty} {Î“ : Cx}
   â†’ Î“ âŠ¢ t âˆ¶ u âˆ¶ A
   â†’ Î“ âŠ¢ â‡‘ t âˆ¶ ! u âˆ¶ u âˆ¶ A
Râ‡‘ {t} = Râ‡‘â¿ {ğ’• = t âˆ· âˆ…}

Râ‡“ : {t u : Tm} {A : Ty} {Î“ : Cx}
   â†’ Î“ âŠ¢ t âˆ¶ u âˆ¶ A
   â†’ Î“ âŠ¢ â‡“ t âˆ¶ A
Râ‡“ {t} = Râ‡“â¿ {ğ’• = t âˆ· âˆ…}


-- Simple level 1 examples

exmI : {x : Var} {A : Ty}
     â†’ âŠ© ğœ† x ï¼ ğ‘£ x
         âˆ¶ (A âŠƒ A)
exmI = Rğœ† (Rğ‘£ Z)


exmK : {x y : Var} {A B : Ty}
     â†’ âŠ© ğœ† x ï¼ ğœ† y ï¼ ğ‘£ x
         âˆ¶ (A âŠƒ B âŠƒ A)
exmK = Rğœ† (Rğœ† (Rğ‘£ (S Z)))


exmS : {f g x : Var} {A B C : Ty}
     â†’ âŠ© ğœ† f ï¼ ğœ† g ï¼ ğœ† x ï¼ ((ğ‘£ f) âˆ˜ (ğ‘£ x)) âˆ˜ ((ğ‘£ g) âˆ˜ (ğ‘£ x))
         âˆ¶ ((A âŠƒ B âŠƒ C) âŠƒ (A âŠƒ B) âŠƒ A âŠƒ C)
exmS = Rğœ† (Rğœ† (Rğœ† (Râˆ˜ (Râˆ˜ (Rğ‘£ (S (S Z)))
                          (Rğ‘£ Z))
                      (Râˆ˜ (Rğ‘£ (S Z))
                          (Rğ‘£ Z)))))


------------------------------------------------------------------------------

-- Simple notation for level 2 terms

ğœ†Â²_ï¼_ : (x : Var) (t : Tm) â†’ Tm
ğœ†Â² x ï¼ t = ğœ†^[ 2 ] x ï¼ t

_âˆ˜Â²_ : (t s : Tm) â†’ Tm
t âˆ˜Â² s = t âˆ˜^[ 2 ] s

ğ‘Â²âŸ¨_,_âŸ© : (t s : Tm) â†’ Tm
ğ‘Â²âŸ¨ t , s âŸ© = ğ‘^[ 2 ]âŸ¨ t , s âŸ©

ğœ‹â‚€Â²_ : (t : Tm) â†’ Tm
ğœ‹â‚€Â² t = ğœ‹â‚€^[ 2 ] t

ğœ‹â‚Â²_ : (t : Tm) â†’ Tm
ğœ‹â‚Â² t = ğœ‹â‚^[ 2 ] t

â‡‘Â²_ : (t : Tm) â†’ Tm
â‡‘Â² t = â‡‘^[ 2 ] t

â‡“Â²_ : (t : Tm) â†’ Tm
â‡“Â² t = â‡“^[ 2 ] t


-- Simple notation for level 2 typing rules

Rğ‘£Â² : {xâ‚‚ xâ‚ : Var} {A : Ty} {Î“ : Cx}
    â†’ ğ‘£ xâ‚‚ âˆ¶ ğ‘£ xâ‚ âˆ¶ A âˆˆ Î“
    â†’ Î“ âŠ¢ ğ‘£ xâ‚‚ âˆ¶ ğ‘£ xâ‚ âˆ¶ A
Rğ‘£Â² {xâ‚‚} {xâ‚} = Rğ‘£â¿ {ğ’™ = xâ‚‚ âˆ· xâ‚ âˆ· âˆ…}

Rğœ†Â² : {xâ‚‚ xâ‚ : Var} {tâ‚‚ tâ‚ : Tm} {A B : Ty} {Î“ : Cx}
    â†’ Î“ , (ğ‘£ xâ‚‚ âˆ¶ ğ‘£ xâ‚ âˆ¶ A) âŠ¢ tâ‚‚ âˆ¶ tâ‚ âˆ¶ B
    â†’ Î“ âŠ¢ ğœ†Â² xâ‚‚ ï¼ tâ‚‚ âˆ¶ ğœ† xâ‚ ï¼ tâ‚ âˆ¶ (A âŠƒ B)
Rğœ†Â² {xâ‚‚} {xâ‚} {tâ‚‚} {tâ‚} = Rğœ†â¿ {ğ’™ = xâ‚‚ âˆ· xâ‚ âˆ· âˆ…} {ğ’• = tâ‚‚ âˆ· tâ‚ âˆ· âˆ…}

Râˆ˜Â² : {tâ‚‚ tâ‚ sâ‚‚ sâ‚ : Tm} {A B : Ty} {Î“ : Cx}
    â†’ Î“ âŠ¢ tâ‚‚ âˆ¶ tâ‚ âˆ¶ (A âŠƒ B)    â†’ Î“ âŠ¢ sâ‚‚ âˆ¶ sâ‚ âˆ¶ A
    â†’ Î“ âŠ¢ tâ‚‚ âˆ˜Â² sâ‚‚ âˆ¶ tâ‚ âˆ˜ sâ‚ âˆ¶ B
Râˆ˜Â² {tâ‚‚} {tâ‚} {sâ‚‚} {sâ‚} = Râˆ˜â¿ {ğ’• = tâ‚‚ âˆ· tâ‚ âˆ· âˆ…} {ğ’” = sâ‚‚ âˆ· sâ‚ âˆ· âˆ…}

Rğ‘Â² : {tâ‚‚ tâ‚ sâ‚‚ sâ‚ : Tm} {A B : Ty} {Î“ : Cx}
    â†’ Î“ âŠ¢ tâ‚‚ âˆ¶ tâ‚ âˆ¶ A    â†’ Î“ âŠ¢ sâ‚‚ âˆ¶ sâ‚ âˆ¶ B
    â†’ Î“ âŠ¢ ğ‘Â²âŸ¨ tâ‚‚ , sâ‚‚ âŸ© âˆ¶ ğ‘âŸ¨ tâ‚ , sâ‚ âŸ© âˆ¶ (A âˆ§ B)
Rğ‘Â² {tâ‚‚} {tâ‚} {sâ‚‚} {sâ‚} = Rğ‘â¿ {ğ’• = tâ‚‚ âˆ· tâ‚ âˆ· âˆ…} {ğ’” = sâ‚‚ âˆ· sâ‚ âˆ· âˆ…}

Rğœ‹â‚€Â² : {tâ‚‚ tâ‚ : Tm} {A B : Ty} {Î“ : Cx}
     â†’ Î“ âŠ¢ tâ‚‚ âˆ¶ tâ‚ âˆ¶ (A âˆ§ B)
     â†’ Î“ âŠ¢ ğœ‹â‚€Â² tâ‚‚ âˆ¶ ğœ‹â‚€ tâ‚ âˆ¶ A
Rğœ‹â‚€Â² {tâ‚‚} {tâ‚} = Rğœ‹â‚€â¿ {ğ’• = tâ‚‚ âˆ· tâ‚ âˆ· âˆ…}

Rğœ‹â‚Â² : {tâ‚‚ tâ‚ : Tm} {A B : Ty} {Î“ : Cx}
     â†’ Î“ âŠ¢ tâ‚‚ âˆ¶ tâ‚ âˆ¶ (A âˆ§ B)
     â†’ Î“ âŠ¢ ğœ‹â‚Â² tâ‚‚ âˆ¶ ğœ‹â‚ tâ‚ âˆ¶ B
Rğœ‹â‚Â² {tâ‚‚} {tâ‚} = Rğœ‹â‚â¿ {ğ’• = tâ‚‚ âˆ· tâ‚ âˆ· âˆ…}

Râ‡‘Â² : {tâ‚‚ tâ‚ u : Tm} {A : Ty} {Î“ : Cx}
    â†’ Î“ âŠ¢ tâ‚‚ âˆ¶ tâ‚ âˆ¶ u âˆ¶ A
    â†’ Î“ âŠ¢ â‡‘Â² tâ‚‚ âˆ¶ â‡‘ tâ‚ âˆ¶ ! u âˆ¶ u âˆ¶ A
Râ‡‘Â² {tâ‚‚} {tâ‚} = Râ‡‘â¿ {ğ’• = tâ‚‚ âˆ· tâ‚ âˆ· âˆ…}

Râ‡“Â² : {tâ‚‚ tâ‚ u : Tm} {A : Ty} {Î“ : Cx}
    â†’ Î“ âŠ¢ tâ‚‚ âˆ¶ tâ‚ âˆ¶ u âˆ¶ A
    â†’ Î“ âŠ¢ â‡“Â² tâ‚‚ âˆ¶ â‡“ tâ‚ âˆ¶ A
Râ‡“Â² {tâ‚‚} {tâ‚} = Râ‡“â¿ {ğ’• = tâ‚‚ âˆ· tâ‚ âˆ· âˆ…}


-- Simple level 2 examples

exmIÂ² : {u x : Var} {A : Ty}
      â†’ âŠ© ğœ†Â² u ï¼ ğ‘£ u
          âˆ¶ ğœ† x ï¼ ğ‘£ x
            âˆ¶ (A âŠƒ A)
exmIÂ² = Rğœ†Â² (Rğ‘£Â² Z)


exmKÂ² : {u x v y : Var} {A B : Ty}
      â†’ âŠ© ğœ†Â² u ï¼ ğœ†Â² v ï¼ ğ‘£ u
          âˆ¶ ğœ† x ï¼ ğœ† y ï¼ ğ‘£ x
            âˆ¶ (A âŠƒ B âŠƒ A)
exmKÂ² = Rğœ†Â² (Rğœ†Â² (Rğ‘£Â² (S Z)))


exmSÂ² : {f g x : Var} {A B C : Ty}
      â†’ âŠ© ğœ†Â² f ï¼ ğœ†Â² g ï¼ ğœ†Â² x ï¼ ((ğ‘£ f) âˆ˜Â² (ğ‘£ x)) âˆ˜Â² ((ğ‘£ g) âˆ˜Â² (ğ‘£ x))
          âˆ¶ ğœ† f ï¼ ğœ† g ï¼ ğœ† x ï¼ ((ğ‘£ f) âˆ˜ (ğ‘£ x)) âˆ˜ ((ğ‘£ g) âˆ˜ (ğ‘£ x))
            âˆ¶ ((A âŠƒ B âŠƒ C) âŠƒ (A âŠƒ B) âŠƒ A âŠƒ C)
exmSÂ² = Rğœ†Â² (Rğœ†Â² (Rğœ†Â² (Râˆ˜Â² (Râˆ˜Â² (Rğ‘£Â² (S (S Z)))
                                (Rğ‘£Â² Z))
                           (Râˆ˜Â² (Rğ‘£Â² (S Z))
                                (Rğ‘£Â² Z)))))


------------------------------------------------------------------------------

-- Example 1 (p. 28[1])

exm1a : {x y : Var} {A : Ty}
      â†’ âŠ© ğœ† y ï¼ â‡“ ğ‘£ y
          âˆ¶ (ğ‘£ x âˆ¶ A âŠƒ A)
exm1a = Rğœ† (Râ‡“ (Rğ‘£ Z))

exm1b : {x y : Var} {A : Ty}
      â†’ âŠ© ğœ† y ï¼ â‡‘ ğ‘£ y
          âˆ¶ (ğ‘£ x âˆ¶ A âŠƒ ! ğ‘£ x âˆ¶ ğ‘£ x âˆ¶ A)
exm1b = Rğœ† (Râ‡‘ (Rğ‘£ Z))

exm1c : {u x v y : Var} {A B : Ty}
      â†’ âŠ© ğœ†Â² u ï¼ ğœ†Â² v ï¼ ğ‘Â²âŸ¨ ğ‘£ u , ğ‘£ v âŸ©
          âˆ¶ ğœ† x ï¼ ğœ† y ï¼ ğ‘âŸ¨ ğ‘£ x , ğ‘£ y âŸ©
            âˆ¶ (A âŠƒ B âŠƒ A âˆ§ B)
exm1c = Rğœ†Â² (Rğœ†Â² (Rğ‘Â² (Rğ‘£Â² (S Z))
                      (Rğ‘£Â² Z)))

exm1d : {u x v y : Var} {A B : Ty}
      â†’ âŠ© ğœ† u ï¼ ğœ† v ï¼ â‡‘ ğ‘Â²âŸ¨ ğ‘£ u , ğ‘£ v âŸ©
          âˆ¶ (ğ‘£ x âˆ¶ A âŠƒ ğ‘£ y âˆ¶ B âŠƒ ! ğ‘âŸ¨ ğ‘£ x , ğ‘£ y âŸ© âˆ¶ ğ‘âŸ¨ ğ‘£ x , ğ‘£ y âŸ© âˆ¶ (A âˆ§ B))
exm1d = Rğœ† (Rğœ† (Râ‡‘ (Rğ‘Â² (Rğ‘£ (S Z))
                        (Rğ‘£ Z))))


-- Example 2 (pp. 31â€“32[1])

exm2a : {xâ‚ƒ xâ‚‚ xâ‚ : Var} {A : Ty}
      â†’ âŠ© ğœ†Â² xâ‚ƒ ï¼ â‡“Â² â‡‘Â² ğ‘£ xâ‚ƒ
          âˆ¶ ğœ† xâ‚‚ ï¼ â‡“ â‡‘ ğ‘£ xâ‚‚
            âˆ¶ (ğ‘£ xâ‚ âˆ¶ A âŠƒ ğ‘£ xâ‚ âˆ¶ A)
exm2a = Rğœ†Â² (Râ‡“Â² (Râ‡‘Â² (Rğ‘£Â² Z)))

exm2b : {xâ‚ƒ xâ‚‚ xâ‚ : Var} {A : Ty}
      â†’ âŠ© ğœ†Â² xâ‚ƒ ï¼ ğ‘£ xâ‚ƒ
          âˆ¶ ğœ† xâ‚‚ ï¼ ğ‘£ xâ‚‚
            âˆ¶ (ğ‘£ xâ‚ âˆ¶ A âŠƒ ğ‘£ xâ‚ âˆ¶ A)
exm2b = Rğœ†Â² (Rğ‘£Â² Z)


------------------------------------------------------------------------------

-- Generalised weakening principle

data _âŠ†_ : (Î“ Î“â€² : Cx) â†’ Set where
  base :                                     âˆ… âŠ† âˆ…
  keep : {Î“ Î“â€² : Cx} {A : Ty} â†’ Î“ âŠ† Î“â€² â†’ Î“ , A âŠ† Î“â€² , A
  drop : {Î“ Î“â€² : Cx} {A : Ty} â†’ Î“ âŠ† Î“â€² â†’     Î“ âŠ† Î“â€² , A

weakâˆˆ : {Î“ Î“â€² : Cx} {A : Ty} â†’ Î“ âŠ† Î“â€² â†’ A âˆˆ Î“ â†’ A âˆˆ Î“â€²
weakâˆˆ (keep Î“âŠ†Î“â€²) Z     = Z
weakâˆˆ (keep Î“âŠ†Î“â€²) (S i) = S (weakâˆˆ Î“âŠ†Î“â€² i)
weakâˆˆ (drop Î“âŠ†Î“â€²) i     = S (weakâˆˆ Î“âŠ†Î“â€² i)

weakâŠ¢ : {Î“ Î“â€² : Cx} {A : Ty} â†’ Î“ âŠ† Î“â€² â†’ Î“ âŠ¢ A â†’ Î“â€² âŠ¢ A
weakâŠ¢ Î“âŠ†Î“â€² (Rğ‘£â¿  {_} {ğ’™} i)         = Rğ‘£â¿  {ğ’™ = ğ’™} (weakâˆˆ Î“âŠ†Î“â€² i)
weakâŠ¢ Î“âŠ†Î“â€² (Rğœ†â¿  {_} {ğ’™} {ğ’•} d)     = Rğœ†â¿  {ğ’™ = ğ’™} {ğ’• = ğ’•} (weakâŠ¢ (keep Î“âŠ†Î“â€²) d)
weakâŠ¢ Î“âŠ†Î“â€² (Râˆ˜â¿  {_} {ğ’•} {ğ’”} dâ‚œ dâ‚›) = Râˆ˜â¿  {ğ’• = ğ’•} {ğ’” = ğ’”} (weakâŠ¢ Î“âŠ†Î“â€² dâ‚œ) (weakâŠ¢ Î“âŠ†Î“â€² dâ‚›)
weakâŠ¢ Î“âŠ†Î“â€² (Rğ‘â¿  {_} {ğ’•} {ğ’”} dâ‚œ dâ‚›) = Rğ‘â¿  {ğ’• = ğ’•} {ğ’” = ğ’”} (weakâŠ¢ Î“âŠ†Î“â€² dâ‚œ) (weakâŠ¢ Î“âŠ†Î“â€² dâ‚›)
weakâŠ¢ Î“âŠ†Î“â€² (Rğœ‹â‚€â¿ {_} {ğ’•} d)         = Rğœ‹â‚€â¿ {ğ’• = ğ’•} (weakâŠ¢ Î“âŠ†Î“â€² d)
weakâŠ¢ Î“âŠ†Î“â€² (Rğœ‹â‚â¿ {_} {ğ’•} d)         = Rğœ‹â‚â¿ {ğ’• = ğ’•} (weakâŠ¢ Î“âŠ†Î“â€² d)
weakâŠ¢ Î“âŠ†Î“â€² (Râ‡‘â¿  {_} {ğ’•} d)         = Râ‡‘â¿  {ğ’• = ğ’•} (weakâŠ¢ Î“âŠ†Î“â€² d)
weakâŠ¢ Î“âŠ†Î“â€² (Râ‡“â¿  {_} {ğ’•} d)         = Râ‡“â¿  {ğ’• = ğ’•} (weakâŠ¢ Î“âŠ†Î“â€² d)


------------------------------------------------------------------------------

-- Theorem 1.  Internalisation principle

-- "Note that the set of axioms is thus also defined inductively according
-- to Î»âˆ: as soon as we are able to establish that F is a type we are
-- entitled to use variables of type F as new axioms."

postulate
  lem1 : {x : Var} {m : â„•} {ğ’™ : VVar m} {A B : Ty} {Î“ : Cx}    -- XXX: How to prove this?
       â†’ Î“ ,     ğ‘£â¿ ğ’™ âˆ¶ A âŠ¢ B
       â†’ Î“ , ğ‘£â¿ x âˆ· ğ’™ âˆ¶ A âŠ¢ B

  lem2 : {n m : â„•} {ğ‘¨ : VTy m} {ğ’š : VVar n} {A B : Ty} {Î“ : Cx}    -- XXX: How to prove this?
       â†’ (Î“ ,â¿ ğ‘¨) , ğ‘£â¿ ğ’š âˆ¶ A âŠ¢ B
       â†’ Î“ ,â¿ (ğ‘£â¿ ğ’š âˆ¶ A âˆ· ğ‘¨) âŠ¢ B

fresh : {m : â„•} {ğ’™ : VVar m} â†’ Var
fresh {m} = suc m    -- XXX: Prove freshness!


-- "Let Î»âˆ derive
--   Aâ‚, Aâ‚‚, â€¦, Aâ‚˜ âŠ¢ B.
-- Then one can build a well-defined term t(xâ‚, xâ‚‚, â€¦, xâ‚˜) with fresh
-- variables ğ’™ such that Î»âˆ also derives
--   xâ‚ âˆ¶ Aâ‚, xâ‚‚ âˆ¶ Aâ‚‚, â€¦, xâ‚˜ âˆ¶ Aâ‚˜ âŠ¢ t(xâ‚, xâ‚‚, â€¦, xâ‚˜) âˆ¶ B."

{-
thm1 : {m : â„•} {ğ‘¨ : VTy m} {B : Ty} {Î“ : Cx}
     â†’ Î“ ,â¿ ğ‘¨ âŠ¢ B
     â†’ Î£ (VVar m â†’ Tm) (Î» t â†’ {ğ’™ : VVar m} â†’ (Î“ ,,â¿ ğ’™ âˆ¶ ğ‘¨) âŠ¢ t ğ’™ âˆ¶ B)

thm1 {_} {ğ‘¨} (Rğ‘£â¿ {_} {ğ’š} D) = {!!}    -- XXX: How to prove this?

thm1 {_} {ğ‘¨} (Rğœ†â¿ {n} {ğ’š} {ğ’•} {A} D) =
  let s , E = thm1 {ğ‘¨ = ğ‘£â¿ ğ’š âˆ¶ A âˆ· ğ‘¨} (lem2 {ğ‘¨ = ğ‘¨} {ğ’š = ğ’š} D)    -- XXX: Does this terminate?
  in  (Î» ğ’™ â†’ let xâ‚˜â‚Šâ‚ = fresh {ğ’™ = ğ’™}
             in  ğœ†^[ suc n ] xâ‚˜â‚Šâ‚ ï¼ s (xâ‚˜â‚Šâ‚ âˆ· ğ’™))
    , (Î» {ğ’™} â†’ let xâ‚˜â‚Šâ‚ = fresh {ğ’™ = ğ’™}
               in  Rğœ†â¿ {ğ’™ = xâ‚˜â‚Šâ‚ âˆ· ğ’š} {ğ’• = s (xâ‚˜â‚Šâ‚ âˆ· ğ’™) âˆ· ğ’•} E)

thm1 {_} {ğ‘¨} (Râˆ˜â¿ {n} {ğ’•} {ğ’”} Dâ‚œ Dâ‚›) =
  let sâ‚œ , Eâ‚œ = thm1 {ğ‘¨ = ğ‘¨} Dâ‚œ
      sâ‚› , Eâ‚› = thm1 {ğ‘¨ = ğ‘¨} Dâ‚›
  in  (Î» ğ’™ â†’ sâ‚œ ğ’™ âˆ˜^[ suc n ] sâ‚› ğ’™)
    , (Î» {ğ’™} â†’ Râˆ˜â¿ {ğ’• = sâ‚œ ğ’™ âˆ· ğ’•} {ğ’” = sâ‚› ğ’™ âˆ· ğ’”} Eâ‚œ Eâ‚›)
    
thm1 {_} {ğ‘¨} (Rğ‘â¿ {n} {ğ’•} {ğ’”} Dâ‚œ Dâ‚›) =
  let sâ‚œ , Eâ‚œ = thm1 {ğ‘¨ = ğ‘¨} Dâ‚œ
      sâ‚› , Eâ‚› = thm1 {ğ‘¨ = ğ‘¨} Dâ‚›
  in  (Î» ğ’™ â†’ ğ‘^[ suc n ]âŸ¨ sâ‚œ ğ’™ , sâ‚› ğ’™ âŸ©)
    , (Î» {ğ’™} â†’ Rğ‘â¿ {ğ’• = sâ‚œ ğ’™ âˆ· ğ’•} {ğ’” = sâ‚› ğ’™ âˆ· ğ’”} Eâ‚œ Eâ‚›)
    
thm1 {_} {ğ‘¨} (Rğœ‹â‚€â¿ {n} {ğ’•} D) =
  let s , E = thm1 {ğ‘¨ = ğ‘¨} D
  in  (Î» ğ’™ â†’ ğœ‹â‚€^[ suc n ] s ğ’™)
    , (Î» {ğ’™} â†’ Rğœ‹â‚€â¿ {ğ’• = s ğ’™ âˆ· ğ’•} E)
    
thm1 {_} {ğ‘¨} (Rğœ‹â‚â¿ {n} {ğ’•} D) =
  let s , E = thm1 {ğ‘¨ = ğ‘¨} D
  in  (Î» ğ’™ â†’ ğœ‹â‚^[ suc n ] s ğ’™)
    , (Î» {ğ’™} â†’ Rğœ‹â‚â¿ {ğ’• = s ğ’™ âˆ· ğ’•} E)
    
thm1 {_} {ğ‘¨} (Râ‡‘â¿ {n} {ğ’•} D) =
  let s , E = thm1 {ğ‘¨ = ğ‘¨} D
  in  (Î» ğ’™ â†’ â‡‘^[ suc n ] s ğ’™)
    , (Î» {ğ’™} â†’ Râ‡‘â¿ {ğ’• = s ğ’™ âˆ· ğ’•} E)
    
thm1 {_} {ğ‘¨} (Râ‡“â¿ {n} {ğ’•} D) =
  let s , E = thm1 {ğ‘¨ = ğ‘¨} D
  in  (Î» ğ’™ â†’ â‡“^[ suc n ] s ğ’™)
    , (Î» {ğ’™} â†’ Râ‡“â¿ {ğ’• = s ğ’™ âˆ· ğ’•} E)
-}
