{-

An implementation of the Alt-ArtÃ«mov system Î»âˆ
==============================================

MiÃ«tek Bak  <mietek@bak.io>


Work in progress.  Checked with Agda 2.4.2.5.

For easy editing with Emacs agda-mode, add to your .emacs file:

'(agda-input-user-translations
   (quote
    ((":." "âˆµ") ("i" "âŠƒ") ("ii" "â«—") ("e" "âŠ¢") ("ee" "âŠ©") ("n" "Â¬")
     ("v" "ğ‘£") ("l" "ğœ†") ("l2" "ğœ†Â²") ("l3" "ğœ†Â³") ("l4" "ğœ†â´") ("ln" "ğœ†â¿")
     ("o" "âˆ˜") ("o2" "âˆ˜Â²") ("o3" "âˆ˜Â³") ("o4" "âˆ˜â´") ("on" "âˆ˜â¿")
     ("p" "ğ‘") ("p2" "ğ‘Â²") ("p3" "ğ‘Â³") ("p4" "ğ‘â´") ("pn" "ğ‘â¿")
     ("pi" "ğœ‹")
     ("pi0" "ğœ‹â‚€") ("pi02" "ğœ‹â‚€Â²") ("pi03" "ğœ‹â‚€Â³") ("pi04" "ğœ‹â‚€â´") ("pi0n" "ğœ‹â‚€â¿")
     ("pi1" "ğœ‹â‚") ("pi12" "ğœ‹â‚Â²") ("pi13" "ğœ‹â‚Â³") ("pi14" "ğœ‹â‚â´") ("pi1n" "ğœ‹â‚â¿")
     ("u" "â‡‘") ("u2" "â‡‘Â²") ("u3" "â‡‘Â³") ("u4" "â‡‘â´") ("un" "â‡‘â¿")
     ("d" "â‡“") ("d2" "â‡“Â²") ("d3" "â‡“Â³") ("d4" "â‡“â´") ("dn" "â‡“â¿")
     ("b" "â–¡") ("*" "â˜†")
     ("mv" "ğ’—") ("ml" "ğ€") ("ml2" "ğ€Â²") ("ml3" "ğ€Â³") ("ml4" "ğ€â´") ("mln" "ğ€â¿")
     ("mo" "âˆ™") ("mo2" "âˆ™Â²") ("mo3" "âˆ™Â³") ("mo4" "âˆ™â´") ("mon" "âˆ™â¿")
     ("mp" "ğ’‘") ("mp2" "ğ’‘Â²") ("mp3" "ğ’‘Â³") ("mp4" "ğ’‘â´") ("mpn" "ğ’‘â¿")
     ("mpi" "ğ…")
     ("mpi0" "ğ…â‚€") ("mpi02" "ğ…â‚€Â²") ("mpi03" "ğ…â‚€Â³") ("mpi04" "ğ…â‚€â´") ("mpi0n" "ğ…â‚€â¿")
     ("mpi1" "ğ…â‚") ("mpi12" "ğ…â‚Â²") ("mpi13" "ğ…â‚Â³") ("mpi14" "ğ…â‚â´") ("mpi1n" "ğ…â‚â¿")
     ("mu" "â¬†") ("mu2" "â¬†Â²") ("mu3" "â¬†Â³") ("mu4" "â¬†â´") ("mun" "â¬†â¿")
     ("md" "â¬‡") ("md2" "â¬‡Â²") ("md3" "â¬‡Â³") ("md4" "â¬‡â´") ("mdn" "â¬‡â¿")
     ("mb" "â– ") ("m*" "â˜…")
     ("mS" "ğ’") ("mZ" "ğ™")
     ("m0" "ğŸ") ("m1" "ğŸ") ("m2" "ğŸ") ("m3" "ğŸ‘") ("m4" "ğŸ’")
     ("s" "ğ¬") ("t" "ğ­") ("x" "ğ±") ("y" "ğ²")
     ("C" "ğ’") ("D" "ğ’Ÿ")
     ("N" "â„•"))))


[1]: Alt, J., ArtÃ«mov, S. (2001) Reflective Î»-calculus.
     Proceedings of the 2001 International Seminar on Proof Theory in
     Computer Science (PTCSâ€™01), Lecture Notes in Computer Science,
     vol. 2183, pp. 22â€“37.
     http://dx.doi.org/10.1007/3-540-45504-3_2

[2]: ArtÃ«mov, S. (2001) Explicit provability and constructive semantics.
     Bulletin of Symbolic Logic, vol. 7, no. 1, pp. 1â€“36.
     http://dx.doi.org/10.2307/2687821

-}


module AltArtemov where

open import Data.Nat using (â„• ; zero ; suc)
open import Data.Product using (_Ã—_) renaming (_,_ to âŸ¨_,_âŸ©)
open import Data.Vec using (Vec ; [] ; _âˆ·_ ; replicate)

infixl 9 !_ ğ‘£_ ğ’—_
infixl 8 ğœ‹â‚€_ ğœ‹â‚€Â²_ ğœ‹â‚€Â³_ ğœ‹â‚€â´_ ğœ‹â‚€â¿_ ğ…â‚€_ ğ…â‚€Â²_ ğ…â‚€Â³_ ğ…â‚€â´_ ğ…â‚€â¿_
infixl 8 ğœ‹â‚_ ğœ‹â‚Â²_ ğœ‹â‚Â³_ ğœ‹â‚â´_ ğœ‹â‚â¿_ ğ…â‚_ ğ…â‚Â²_ ğ…â‚Â³_ ğ…â‚â´_ ğ…â‚â¿_
infixl 7 _âˆ˜_ _âˆ˜Â²_ _âˆ˜Â³_ _âˆ˜â´_ _âˆ˜â¿_ _âˆ™_ _âˆ™Â²_ _âˆ™Â³_ _âˆ™â´_ _âˆ™â¿_
infixr 6 â‡‘_ â‡‘Â²_ â‡‘Â³_ â‡‘â´_ â‡‘â¿_ â¬†_ â¬†Â²_ â¬†Â³_ â¬†â´_ â¬†â¿_
infixr 6 â‡“_ â‡“Â²_ â‡“Â³_ â‡“â´_ â‡“â¿_ â¬‡_ â¬‡Â²_ â¬‡Â³_ â¬‡â´_ â¬‡â¿_
infixr 5 ğœ†_ ğœ†Â²_ ğœ†Â³_ ğœ†â´_ ğœ†â¿_ ğ€_ ğ€Â²_ ğ€Â³_ ğ€â´_ ğ€â¿_
infixr 4 _âˆ¶_ _âˆµ_
infixr 3 Â¬_
infixl 3 _âˆ§_
infixl 2 _âˆ¨_ _,_ _â€_
infixr 1 _âŠƒ_ _â«—_
infixr 0 _âŠ¢_ âŠ©_


-- --------------------------------------------------------------------------
--
-- Untyped syntax


-- Variables
Var : Set
Var = â„•


-- Term constructors
data Tm : Set where
  -- Variable reference
  ğ‘£_ : Var â†’ Tm

  -- Abstraction (âŠƒI) at level n
  ğœ†[_]_ : â„• â†’ Tm â†’ Tm

  -- Application (âŠƒE) at level n
  _âˆ˜[_]_ : Tm â†’ â„• â†’ Tm â†’ Tm

  -- Pairing (âˆ§I) at level n
  ğ‘[_]âŸ¨_,_âŸ© : â„• â†’ Tm â†’ Tm â†’ Tm

  -- 0th projection (âˆ§Eâ‚€) at level n
  ğœ‹â‚€[_]_ : â„• â†’ Tm â†’ Tm

  -- 1st projection (âˆ§Eâ‚) at level n
  ğœ‹â‚[_]_ : â„• â†’ Tm â†’ Tm

  -- ArtÃ«movâ€™s â€œproof checkerâ€
  !_ : Tm â†’ Tm

  -- Reification at level n
  â‡‘[_]_ : â„• â†’ Tm â†’ Tm

  -- Reflection at level n
  â‡“[_]_ : â„• â†’ Tm â†’ Tm


-- Type constructors
data Ty : Set where
  -- Falsehood
  âŠ¥ : Ty

  -- Implication
  _âŠƒ_ : Ty â†’ Ty â†’ Ty

  -- Conjunction
  _âˆ§_ : Ty â†’ Ty â†’ Ty

  -- Explicit provability
  _âˆ¶_ : Tm â†’ Ty â†’ Ty


-- --------------------------------------------------------------------------
--
-- Example types


-- Truth
âŠ¤ : Ty
âŠ¤ = âŠ¥ âŠƒ âŠ¥

-- Negation
Â¬_ : Ty â†’ Ty
Â¬ A = A âŠƒ âŠ¥

-- Disjunction
_âˆ¨_ : Ty â†’ Ty â†’ Ty
A âˆ¨ B = Â¬ A âŠƒ B

-- Equivalence
_â«—_ : Ty â†’ Ty â†’ Ty
A â«— B = (A âŠƒ B) âˆ§ (B âŠƒ A)


-- --------------------------------------------------------------------------
--
-- Notation for term constructors at level 1


ğœ†_ : Tm â†’ Tm
ğœ† t = ğœ†[ 1 ] t

_âˆ˜_ : Tm â†’ Tm â†’ Tm
t âˆ˜ s = t âˆ˜[ 1 ] s

ğ‘âŸ¨_,_âŸ© : Tm â†’ Tm â†’ Tm
ğ‘âŸ¨ t , s âŸ© = ğ‘[ 1 ]âŸ¨ t , s âŸ©

ğœ‹â‚€_ : Tm â†’ Tm
ğœ‹â‚€ t = ğœ‹â‚€[ 1 ] t

ğœ‹â‚_ : Tm â†’ Tm
ğœ‹â‚ t = ğœ‹â‚[ 1 ] t

â‡‘_ : Tm â†’ Tm
â‡‘ t = â‡‘[ 1 ] t

â‡“_ : Tm â†’ Tm
â‡“ t = â‡“[ 1 ] t


-- --------------------------------------------------------------------------
--
-- Notation for term constructors at level 2


ğœ†Â²_ : Tm â†’ Tm
ğœ†Â² tâ‚‚ = ğœ†[ 2 ] tâ‚‚

_âˆ˜Â²_ : Tm â†’ Tm â†’ Tm
tâ‚‚ âˆ˜Â² sâ‚‚ = tâ‚‚ âˆ˜[ 2 ] sâ‚‚

ğ‘Â²âŸ¨_,_âŸ© : Tm â†’ Tm â†’ Tm
ğ‘Â²âŸ¨ tâ‚‚ , sâ‚‚ âŸ© = ğ‘[ 2 ]âŸ¨ tâ‚‚ , sâ‚‚ âŸ©

ğœ‹â‚€Â²_ : Tm â†’ Tm
ğœ‹â‚€Â² tâ‚‚ = ğœ‹â‚€[ 2 ] tâ‚‚

ğœ‹â‚Â²_ : Tm â†’ Tm
ğœ‹â‚Â² tâ‚‚ = ğœ‹â‚[ 2 ] tâ‚‚

â‡‘Â²_ : Tm â†’ Tm
â‡‘Â² tâ‚‚ = â‡‘[ 2 ] tâ‚‚

â‡“Â²_ : Tm â†’ Tm
â‡“Â² tâ‚‚ = â‡“[ 2 ] tâ‚‚


-- --------------------------------------------------------------------------
--
-- Notation for term constructors at level 3


ğœ†Â³_ : Tm â†’ Tm
ğœ†Â³ tâ‚ƒ = ğœ†[ 3 ] tâ‚ƒ

_âˆ˜Â³_ : Tm â†’ Tm â†’ Tm
tâ‚ƒ âˆ˜Â³ sâ‚ƒ = tâ‚ƒ âˆ˜[ 3 ] sâ‚ƒ

ğ‘Â³âŸ¨_,_âŸ© : Tm â†’ Tm â†’ Tm
ğ‘Â³âŸ¨ tâ‚ƒ , sâ‚ƒ âŸ© = ğ‘[ 3 ]âŸ¨ tâ‚ƒ , sâ‚ƒ âŸ©

ğœ‹â‚€Â³_ : Tm â†’ Tm
ğœ‹â‚€Â³ tâ‚ƒ = ğœ‹â‚€[ 3 ] tâ‚ƒ

ğœ‹â‚Â³_ : Tm â†’ Tm
ğœ‹â‚Â³ tâ‚ƒ = ğœ‹â‚[ 3 ] tâ‚ƒ

â‡‘Â³_ : Tm â†’ Tm
â‡‘Â³ tâ‚ƒ = â‡‘[ 3 ] tâ‚ƒ

â‡“Â³_ : Tm â†’ Tm
â‡“Â³ tâ‚ƒ = â‡“[ 3 ] tâ‚ƒ


-- --------------------------------------------------------------------------
--
-- Notation for term constructors at level 4


ğœ†â´_ : Tm â†’ Tm
ğœ†â´ tâ‚„ = ğœ†[ 4 ] tâ‚„

_âˆ˜â´_ : Tm â†’ Tm â†’ Tm
tâ‚„ âˆ˜â´ sâ‚„ = tâ‚„ âˆ˜[ 4 ] sâ‚„

ğ‘â´âŸ¨_,_âŸ© : Tm â†’ Tm â†’ Tm
ğ‘â´âŸ¨ tâ‚„ , sâ‚„ âŸ© = ğ‘[ 4 ]âŸ¨ tâ‚„ , sâ‚„ âŸ©

ğœ‹â‚€â´_ : Tm â†’ Tm
ğœ‹â‚€â´ tâ‚„ = ğœ‹â‚€[ 4 ] tâ‚„

ğœ‹â‚â´_ : Tm â†’ Tm
ğœ‹â‚â´ tâ‚„ = ğœ‹â‚[ 4 ] tâ‚„

â‡‘â´_ : Tm â†’ Tm
â‡‘â´ tâ‚„ = â‡‘[ 4 ] tâ‚„

â‡“â´_ : Tm â†’ Tm
â‡“â´ tâ‚„ = â‡“[ 4 ] tâ‚„


-- --------------------------------------------------------------------------
--
-- Vector notation for type assertions at level n (p. 27 [1])


map# : âˆ€{n} {X Y : Set}
    â†’ (â„• â†’ X â†’ Y) â†’ Vec X n â†’ Vec Y n
map# {zero}  f []      = []
map# {suc n} f (x âˆ· ğ±) = f (suc n) x âˆ· map# f ğ±

zipWith# : âˆ€{n} {X Y Z : Set}
    â†’ (â„• â†’ X â†’ Y â†’ Z) â†’ Vec X n â†’ Vec Y n â†’ Vec Z n
zipWith# {zero}  f []      []       = []
zipWith# {suc n} f (x âˆ· ğ±) (y âˆ· ğ²) = f (suc n) x y âˆ· zipWith# f ğ± ğ²


-- Term vectors
Tms : â„• â†’ Set
Tms = Vec Tm


-- tâ‚™ âˆ¶ tâ‚™â‚‹â‚ âˆ¶ â€¦ âˆ¶ t âˆ¶ A
_âˆµ_ : âˆ€{n} â†’ Tms n â†’ Ty â†’ Ty
[]      âˆµ A = A
(x âˆ· ğ­) âˆµ A = x âˆ¶ ğ­ âˆµ A

-- ğ‘£ x âˆ¶ ğ‘£ x âˆ¶ â€¦ âˆ¶ ğ‘£ x
ğ‘£[_]_ : (n : â„•) â†’ Var â†’ Tms n
ğ‘£[ n ] x = replicate {n = n} (ğ‘£ x)

-- ğœ†â¿ tâ‚™ âˆ¶ ğœ†â¿â»Â¹ tâ‚™â‚‹â‚ âˆ¶ â€¦ âˆ¶ ğœ† t
ğœ†â¿_ : âˆ€{n} â†’ Tms n â†’ Tms n
ğœ†â¿_ = map# ğœ†[_]_

-- tâ‚™ âˆ˜â¿ sâ‚™ âˆ¶ tâ‚™â‚‹â‚ âˆ˜â¿â»Â¹ âˆ¶ sâ‚™â‚‹â‚ âˆ¶ â€¦ âˆ¶ t âˆ˜ s
_âˆ˜â¿_ : âˆ€{n} â†’ Tms n â†’ Tms n â†’ Tms n
_âˆ˜â¿_ = zipWith# (Î» n t s â†’ t âˆ˜[ n ] s)

-- ğ‘â¿âŸ¨ tâ‚™ , sâ‚™ âŸ© âˆ¶ ğ‘â¿â»Â¹âŸ¨ tâ‚™â‚‹â‚ , sâ‚™â‚‹â‚ âŸ© âˆ¶ â€¦ âˆ¶ pâŸ¨ t , s âŸ©
ğ‘â¿âŸ¨_,_âŸ© : âˆ€{n} â†’ Tms n â†’ Tms n â†’ Tms n
ğ‘â¿âŸ¨_,_âŸ© = zipWith# ğ‘[_]âŸ¨_,_âŸ©

-- ğœ‹â‚€â¿ tâ‚™ âˆ¶ ğœ‹â‚€â¿â»Â¹ tâ‚™â‚‹â‚ âˆ¶ â€¦ âˆ¶ ğœ‹â‚€ t
ğœ‹â‚€â¿_ : âˆ€{n} â†’ Tms n â†’ Tms n
ğœ‹â‚€â¿_ = map# ğœ‹â‚€[_]_

-- ğœ‹â‚â¿ tâ‚™ âˆ¶ ğœ‹â‚â¿â»Â¹ tâ‚™â‚‹â‚ âˆ¶ â€¦ âˆ¶ ğœ‹â‚ t
ğœ‹â‚â¿_ : âˆ€{n} â†’ Tms n â†’ Tms n
ğœ‹â‚â¿_ = map# ğœ‹â‚[_]_

-- â‡‘â¿ tâ‚™ âˆ¶ â‡‘â¿â»Â¹ tâ‚™â‚‹â‚ âˆ¶ â€¦ âˆ¶ â‡‘ t
â‡‘â¿_ : âˆ€{n} â†’ Tms n â†’ Tms n
â‡‘â¿_ = map# â‡‘[_]_

-- â‡“â¿ tâ‚™ âˆ¶ â‡‘â¿â»Â¹ tâ‚™â‚‹â‚ âˆ¶ â€¦ âˆ¶ â‡‘ t
â‡“â¿_ : âˆ€{n} â†’ Tms n â†’ Tms n
â‡“â¿_ = map# â‡“[_]_


-- --------------------------------------------------------------------------
--
-- Typed syntax


-- Hypotheses
Hyp : Set
Hyp = â„• Ã— Ty


-- Contexts
data Cx : Set where
  âˆ…   : Cx
  _,_ : Cx â†’ Hyp â†’ Cx

_â€_ : Cx â†’ Cx â†’ Cx
Î“ â€ âˆ…       = Î“
Î“ â€ (Î” , A) = Î“ â€ Î” , A


-- Context membership evidence
data _âˆˆ[_]_ : Hyp â†’ â„• â†’ Cx â†’ Set where
  ğ™ : âˆ€{A Î“}
      â†’ A âˆˆ[ zero ] (Î“ , A)

  ğ’_ : âˆ€{A B x Î“}
      â†’ A âˆˆ[ x ] Î“
      â†’ A âˆˆ[ suc x ] (Î“ , B)


-- Typed terms
data _âŠ¢_ (Î“ : Cx) : Ty â†’ Set where
  -- Variable reference
  ğ’—_ : âˆ€{n x A}
      â†’ âŸ¨ n , A âŸ© âˆˆ[ x ] Î“
      â†’ Î“ âŠ¢ ğ‘£[ n ] x âˆµ A

  -- Abstraction (âŠƒI) at level n
  ğ€â¿_ : âˆ€{n} {ğ­ : Tms n} {A B}
      â†’ Î“ , âŸ¨ n , A âŸ© âŠ¢ ğ­ âˆµ B
      â†’ Î“ âŠ¢ ğœ†â¿ ğ­ âˆµ (A âŠƒ B)

  -- Application (âŠƒE) at level n
  _âˆ™â¿_ : âˆ€{n} {ğ­ ğ¬ : Tms n} {A B}
      â†’ Î“ âŠ¢ ğ­ âˆµ (A âŠƒ B)    â†’ Î“ âŠ¢ ğ¬ âˆµ A
      â†’ Î“ âŠ¢ ğ­ âˆ˜â¿ ğ¬ âˆµ B

  -- Pairing (âˆ§I) at level n
  ğ’‘â¿âŸ¨_,_âŸ© : âˆ€{n} {ğ­ ğ¬ : Tms n} {A B}
      â†’ Î“ âŠ¢ ğ­ âˆµ A          â†’ Î“ âŠ¢ ğ¬ âˆµ B
      â†’ Î“ âŠ¢ ğ‘â¿âŸ¨ ğ­ , ğ¬ âŸ© âˆµ (A âˆ§ B)

  -- 0th projection (âˆ§Eâ‚€) at level n
  ğ…â‚€â¿_ : âˆ€{n} {ğ­ : Tms n} {A B}
      â†’ Î“ âŠ¢ ğ­ âˆµ (A âˆ§ B)
      â†’ Î“ âŠ¢ ğœ‹â‚€â¿ ğ­ âˆµ A

  -- 1st projection (âˆ§Eâ‚) at level n
  ğ…â‚â¿_ : âˆ€{n} {ğ­ : Tms n} {A B}
      â†’ Î“ âŠ¢ ğ­ âˆµ (A âˆ§ B)
      â†’ Î“ âŠ¢ ğœ‹â‚â¿ ğ­ âˆµ B

  -- Reification at level n
  â¬†â¿_ : âˆ€{n} {ğ­ : Tms n} {u A}
      â†’ Î“ âŠ¢ ğ­ âˆµ (u âˆ¶ A)
      â†’ Î“ âŠ¢ â‡‘â¿ ğ­ âˆµ (! u âˆ¶ u âˆ¶ A)

  -- Reflection at level n
  â¬‡â¿_ : âˆ€{n} {ğ­ : Tms n} {u A}
      â†’ Î“ âŠ¢ ğ­ âˆµ (u âˆ¶ A)
      â†’ Î“ âŠ¢ â‡“â¿ ğ­ âˆµ A


-- Theorems
âŠ©_  : Ty â†’ Set
âŠ© A = âˆ€{Î“} â†’ Î“ âŠ¢ A


-- --------------------------------------------------------------------------
--
-- Notation for context membership evidence


ğŸ : âˆ€{A Î“}
    â†’ A âˆˆ[ 0 ] (Î“ , A)
ğŸ = ğ™

ğŸ : âˆ€{A B Î“}
    â†’ A âˆˆ[ 1 ] (Î“ , A , B)
ğŸ = ğ’ ğŸ

ğŸ : âˆ€{A B C Î“}
    â†’ A âˆˆ[ 2 ] (Î“ , A , B , C)
ğŸ = ğ’ ğŸ

ğŸ‘ : âˆ€{A B C D Î“}
    â†’ A âˆˆ[ 3 ] (Î“ , A , B , C , D)
ğŸ‘ = ğ’ ğŸ

ğŸ’ : âˆ€{A B C D E Î“}
    â†’ A âˆˆ[ 4 ] (Î“ , A , B , C , D , E)
ğŸ’ = ğ’ ğŸ‘


-- --------------------------------------------------------------------------
--
-- Notation for typed terms at level 1


ğ€_ : âˆ€{A B Î“}
    â†’ Î“ , âŸ¨ 0 , A âŸ© âŠ¢ B
    â†’ Î“ âŠ¢ A âŠƒ B
ğ€_ = ğ€â¿_ {ğ­ = []}

_âˆ™_ : âˆ€{A B Î“}
    â†’ Î“ âŠ¢ A âŠƒ B    â†’ Î“ âŠ¢ A
    â†’ Î“ âŠ¢ B
_âˆ™_ = _âˆ™â¿_ {ğ­ = []} {ğ¬ = []}

ğ’‘âŸ¨_,_âŸ© : âˆ€{A B Î“}
    â†’ Î“ âŠ¢ A        â†’ Î“ âŠ¢ B
    â†’ Î“ âŠ¢ A âˆ§ B
ğ’‘âŸ¨_,_âŸ© = ğ’‘â¿âŸ¨_,_âŸ© {ğ­ = []} {ğ¬ = []}

ğ…â‚€_ : âˆ€{A B Î“}
    â†’ Î“ âŠ¢ A âˆ§ B
    â†’ Î“ âŠ¢ A
ğ…â‚€_ = ğ…â‚€â¿_ {ğ­ = []}

ğ…â‚_ : âˆ€{A B Î“}
    â†’ Î“ âŠ¢ A âˆ§ B
    â†’ Î“ âŠ¢ B
ğ…â‚_ = ğ…â‚â¿_ {ğ­ = []}

â¬†_ : âˆ€{u A Î“}
    â†’ Î“ âŠ¢ u âˆ¶ A
    â†’ Î“ âŠ¢ ! u âˆ¶ u âˆ¶ A
â¬†_ = â¬†â¿_ {ğ­ = []}

â¬‡_ : âˆ€{u A Î“}
    â†’ Î“ âŠ¢ u âˆ¶ A
    â†’ Î“ âŠ¢ A
â¬‡_ = â¬‡â¿_ {ğ­ = []}


-- --------------------------------------------------------------------------
--
-- Notation for typed terms at level 2


ğ€Â²_ : âˆ€{t A B Î“}
    â†’ Î“ , âŸ¨ 1 , A âŸ© âŠ¢ t âˆ¶ B
    â†’ Î“ âŠ¢ ğœ† t âˆ¶ (A âŠƒ B)
ğ€Â²_ {t} =
    ğ€â¿_ {ğ­ = t âˆ· []}

_âˆ™Â²_ : âˆ€{t s A B Î“}
    â†’ Î“ âŠ¢ t âˆ¶ (A âŠƒ B)    â†’ Î“ âŠ¢ s âˆ¶ A
    â†’ Î“ âŠ¢ t âˆ˜ s âˆ¶ B
_âˆ™Â²_ {t} {s} =
    _âˆ™â¿_ {ğ­ = t âˆ· []} {ğ¬ = s âˆ· []}

ğ’‘Â²âŸ¨_,_âŸ© : âˆ€{t s A B Î“}
    â†’ Î“ âŠ¢ t âˆ¶ A          â†’ Î“ âŠ¢ s âˆ¶ B
    â†’ Î“ âŠ¢ ğ‘âŸ¨ t , s âŸ© âˆ¶ (A âˆ§ B)
ğ’‘Â²âŸ¨_,_âŸ© {t} {s} =
    ğ’‘â¿âŸ¨_,_âŸ© {ğ­ = t âˆ· []} {ğ¬ = s âˆ· []}

ğ…â‚€Â²_ : âˆ€{t A B Î“}
    â†’ Î“ âŠ¢ t âˆ¶ (A âˆ§ B)
    â†’ Î“ âŠ¢ ğœ‹â‚€ t âˆ¶ A
ğ…â‚€Â²_ {t} =
    ğ…â‚€â¿_ {ğ­ = t âˆ· []}

ğ…â‚Â²_ : âˆ€{t A B Î“}
    â†’ Î“ âŠ¢ t âˆ¶ (A âˆ§ B)
    â†’ Î“ âŠ¢ ğœ‹â‚ t âˆ¶ B
ğ…â‚Â²_ {t} =
    ğ…â‚â¿_ {ğ­ = t âˆ· []}

â¬†Â²_ : âˆ€{t u A Î“}
    â†’ Î“ âŠ¢ t âˆ¶ u âˆ¶ A
    â†’ Î“ âŠ¢ â‡‘ t âˆ¶ ! u âˆ¶ u âˆ¶ A
â¬†Â²_ {t} =
    â¬†â¿_ {ğ­ = t âˆ· []}

â¬‡Â²_ : âˆ€{t u A Î“}
    â†’ Î“ âŠ¢ t âˆ¶ u âˆ¶ A
    â†’ Î“ âŠ¢ â‡“ t âˆ¶ A
â¬‡Â²_ {t} =
    â¬‡â¿_ {ğ­ = t âˆ· []}


-- --------------------------------------------------------------------------
--
-- Notation for typed terms at level 3


ğ€Â³_ : âˆ€{tâ‚‚ t A B Î“}
    â†’ Î“ , âŸ¨ 2 , A âŸ© âŠ¢ tâ‚‚ âˆ¶ t âˆ¶ B
    â†’ Î“ âŠ¢ ğœ†Â² tâ‚‚ âˆ¶ ğœ† t âˆ¶ (A âŠƒ B)
ğ€Â³_ {tâ‚‚} {t} =
    ğ€â¿_ {ğ­ = tâ‚‚ âˆ· t âˆ· []}

_âˆ™Â³_ : âˆ€{tâ‚‚ t sâ‚‚ s A B Î“}
    â†’ Î“ âŠ¢ tâ‚‚ âˆ¶ t âˆ¶ (A âŠƒ B)    â†’ Î“ âŠ¢ sâ‚‚ âˆ¶ s âˆ¶ A
    â†’ Î“ âŠ¢ tâ‚‚ âˆ˜Â² sâ‚‚ âˆ¶ t âˆ˜ s âˆ¶ B
_âˆ™Â³_ {tâ‚‚} {t} {sâ‚‚} {s} =
    _âˆ™â¿_ {ğ­ = tâ‚‚ âˆ· t âˆ· []} {ğ¬ = sâ‚‚ âˆ· s âˆ· []}

ğ’‘Â³âŸ¨_,_âŸ© : âˆ€{tâ‚‚ t sâ‚‚ s A B Î“}
    â†’ Î“ âŠ¢ tâ‚‚ âˆ¶ t âˆ¶ A          â†’ Î“ âŠ¢ sâ‚‚ âˆ¶ s âˆ¶ B
    â†’ Î“ âŠ¢ ğ‘Â²âŸ¨ tâ‚‚ , sâ‚‚ âŸ© âˆ¶ ğ‘âŸ¨ t , s âŸ© âˆ¶ (A âˆ§ B)
ğ’‘Â³âŸ¨_,_âŸ© {tâ‚‚} {t} {sâ‚‚} {s} =
    ğ’‘â¿âŸ¨_,_âŸ© {ğ­ = tâ‚‚ âˆ· t âˆ· []} {ğ¬ = sâ‚‚ âˆ· s âˆ· []}

ğ…â‚€Â³_ : âˆ€{tâ‚‚ t A B Î“}
    â†’ Î“ âŠ¢ tâ‚‚ âˆ¶ t âˆ¶ (A âˆ§ B)
    â†’ Î“ âŠ¢ ğœ‹â‚€Â² tâ‚‚ âˆ¶ ğœ‹â‚€ t âˆ¶ A
ğ…â‚€Â³_ {tâ‚‚} {t} =
    ğ…â‚€â¿_ {ğ­ = tâ‚‚ âˆ· t âˆ· []}

ğ…â‚Â³_ : âˆ€{tâ‚‚ t A B Î“}
    â†’ Î“ âŠ¢ tâ‚‚ âˆ¶ t âˆ¶ (A âˆ§ B)
    â†’ Î“ âŠ¢ ğœ‹â‚Â² tâ‚‚ âˆ¶ ğœ‹â‚ t âˆ¶ B
ğ…â‚Â³_ {tâ‚‚} {t} =
    ğ…â‚â¿_ {ğ­ = tâ‚‚ âˆ· t âˆ· []}

â¬†Â³_ : âˆ€{tâ‚‚ t u A Î“}
    â†’ Î“ âŠ¢ tâ‚‚ âˆ¶ t âˆ¶ u âˆ¶ A
    â†’ Î“ âŠ¢ â‡‘Â² tâ‚‚ âˆ¶ â‡‘ t âˆ¶ ! u âˆ¶ u âˆ¶ A
â¬†Â³_ {tâ‚‚} {t} =
    â¬†â¿_ {ğ­ = tâ‚‚ âˆ· t âˆ· []}

â¬‡Â³_ : âˆ€{tâ‚‚ t u A Î“}
    â†’ Î“ âŠ¢ tâ‚‚ âˆ¶ t âˆ¶ u âˆ¶ A
    â†’ Î“ âŠ¢ â‡“Â² tâ‚‚ âˆ¶ â‡“ t âˆ¶ A
â¬‡Â³_ {tâ‚‚} {t} =
    â¬‡â¿_ {ğ­ = tâ‚‚ âˆ· t âˆ· []}


-- --------------------------------------------------------------------------
--
-- Notation for typed terms at level 4


ğ€â´_ : âˆ€{tâ‚ƒ tâ‚‚ t A B Î“}
    â†’ Î“ , âŸ¨ 3 , A âŸ© âŠ¢ tâ‚ƒ âˆ¶ tâ‚‚ âˆ¶ t âˆ¶ B
    â†’ Î“ âŠ¢ ğœ†Â³ tâ‚ƒ âˆ¶ ğœ†Â² tâ‚‚ âˆ¶ ğœ† t âˆ¶ (A âŠƒ B)
ğ€â´_ {tâ‚ƒ} {tâ‚‚} {t} =
    ğ€â¿_ {ğ­ = tâ‚ƒ âˆ· tâ‚‚ âˆ· t âˆ· []}

_âˆ™â´_ : âˆ€{tâ‚ƒ tâ‚‚ t sâ‚ƒ sâ‚‚ s A B Î“}
    â†’ Î“ âŠ¢ tâ‚ƒ âˆ¶ tâ‚‚ âˆ¶ t âˆ¶ (A âŠƒ B)    â†’ Î“ âŠ¢ sâ‚ƒ âˆ¶ sâ‚‚ âˆ¶ s âˆ¶ A
    â†’ Î“ âŠ¢ tâ‚ƒ âˆ˜Â³ sâ‚ƒ âˆ¶ tâ‚‚ âˆ˜Â² sâ‚‚ âˆ¶ t âˆ˜ s âˆ¶ B
_âˆ™â´_ {tâ‚ƒ} {tâ‚‚} {t} {sâ‚ƒ} {sâ‚‚} {s} =
    _âˆ™â¿_ {ğ­ = tâ‚ƒ âˆ· tâ‚‚ âˆ· t âˆ· []} {ğ¬ = sâ‚ƒ âˆ· sâ‚‚ âˆ· s âˆ· []}

ğ’‘â´âŸ¨_,_âŸ© : âˆ€{tâ‚ƒ tâ‚‚ t sâ‚ƒ sâ‚‚ s A B Î“}
    â†’ Î“ âŠ¢ tâ‚ƒ âˆ¶ tâ‚‚ âˆ¶ t âˆ¶ A          â†’ Î“ âŠ¢ sâ‚ƒ âˆ¶ sâ‚‚ âˆ¶ s âˆ¶ B
    â†’ Î“ âŠ¢ ğ‘Â³âŸ¨ tâ‚ƒ , sâ‚ƒ âŸ© âˆ¶ ğ‘Â²âŸ¨ tâ‚‚ , sâ‚‚ âŸ© âˆ¶ ğ‘âŸ¨ t , s âŸ© âˆ¶ (A âˆ§ B)
ğ’‘â´âŸ¨_,_âŸ© {tâ‚ƒ} {tâ‚‚} {t} {sâ‚ƒ} {sâ‚‚} {s} =
    ğ’‘â¿âŸ¨_,_âŸ© {ğ­ = tâ‚ƒ âˆ· tâ‚‚ âˆ· t âˆ· []} {ğ¬ = sâ‚ƒ âˆ· sâ‚‚ âˆ· s âˆ· []}

ğ…â‚€â´_ : âˆ€{tâ‚ƒ tâ‚‚ t A B Î“}
    â†’ Î“ âŠ¢ tâ‚ƒ âˆ¶ tâ‚‚ âˆ¶ t âˆ¶ (A âˆ§ B)
    â†’ Î“ âŠ¢ ğœ‹â‚€Â³ tâ‚ƒ âˆ¶ ğœ‹â‚€Â² tâ‚‚ âˆ¶ ğœ‹â‚€ t âˆ¶ A
ğ…â‚€â´_ {tâ‚ƒ} {tâ‚‚} {t} =
    ğ…â‚€â¿_ {ğ­ = tâ‚ƒ âˆ· tâ‚‚ âˆ· t âˆ· []}

ğ…â‚â´_ : âˆ€{tâ‚ƒ tâ‚‚ t A B Î“}
    â†’ Î“ âŠ¢ tâ‚ƒ âˆ¶ tâ‚‚ âˆ¶ t âˆ¶ (A âˆ§ B)
    â†’ Î“ âŠ¢ ğœ‹â‚Â³ tâ‚ƒ âˆ¶ ğœ‹â‚Â² tâ‚‚ âˆ¶ ğœ‹â‚ t âˆ¶ B
ğ…â‚â´_ {tâ‚ƒ} {tâ‚‚} {t} =
    ğ…â‚â¿_ {ğ­ = tâ‚ƒ âˆ· tâ‚‚ âˆ· t âˆ· []}

â¬†â´_ : âˆ€{tâ‚ƒ tâ‚‚ t u A Î“}
    â†’ Î“ âŠ¢ tâ‚ƒ âˆ¶ tâ‚‚ âˆ¶ t âˆ¶ u âˆ¶ A
    â†’ Î“ âŠ¢ â‡‘Â³ tâ‚ƒ âˆ¶ â‡‘Â² tâ‚‚ âˆ¶ â‡‘ t âˆ¶ ! u âˆ¶ u âˆ¶ A
â¬†â´_ {tâ‚ƒ} {tâ‚‚} {t} =
    â¬†â¿_ {ğ­ = tâ‚ƒ âˆ· tâ‚‚ âˆ· t âˆ· []}

â¬‡â´_ : âˆ€{tâ‚ƒ tâ‚‚ t u A Î“}
    â†’ Î“ âŠ¢ tâ‚ƒ âˆ¶ tâ‚‚ âˆ¶ t âˆ¶ u âˆ¶ A
    â†’ Î“ âŠ¢ â‡“Â³ tâ‚ƒ âˆ¶ â‡“Â² tâ‚‚ âˆ¶ â‡“ t âˆ¶ A
â¬‡â´_ {tâ‚ƒ} {tâ‚‚} {t} =
    â¬‡â¿_ {ğ­ = tâ‚ƒ âˆ· tâ‚‚ âˆ· t âˆ· []}


-- --------------------------------------------------------------------------
--
-- Quotation


quot : âˆ€{B Î“} â†’ Î“ âŠ¢ B â†’ Tm
quot (ğ’—_ {x = x} i)    = ğ‘£ x
quot (ğ€â¿_ {n} ğ’Ÿ)       = ğœ†[ suc n ] quot ğ’Ÿ
quot (_âˆ™â¿_ {n} ğ’Ÿ ğ’)    = quot ğ’Ÿ âˆ˜[ suc n ] quot ğ’
quot (ğ’‘â¿âŸ¨_,_âŸ© {n} ğ’Ÿ ğ’) = ğ‘[ suc n ]âŸ¨ quot ğ’Ÿ , quot ğ’ âŸ©
quot (ğ…â‚€â¿_ {n} ğ’Ÿ)      = ğœ‹â‚€[ suc n ] quot ğ’Ÿ
quot (ğ…â‚â¿_ {n} ğ’Ÿ)      = ğœ‹â‚[ suc n ] quot ğ’Ÿ
quot (â¬†â¿_ {n} ğ’Ÿ)       = â‡‘[ suc n ] quot ğ’Ÿ
quot (â¬‡â¿_ {n} ğ’Ÿ)       = â‡“[ suc n ] quot ğ’Ÿ


-- --------------------------------------------------------------------------
--
-- Internalisation (theorem 1, p. 29 [1]; lemma 5.4, pp. 9â€“10 [2])


-- A , Aâ‚‚ , â€¦ , Aâ‚˜ â‡’
--   x âˆ¶ A , xâ‚‚ âˆ¶ Aâ‚‚ , â€¦ , xâ‚˜ âˆ¶ Aâ‚˜
prefix : Cx â†’ Cx
prefix âˆ…               = âˆ…
prefix (Î“ , âŸ¨ n , A âŸ©) = prefix Î“ , âŸ¨ suc n , A âŸ©


-- yâ‚™ âˆ¶ yâ‚™â‚‹â‚ âˆ¶ â€¦ âˆ¶ y âˆ¶ Aâ°â‚– âˆˆ A , Aâ‚‚ , â€¦ , Aâ‚˜ â‡’
--   xâ‚– âˆ¶ yâ‚™ âˆ¶ yâ‚™â‚‹â‚ âˆ¶ â€¦ âˆ¶ y âˆ¶ Aâ°â‚– âˆˆ x âˆ¶ A, xâ‚‚ âˆ¶ Aâ‚‚ , â€¦ , xâ‚˜ âˆ¶ Aâ‚˜
intâˆˆ : âˆ€{n x A Î“}
    â†’ âŸ¨ n , A âŸ© âˆˆ[ x ] Î“
    â†’ âŸ¨ suc n , A âŸ© âˆˆ[ x ] prefix Î“
intâˆˆ ğ™     = ğ™
intâˆˆ (ğ’ i) = ğ’ (intâˆˆ i)


-- A , Aâ‚‚ , â€¦ , Aâ‚˜ âŠ¢ B â‡’
--   x âˆ¶ A , xâ‚‚ âˆ¶ Aâ‚‚ , â€¦ xâ‚˜ âˆ¶ Aâ‚˜ âŠ¢ t (x , xâ‚‚ , â€¦ , xâ‚˜) âˆ¶ B
intâŠ¢ : âˆ€{B Î“}
    â†’ (ğ’Ÿ : Î“ âŠ¢ B)
    â†’ prefix Î“ âŠ¢ quot ğ’Ÿ âˆ¶ B

intâŠ¢ (ğ’— i) =
    ğ’— intâˆˆ i

intâŠ¢ (ğ€â¿_ {ğ­ = ğ­} ğ’Ÿ) =
    ğ€â¿_ {ğ­ = quot ğ’Ÿ âˆ· ğ­} (intâŠ¢ ğ’Ÿ)

intâŠ¢ (_âˆ™â¿_ {ğ­ = ğ­} {ğ¬ = ğ¬} ğ’Ÿ ğ’) =
    _âˆ™â¿_ {ğ­ = quot ğ’Ÿ âˆ· ğ­} {ğ¬ = quot ğ’ âˆ· ğ¬} (intâŠ¢ ğ’Ÿ) (intâŠ¢ ğ’)

intâŠ¢ (ğ’‘â¿âŸ¨_,_âŸ© {ğ­ = ğ­} {ğ¬ = ğ¬} ğ’Ÿ ğ’) =
    ğ’‘â¿âŸ¨_,_âŸ© {ğ­ = quot ğ’Ÿ âˆ· ğ­} {ğ¬ = quot ğ’ âˆ· ğ¬} (intâŠ¢ ğ’Ÿ) (intâŠ¢ ğ’)

intâŠ¢ (ğ…â‚€â¿_ {ğ­ = ğ­} ğ’Ÿ) =
    ğ…â‚€â¿_ {ğ­ = quot ğ’Ÿ âˆ· ğ­} (intâŠ¢ ğ’Ÿ)

intâŠ¢ (ğ…â‚â¿_ {ğ­ = ğ­} ğ’Ÿ) =
    ğ…â‚â¿_ {ğ­ = quot ğ’Ÿ âˆ· ğ­} (intâŠ¢ ğ’Ÿ)

intâŠ¢ (â¬†â¿_ {ğ­ = ğ­} ğ’Ÿ) =
    â¬†â¿_ {ğ­ = quot ğ’Ÿ âˆ· ğ­} (intâŠ¢ ğ’Ÿ)

intâŠ¢ (â¬‡â¿_ {ğ­ = ğ­} ğ’Ÿ) =
    â¬‡â¿_ {ğ­ = quot ğ’Ÿ âˆ· ğ­} (intâŠ¢ ğ’Ÿ)


-- --------------------------------------------------------------------------
--
-- Weakening


wkâˆˆ : âˆ€{x A Î”}
    â†’ (Î“ : Cx)    â†’ A âˆˆ[ x ] (âˆ… â€ Î“)
    â†’ A âˆˆ[ x ] (Î” â€ Î“)
wkâˆˆ âˆ…       ()
wkâˆˆ (Î“ , A) ğ™     = ğ™
wkâˆˆ (Î“ , A) (ğ’ i) = ğ’ (wkâˆˆ Î“ i)


wkâŠ¢ : âˆ€{A Î”}
    â†’ (Î“ : Cx)    â†’ âˆ… â€ Î“ âŠ¢ A
    â†’ Î” â€ Î“ âŠ¢ A

wkâŠ¢ Î“ (ğ’— i) =
    ğ’— wkâˆˆ Î“ i

wkâŠ¢ Î“ (ğ€â¿_ {n} {ğ­} {A} ğ’Ÿ) =
    ğ€â¿_ {ğ­ = ğ­} (wkâŠ¢ (Î“ , âŸ¨ n , A âŸ©) ğ’Ÿ)

wkâŠ¢ Î“ (_âˆ™â¿_ {ğ­ = ğ­} {ğ¬ = ğ¬} ğ’Ÿ ğ’) =
    _âˆ™â¿_ {ğ­ = ğ­} {ğ¬} (wkâŠ¢ Î“ ğ’Ÿ) (wkâŠ¢ Î“ ğ’)

wkâŠ¢ Î“ (ğ’‘â¿âŸ¨_,_âŸ© {ğ­ = ğ­} {ğ¬ = ğ¬} ğ’Ÿ ğ’) =
    ğ’‘â¿âŸ¨_,_âŸ© {ğ­ = ğ­} {ğ¬} (wkâŠ¢ Î“ ğ’Ÿ) (wkâŠ¢ Î“ ğ’)

wkâŠ¢ Î“ (ğ…â‚€â¿_ {ğ­ = ğ­} ğ’Ÿ) =
    ğ…â‚€â¿_ {ğ­ = ğ­} (wkâŠ¢ Î“ ğ’Ÿ)

wkâŠ¢ Î“ (ğ…â‚â¿_ {ğ­ = ğ­} ğ’Ÿ) =
    ğ…â‚â¿_ {ğ­ = ğ­} (wkâŠ¢ Î“ ğ’Ÿ)

wkâŠ¢ Î“ (â¬†â¿_ {ğ­ = ğ­} ğ’Ÿ) =
    â¬†â¿_ {ğ­ = ğ­} (wkâŠ¢ Î“ ğ’Ÿ)

wkâŠ¢ Î“ (â¬‡â¿_ {ğ­ = ğ­} ğ’Ÿ) =
    â¬‡â¿_ {ğ­ = ğ­} (wkâŠ¢ Î“ ğ’Ÿ)


-- --------------------------------------------------------------------------
--
-- Constructive necessitation (corollary 5.5, p. 10 [2])


nec : âˆ€{A}
    â†’ (ğ’Ÿ : âˆ… âŠ¢ A)
    â†’ âŠ© quot ğ’Ÿ âˆ¶ A
nec ğ’Ÿ = wkâŠ¢ âˆ… (intâŠ¢ ğ’Ÿ)


-- --------------------------------------------------------------------------
--
-- Examples


-- Theorems of propositional logic
module PL where
  -- A âŠƒ A
  I : âˆ€{A}
      â†’ âŠ© A âŠƒ A
  I = ğ€ ğ’— ğŸ

  -- A âŠƒ B âŠƒ A
  K : âˆ€{A B}
      â†’ âŠ© A âŠƒ B âŠƒ A
  K = ğ€ ğ€ ğ’— ğŸ

  -- (A âŠƒ B âŠƒ C) âŠƒ (A âŠƒ B) âŠƒ A âŠƒ C
  S : âˆ€{A B C}
      â†’ âŠ© (A âŠƒ B âŠƒ C) âŠƒ (A âŠƒ B) âŠƒ A âŠƒ C
  S = ğ€ ğ€ ğ€ (ğ’— ğŸ âˆ™ ğ’— ğŸ) âˆ™ (ğ’— ğŸ âˆ™ ğ’— ğŸ)

  -- A âŠƒ B âŠƒ A âˆ§ B
  X1 : âˆ€{A B}
      â†’ âŠ© A âŠƒ B âŠƒ A âˆ§ B
  X1 = ğ€ ğ€ ğ’‘âŸ¨ ğ’— ğŸ , ğ’— ğŸ âŸ©


-- Theorems derived from theorems of PL
module PLExamples where
  -- â–¡ (A âŠƒ A)
  IÂ² : âˆ€{A}
      â†’ âŠ© ğœ† ğ‘£ 0 âˆ¶ (A âŠƒ A)
  IÂ² = nec PL.I

  -- â–¡ â–¡ (A âŠƒ A)
  IÂ³ : âˆ€{A}
      â†’ âŠ© ğœ†Â² ğ‘£ 0 âˆ¶ ğœ† ğ‘£ 0 âˆ¶ (A âŠƒ A)
  IÂ³ = nec IÂ²

  -- â–¡ (A âŠƒ B âŠƒ A)
  KÂ² : âˆ€{A B}
      â†’ âŠ© ğœ† ğœ† ğ‘£ 1 âˆ¶ (A âŠƒ B âŠƒ A)
  KÂ² = nec PL.K

  -- â–¡ â–¡ (A âŠƒ B âŠƒ A)
  KÂ³ : âˆ€{A B}
      â†’ âŠ© ğœ†Â² ğœ†Â² ğ‘£ 1 âˆ¶ ğœ† ğœ† ğ‘£ 1 âˆ¶ (A âŠƒ B âŠƒ A)
  KÂ³ = nec KÂ²

  -- â–¡ ((A âŠƒ B âŠƒ C) âŠƒ (A âŠƒ B) âŠƒ A âŠƒ C)
  SÂ² : âˆ€{A B C}
      â†’ âŠ© ğœ† ğœ† ğœ† (ğ‘£ 2 âˆ˜ ğ‘£ 0) âˆ˜ (ğ‘£ 1 âˆ˜ ğ‘£ 0)
          âˆ¶ ((A âŠƒ B âŠƒ C) âŠƒ (A âŠƒ B) âŠƒ A âŠƒ C)
  SÂ² = nec PL.S

  -- â–¡ â–¡ ((A âŠƒ B âŠƒ C) âŠƒ (A âŠƒ B) âŠƒ A âŠƒ C)
  SÂ³ : âˆ€{A B C}
      â†’ âŠ© ğœ†Â² ğœ†Â² ğœ†Â² (ğ‘£ 2 âˆ˜Â² ğ‘£ 0) âˆ˜Â² (ğ‘£ 1 âˆ˜Â² ğ‘£ 0)
          âˆ¶ ğœ† ğœ† ğœ† (ğ‘£ 2 âˆ˜ ğ‘£ 0) âˆ˜ (ğ‘£ 1 âˆ˜ ğ‘£ 0)
              âˆ¶ ((A âŠƒ B âŠƒ C) âŠƒ (A âŠƒ B) âŠƒ A âŠƒ C)
  SÂ³ = nec SÂ²


-- Theorems of modal logic S4
module S4 where
  -- â–¡ (A âŠƒ B) âŠƒ â–¡ A âŠƒ â–¡ B
  K : âˆ€{f x A B}
      â†’ âŠ© (f âˆ¶ (A âŠƒ B)) âŠƒ x âˆ¶ A âŠƒ (f âˆ˜ x) âˆ¶ B
  K = ğ€ ğ€ (ğ’— ğŸ âˆ™Â² ğ’— ğŸ)

  -- â–¡ A âŠƒ A
  T : âˆ€{x A}
      â†’ âŠ© x âˆ¶ A âŠƒ A
  T = ğ€ â¬‡ ğ’— ğŸ

  -- â–¡ A âŠƒ â–¡ â–¡ A
  #4 : âˆ€{x A}
      â†’ âŠ© x âˆ¶ A âŠƒ ! x âˆ¶ x âˆ¶ A
  #4 = ğ€ â¬† ğ’— ğŸ

  -- â–¡ A âŠƒ â–¡ B âŠƒ â–¡ â–¡ (A âˆ§ B)
  X1 : âˆ€{x y A B}
      â†’ âŠ© x âˆ¶ A âŠƒ y âˆ¶ B âŠƒ ! ğ‘âŸ¨ x , y âŸ© âˆ¶ ğ‘âŸ¨ x , y âŸ© âˆ¶ (A âˆ§ B)
  X1 = ğ€ ğ€ â¬† ğ’‘Â²âŸ¨ ğ’— ğŸ , ğ’— ğŸ âŸ©

  -- â–¡ A âŠƒ â–¡ B âŠƒ â–¡ (A âˆ§ B)
  X2 : âˆ€{x y A B}
      â†’ âŠ© x âˆ¶ A âŠƒ y âˆ¶ B âŠƒ ğ‘âŸ¨ x , y âŸ© âˆ¶ (A âˆ§ B)
  X2 = ğ€ ğ€ ğ’‘Â²âŸ¨ ğ’— ğŸ , ğ’— ğŸ âŸ©

  -- â–¡ A âˆ§ â–¡ B âŠƒ â–¡ â–¡ (A âˆ§ B)
  X3 : âˆ€{x y A B}
      â†’ âŠ© x âˆ¶ A âˆ§ y âˆ¶ B âŠƒ ! ğ‘âŸ¨ x , y âŸ© âˆ¶ ğ‘âŸ¨ x , y âŸ© âˆ¶ (A âˆ§ B)
  X3 = ğ€ â¬† ğ’‘Â²âŸ¨ ğ…â‚€ ğ’— ğŸ , ğ…â‚ ğ’— ğŸ âŸ©

  -- â–¡ A âˆ§ â–¡ B âŠƒ â–¡ (A âˆ§ B)
  X4 : âˆ€{x y A B}
      â†’ âŠ© x âˆ¶ A âˆ§ y âˆ¶ B âŠƒ ğ‘âŸ¨ x , y âŸ© âˆ¶ (A âˆ§ B)
  X4 = ğ€ ğ’‘Â²âŸ¨ ğ…â‚€ ğ’— ğŸ , ğ…â‚ ğ’— ğŸ âŸ©


-- Theorems derived from theorems of S4
module S4Examples where
  -- â–¡ (â–¡ (A âŠƒ B) âŠƒ â–¡ A âŠƒ â–¡ B)
  KÂ² : âˆ€{f x A B}
      â†’ âŠ© ğœ† ğœ† ğ‘£ 1 âˆ˜Â² ğ‘£ 0 âˆ¶ (f âˆ¶ (A âŠƒ B) âŠƒ x âˆ¶ A âŠƒ (f âˆ˜ x) âˆ¶ B)
  KÂ² = nec S4.K


-- Example 1 (p. 28 [1])
module Example1 where
  -- â–¡ (â–¡ A âŠƒ A)
  E11 : âˆ€{x A}
      â†’ âŠ© ğœ† â‡“ ğ‘£ 0 âˆ¶ (x âˆ¶ A âŠƒ A)
  E11 = nec S4.T

  -- â–¡ (â–¡ A âŠƒ â–¡ â–¡ A)
  E12 : âˆ€{x A}
      â†’ âŠ© ğœ† â‡‘ ğ‘£ 0 âˆ¶ (x âˆ¶ A âŠƒ ! x âˆ¶ x âˆ¶ A)
  E12 = nec S4.#4

  -- â–¡ â–¡ (A âŠƒ B âŠƒ A âˆ§ B)
  E13 : âˆ€{A B}
      â†’ âŠ© ğœ†Â² ğœ†Â² ğ‘Â²âŸ¨ ğ‘£ 1 , ğ‘£ 0 âŸ© âˆ¶ ğœ† ğœ† ğ‘âŸ¨ ğ‘£ 1 , ğ‘£ 0 âŸ© âˆ¶ (A âŠƒ B âŠƒ A âˆ§ B)
  E13 = nec (nec PL.X1)

  -- â–¡ (â–¡ A âŠƒ â–¡ B âŠƒ â–¡ â–¡ (A âˆ§ B))
  E14 : âˆ€{x y A B}
      â†’ âŠ© ğœ† ğœ† â‡‘ ğ‘Â²âŸ¨ ğ‘£ 1 , ğ‘£ 0 âŸ©
          âˆ¶ (x âˆ¶ A âŠƒ y âˆ¶ B âŠƒ ! ğ‘âŸ¨ x , y âŸ© âˆ¶ ğ‘âŸ¨ x , y âŸ© âˆ¶ (A âˆ§ B))
  E14 = nec S4.X1


-- Additional variants of example 1
module Example1a where
  -- â–¡ (â–¡ A âŠƒ â–¡ B âŠƒ â–¡ (A âˆ§ B))
  E14a : âˆ€{x y A B}
      â†’ âŠ© ğœ† ğœ† ğ‘Â²âŸ¨ ğ‘£ 1 , ğ‘£ 0 âŸ© âˆ¶ (x âˆ¶ A âŠƒ y âˆ¶ B âŠƒ ğ‘âŸ¨ x , y âŸ© âˆ¶ (A âˆ§ B))
  E14a = nec S4.X2

  -- â–¡ (â–¡ A âˆ§ â–¡ B âŠƒ â–¡ â–¡ (A âˆ§ B))
  E14c : âˆ€{x y A B}
      â†’ âŠ© ğœ† â‡‘ ğ‘Â²âŸ¨ ğœ‹â‚€ ğ‘£ 0 , ğœ‹â‚ ğ‘£ 0 âŸ©
          âˆ¶ (x âˆ¶ A âˆ§ y âˆ¶ B âŠƒ ! ğ‘âŸ¨ x , y âŸ© âˆ¶ ğ‘âŸ¨ x , y âŸ© âˆ¶ (A âˆ§ B))
  E14c = nec S4.X3

  -- â–¡ (â–¡ A âˆ§ â–¡ B âŠƒ â–¡ (A âˆ§ B))
  E14b : âˆ€{x y A B}
      â†’ âŠ© ğœ† ğ‘Â²âŸ¨ ğœ‹â‚€ ğ‘£ 0 , ğœ‹â‚ ğ‘£ 0 âŸ© âˆ¶ (x âˆ¶ A âˆ§ y âˆ¶ B âŠƒ ğ‘âŸ¨ x , y âŸ© âˆ¶ (A âˆ§ B))
  E14b = nec S4.X4


-- Example 2 (pp. 31â€“32 [1])
module Example2 where
  E2 : âˆ€{x A}
      â†’ âŠ© ğœ†Â² â‡“Â² â‡‘Â² ğ‘£ 0 âˆ¶ ğœ† â‡“ â‡‘ ğ‘£ 0 âˆ¶ (x âˆ¶ A âŠƒ x âˆ¶ A)
  E2 = ğ€Â³ â¬‡Â³ â¬†Â³ ğ’— ğŸ

  E2a : âˆ€{x A}
      â†’ âŠ© ğœ†Â² ğ‘£ 0 âˆ¶ ğœ† ğ‘£ 0 âˆ¶ (x âˆ¶ A âŠƒ x âˆ¶ A)
  E2a = ğ€Â³ ğ’— ğŸ
