{-

An implementation of the Alt-ArtÃ«mov system Î»âˆ
==============================================

MiÃ«tek Bak  <mietek@bak.io>


Work in progress.  Checked with Agda 2.4.2.5.

For easy editing with Emacs agda-mode, add to your .emacs file:

'(agda-input-user-translations
   (quote
    (("i" "âŠƒ") ("ii" "â«—") ("e" "âŠ¢") ("ee" "âŠ©") ("n" "Â¬") ("N" "â„•")
     ("v" "ğ‘£") ("l" "ğœ†") ("l2" "ğœ†Â²") ("l3" "ğœ†Â³") ("ln" "ğœ†â¿")
     ("o" "âˆ˜") ("o2" "âˆ˜Â²") ("o3" "âˆ˜Â³") ("on" "âˆ˜â¿")
     ("p" "ğ‘") ("p2" "ğ‘Â²") ("p3" "ğ‘Â³") ("pn" "ğ‘â¿")
     ("pi0" "ğœ‹â‚€") ("pi02" "ğœ‹â‚€Â²") ("pi03" "ğœ‹â‚€Â³") ("pi0n" "ğœ‹â‚€â¿")
     ("pi1" "ğœ‹â‚") ("pi12" "ğœ‹â‚Â²") ("pi13" "ğœ‹â‚Â³") ("pi1n" "ğœ‹â‚â¿")
     ("u" "â‡‘") ("u2" "â‡‘Â²") ("u3" "â‡‘Â³") ("un" "â‡‘â¿")
     ("d" "â‡“") ("d2" "â‡“Â²") ("d3" "â‡“Â³") ("dn" "â‡“â¿")
     ("mv" "ğ’—") ("ml" "ğ€") ("ml2" "ğ€Â²") ("ml3" "ğ€Â³") ("mln" "ğ€â¿")
     ("mo" "âˆ™") ("mo2" "âˆ™Â²") ("mo3" "âˆ™Â³") ("mon" "âˆ™â¿")
     ("mp" "ğ’‘") ("mp2" "ğ’‘Â²") ("mp3" "ğ’‘Â³") ("mpn" "ğ’‘â¿")
     ("mpi0" "ğ…â‚€") ("mpi02" "ğ…â‚€Â²") ("mpi03" "ğ…â‚€Â³") ("mpi0n" "ğ…â‚€â¿")
     ("mpi1" "ğ…â‚") ("mpi12" "ğ…â‚Â²") ("mpi13" "ğ…â‚Â³") ("mpi1n" "ğ…â‚â¿")
     ("mu" "â¬†") ("mu2" "â¬†Â²") ("mu3" "â¬†Â³") ("mun" "â¬†â¿")
     ("md" "â¬‡") ("md2" "â¬‡Â²") ("md3" "â¬‡Â³") ("mdn" "â¬‡â¿")
     ("mS" "ğ’") ("mZ" "ğ™") ("m0" "ğŸ") ("m1" "ğŸ") ("m2" "ğŸ") ("m3" "ğŸ‘")
     ("s" "ğ¬") ("t" "ğ­") ("x" "ğ±") ("y" "ğ²"))))


[1]: Alt, J., ArtÃ«mov, S. (2001) Reflective Î»-calculus,
     Proceedings of the 2001 International Seminar on Proof Theory in
     Computer Science (PTCSâ€™01), Lecture Notes in Computer Science,
     vol. 2183, pp. 22â€“37.
     http://dx.doi.org/10.1007/3-540-45504-3_2

-}


module AltArtemov where

open import Data.Nat
  using (â„• ; zero ; suc)

open import Data.Product
  using (Î£ ; projâ‚ ; projâ‚‚ ; _Ã—_)
  renaming (_,_ to âŸ¨_,_âŸ©)

open import Data.Vec
  using (Vec ; [] ; _âˆ·_ ; replicate)

infixl 9 !_ ğ‘£_ ğ’—_
infixl 8 ğœ‹â‚€_ ğœ‹â‚€Â²_ ğ…â‚€_ ğ…â‚€Â²_ ğ…â‚€Â³_
infixl 8 ğœ‹â‚_ ğœ‹â‚Â²_ ğ…â‚_ ğ…â‚Â²_ ğ…â‚Â³_
infixl 7 _âˆ˜_ _âˆ˜Â²_ _âˆ™_ _âˆ™Â²_ _âˆ™Â³_
infixr 6 â‡‘_ â‡‘Â²_ â¬†_ â¬†Â²_ â¬†Â³_
infixr 6 â‡“_ â‡“Â²_ â¬‡_ â¬‡Â²_ â¬‡Â³_
infixr 5 ğœ†_ ğœ†Â²_ ğ€_ ğ€Â²_ ğ€Â³_
infixr 4 _âˆ¶_ -- _âˆ·_
infixr 3 Â¬_
infixl 2 _âˆ§_ _,_
infixr 1 _âŠƒ_ _â«—_
infixr 0 _âŠ¢_ âŠ©_


-- --------------------------------------------------------------------------
--
-- Untyped syntax


-- Variables
Var : Set
Var = â„•


-- Type and term constructors
mutual
  data Ty : Set where
    -- Falsehood
    âŠ¥ : Ty

    -- Implication
    _âŠƒ_ : Ty â†’ Ty â†’ Ty

    -- Conjunction
    _âˆ§_ : Ty â†’ Ty â†’ Ty

    -- Explicit provability
    _âˆ¶_ : Tm â†’ Ty â†’ Ty


  data Tm : Set where
    -- Variable reference
    ğ‘£_ : Var â†’ Tm

    -- Abstraction (âŠƒI) at level n
    ğœ†[_]_ : â„• â†’ Tm â†’ Tm

    -- Application (âŠƒE) at level n
    _âˆ˜[_]_ : Tm â†’ â„• â†’ Tm â†’ Tm

    -- Pairing (âˆ§I) at level n
    ğ‘[_]âŸ¨_,_âŸ© : â„• â†’ Tm â†’ Tm â†’ Tm

    -- 0th projection (âˆ§Eâ‚€) at level n
    ğœ‹â‚€[_]_ : â„• â†’ Tm â†’ Tm

    -- 1st projection (âˆ§Eâ‚) at level n
    ğœ‹â‚[_]_ : â„• â†’ Tm â†’ Tm

    -- ArtÃ«movâ€™s â€œproof checkerâ€
    !_ : Tm â†’ Tm

    -- Reification at level n
    â‡‘[_]_ : â„• â†’ Tm â†’ Tm

    -- Reflection at level n
    â‡“[_]_ : â„• â†’ Tm â†’ Tm


-- --------------------------------------------------------------------------
--
-- Example types


-- Truth
âŠ¤ : Ty
âŠ¤ = âŠ¥ âŠƒ âŠ¥

-- Negation
Â¬_ : Ty â†’ Ty
Â¬ A = A âŠƒ âŠ¥

-- Equivalence
_â«—_ : Ty â†’ Ty â†’ Ty
A â«— B = (A âŠƒ B) âˆ§ (B âŠƒ A)


-- --------------------------------------------------------------------------
--
-- Simplified notation for term constructors at level 1


ğœ†_ : Tm â†’ Tm
ğœ† t = ğœ†[ 1 ] t

_âˆ˜_ : Tm â†’ Tm â†’ Tm
t âˆ˜ s = t âˆ˜[ 1 ] s

ğ‘âŸ¨_,_âŸ© : Tm â†’ Tm â†’ Tm
ğ‘âŸ¨ t , s âŸ© = ğ‘[ 1 ]âŸ¨ t , s âŸ©

ğœ‹â‚€_ : Tm â†’ Tm
ğœ‹â‚€ t = ğœ‹â‚€[ 1 ] t

ğœ‹â‚_ : Tm â†’ Tm
ğœ‹â‚ t = ğœ‹â‚[ 1 ] t

â‡‘_ : Tm â†’ Tm
â‡‘ t = â‡‘[ 1 ] t

â‡“_ : Tm â†’ Tm
â‡“ t = â‡“[ 1 ] t


-- --------------------------------------------------------------------------
--
-- Simplified notation for term constructors at level 2


ğœ†Â²_ : Tm â†’ Tm
ğœ†Â² tâ‚‚ = ğœ†[ 2 ] tâ‚‚

_âˆ˜Â²_ : Tm â†’ Tm â†’ Tm
tâ‚‚ âˆ˜Â² sâ‚‚ = tâ‚‚ âˆ˜[ 2 ] sâ‚‚

ğ‘Â²âŸ¨_,_âŸ© : Tm â†’ Tm â†’ Tm
ğ‘Â²âŸ¨ tâ‚‚ , sâ‚‚ âŸ© = ğ‘[ 2 ]âŸ¨ tâ‚‚ , sâ‚‚ âŸ©

ğœ‹â‚€Â²_ : Tm â†’ Tm
ğœ‹â‚€Â² tâ‚‚ = ğœ‹â‚€[ 2 ] tâ‚‚

ğœ‹â‚Â²_ : Tm â†’ Tm
ğœ‹â‚Â² tâ‚‚ = ğœ‹â‚[ 2 ] tâ‚‚

â‡‘Â²_ : Tm â†’ Tm
â‡‘Â² tâ‚‚ = â‡‘[ 2 ] tâ‚‚

â‡“Â²_ : Tm â†’ Tm
â‡“Â² tâ‚‚ = â‡“[ 2 ] tâ‚‚


-- --------------------------------------------------------------------------
--
-- Simplified notation for term constructors at level 3


ğœ†Â³_ : Tm â†’ Tm
ğœ†Â³ tâ‚ƒ = ğœ†[ 3 ] tâ‚ƒ

_âˆ˜Â³_ : Tm â†’ Tm â†’ Tm
tâ‚ƒ âˆ˜Â³ sâ‚ƒ = tâ‚ƒ âˆ˜[ 3 ] sâ‚ƒ

ğ‘Â³âŸ¨_,_âŸ© : Tm â†’ Tm â†’ Tm
ğ‘Â³âŸ¨ tâ‚ƒ , sâ‚ƒ âŸ© = ğ‘[ 3 ]âŸ¨ tâ‚ƒ , sâ‚ƒ âŸ©

ğœ‹â‚€Â³_ : Tm â†’ Tm
ğœ‹â‚€Â³ tâ‚ƒ = ğœ‹â‚€[ 3 ] tâ‚ƒ

ğœ‹â‚Â³_ : Tm â†’ Tm
ğœ‹â‚Â³ tâ‚ƒ = ğœ‹â‚[ 3 ] tâ‚ƒ

â‡‘Â³_ : Tm â†’ Tm
â‡‘Â³ tâ‚ƒ = â‡‘[ 3 ] tâ‚ƒ

â‡“Â³_ : Tm â†’ Tm
â‡“Â³ tâ‚ƒ = â‡“[ 3 ] tâ‚ƒ


-- --------------------------------------------------------------------------
--
-- Generic vector functions


-- Transforming each element dependent on its index
ixMap : âˆ€{n} {X Y : Set}
    â†’ (â„• â†’ X â†’ Y) â†’ Vec X n â†’ Vec Y n
ixMap {zero}  f []      = []
ixMap {suc n} f (x âˆ· ğ±) = f (suc n) x âˆ· ixMap f ğ±

-- Transforming each pair of elements dependent on their index
ixZipWith : âˆ€{n} {X Y Z : Set}
    â†’ (â„• â†’ X â†’ Y â†’ Z) â†’ Vec X n â†’ Vec Y n â†’ Vec Z n
ixZipWith {zero}  f []      []       = []
ixZipWith {suc n} f (x âˆ· ğ±) (y âˆ· ğ²) = f (suc n) x y âˆ· ixZipWith f ğ± ğ²


-- --------------------------------------------------------------------------
--
-- Vector notation for type assertions at level n, p. 27 [1]


-- Term vectors
Tms : â„• â†’ Set
Tms = Vec Tm


-- tâ‚™ âˆ¶ tâ‚™â‚‹â‚ âˆ¶ â‹¯ âˆ¶ tâ‚ âˆ¶ A
*_âˆ·_ : âˆ€{n} â†’ Tms n â†’ Ty â†’ Ty
* []      âˆ· A = A
* (x âˆ· ğ­) âˆ· A = x âˆ¶ * ğ­ âˆ· A

-- ğ‘£ x âˆ¶ ğ‘£ x âˆ¶ â‹¯ âˆ¶ ğ‘£ x âˆ¶ A
ğ‘£[_]_âˆ·_ : â„• â†’ Var â†’ Ty â†’ Ty
ğ‘£[ n ] x âˆ· A = * replicate {n = n} (ğ‘£ x) âˆ· A

-- ğœ†â¿ tâ‚™ âˆ¶ ğœ†â¿â»Â¹ tâ‚™â‚‹â‚ âˆ¶ â‹¯ âˆ¶ ğœ† tâ‚ âˆ¶ A
ğœ†â¿_âˆ·_ : âˆ€{n} â†’ Tms n â†’ Ty â†’ Ty
ğœ†â¿ ğ­ âˆ· A = * ixMap ğœ†[_]_ ğ­ âˆ· A

-- tâ‚™ âˆ˜â¿ sâ‚™ âˆ¶ tâ‚™â‚‹â‚ âˆ˜â¿â»Â¹ âˆ¶ sâ‚™â‚‹â‚ âˆ¶ â‹¯ âˆ¶ tâ‚ âˆ˜ sâ‚ âˆ¶ A
_âˆ˜â¿_âˆ·_ : âˆ€{n} â†’ Tms n â†’ Tms n â†’ Ty â†’ Ty
ğ­ âˆ˜â¿ ğ¬ âˆ· A = * ixZipWith (Î» n t s â†’ t âˆ˜[ n ] s) ğ­ ğ¬ âˆ· A

-- ğ‘â¿âŸ¨ tâ‚™ , sâ‚™ âŸ© âˆ¶ ğ‘â¿â»Â¹âŸ¨ tâ‚™â‚‹â‚ , sâ‚™â‚‹â‚ âŸ© âˆ¶ â‹¯ âˆ¶ pâŸ¨ tâ‚ , sâ‚ âŸ© âˆ¶ A
ğ‘â¿âŸ¨_,_âŸ©âˆ·_ : âˆ€{n} â†’ Tms n â†’ Tms n â†’ Ty â†’ Ty
ğ‘â¿âŸ¨ ğ­ , ğ¬ âŸ©âˆ· A = * ixZipWith ğ‘[_]âŸ¨_,_âŸ© ğ­ ğ¬ âˆ· A

-- ğœ‹â‚€â¿ tâ‚™ âˆ¶ ğœ‹â‚€â¿â»Â¹ tâ‚™â‚‹â‚ âˆ¶ â‹¯ âˆ¶ ğœ‹â‚€ tâ‚ âˆ¶ A
ğœ‹â‚€â¿_âˆ·_ : âˆ€{n} â†’ Tms n â†’ Ty â†’ Ty
ğœ‹â‚€â¿ ğ­ âˆ· A = * ixMap ğœ‹â‚€[_]_ ğ­ âˆ· A

-- ğœ‹â‚â¿ tâ‚™ âˆ¶ ğœ‹â‚â¿â»Â¹ tâ‚™â‚‹â‚ âˆ¶ â‹¯ âˆ¶ ğœ‹â‚ tâ‚ âˆ¶ A
ğœ‹â‚â¿_âˆ·_ : âˆ€{n} â†’ Tms n â†’ Ty â†’ Ty
ğœ‹â‚â¿ ğ­ âˆ· A = * ixMap ğœ‹â‚[_]_ ğ­ âˆ· A

-- â‡‘â¿ tâ‚™ âˆ¶ â‡‘â¿â»Â¹ tâ‚™â‚‹â‚ âˆ¶ â‹¯ âˆ¶ â‡‘ tâ‚ âˆ¶ A
â‡‘â¿_âˆ·_ : âˆ€{n} â†’ Tms n â†’ Ty â†’ Ty
â‡‘â¿ ğ­ âˆ· A = * ixMap â‡‘[_]_ ğ­ âˆ· A

-- â‡“â¿ tâ‚™ âˆ¶ â‡‘â¿â»Â¹ tâ‚™â‚‹â‚ âˆ¶ â‹¯ âˆ¶ â‡‘ tâ‚ âˆ¶ A
â‡“â¿_âˆ·_ : âˆ€{n} â†’ Tms n â†’ Ty â†’ Ty
â‡“â¿ ğ­ âˆ· A = * ixMap â‡“[_]_ ğ­ âˆ· A


-- --------------------------------------------------------------------------
--
-- Typed syntax


-- Hypotheses
Hyp : Set
Hyp = â„• Ã— Ty


-- Contexts
data Cx : â„• â†’ Set where
  âˆ…   : Cx zero
  _,_ : âˆ€{m} â†’ Cx m â†’ Hyp â†’ Cx (suc m)


-- Context membership evidence
data _âˆˆ[_]_ : âˆ€{m} â†’ Hyp â†’ â„• â†’ Cx m â†’ Set where
  ğ™ : âˆ€{m A} {Î“ : Cx m}
      â†’ A âˆˆ[ zero ] (Î“ , A)

  ğ’_ : âˆ€{m A B x} {Î“ : Cx m}
      â†’ A âˆˆ[ x ] Î“
      â†’ A âˆˆ[ suc x ] (Î“ , B)


-- Typing rules
data _âŠ¢_ {m : â„•} (Î“ : Cx m) : Ty â†’ Set where
  ğ’—_ : âˆ€{n x} {A}
      â†’ âŸ¨ n , A âŸ© âˆˆ[ x ] Î“
      â†’ Î“ âŠ¢ ğ‘£[ n ] x âˆ· A

  ğ€â¿_ : âˆ€{n} {ğ­ : Tms n} {A B}
      â†’ Î“ , âŸ¨ n , A âŸ© âŠ¢ * ğ­ âˆ· B
      â†’ Î“ âŠ¢ ğœ†â¿ ğ­ âˆ· (A âŠƒ B)

  _âˆ™â¿_ : âˆ€{n} {ğ­ ğ¬ : Tms n} {A B}
      â†’ Î“ âŠ¢ * ğ­ âˆ· (A âŠƒ B)    â†’ Î“ âŠ¢ * ğ¬ âˆ· A
      â†’ Î“ âŠ¢ ğ­ âˆ˜â¿ ğ¬ âˆ· B

  ğ’‘â¿âŸ¨_,_âŸ© : âˆ€{n} {ğ­ ğ¬ : Tms n} {A B}
      â†’ Î“ âŠ¢ * ğ­ âˆ· A          â†’ Î“ âŠ¢ * ğ¬ âˆ· B
      â†’ Î“ âŠ¢ ğ‘â¿âŸ¨ ğ­ , ğ¬ âŸ©âˆ· (A âˆ§ B)

  ğ…â‚€â¿_ : âˆ€{n} {ğ­ : Tms n} {A B}
      â†’ Î“ âŠ¢ * ğ­ âˆ· (A âˆ§ B)
      â†’ Î“ âŠ¢ ğœ‹â‚€â¿ ğ­ âˆ· A

  ğ…â‚â¿_ : âˆ€{n} {ğ­ : Tms n} {A B}
      â†’ Î“ âŠ¢ * ğ­ âˆ· (A âˆ§ B)
      â†’ Î“ âŠ¢ ğœ‹â‚â¿ ğ­ âˆ· B

  â¬†â¿_ : âˆ€{n} {ğ­ : Tms n} {u A}
      â†’ Î“ âŠ¢ * ğ­ âˆ· (u âˆ¶ A)
      â†’ Î“ âŠ¢ â‡‘â¿ ğ­ âˆ· (! u âˆ¶ u âˆ¶ A)

  â¬‡â¿_ : âˆ€{n} {ğ­ : Tms n} {u A}
      â†’ Î“ âŠ¢ * ğ­ âˆ· (u âˆ¶ A)
      â†’ Î“ âŠ¢ â‡“â¿ ğ­ âˆ· A


-- Theorems
âŠ©_  : Ty â†’ Set
âŠ© A = âˆ… âŠ¢ A


-- --------------------------------------------------------------------------
--
-- Simplified notation for context membership evidence


ğŸ : âˆ€{m A} {Î“ : Cx m} â†’ A âˆˆ[ 0 ] (Î“ , A)
ğŸ = ğ™

ğŸ : âˆ€{m A B} {Î“ : Cx m} â†’ A âˆˆ[ 1 ] (Î“ , A , B)
ğŸ = ğ’ ğ™

ğŸ : âˆ€{m A B C} {Î“ : Cx m} â†’ A âˆˆ[ 2 ] (Î“ , A , B , C)
ğŸ = ğ’ ğ’ ğ™

ğŸ‘ : âˆ€{m A B C D} {Î“ : Cx m} â†’ A âˆˆ[ 3 ] (Î“ , A , B , C , D)
ğŸ‘ = ğ’ ğ’ ğ’ ğ™


-- --------------------------------------------------------------------------
--
-- Simplified notation for typing rules at level 1


ğ€_ : âˆ€{A B m} {Î“ : Cx m}
    â†’ Î“ , âŸ¨ 0 , A âŸ© âŠ¢ B
    â†’ Î“ âŠ¢ A âŠƒ B
ğ€_ = ğ€â¿_ {ğ­ = []}

_âˆ™_ : âˆ€{A B m} {Î“ : Cx m}
    â†’ Î“ âŠ¢ A âŠƒ B    â†’ Î“ âŠ¢ A
    â†’ Î“ âŠ¢ B
_âˆ™_ = _âˆ™â¿_ {ğ­ = []} {ğ¬ = []}

ğ’‘âŸ¨_,_âŸ© : âˆ€{A B m} {Î“ : Cx m}
    â†’ Î“ âŠ¢ A        â†’ Î“ âŠ¢ B
    â†’ Î“ âŠ¢ A âˆ§ B
ğ’‘âŸ¨_,_âŸ© = ğ’‘â¿âŸ¨_,_âŸ© {ğ­ = []} {ğ¬ = []}

ğ…â‚€_ : âˆ€{A B m} {Î“ : Cx m}
    â†’ Î“ âŠ¢ A âˆ§ B
    â†’ Î“ âŠ¢ A
ğ…â‚€_ = ğ…â‚€â¿_ {ğ­ = []}

ğ…â‚_ : âˆ€{A B m} {Î“ : Cx m}
    â†’ Î“ âŠ¢ A âˆ§ B
    â†’ Î“ âŠ¢ B
ğ…â‚_ = ğ…â‚â¿_ {ğ­ = []}

â¬†_ : âˆ€{u A m} {Î“ : Cx m}
    â†’ Î“ âŠ¢ u âˆ¶ A
    â†’ Î“ âŠ¢ ! u âˆ¶ u âˆ¶ A
â¬†_ = â¬†â¿_ {ğ­ = []}

â¬‡_ : âˆ€{u A m} {Î“ : Cx m}
    â†’ Î“ âŠ¢ u âˆ¶ A
    â†’ Î“ âŠ¢ A
â¬‡_ = â¬‡â¿_ {ğ­ = []}


-- --------------------------------------------------------------------------
--
-- Simplified notation for typing rules at level 2


ğ€Â²_ : âˆ€{t A B m} {Î“ : Cx m}
    â†’ Î“ , âŸ¨ 1 , A âŸ© âŠ¢ t âˆ¶ B
    â†’ Î“ âŠ¢ ğœ† t âˆ¶ (A âŠƒ B)
ğ€Â²_ {t} = ğ€â¿_ {ğ­ = t âˆ· []}

_âˆ™Â²_ : âˆ€{t s A B m} {Î“ : Cx m}
    â†’ Î“ âŠ¢ t âˆ¶ (A âŠƒ B)    â†’ Î“ âŠ¢ s âˆ¶ A
    â†’ Î“ âŠ¢ t âˆ˜ s âˆ¶ B
_âˆ™Â²_ {t} {s} = _âˆ™â¿_ {ğ­ = t âˆ· []} {ğ¬ = s âˆ· []}

ğ’‘Â²âŸ¨_,_âŸ© : âˆ€{t s A B m} {Î“ : Cx m}
    â†’ Î“ âŠ¢ t âˆ¶ A          â†’ Î“ âŠ¢ s âˆ¶ B
    â†’ Î“ âŠ¢ ğ‘âŸ¨ t , s âŸ© âˆ¶ (A âˆ§ B)
ğ’‘Â²âŸ¨_,_âŸ© {t} {s} = ğ’‘â¿âŸ¨_,_âŸ© {ğ­ = t âˆ· []} {ğ¬ = s âˆ· []}

ğ…â‚€Â²_ : âˆ€{t A B m} {Î“ : Cx m}
    â†’ Î“ âŠ¢ t âˆ¶ (A âˆ§ B)
    â†’ Î“ âŠ¢ ğœ‹â‚€ t âˆ¶ A
ğ…â‚€Â²_ {t} = ğ…â‚€â¿_ {ğ­ = t âˆ· []}

ğ…â‚Â²_ : âˆ€{t A B m} {Î“ : Cx m}
    â†’ Î“ âŠ¢ t âˆ¶ (A âˆ§ B)
    â†’ Î“ âŠ¢ ğœ‹â‚ t âˆ¶ B
ğ…â‚Â²_ {t} = ğ…â‚â¿_ {ğ­ = t âˆ· []}

â¬†Â²_ : âˆ€{t u A m} {Î“ : Cx m}
    â†’ Î“ âŠ¢ t âˆ¶ u âˆ¶ A
    â†’ Î“ âŠ¢ â‡‘ t âˆ¶ ! u âˆ¶ u âˆ¶ A
â¬†Â²_ {t} = â¬†â¿_ {ğ­ = t âˆ· []}

â¬‡Â²_ : âˆ€{t u A m} {Î“ : Cx m}
    â†’ Î“ âŠ¢ t âˆ¶ u âˆ¶ A
    â†’ Î“ âŠ¢ â‡“ t âˆ¶ A
â¬‡Â²_ {t} = â¬‡â¿_ {ğ­ = t âˆ· []}


-- --------------------------------------------------------------------------
--
-- Simplified notation for typing rules at level 3


ğ€Â³_ : âˆ€{tâ‚‚ tâ‚ A B m} {Î“ : Cx m}
    â†’ Î“ , âŸ¨ 2 , A âŸ© âŠ¢ tâ‚‚ âˆ¶ tâ‚ âˆ¶ B
    â†’ Î“ âŠ¢ ğœ†Â² tâ‚‚ âˆ¶ ğœ† tâ‚ âˆ¶ (A âŠƒ B)
ğ€Â³_ {tâ‚‚} {tâ‚} = ğ€â¿_ {ğ­ = tâ‚‚ âˆ· tâ‚ âˆ· []}

_âˆ™Â³_ : âˆ€{tâ‚‚ tâ‚ sâ‚‚ sâ‚ A B m} {Î“ : Cx m}
    â†’ Î“ âŠ¢ tâ‚‚ âˆ¶ tâ‚ âˆ¶ (A âŠƒ B)    â†’ Î“ âŠ¢ sâ‚‚ âˆ¶ sâ‚ âˆ¶ A
    â†’ Î“ âŠ¢ tâ‚‚ âˆ˜Â² sâ‚‚ âˆ¶ tâ‚ âˆ˜ sâ‚ âˆ¶ B
_âˆ™Â³_ {tâ‚‚} {tâ‚} {sâ‚‚} {sâ‚} = _âˆ™â¿_ {ğ­ = tâ‚‚ âˆ· tâ‚ âˆ· []} {ğ¬ = sâ‚‚ âˆ· sâ‚ âˆ· []}

ğ’‘Â³âŸ¨_,_âŸ© : âˆ€{tâ‚‚ tâ‚ sâ‚‚ sâ‚ A B m} {Î“ : Cx m}
    â†’ Î“ âŠ¢ tâ‚‚ âˆ¶ tâ‚ âˆ¶ A          â†’ Î“ âŠ¢ sâ‚‚ âˆ¶ sâ‚ âˆ¶ B
    â†’ Î“ âŠ¢ ğ‘Â²âŸ¨ tâ‚‚ , sâ‚‚ âŸ© âˆ¶ ğ‘âŸ¨ tâ‚ , sâ‚ âŸ© âˆ¶ (A âˆ§ B)
ğ’‘Â³âŸ¨_,_âŸ© {tâ‚‚} {tâ‚} {sâ‚‚} {sâ‚} = ğ’‘â¿âŸ¨_,_âŸ© {ğ­ = tâ‚‚ âˆ· tâ‚ âˆ· []} {ğ¬ = sâ‚‚ âˆ· sâ‚ âˆ· []}

ğ…â‚€Â³_ : âˆ€{tâ‚‚ tâ‚ A B m} {Î“ : Cx m}
    â†’ Î“ âŠ¢ tâ‚‚ âˆ¶ tâ‚ âˆ¶ (A âˆ§ B)
    â†’ Î“ âŠ¢ ğœ‹â‚€Â² tâ‚‚ âˆ¶ ğœ‹â‚€ tâ‚ âˆ¶ A
ğ…â‚€Â³_ {tâ‚‚} {tâ‚} = ğ…â‚€â¿_ {ğ­ = tâ‚‚ âˆ· tâ‚ âˆ· []}

ğ…â‚Â³_ : âˆ€{tâ‚‚ tâ‚ A B m} {Î“ : Cx m}
    â†’ Î“ âŠ¢ tâ‚‚ âˆ¶ tâ‚ âˆ¶ (A âˆ§ B)
    â†’ Î“ âŠ¢ ğœ‹â‚Â² tâ‚‚ âˆ¶ ğœ‹â‚ tâ‚ âˆ¶ B
ğ…â‚Â³_ {tâ‚‚} {tâ‚} = ğ…â‚â¿_ {ğ­ = tâ‚‚ âˆ· tâ‚ âˆ· []}

â¬†Â³_ : âˆ€{tâ‚‚ tâ‚ u A m} {Î“ : Cx m}
    â†’ Î“ âŠ¢ tâ‚‚ âˆ¶ tâ‚ âˆ¶ u âˆ¶ A
    â†’ Î“ âŠ¢ â‡‘Â² tâ‚‚ âˆ¶ â‡‘ tâ‚ âˆ¶ ! u âˆ¶ u âˆ¶ A
â¬†Â³_ {tâ‚‚} {tâ‚} = â¬†â¿_ {ğ­ = tâ‚‚ âˆ· tâ‚ âˆ· []}

â¬‡Â³_ : âˆ€{tâ‚‚ tâ‚ u A m} {Î“ : Cx m}
    â†’ Î“ âŠ¢ tâ‚‚ âˆ¶ tâ‚ âˆ¶ u âˆ¶ A
    â†’ Î“ âŠ¢ â‡“Â² tâ‚‚ âˆ¶ â‡“ tâ‚ âˆ¶ A
â¬‡Â³_ {tâ‚‚} {tâ‚} = â¬‡â¿_ {ğ­ = tâ‚‚ âˆ· tâ‚ âˆ· []}


-- --------------------------------------------------------------------------
--
-- Example terms at levels 1, 2, and 3


-- S4: A âŠƒ A
I : âˆ€{A}
    â†’ âŠ©  A âŠƒ A
I = ğ€ ğ’— ğŸ

-- S4: â–¡(A âŠƒ A)
IÂ² : âˆ€{A}
    â†’ âŠ©  ğœ† ğ‘£ 0  âˆ¶  (A âŠƒ A)
IÂ² = ğ€Â² ğ’— ğŸ

-- S4: â–¡â–¡(A âŠƒ A)
IÂ³ : âˆ€{A}
    â†’ âŠ©  ğœ†Â² ğ‘£ 0  âˆ¶  ğœ† ğ‘£ 0  âˆ¶  (A âŠƒ A)
IÂ³ = ğ€Â³ ğ’— ğŸ


-- S4: A âŠƒ B âŠƒ A
K : âˆ€{A B}
    â†’ âŠ©  A âŠƒ B âŠƒ A
K = ğ€ ğ€ ğ’— ğŸ

-- S4: â–¡(A âŠƒ B âŠƒ A)
KÂ² : âˆ€{A B}
    â†’ âŠ©  ğœ† ğœ† ğ‘£ 1  âˆ¶  (A âŠƒ B âŠƒ A)
KÂ² = ğ€Â² ğ€Â² ğ’— ğŸ

-- S4: â–¡â–¡(A âŠƒ B âŠƒ A)
KÂ³ : âˆ€{A B}
    â†’ âŠ©  ğœ†Â² ğœ†Â² ğ‘£ 1  âˆ¶  ğœ† ğœ† ğ‘£ 1  âˆ¶  (A âŠƒ B âŠƒ A)
KÂ³ = ğ€Â³ ğ€Â³ ğ’— ğŸ


-- S4: (A âŠƒ B âŠƒ C) âŠƒ (A âŠƒ B) âŠƒ A âŠƒ C
S : âˆ€{A B C}
    â†’ âŠ©  (A âŠƒ B âŠƒ C) âŠƒ (A âŠƒ B) âŠƒ A âŠƒ C
S = ğ€ ğ€ ğ€ (ğ’— ğŸ âˆ™ ğ’— ğŸ) âˆ™ (ğ’— ğŸ âˆ™ ğ’— ğŸ)

-- S4: â–¡((A âŠƒ B âŠƒ C) âŠƒ (A âŠƒ B) âŠƒ A âŠƒ C)
SÂ² : âˆ€{A B C}
    â†’ âŠ©  ğœ† ğœ† ğœ† (ğ‘£ 2 âˆ˜ ğ‘£ 0) âˆ˜ (ğ‘£ 1 âˆ˜ ğ‘£ 0)  âˆ¶  ((A âŠƒ B âŠƒ C) âŠƒ (A âŠƒ B) âŠƒ A âŠƒ C)
SÂ² = ğ€Â² ğ€Â² ğ€Â² (ğ’— ğŸ âˆ™Â² ğ’— ğŸ) âˆ™Â² (ğ’— ğŸ âˆ™Â² ğ’— ğŸ)

-- S4: â–¡â–¡((A âŠƒ B âŠƒ C) âŠƒ (A âŠƒ B) âŠƒ A âŠƒ C)
SÂ³ : âˆ€{A B C}
    â†’ âŠ©  ğœ†Â² ğœ†Â² ğœ†Â² (ğ‘£ 2 âˆ˜Â² ğ‘£ 0) âˆ˜Â² (ğ‘£ 1 âˆ˜Â² ğ‘£ 0)  âˆ¶  ğœ† ğœ† ğœ† (ğ‘£ 2 âˆ˜ ğ‘£ 0) âˆ˜ (ğ‘£ 1 âˆ˜ ğ‘£ 0)  âˆ¶  ((A âŠƒ B âŠƒ C) âŠƒ (A âŠƒ B) âŠƒ A âŠƒ C)
SÂ³ = ğ€Â³ ğ€Â³ ğ€Â³ (ğ’— ğŸ âˆ™Â³ ğ’— ğŸ) âˆ™Â³ (ğ’— ğŸ âˆ™Â³ ğ’— ğŸ)


-- --------------------------------------------------------------------------
--
-- Example terms corresponding to S4 axioms at levels 1 and 2


-- S4: â–¡(A âŠƒ B) âŠƒ â–¡A âŠƒ â–¡B
axK : âˆ€{A B f x}
    â†’ âŠ©  (f âˆ¶ (A âŠƒ B)) âŠƒ x âˆ¶ A âŠƒ (f âˆ˜ x) âˆ¶ B
axK = ğ€ ğ€ (ğ’— ğŸ âˆ™Â² ğ’— ğŸ)

-- S4: â–¡(â–¡(A âŠƒ B) âŠƒ â–¡A âŠƒ â–¡B)
axKÂ² : âˆ€{A B f x}
    â†’ âŠ©  ğœ† ğœ† ğ‘£ 1 âˆ˜Â² ğ‘£ 0  âˆ¶  (f âˆ¶ (A âŠƒ B) âŠƒ x âˆ¶ A âŠƒ (f âˆ˜ x) âˆ¶ B)
axKÂ² = ğ€Â² ğ€Â² (ğ’— ğŸ âˆ™Â³ ğ’— ğŸ)

-- S4: â–¡A âŠƒ A
axT : âˆ€{A x}
    â†’ âŠ©  x âˆ¶ A âŠƒ A
axT = ğ€ â¬‡ ğ’— ğŸ

-- S4: â–¡(â–¡A âŠƒ A)
axTÂ² : âˆ€{A x}
    â†’ âŠ©  ğœ† â‡“ ğ‘£ 0  âˆ¶  (x âˆ¶ A âŠƒ A)
axTÂ² = ğ€Â² â¬‡Â² ğ’— ğŸ

-- S4: â–¡A âŠƒ â–¡â–¡A
ax4 : âˆ€{A x}
    â†’ âŠ©  x âˆ¶ A âŠƒ ! x âˆ¶ x âˆ¶ A
ax4 = ğ€ â¬† ğ’— ğŸ

-- S4: â–¡(â–¡A âŠƒ â–¡â–¡A)
ax4Â² : âˆ€{A x}
    â†’ âŠ©  ğœ† â‡‘ ğ‘£ 0  âˆ¶  (x âˆ¶ A âŠƒ ! x âˆ¶ x âˆ¶ A)
ax4Â² = ğ€Â² â¬†Â² ğ’— ğŸ


-- --------------------------------------------------------------------------
--
-- Terms of example 1, p. 28 [1]


-- S4: â–¡(â–¡A âŠƒ A)
ex11 : âˆ€{A x}
    â†’ âŠ©  ğœ† â‡“ ğ‘£ 0  âˆ¶  (x âˆ¶ A âŠƒ A)
ex11 = axTÂ²

-- S4: â–¡(â–¡A âŠƒ â–¡â–¡A)
ex12 : âˆ€{A x}
    â†’ âŠ©  ğœ† â‡‘ ğ‘£ 0  âˆ¶  (x âˆ¶ A âŠƒ ! x âˆ¶ x âˆ¶ A)
ex12 = ax4Â²

-- S4: â–¡â–¡(A âŠƒ B âŠƒ A âˆ§ B)
ex13 : âˆ€{A B}
    â†’ âŠ©  ğœ†Â² ğœ†Â² ğ‘Â²âŸ¨ ğ‘£ 1 , ğ‘£ 0 âŸ©  âˆ¶  ğœ† ğœ† ğ‘âŸ¨ ğ‘£ 1 , ğ‘£ 0 âŸ©  âˆ¶  (A âŠƒ B âŠƒ A âˆ§ B)
ex13 = ğ€Â³ ğ€Â³ ğ’‘Â³âŸ¨ ğ’— ğŸ , ğ’— ğŸ âŸ©

-- S4: â–¡(â–¡A âŠƒ â–¡B âŠƒ â–¡â–¡(A âˆ§ B))
ex14 : âˆ€{A B x y}
    â†’ âŠ©  ğœ† ğœ† â‡‘ ğ‘Â²âŸ¨ ğ‘£ 1 , ğ‘£ 0 âŸ©  âˆ¶  (x âˆ¶ A âŠƒ y âˆ¶ B âŠƒ ! ğ‘âŸ¨ x , y âŸ© âˆ¶ ğ‘âŸ¨ x , y âŸ© âˆ¶ (A âˆ§ B))
ex14 = ğ€Â² ğ€Â² â¬†Â² ğ’‘Â³âŸ¨ ğ’— ğŸ , ğ’— ğŸ âŸ©


-- --------------------------------------------------------------------------
--
-- Additional example terms


-- S4: â–¡(â–¡A âŠƒ â–¡B âŠƒ â–¡(A âˆ§ B))
exA : âˆ€{A B x y}
    â†’ âŠ©  ğœ† ğœ† ğ‘Â²âŸ¨ ğ‘£ 1 , ğ‘£ 0 âŸ©  âˆ¶  (x âˆ¶ A âŠƒ y âˆ¶ B âŠƒ ğ‘âŸ¨ x , y âŸ© âˆ¶ (A âˆ§ B))
exA = ğ€Â² ğ€Â² ğ’‘Â³âŸ¨ ğ’— ğŸ , ğ’— ğŸ âŸ©

-- S4: â–¡(â–¡A âˆ§ â–¡B âŠƒ â–¡â–¡(A âˆ§ B))
exB : âˆ€{A B x y}
    â†’ âŠ©  ğœ† â‡‘ ğ‘Â²âŸ¨ ğœ‹â‚€ ğ‘£ 0 , ğœ‹â‚ ğ‘£ 0 âŸ©  âˆ¶  (x âˆ¶ A âˆ§ y âˆ¶ B âŠƒ ! ğ‘âŸ¨ x , y âŸ© âˆ¶ ğ‘âŸ¨ x , y âŸ© âˆ¶ (A âˆ§ B))
exB = ğ€Â² â¬†Â² ğ’‘Â³âŸ¨ ğ…â‚€Â² ğ’— ğŸ , ğ…â‚Â² ğ’— ğŸ âŸ©

-- S4: â–¡(â–¡A âˆ§ â–¡B âŠƒ â–¡(A âˆ§ B))
exC : âˆ€{A B x y}
    â†’ âŠ©  ğœ† ğ‘Â²âŸ¨ ğœ‹â‚€ ğ‘£ 0 , ğœ‹â‚ ğ‘£ 0 âŸ©  âˆ¶  (x âˆ¶ A âˆ§ y âˆ¶ B âŠƒ ğ‘âŸ¨ x , y âŸ© âˆ¶ (A âˆ§ B))
exC = ğ€Â² ğ’‘Â³âŸ¨ ğ…â‚€Â² ğ’— ğŸ , ğ…â‚Â² ğ’— ğŸ âŸ©


-- --------------------------------------------------------------------------
--
-- Terms of example 2, pp. 31â€“32 [1]


ex2 : âˆ€{A x}
    â†’ âŠ©  ğœ†Â² â‡“Â² â‡‘Â² ğ‘£ 0  âˆ¶  ğœ† â‡“ â‡‘ ğ‘£ 0  âˆ¶  (x âˆ¶ A âŠƒ x âˆ¶ A)
ex2 = ğ€Â³ â¬‡Â³ â¬†Â³ ğ’— ğŸ

ex2â€² : âˆ€{A x}
    â†’ âŠ© ğœ†Â² ğ‘£ 0  âˆ¶  ğœ† ğ‘£ 0  âˆ¶  (x âˆ¶ A âŠƒ x âˆ¶ A)
ex2â€² = ğ€Â³  ğ’— ğŸ


-- --------------------------------------------------------------------------
--
-- Theorem 1 (Internalisation principle), p. 29 [1]


prefix : âˆ€{m} â†’ Cx m â†’ Cx m
prefix âˆ…               = âˆ…
prefix (Î“ , âŸ¨ n , A âŸ©) = prefix Î“ , âŸ¨ suc n , A âŸ©


inâˆˆ : âˆ€{n A m k} {Î“ : Cx m}
    â†’ âŸ¨ n , A âŸ© âˆˆ[ k ] Î“
    â†’ âŸ¨ suc n , A âŸ© âˆˆ[ k ] prefix Î“
inâˆˆ ğ™     = ğ™
inâˆˆ (ğ’ i) = ğ’ (inâˆˆ i)


inâŠ¢ : âˆ€{A m} {Î“ : Cx m}
    â†’ Î“ âŠ¢ A
    â†’ Î£ Tm Î» t â†’ prefix Î“ âŠ¢ t âˆ¶ A
inâŠ¢ (ğ’—_ {n} {k} i)
    = let j = inâˆˆ i in
        âŸ¨ ğ‘£ k
        , ğ’— j
        âŸ©
inâŠ¢ (ğ€â¿_ {n} {ğ­} D)
    = let âŸ¨ s , C âŸ© = inâŠ¢ D in
        âŸ¨ ğœ†[ suc n ] s
        , ğ€â¿_ {ğ­ = s âˆ· ğ­} C
        âŸ©
inâŠ¢ (_âˆ™â¿_ {n} {ğ­} {ğ¬} Dâ‚œ Dâ‚›)
    = let âŸ¨ sâ‚œ , Câ‚œ âŸ© = inâŠ¢ Dâ‚œ
          âŸ¨ sâ‚› , Câ‚› âŸ© = inâŠ¢ Dâ‚› in
        âŸ¨ sâ‚œ âˆ˜[ suc n ] sâ‚›
        , _âˆ™â¿_ {ğ­ = sâ‚œ âˆ· ğ­} {ğ¬ = sâ‚› âˆ· ğ¬} Câ‚œ Câ‚›
        âŸ©
inâŠ¢ (ğ’‘â¿âŸ¨_,_âŸ© {n} {ğ­} {ğ¬} Dâ‚œ Dâ‚›)
    = let âŸ¨ sâ‚œ , Câ‚œ âŸ© = inâŠ¢ Dâ‚œ
          âŸ¨ sâ‚› , Câ‚› âŸ© = inâŠ¢ Dâ‚› in
        âŸ¨ ğ‘[ suc n ]âŸ¨ sâ‚œ , sâ‚› âŸ©
        , ğ’‘â¿âŸ¨_,_âŸ© {ğ­ = sâ‚œ âˆ· ğ­} {ğ¬ = sâ‚› âˆ· ğ¬} Câ‚œ Câ‚›
        âŸ©
inâŠ¢ (ğ…â‚€â¿_ {n} {ğ­} D)
    = let âŸ¨ s , C âŸ© = inâŠ¢ D in
        âŸ¨ ğœ‹â‚€[ suc n ] s
        , ğ…â‚€â¿_ {ğ­ = s âˆ· ğ­} C
        âŸ©
inâŠ¢ (ğ…â‚â¿_ {n} {ğ­} D)
    = let âŸ¨ s , C âŸ© = inâŠ¢ D in
        âŸ¨ ğœ‹â‚[ suc n ] s
        , ğ…â‚â¿_ {ğ­ = s âˆ· ğ­} C
        âŸ©
inâŠ¢ (â¬†â¿_ {n} {ğ­} D)
    = let âŸ¨ s , C âŸ© = inâŠ¢ D in
        âŸ¨ â‡‘[ suc n ] s
        , â¬†â¿_ {ğ­ = s âˆ· ğ­} C
        âŸ©
inâŠ¢ (â¬‡â¿_ {n} {ğ­} D)
    = let âŸ¨ s , C âŸ© = inâŠ¢ D in
        âŸ¨ â‡“[ suc n ] s
        , â¬‡â¿_ {ğ­ = s âˆ· ğ­} C
        âŸ©


-- --------------------------------------------------------------------------
--
-- Constructive necessitation


nec : âˆ€{A}
    â†’ âŠ© A
    â†’ Î£ Tm Î» t â†’ âŠ© t âˆ¶ A
nec = inâŠ¢


IÂ²â€² : âˆ€{A} â†’ Î£ Tm Î» t
    â†’ âŠ©  t  âˆ¶  (A âŠƒ A)
IÂ²â€² = nec I

IÂ³â€² : âˆ€{A} â†’ Î£ Tm Î» t
    â†’ âŠ©  t  âˆ¶  ğœ† ğ‘£ 0  âˆ¶  (A âŠƒ A)
IÂ³â€² = nec IÂ²

Iâ´â€² : âˆ€{A} â†’ Î£ Tm Î» t
    â†’ âŠ©  t  âˆ¶  ğœ†Â² ğ‘£ 0  âˆ¶  ğœ† ğ‘£ 0  âˆ¶  (A âŠƒ A)
Iâ´â€² = nec IÂ³


IÂ³â€³ : âˆ€{A} â†’ Î£ Tm Î» t
    â†’ âŠ©  t  âˆ¶  ğœ† ğ‘£ 0  âˆ¶  (A âŠƒ A)
IÂ³â€³ = nec (projâ‚‚ (IÂ²â€²))

Iâ´â€³ : âˆ€{A} â†’ Î£ Tm Î» t
    â†’ âŠ©  t  âˆ¶ ğœ†Â² ğ‘£ 0  âˆ¶  ğœ† ğ‘£ 0  âˆ¶  (A âŠƒ A)
Iâ´â€³ = nec (projâ‚‚ (IÂ³â€²))
