module STLC-Negative-Weak-NotEtaLong-ConcreteNbE where

open import STLC-Negative-Weak-NotEtaLong public


----------------------------------------------------------------------------------------------------

-- semantic objects
infix 3 _âŠ©_
_âŠ©_ : Ctx â†’ Ty â†’ Set
W âŠ© A `âŠƒ B = âˆ€ {Wâ€²} â†’ W âŠ† Wâ€² â†’ Wâ€² âŠ© A â†’ Wâ€² âŠ© B
W âŠ© A `âˆ§ B = W âŠ© A Ã— W âŠ© B
W âŠ© `ğŸ™     = ğŸ™

renâŠ© : âˆ€ {W Wâ€² A} â†’ W âŠ† Wâ€² â†’ W âŠ© A â†’ Wâ€² âŠ© A
renâŠ© {A = A `âŠƒ B} e f         = Î» eâ€² â†’ f (transâŠ† e eâ€²)
renâŠ© {A = A `âˆ§ B} e (oâ‚ , oâ‚‚) = renâŠ© e oâ‚ , renâŠ© e oâ‚‚
renâŠ© {A = `ğŸ™}     e unit      = unit

open ConcreteKit _âŠ©_ (Î» {_} {_} {A} â†’ renâŠ© {_} {_} {A}) public

-- reflection
âŸ¦_âŸ§ : âˆ€ {Î“ A} â†’ Î“ âŠ¢ A â†’ Î“ âŠ¨ A
âŸ¦ `v i     âŸ§ os = âŸ¦ i âŸ§âˆ‹ os
âŸ¦ `Î» t     âŸ§ os = Î» e o â†’ âŸ¦ t âŸ§ (o âˆ· renâŠ©* e os)
âŸ¦ tâ‚ `$ tâ‚‚ âŸ§ os = âŸ¦ tâ‚ âŸ§ os reflâŠ† $ âŸ¦ tâ‚‚ âŸ§ os
âŸ¦ tâ‚ `, tâ‚‚ âŸ§ os = âŸ¦ tâ‚ âŸ§ os , âŸ¦ tâ‚‚ âŸ§ os
âŸ¦ `projâ‚ t âŸ§ os = projâ‚ (âŸ¦ t âŸ§ os)
âŸ¦ `projâ‚‚ t âŸ§ os = projâ‚‚ (âŸ¦ t âŸ§ os)
âŸ¦ `unit    âŸ§ os = unit


----------------------------------------------------------------------------------------------------

mutual
  â†‘ : âˆ€ {Î“ A} {t : Î“ âŠ¢ A} â†’ NNF t â†’ Î“ âŠ© A
  â†‘ {A = A `âŠƒ B} p = Î» e o â†’ â†‘ (renNNF e p `$ projâ‚‚ (â†“ o))
  â†‘ {A = A `âˆ§ B} p = â†‘ (`projâ‚ p) , â†‘ (`projâ‚‚ p)
  â†‘ {A = `ğŸ™}     p = unit

  â†“ : âˆ€ {Î“ A} â†’ Î“ âŠ© A â†’ Î£ (Î“ âŠ¢ A) Î» t â†’ NF t
  â†“ {A = A `âŠƒ B} f         with â†“ (f wkâŠ† (â†‘ (`v {i = zero})))
  ... | t , p                = `Î» t , `Î»
  â†“ {A = A `âˆ§ B} (oâ‚ , oâ‚‚) with â†“ oâ‚ | â†“ oâ‚‚
  ... | tâ‚ , pâ‚ | tâ‚‚ , pâ‚‚    = tâ‚ `, tâ‚‚ , _`,_
  â†“ {A = `ğŸ™}     unit      = `unit , `unit

reflâŠ©* : âˆ€ {Î“} â†’ Î“ âŠ©* Î“
reflâŠ©* {[]}    = []
reflâŠ©* {A âˆ· Î“} = â†‘ (`v {i = zero}) âˆ· renâŠ©* wkâŠ† reflâŠ©*

-- reification
âŸ¦_âŸ§â»Â¹ : âˆ€ {Î“ A} â†’ Î“ âŠ¨ A â†’ Î£ (Î“ âŠ¢ A) Î» tâ€² â†’ NF tâ€²
âŸ¦ o âŸ§â»Â¹ = â†“ (o reflâŠ©*)

nbe : âˆ€ {Î“ A} â†’ Î“ âŠ¢ A â†’ Î£ (Î“ âŠ¢ A) Î» tâ€² â†’ NF tâ€²
nbe = âŸ¦_âŸ§â»Â¹ âˆ˜ âŸ¦_âŸ§


----------------------------------------------------------------------------------------------------
