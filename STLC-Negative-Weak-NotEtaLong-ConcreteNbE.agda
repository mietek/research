module STLC-Negative-Weak-NotEtaLong-ConcreteNbE where

open import STLC-Negative-Weak-NotEtaLong public


----------------------------------------------------------------------------------------------------

-- semantic values
infix 3 _âŠ©_
_âŠ©_ : Ctx â†’ Ty â†’ Set
W âŠ© A âŒœâŠƒâŒ B = âˆ€ {Wâ€²} â†’ W âŠ† Wâ€² â†’ Wâ€² âŠ© A â†’ Wâ€² âŠ© B
W âŠ© A âŒœâˆ§âŒ B = W âŠ© A Ã— W âŠ© B
W âŠ© âŒœğŸ™âŒ     = ğŸ™

renâŠ© : âˆ€ {W Wâ€² A} â†’ W âŠ† Wâ€² â†’ W âŠ© A â†’ Wâ€² âŠ© A
renâŠ© {A = A âŒœâŠƒâŒ B} e v         = Î» eâ€² â†’ v (transâŠ† e eâ€²)
renâŠ© {A = A âŒœâˆ§âŒ B} e (vâ‚ , vâ‚‚) = renâŠ© e vâ‚ , renâŠ© e vâ‚‚
renâŠ© {A = âŒœğŸ™âŒ}     e unit      = unit

open âŠ©Kit _âŠ©_ (Î» {W} {Wâ€²} {A} â†’ renâŠ© {A = A}) public

-- reflection
âŸ¦_âŸ§ : âˆ€ {Î“ A} â†’ Î“ âŠ¢ A â†’ Î“ âŠ¨ A
âŸ¦ âŒœvâŒ i     âŸ§ vs = âŸ¦ i âŸ§âˆ‹ vs
âŸ¦ âŒœÎ»âŒ t     âŸ§ vs = Î» e v â†’ âŸ¦ t âŸ§ (v âˆ· renâŠ©* e vs)
âŸ¦ tâ‚ âŒœ$âŒ tâ‚‚ âŸ§ vs = âŸ¦ tâ‚ âŸ§ vs reflâŠ† $ âŸ¦ tâ‚‚ âŸ§ vs
âŸ¦ tâ‚ âŒœ,âŒ tâ‚‚ âŸ§ vs = âŸ¦ tâ‚ âŸ§ vs , âŸ¦ tâ‚‚ âŸ§ vs
âŸ¦ âŒœprojâ‚âŒ t âŸ§ vs = projâ‚ (âŸ¦ t âŸ§ vs)
âŸ¦ âŒœprojâ‚‚âŒ t âŸ§ vs = projâ‚‚ (âŸ¦ t âŸ§ vs)
âŸ¦ âŒœunitâŒ    âŸ§ vs = unit


----------------------------------------------------------------------------------------------------

mutual
  â†‘ : âˆ€ {Î“ A} â†’ Î£ (Î“ âŠ¢ A) NNF â†’ Î“ âŠ© A
  â†‘ {A = A âŒœâŠƒâŒ B} (_ , pâ‚) = Î» e vâ‚‚ â†’ let _ , pâ‚‚ = â†“ vâ‚‚ in
                               â†‘ (_ , renâŠ¢NNF e pâ‚ âŒœ$âŒ pâ‚‚)
  â†‘ {A = A âŒœâˆ§âŒ B} (_ , p)  = â†‘ (_ , âŒœprojâ‚âŒ p) , â†‘ (_ , âŒœprojâ‚‚âŒ p)
  â†‘ {A = âŒœğŸ™âŒ}     (_ , p)  = unit

  â†“ : âˆ€ {Î“ A} â†’ Î“ âŠ© A â†’ Î£ (Î“ âŠ¢ A) NF
  â†“ {A = A âŒœâŠƒâŒ B} v         = let t , p = â†“ (v wkâŠ† (â†‘ (âŒœvâŒ zero , âŒœvâŒ-))) in
                                âŒœÎ»âŒ t , âŒœÎ»âŒ-
  â†“ {A = A âŒœâˆ§âŒ B} (vâ‚ , vâ‚‚) = let tâ‚ , pâ‚ = â†“ vâ‚
                                  tâ‚‚ , pâ‚‚ = â†“ vâ‚‚ in
                                tâ‚ âŒœ,âŒ tâ‚‚ , -âŒœ,âŒ-
  â†“ {A = âŒœğŸ™âŒ}     unit        = _ , âŒœunitâŒ

reflâŠ©* : âˆ€ {Î“} â†’ Î“ âŠ©* Î“
reflâŠ©* {[]}    = []
reflâŠ©* {A âˆ· Î“} = â†‘ (âŒœvâŒ zero , âŒœvâŒ-) âˆ· renâŠ©* wkâŠ† reflâŠ©*

-- reification
âŸ¦_âŸ§â»Â¹ : âˆ€ {Î“ A} â†’ Î“ âŠ¨ A â†’ Î£ (Î“ âŠ¢ A) NF
âŸ¦ v âŸ§â»Â¹ = â†“ (v reflâŠ©*)

nbe : âˆ€ {Î“ A} â†’ Î“ âŠ¢ A â†’ Î£ (Î“ âŠ¢ A) NF
nbe t = âŸ¦ âŸ¦ t âŸ§ âŸ§â»Â¹


----------------------------------------------------------------------------------------------------
