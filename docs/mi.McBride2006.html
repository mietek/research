<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=yes">
  <title>C. McBride (2006) Type-preserving renaming and substitution — Machine Intuitionist</title>
  <link rel="stylesheet" href="mi-common.css">
  <link rel="stylesheet" href="mi-layout.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
    var mathElements = document.getElementsByClassName("math");
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") { katex.render(texText.data, mathElements[i], { displayMode: mathElements[i].classList.contains("display"), throwOnError: false } );
    }}});</script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/katex.min.css" />
</head>
<body>
<nav id="head">
<p><a href="mi.index.html">Machine Intuitionist</a></p>
</nav>
<main>
<header id="title-block-header">
<h1 class="title">Type-preserving<br>renaming and substitution</h1>
<p class="author">Conor McBride</p>
<p class="year">2006</p>
</header>
<pre class="Agda"><a id="386" class="Comment">-- Re-mechanised by Miëtek Bak</a>

<a id="418" class="Keyword">module</a> <a id="425" href="mi.McBride2006.html" class="Module">mi.McBride2006</a> <a id="440" class="Keyword">where</a>

<a id="id"></a><a id="447" href="mi.McBride2006.html#447" class="Function">id</a> <a id="450" class="Symbol">:</a> <a id="452" class="Symbol">∀</a> <a id="454" class="Symbol">{</a><a id="455" href="mi.McBride2006.html#455" class="Bound">𝒶</a><a id="456" class="Symbol">}</a> <a id="458" class="Symbol">{</a><a id="459" href="mi.McBride2006.html#459" class="Bound">A</a> <a id="461" class="Symbol">:</a> <a id="463" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="467" href="mi.McBride2006.html#455" class="Bound">𝒶</a><a id="468" class="Symbol">}</a> <a id="470" class="Symbol">→</a> <a id="472" href="mi.McBride2006.html#459" class="Bound">A</a> <a id="474" class="Symbol">→</a> <a id="476" href="mi.McBride2006.html#459" class="Bound">A</a>
<a id="478" href="mi.McBride2006.html#447" class="Function">id</a> <a id="481" href="mi.McBride2006.html#481" class="Bound">x</a> <a id="483" class="Symbol">=</a> <a id="485" href="mi.McBride2006.html#481" class="Bound">x</a>
</pre>
<p>I present a substitution algorithm for the simply-typed λ-calculus, represented in the style of Altenkirch and Reus <a href="#r1" id="rr1" class="rr">(1999)</a> which is statically guaranteed to respect scope and type. Moreover, I use a single traversal function, instantiated first to renaming, then to substitution. The program is written in Epigram <a href="#r5" id="rr5" class="rr">(McBride &amp; McKinna, 2004)</a>.</p>
<h2 id="1-introduction">1. Introduction</h2>
<p>In this paper, I give a small but indicative example of programming with <em>inductive families of datatypes</em> <a href="#r4" id="rr4" class="rr">(Dybjer, 1991)</a> in the dependently typed functional programming language, Epigram <a href="#r5" id="rr5-1" class="rr">(McBride &amp; McKinna, 2004)</a>. I present <em>type-preserving</em> renaming and substitution for the <em>type-correct</em> representation of the simply-typed <span class="math inline">λ</span>-calculus given by Altenkirch and Reus <a href="#r1" id="rr1-1" class="rr">(1999)</a>. I should draw attention to two aspects of this program:</p>
<ul>
<li><p>Renaming and substitution turn out to be instances of a single traversal operation, pushing functions from variables to ‘stuff’ through terms, for a suitable notion of ‘stuff’. This traversal operation is structurally recursive, hence clearly total.</p></li>
<li><p>Type preservation is clearly promised by the types of these programs; in their bodies, the amount of syntax required to fulfil this promise is <em>none whatsoever</em>. The ill-concealed ulterior motive of this paper is to put Epigram’s notational innovations through their paces.</p></li>
</ul>
<p>The only significant cosmetic treatment I have given the code is to delete a few brackets and make some of the operators infix: the honest ASCII thus looks a little clumsier. I suppressed no details: the process usually referred to vaguely as ‘type inference’ is hard at work here, inferring <em>values</em> determined by the dependent types in which they occur.</p>
<h2 id="2-simply-typed-λ-calculus">2. Simply typed <span class="math inline">λ</span>-calculus</h2>
<p>Figure 1 gives the now traditional definition of the type-correct simply-typed <span class="math inline">λ</span>-terms in Epigram’s two-dimensional syntax. The natural deduction style emphasises the connection between inductive families of datatypes and deduction systems. Each rule types the general usage of a new symbol, below the line, in terms of parameters typed above the line. You can read ‘<span class="math inline">:</span>’ as ‘has type’ and ‘<span class="math inline">\star</span>’ as the type of types.</p>
<div class="align-top">
<p><span class="math display">
\begin{aligned}
  &amp;\underline{\textrm{data}}
    &amp;&amp;\frac{}{\textsf{Ty} : \star}
    &amp;&amp;\underline{\textrm{where}}
    &amp;&amp;\frac{}{\bullet : \textsf{Ty}}\quad
    \frac{S,T : \textsf{Ty}}{S \vartriangleright T : \textsf{Ty}}\\\\
  &amp;\underline{\textrm{data}}
    &amp;&amp;\frac{}{\textsf{Ctxt} : \star}
    &amp;&amp;\underline{\textrm{where}}
    &amp;&amp;\frac{}{\mathcal{E} : \textsf{Ctxt}}\quad
    \frac{Γ : \textsf{Ctxt}\quad S : \textsf{Ty}}{Γ :: S : \textsf{Ctxt}}\\\\
  &amp;\underline{\textrm{data}}
    &amp;&amp;\frac{Γ : \textsf{Ctxt}\quad T : \textsf{Ty}}{Γ ∋ T : \star}
    &amp;&amp;\underline{\textrm{where}}
    &amp;&amp;\frac{}{\textsf{vz} : Γ :: S ∋ S}\quad
    \frac{x : Γ ∋ T}{\textsf{vs}\ x : Γ :: S ∋ T}\\\\
  &amp;\underline{\textrm{data}}
    &amp;&amp;\frac{Γ : \textsf{Ctxt}\quad T : \textsf{Ty}}{Γ \blacktriangleright T : \star}
    &amp;&amp;\underline{\textrm{where}}
    &amp;&amp;\frac{x : Γ ∋ T}{\textsf{var}\ x : Γ \blacktriangleright T}\quad
    \frac{t : Γ :: S \blacktriangleright T}
         {\textsf{lam}\ t : Γ \blacktriangleright S \vartriangleright T}\\[11pt]
    &amp;&amp;&amp;&amp;&amp;&amp;&amp;\frac{f : Γ \blacktriangleright S \vartriangleright T\quad s : Γ \blacktriangleright S}
                {\textsf{app}\ s\ t : Γ \blacktriangleright T}
\end{aligned}
</span></p>
<p>Fig. 1. The simply typed λ-calculus</p>
<pre class="Agda"><a id="4011" class="Keyword">data</a> <a id="Ty"></a><a id="4016" href="mi.McBride2006.html#4016" class="Datatype">Ty</a> <a id="4019" class="Symbol">:</a> <a id="4021" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="4025" class="Keyword">where</a>
  <a id="Ty.•"></a><a id="4033" href="mi.McBride2006.html#4033" class="InductiveConstructor">•</a>   <a id="4037" class="Symbol">:</a> <a id="4039" href="mi.McBride2006.html#4016" class="Datatype">Ty</a>
  <a id="Ty._▷_"></a><a id="4044" href="mi.McBride2006.html#4044" class="InductiveConstructor Operator">_▷_</a> <a id="4048" class="Symbol">:</a> <a id="4050" class="Symbol">∀</a> <a id="4052" class="Symbol">(</a><a id="4053" href="mi.McBride2006.html#4053" class="Bound">S</a> <a id="4055" href="mi.McBride2006.html#4055" class="Bound">T</a> <a id="4057" class="Symbol">:</a> <a id="4059" href="mi.McBride2006.html#4016" class="Datatype">Ty</a><a id="4061" class="Symbol">)</a> <a id="4063" class="Symbol">→</a> <a id="4065" href="mi.McBride2006.html#4016" class="Datatype">Ty</a>

<a id="4069" class="Keyword">data</a> <a id="Ctxt"></a><a id="4074" href="mi.McBride2006.html#4074" class="Datatype">Ctxt</a> <a id="4079" class="Symbol">:</a> <a id="4081" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="4085" class="Keyword">where</a>
  <a id="Ctxt.ℰ"></a><a id="4093" href="mi.McBride2006.html#4093" class="InductiveConstructor">ℰ</a>   <a id="4097" class="Symbol">:</a> <a id="4099" href="mi.McBride2006.html#4074" class="Datatype">Ctxt</a>
  <a id="Ctxt._∷_"></a><a id="4106" href="mi.McBride2006.html#4106" class="InductiveConstructor Operator">_∷_</a> <a id="4110" class="Symbol">:</a> <a id="4112" class="Symbol">∀</a> <a id="4114" class="Symbol">(</a><a id="4115" href="mi.McBride2006.html#4115" class="Bound">Γ</a> <a id="4117" class="Symbol">:</a> <a id="4119" href="mi.McBride2006.html#4074" class="Datatype">Ctxt</a><a id="4123" class="Symbol">)</a> <a id="4125" class="Symbol">→</a> <a id="4127" class="Symbol">(</a><a id="4128" href="mi.McBride2006.html#4128" class="Bound">S</a> <a id="4130" class="Symbol">:</a> <a id="4132" href="mi.McBride2006.html#4016" class="Datatype">Ty</a><a id="4134" class="Symbol">)</a> <a id="4136" class="Symbol">→</a> <a id="4138" href="mi.McBride2006.html#4074" class="Datatype">Ctxt</a>

<a id="4144" class="Keyword">data</a> <a id="_∋_"></a><a id="4149" href="mi.McBride2006.html#4149" class="Datatype Operator">_∋_</a> <a id="4153" class="Symbol">:</a> <a id="4155" href="mi.McBride2006.html#4074" class="Datatype">Ctxt</a> <a id="4160" class="Symbol">→</a> <a id="4162" href="mi.McBride2006.html#4016" class="Datatype">Ty</a> <a id="4165" class="Symbol">→</a> <a id="4167" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="4171" class="Keyword">where</a>
  <a id="_∋_.vz"></a><a id="4179" href="mi.McBride2006.html#4179" class="InductiveConstructor">vz</a>  <a id="4183" class="Symbol">:</a> <a id="4185" class="Symbol">∀</a> <a id="4187" class="Symbol">{</a><a id="4188" href="mi.McBride2006.html#4188" class="Bound">Γ</a> <a id="4190" href="mi.McBride2006.html#4190" class="Bound">S</a><a id="4191" class="Symbol">}</a> <a id="4193" class="Symbol">→</a> <a id="4195" class="Symbol">(</a><a id="4196" href="mi.McBride2006.html#4188" class="Bound">Γ</a> <a id="4198" href="mi.McBride2006.html#4106" class="InductiveConstructor Operator">∷</a> <a id="4200" href="mi.McBride2006.html#4190" class="Bound">S</a><a id="4201" class="Symbol">)</a> <a id="4203" href="mi.McBride2006.html#4149" class="Datatype Operator">∋</a> <a id="4205" href="mi.McBride2006.html#4190" class="Bound">S</a>
  <a id="_∋_.vs"></a><a id="4209" href="mi.McBride2006.html#4209" class="InductiveConstructor">vs</a>  <a id="4213" class="Symbol">:</a> <a id="4215" class="Symbol">∀</a> <a id="4217" class="Symbol">{</a><a id="4218" href="mi.McBride2006.html#4218" class="Bound">Γ</a> <a id="4220" href="mi.McBride2006.html#4220" class="Bound">S</a> <a id="4222" href="mi.McBride2006.html#4222" class="Bound">T</a><a id="4223" class="Symbol">}</a> <a id="4225" class="Symbol">(</a><a id="4226" href="mi.McBride2006.html#4226" class="Bound">x</a> <a id="4228" class="Symbol">:</a> <a id="4230" href="mi.McBride2006.html#4218" class="Bound">Γ</a> <a id="4232" href="mi.McBride2006.html#4149" class="Datatype Operator">∋</a> <a id="4234" href="mi.McBride2006.html#4222" class="Bound">T</a><a id="4235" class="Symbol">)</a> <a id="4237" class="Symbol">→</a> <a id="4239" class="Symbol">(</a><a id="4240" href="mi.McBride2006.html#4218" class="Bound">Γ</a> <a id="4242" href="mi.McBride2006.html#4106" class="InductiveConstructor Operator">∷</a> <a id="4244" href="mi.McBride2006.html#4220" class="Bound">S</a><a id="4245" class="Symbol">)</a> <a id="4247" href="mi.McBride2006.html#4149" class="Datatype Operator">∋</a> <a id="4249" href="mi.McBride2006.html#4222" class="Bound">T</a>

<a id="4252" class="Keyword">data</a> <a id="_▶︎_"></a><a id="4257" href="mi.McBride2006.html#4257" class="Datatype Operator">_▶︎_</a> <a id="4262" class="Symbol">(</a><a id="4263" href="mi.McBride2006.html#4263" class="Bound">Γ</a> <a id="4265" class="Symbol">:</a> <a id="4267" href="mi.McBride2006.html#4074" class="Datatype">Ctxt</a><a id="4271" class="Symbol">)</a> <a id="4273" class="Symbol">:</a> <a id="4275" href="mi.McBride2006.html#4016" class="Datatype">Ty</a> <a id="4278" class="Symbol">→</a> <a id="4280" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="4284" class="Keyword">where</a>
  <a id="_▶︎_.var"></a><a id="4292" href="mi.McBride2006.html#4292" class="InductiveConstructor">var</a> <a id="4296" class="Symbol">:</a> <a id="4298" class="Symbol">∀</a> <a id="4300" class="Symbol">{</a><a id="4301" href="mi.McBride2006.html#4301" class="Bound">T</a><a id="4302" class="Symbol">}</a> <a id="4304" class="Symbol">(</a><a id="4305" href="mi.McBride2006.html#4305" class="Bound">x</a> <a id="4307" class="Symbol">:</a> <a id="4309" href="mi.McBride2006.html#4263" class="Bound">Γ</a> <a id="4311" href="mi.McBride2006.html#4149" class="Datatype Operator">∋</a> <a id="4313" href="mi.McBride2006.html#4301" class="Bound">T</a><a id="4314" class="Symbol">)</a> <a id="4316" class="Symbol">→</a> <a id="4318" href="mi.McBride2006.html#4263" class="Bound">Γ</a> <a id="4320" href="mi.McBride2006.html#4257" class="Datatype Operator">▶︎</a> <a id="4323" href="mi.McBride2006.html#4301" class="Bound">T</a>
  <a id="_▶︎_.lam"></a><a id="4327" href="mi.McBride2006.html#4327" class="InductiveConstructor">lam</a> <a id="4331" class="Symbol">:</a> <a id="4333" class="Symbol">∀</a> <a id="4335" class="Symbol">{</a><a id="4336" href="mi.McBride2006.html#4336" class="Bound">S</a> <a id="4338" href="mi.McBride2006.html#4338" class="Bound">T</a><a id="4339" class="Symbol">}</a> <a id="4341" class="Symbol">(</a><a id="4342" href="mi.McBride2006.html#4342" class="Bound">t</a> <a id="4344" class="Symbol">:</a> <a id="4346" class="Symbol">(</a><a id="4347" href="mi.McBride2006.html#4263" class="Bound">Γ</a> <a id="4349" href="mi.McBride2006.html#4106" class="InductiveConstructor Operator">∷</a> <a id="4351" href="mi.McBride2006.html#4336" class="Bound">S</a><a id="4352" class="Symbol">)</a> <a id="4354" href="mi.McBride2006.html#4257" class="Datatype Operator">▶︎</a> <a id="4357" href="mi.McBride2006.html#4338" class="Bound">T</a><a id="4358" class="Symbol">)</a> <a id="4360" class="Symbol">→</a> <a id="4362" href="mi.McBride2006.html#4263" class="Bound">Γ</a> <a id="4364" href="mi.McBride2006.html#4257" class="Datatype Operator">▶︎</a> <a id="4367" class="Symbol">(</a><a id="4368" href="mi.McBride2006.html#4336" class="Bound">S</a> <a id="4370" href="mi.McBride2006.html#4044" class="InductiveConstructor Operator">▷</a> <a id="4372" href="mi.McBride2006.html#4338" class="Bound">T</a><a id="4373" class="Symbol">)</a>
  <a id="_▶︎_.app"></a><a id="4377" href="mi.McBride2006.html#4377" class="InductiveConstructor">app</a> <a id="4381" class="Symbol">:</a> <a id="4383" class="Symbol">∀</a> <a id="4385" class="Symbol">{</a><a id="4386" href="mi.McBride2006.html#4386" class="Bound">S</a> <a id="4388" href="mi.McBride2006.html#4388" class="Bound">T</a><a id="4389" class="Symbol">}</a> <a id="4391" class="Symbol">(</a><a id="4392" href="mi.McBride2006.html#4392" class="Bound">f</a> <a id="4394" class="Symbol">:</a> <a id="4396" href="mi.McBride2006.html#4263" class="Bound">Γ</a> <a id="4398" href="mi.McBride2006.html#4257" class="Datatype Operator">▶︎</a> <a id="4401" class="Symbol">(</a><a id="4402" href="mi.McBride2006.html#4386" class="Bound">S</a> <a id="4404" href="mi.McBride2006.html#4044" class="InductiveConstructor Operator">▷</a> <a id="4406" href="mi.McBride2006.html#4388" class="Bound">T</a><a id="4407" class="Symbol">))</a> <a id="4410" class="Symbol">(</a><a id="4411" href="mi.McBride2006.html#4411" class="Bound">s</a> <a id="4413" class="Symbol">:</a> <a id="4415" href="mi.McBride2006.html#4263" class="Bound">Γ</a> <a id="4417" href="mi.McBride2006.html#4257" class="Datatype Operator">▶︎</a> <a id="4420" href="mi.McBride2006.html#4386" class="Bound">S</a><a id="4421" class="Symbol">)</a> <a id="4423" class="Symbol">→</a> <a id="4425" href="mi.McBride2006.html#4263" class="Bound">Γ</a> <a id="4427" href="mi.McBride2006.html#4257" class="Datatype Operator">▶︎</a> <a id="4430" href="mi.McBride2006.html#4388" class="Bound">T</a>
</pre>
</div>
<p>This may seem like overkill for ‘simple’ definitions like <span class="math inline">\textsf{Ty}</span> (for simple types) and <span class="math inline">\textsf{Ctxt}</span> (for contexts—reversed lists of simple types), which you might imagine writing grammar-style, like this:</p>
<p><span class="math display">
\begin{aligned}
  &amp;\underline{\textrm{data}}\ \textsf{Ty} =
    \bullet\ |\ \textsf{Ty} \vartriangleright \textsf{Ty}\\
  &amp;\underline{\textrm{data}}\ \textsf{Ctx} =
    \mathcal{E}\ |\ \textsf{Ctxt} :: \textsf{Ty}
\end{aligned}
</span></p>
<p>The production <span class="math inline">\textsf{Ty} \vartriangleright \textsf{Ty}</span> makes perfect sense in a language where types and values are rigidly separated, but in Epigram it’s actually a well-formed but ill-typed application! Our notation invites the programmer to write a set of <em>patterns</em> for data, naming their parts: these patterns and these names reappear when you edit interactively, as the machine generates exhaustive case analyses on the left-hand sides of programs.</p>
<p>Naming becomes practically indispensable once types start to depend on values. Moreover, <em>inductive families of datatypes</em> assign individual return types for each constructor, an unconventional practice which again leads us away from the conventional notation.</p>
<p>Here, the ‘<span class="math inline">\ni</span>’ family presents <em>variables</em> as an inference system for context membership. This representation amounts to de Bruijn indices <a href="#r3" id="rr3" class="rr">(de Bruijn, 1972)</a>, but correctly typed and scoped. Meanwhile, the ‘<span class="math inline">\blacktriangleright</span>’ family presents simply-typed terms via their typing rules, extending the context under a <span class="math inline">\textsf{lam}</span> and policing the compatibility of domain and argument in an <span class="math inline">\textsf{app}.</span> Note that ‘<span class="math inline">::</span>’ and ‘<span class="math inline">\vartriangleright</span>’ bind more tightly than ‘<span class="math inline">\ni</span>’ and ‘<span class="math inline">\blacktriangleright</span>’.</p>
<p>The form of a rule’s conclusion quietly specifies which arguments are to be kept implicit and which should be shown. In the data constructors for ‘<span class="math inline">\ni</span>’ and ‘<span class="math inline">\blacktriangleright</span>’, you’ll find <span class="math inline">Γ,</span> <span class="math inline">S,</span> and <span class="math inline">T</span> undeclared—their types are inferable from usage by standard techniques <a href="#r2" id="rr2" class="rr">(Damas &amp; Milner, 1982)</a>. Moreover, the natural deduction rule serves like ‘let’ in the Hindley-Milner system to indicate the point at which variables should be generalised where possible. In effect, we may omit declarations for an <em>initial</em> segment of parameters to a rule, provided their types are inferable.</p>
<p>What has happened? The usual alignment of the implicit-versus-explicit with type-versus-value is so traditional that you almost forget it’s a design choice. Dependent types make that choice untenable, but it’s not the end of the world.</p>
<h2 id="3-renaming-and-substitution-together">3. Renaming and substitution, together</h2>
<p>Renaming and substitution are both term traversals, lifting an operation on variables structurally to the corresponding operation on terms. Each must perform an appropriate lifting to push an operation under a <span class="math inline">\textsf{lam}</span>. Where these operations differ is in the image of variables: renamings map variables to variables and substitutions map variables to terms. Here, I abstract the pattern, showing how to traverse terms, mapping variables to any stuff which supports the necessary equipment. What’s stuff? It’s a type family ‘<span class="math inline">\blacklozenge</span>’ indexed by <span class="math inline">\textsf{Ctxt}</span> and <span class="math inline">\textsf{Ty}.</span> What’s the necessary equipment? Here it is:</p>
<div class="align-top">
<p><span class="math display">
\begin{aligned}
  &amp;\underline{\textrm{data}}\quad
    \frac{\frac{G\ :\ \textsf{Ctxt}\quad T\ :\ \textsf{Ty}}{G\ \blacklozenge\ T\ :\ \star}}
         {\textsf{Kit}(\blacklozenge) : \star}\\[11pt]
  &amp;\underline{\textrm{where}}\quad
    \frac{(\blacklozenge)\quad
          \frac{x\ :\ Γ\ ∋\ T}{vr\ x\ :\ Γ\ \blacklozenge\ T}\quad
          \frac{i\ :\ Γ\ \blacklozenge\ T}{tm\ i\ :\ Γ\ \blacktriangleright\ T}\quad
          \frac{i\ :\ Γ\ \blacklozenge\ T}{wk\ i\ :\ Γ\ ::\ S\ \blacklozenge\ T}}
         {\textsf{kit}\ vr\ tm\ wk : \textsf{Kit}(\blacklozenge)}
\end{aligned}
</span></p>
<pre class="Agda"><a id="8299" class="Keyword">record</a> <a id="Kit"></a><a id="8306" href="mi.McBride2006.html#8306" class="Record">Kit</a> <a id="8310" class="Symbol">(</a><a id="8311" href="mi.McBride2006.html#8311" class="Bound Operator">_◆_</a> <a id="8315" class="Symbol">:</a> <a id="8317" href="mi.McBride2006.html#4074" class="Datatype">Ctxt</a> <a id="8322" class="Symbol">→</a> <a id="8324" href="mi.McBride2006.html#4016" class="Datatype">Ty</a> <a id="8327" class="Symbol">→</a> <a id="8329" href="Agda.Primitive.html#388" class="Primitive">Set</a><a id="8332" class="Symbol">)</a> <a id="8334" class="Symbol">:</a> <a id="8336" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="8340" class="Keyword">where</a>
  <a id="8348" class="Keyword">constructor</a> <a id="kit"></a><a id="8360" href="mi.McBride2006.html#8360" class="InductiveConstructor">kit</a>
  <a id="8366" class="Keyword">field</a>
    <a id="Kit.vr"></a><a id="8376" href="mi.McBride2006.html#8376" class="Field">vr</a> <a id="8379" class="Symbol">:</a> <a id="8381" class="Symbol">∀</a> <a id="8383" class="Symbol">{</a><a id="8384" href="mi.McBride2006.html#8384" class="Bound">Γ</a> <a id="8386" href="mi.McBride2006.html#8386" class="Bound">T</a><a id="8387" class="Symbol">}</a> <a id="8389" class="Symbol">(</a><a id="8390" href="mi.McBride2006.html#8390" class="Bound">x</a> <a id="8392" class="Symbol">:</a> <a id="8394" href="mi.McBride2006.html#8384" class="Bound">Γ</a> <a id="8396" href="mi.McBride2006.html#4149" class="Datatype Operator">∋</a> <a id="8398" href="mi.McBride2006.html#8386" class="Bound">T</a><a id="8399" class="Symbol">)</a> <a id="8401" class="Symbol">→</a> <a id="8403" href="mi.McBride2006.html#8384" class="Bound">Γ</a> <a id="8405" href="mi.McBride2006.html#8311" class="Bound Operator">◆</a> <a id="8407" href="mi.McBride2006.html#8386" class="Bound">T</a>
    <a id="Kit.tm"></a><a id="8413" href="mi.McBride2006.html#8413" class="Field">tm</a> <a id="8416" class="Symbol">:</a> <a id="8418" class="Symbol">∀</a> <a id="8420" class="Symbol">{</a><a id="8421" href="mi.McBride2006.html#8421" class="Bound">Γ</a> <a id="8423" href="mi.McBride2006.html#8423" class="Bound">T</a><a id="8424" class="Symbol">}</a> <a id="8426" class="Symbol">(</a><a id="8427" href="mi.McBride2006.html#8427" class="Bound">i</a> <a id="8429" class="Symbol">:</a> <a id="8431" href="mi.McBride2006.html#8421" class="Bound">Γ</a> <a id="8433" href="mi.McBride2006.html#8311" class="Bound Operator">◆</a> <a id="8435" href="mi.McBride2006.html#8423" class="Bound">T</a><a id="8436" class="Symbol">)</a> <a id="8438" class="Symbol">→</a> <a id="8440" href="mi.McBride2006.html#8421" class="Bound">Γ</a> <a id="8442" href="mi.McBride2006.html#4257" class="Datatype Operator">▶︎</a> <a id="8445" href="mi.McBride2006.html#8423" class="Bound">T</a>
    <a id="Kit.wk"></a><a id="8451" href="mi.McBride2006.html#8451" class="Field">wk</a> <a id="8454" class="Symbol">:</a> <a id="8456" class="Symbol">∀</a> <a id="8458" class="Symbol">{</a><a id="8459" href="mi.McBride2006.html#8459" class="Bound">Γ</a> <a id="8461" href="mi.McBride2006.html#8461" class="Bound">S</a> <a id="8463" href="mi.McBride2006.html#8463" class="Bound">T</a><a id="8464" class="Symbol">}</a> <a id="8466" class="Symbol">(</a><a id="8467" href="mi.McBride2006.html#8467" class="Bound">i</a> <a id="8469" class="Symbol">:</a> <a id="8471" href="mi.McBride2006.html#8459" class="Bound">Γ</a> <a id="8473" href="mi.McBride2006.html#8311" class="Bound Operator">◆</a> <a id="8475" href="mi.McBride2006.html#8463" class="Bound">T</a><a id="8476" class="Symbol">)</a> <a id="8478" class="Symbol">→</a> <a id="8480" class="Symbol">(</a><a id="8481" href="mi.McBride2006.html#8459" class="Bound">Γ</a> <a id="8483" href="mi.McBride2006.html#4106" class="InductiveConstructor Operator">∷</a> <a id="8485" href="mi.McBride2006.html#8461" class="Bound">S</a><a id="8486" class="Symbol">)</a> <a id="8488" href="mi.McBride2006.html#8311" class="Bound Operator">◆</a> <a id="8490" href="mi.McBride2006.html#8463" class="Bound">T</a>
</pre>
</div>
<p>We need ‘<span class="math inline">\blacklozenge</span>’ to support three things: a mapping in from the variables, a mapping out to the terms, and a weakening map which extends the context. Renaming will instantiate ‘<span class="math inline">\blacklozenge</span>’ with ‘<span class="math inline">\ni</span>’; for substitution, we may choose ‘<span class="math inline">\blacktriangleright</span>’ instead. Now we need to show how to traverse terms with any <span class="math inline">\textsf{Kit}</span>, and how to build the <span class="math inline">\textsf{Kit}</span>s we need.</p>
<p>By the way, you may have noticed that I have nested natural deduction rules in order to declare parameters which themselves have functional types. Epigram has ‘hypothetical hypotheses’ hereditarily. As before, these rules indicate points where variables should be generalised where possible. Correspondingly, it is sometimes necessary to insert an (untyped) declaration at an outer level, in order to suppress generalisation at an inner level. For example, in the declaration of <span class="math inline">\textsf{kit},</span> it’s important that each operation is general with respect to contexts and types, but they should all apply to a fixed instance of ‘<span class="math inline">\blacklozenge</span>’, hence its explicit declaration.</p>
<p>How do we traverse a term, given a <span class="math inline">\textsf{Kit}</span>? In general, we have a type-preserving map <span class="math inline">τ</span> from variables over context <span class="math inline">Γ</span> to stuff over <span class="math inline">Δ</span>. We can push that map through terms in a type-preserving way as follows:</p>
<div class="align-top">
<p><span class="math display">
\begin{aligned}
  &amp;\underline{\textrm{let}}
    &amp;&amp;\frac{K : \textsf{Kit}(\blacklozenge)\quad
            Γ, Δ\quad
            \frac{x\ :\ Γ\ ∋\ X}{τ\ x\ :\ Δ\ \blacklozenge\ X}\quad
            t : Γ \blacktriangleright T}
           {\textbf{trav}\ K\ τ\ t : Δ \vartriangleright T}\\[11pt]
  &amp;&amp;&amp;\textbf{trav}\ K\ τ\ t ⇐ \underline{\textrm{rec}}\ t\ \{\\
  &amp;&amp;&amp;\quad\textbf{trav}\ K\ τ\ t ⇐ \underline{\textrm{case}}\ t\ \{\\
  &amp;&amp;&amp;\qquad\textbf{trav}\ K\ τ\ (\textsf{var}\ x) ⇐ \underline{\textrm{case}}\ K\ \{\\
  &amp;&amp;&amp;\qquad\quad\textbf{trav}\ (\textsf{kit}\ vr\ tm\ wk)\ τ\ (\textsf{var}\ x) ⇒
    tm\ (τ\ x)\ \}\\
  &amp;&amp;&amp;\qquad\textbf{trav}\ K\ τ\ (\textsf{lam}\ t&#39;) ⇒
    \textsf{lam}\ (\textbf{trav}\ K\ (\textbf{lift}\ K\ τ)\ t&#39;)\\
  &amp;&amp;&amp;\qquad\textbf{trav}\ K\ τ\ (\textsf{app}\ f\ s) ⇒
    \textsf{app}\ (\textbf{trav}\ K\ τ\ f)\ (\textbf{trav}\ K\ τ\ s)\ \}\}
\end{aligned}
</span></p>
<pre class="Agda"><a id="10710" class="Keyword">mutual</a>
  <a id="trav"></a><a id="10719" href="mi.McBride2006.html#10719" class="Function">trav</a> <a id="10724" class="Symbol">:</a> <a id="10726" class="Symbol">∀</a> <a id="10728" class="Symbol">{</a><a id="10729" href="mi.McBride2006.html#10729" class="Bound Operator">_◆_</a> <a id="10733" href="mi.McBride2006.html#10733" class="Bound">Γ</a> <a id="10735" href="mi.McBride2006.html#10735" class="Bound">Δ</a> <a id="10737" href="mi.McBride2006.html#10737" class="Bound">T</a><a id="10738" class="Symbol">}</a> <a id="10740" class="Symbol">(</a><a id="10741" href="mi.McBride2006.html#10741" class="Bound">K</a> <a id="10743" class="Symbol">:</a> <a id="10745" href="mi.McBride2006.html#8306" class="Record">Kit</a> <a id="10749" href="mi.McBride2006.html#10729" class="Bound Operator">_◆_</a><a id="10752" class="Symbol">)</a> <a id="10754" class="Symbol">(</a><a id="10755" href="mi.McBride2006.html#10755" class="Bound">τ</a> <a id="10757" class="Symbol">:</a> <a id="10759" class="Symbol">∀</a> <a id="10761" class="Symbol">{</a><a id="10762" href="mi.McBride2006.html#10762" class="Bound">X</a><a id="10763" class="Symbol">}</a> <a id="10765" class="Symbol">(</a><a id="10766" href="mi.McBride2006.html#10766" class="Bound">x</a> <a id="10768" class="Symbol">:</a> <a id="10770" href="mi.McBride2006.html#10733" class="Bound">Γ</a> <a id="10772" href="mi.McBride2006.html#4149" class="Datatype Operator">∋</a> <a id="10774" href="mi.McBride2006.html#10762" class="Bound">X</a><a id="10775" class="Symbol">)</a> <a id="10777" class="Symbol">→</a> <a id="10779" href="mi.McBride2006.html#10735" class="Bound">Δ</a> <a id="10781" href="mi.McBride2006.html#10729" class="Bound Operator">◆</a> <a id="10783" href="mi.McBride2006.html#10762" class="Bound">X</a><a id="10784" class="Symbol">)</a>
           <a id="10797" class="Symbol">(</a><a id="10798" href="mi.McBride2006.html#10798" class="Bound">t</a> <a id="10800" class="Symbol">:</a> <a id="10802" href="mi.McBride2006.html#10733" class="Bound">Γ</a> <a id="10804" href="mi.McBride2006.html#4257" class="Datatype Operator">▶︎</a> <a id="10807" href="mi.McBride2006.html#10737" class="Bound">T</a><a id="10808" class="Symbol">)</a> <a id="10810" class="Symbol">→</a> <a id="10812" href="mi.McBride2006.html#10735" class="Bound">Δ</a> <a id="10814" href="mi.McBride2006.html#4257" class="Datatype Operator">▶︎</a> <a id="10817" href="mi.McBride2006.html#10737" class="Bound">T</a>
  <a id="10821" href="mi.McBride2006.html#10719" class="Function">trav</a> <a id="10826" class="Symbol">(</a><a id="10827" href="mi.McBride2006.html#8360" class="InductiveConstructor">kit</a> <a id="10831" href="mi.McBride2006.html#10831" class="Bound">vr</a> <a id="10834" href="mi.McBride2006.html#10834" class="Bound">tm</a> <a id="10837" href="mi.McBride2006.html#10837" class="Bound">wk</a><a id="10839" class="Symbol">)</a> <a id="10841" href="mi.McBride2006.html#10841" class="Bound">τ</a> <a id="10843" class="Symbol">(</a><a id="10844" href="mi.McBride2006.html#4292" class="InductiveConstructor">var</a> <a id="10848" href="mi.McBride2006.html#10848" class="Bound">x</a><a id="10849" class="Symbol">)</a>   <a id="10853" class="Symbol">=</a> <a id="10855" href="mi.McBride2006.html#10834" class="Bound">tm</a> <a id="10858" class="Symbol">(</a><a id="10859" href="mi.McBride2006.html#10841" class="Bound">τ</a> <a id="10861" href="mi.McBride2006.html#10848" class="Bound">x</a><a id="10862" class="Symbol">)</a>
  <a id="10866" href="mi.McBride2006.html#10719" class="Function">trav</a> <a id="10871" href="mi.McBride2006.html#10871" class="Bound">K</a>              <a id="10886" href="mi.McBride2006.html#10886" class="Bound">τ</a> <a id="10888" class="Symbol">(</a><a id="10889" href="mi.McBride2006.html#4327" class="InductiveConstructor">lam</a> <a id="10893" href="mi.McBride2006.html#10893" class="Bound">t</a><a id="10894" class="Symbol">)</a>   <a id="10898" class="Symbol">=</a> <a id="10900" href="mi.McBride2006.html#4327" class="InductiveConstructor">lam</a> <a id="10904" class="Symbol">(</a><a id="10905" href="mi.McBride2006.html#10719" class="Function">trav</a> <a id="10910" href="mi.McBride2006.html#10871" class="Bound">K</a> <a id="10912" class="Symbol">(</a><a id="10913" href="mi.McBride2006.html#13756" class="Function">lift</a> <a id="10918" href="mi.McBride2006.html#10871" class="Bound">K</a> <a id="10920" href="mi.McBride2006.html#10886" class="Bound">τ</a><a id="10921" class="Symbol">)</a> <a id="10923" href="mi.McBride2006.html#10893" class="Bound">t</a><a id="10924" class="Symbol">)</a>
  <a id="10928" href="mi.McBride2006.html#10719" class="Function">trav</a> <a id="10933" href="mi.McBride2006.html#10933" class="Bound">K</a>              <a id="10948" href="mi.McBride2006.html#10948" class="Bound">τ</a> <a id="10950" class="Symbol">(</a><a id="10951" href="mi.McBride2006.html#4377" class="InductiveConstructor">app</a> <a id="10955" href="mi.McBride2006.html#10955" class="Bound">f</a> <a id="10957" href="mi.McBride2006.html#10957" class="Bound">s</a><a id="10958" class="Symbol">)</a> <a id="10960" class="Symbol">=</a> <a id="10962" href="mi.McBride2006.html#4377" class="InductiveConstructor">app</a> <a id="10966" class="Symbol">(</a><a id="10967" href="mi.McBride2006.html#10719" class="Function">trav</a> <a id="10972" href="mi.McBride2006.html#10933" class="Bound">K</a> <a id="10974" href="mi.McBride2006.html#10948" class="Bound">τ</a> <a id="10976" href="mi.McBride2006.html#10955" class="Bound">f</a><a id="10977" class="Symbol">)</a> <a id="10979" class="Symbol">(</a><a id="10980" href="mi.McBride2006.html#10719" class="Function">trav</a> <a id="10985" href="mi.McBride2006.html#10933" class="Bound">K</a> <a id="10987" href="mi.McBride2006.html#10948" class="Bound">τ</a> <a id="10989" href="mi.McBride2006.html#10957" class="Bound">s</a><a id="10990" class="Symbol">)</a>
</pre>
</div>
<p>Epigram programs are tree-structured. The nodes, marked with ‘<span class="math inline">⇐</span>’ symbols (pronounced ‘by’), explain how to refine the problem of delivering an output from the inputs, by invoking ‘eliminators’ which specify problem-decomposition strategies, such as structural recursion or case analysis. The leaves, marked with ‘<span class="math inline">⇒</span>’ symbols (pronounced ‘return’), indicate the output which the program should produce in a given case. Informally, you can imagine that the program only consists of leaves, defined by pattern matching. More formally, the program is checked with respect to its eliminators—each of the <span class="math inline">\underline{\textrm{case}}</span> nodes is exhaustive, and the recursive calls are checked to be structural with respect to the parameter indicated in the <span class="math inline">\textsf{rec}</span> node. This program is thus seen to be total.</p>
<p>In the <span class="math inline">\textsf{var}</span> case, our map <span class="math inline">τ</span> gives us some stuff, which we can turn into a term with some help from our kit. The other two cases go with structure, but we shall need to <span class="math inline">\textbf{lift}\ τ</span> to source and target contexts extended by a bound variable, in order to push it under a binder—we shall see how to do this in a moment. The rules of the simply-typed <span class="math inline">λ</span>-calculus are respected without a squeak!</p>
<p>Note that the ‘patterns’ to the left of ‘<span class="math inline">⇐</span>’ or ‘<span class="math inline">⇒</span>’ were not written by me, but by the editor, provoked by my choices of eliminator. The notation may be a touch verbose, but the effort involved is less than usual. This somewhat austere notation allows for the possibility of <em>user-defined</em> eliminators, rather than <span class="math inline">\underline{\textrm{rec}}</span> and <span class="math inline">\underline{\textrm{case}},</span> a possibility explored more fully in ‘The view from the left’ <a href="#r5" id="rr5-2" class="rr">(McBride &amp; McKinna, 2004)</a>, but it could readily be tuned to privilege normal behaviour, suppressing <span class="math inline">\underline{\textrm{case}}</span> eliminators inferable from the constructor symbols in patterns.</p>
<p>But I digress, when I should be writing <span class="math inline">\textbf{lift}.</span> This just maps the new variable to itself (or rather, its representation as ‘stuff’), and each old variable to the weakening of its old image.</p>
<div class="align-top">
<p><span class="math display">
\begin{aligned}
  &amp;\underline{\textrm{let}}
    &amp;&amp;\frac{K : \textsf{Kit}(\blacklozenge)\quad
            Γ, Δ\quad
            \frac{x\ :\ Γ\ ∋\ X}{τ\ x\ :\ Δ\ \blacklozenge\ X}\quad
            x : Γ :: S \ni T}
           {\textbf{lift}\ K\ τ\ x : Δ :: S\ \blacklozenge\ T}\\[11pt]
  &amp;&amp;&amp;\textbf{lift}\ K\ τ\ x ⇐ \underline{\textrm{case}}\ K\ \{\\
  &amp;&amp;&amp;\quad\textbf{lift}\ (\textsf{kit}\ vr\ tm\ wk)\ τ\ x ⇐ \underline{\textrm{case}}\ x\ \{\\
  &amp;&amp;&amp;\qquad\textbf{lift}\ (\textsf{kit}\ vr\ tm\ wk)\ τ\ \textsf{vz} ⇒ vr\ \textsf{vz}\\
  &amp;&amp;&amp;\qquad\textbf{lift}\ (\textsf{kit}\ vr\ tm\ wk)\ τ\ (\textsf{vs}\ x) ⇒ wk\ (τ\ x)\ \}\}
\end{aligned}
</span></p>
<pre class="Agda">  <a id="lift"></a><a id="13756" href="mi.McBride2006.html#13756" class="Function">lift</a> <a id="13761" class="Symbol">:</a> <a id="13763" class="Symbol">∀</a> <a id="13765" class="Symbol">{</a><a id="13766" href="mi.McBride2006.html#13766" class="Bound Operator">_◆_</a> <a id="13770" href="mi.McBride2006.html#13770" class="Bound">Γ</a> <a id="13772" href="mi.McBride2006.html#13772" class="Bound">Δ</a> <a id="13774" href="mi.McBride2006.html#13774" class="Bound">S</a> <a id="13776" href="mi.McBride2006.html#13776" class="Bound">T</a><a id="13777" class="Symbol">}</a> <a id="13779" class="Symbol">(</a><a id="13780" href="mi.McBride2006.html#13780" class="Bound">K</a> <a id="13782" class="Symbol">:</a> <a id="13784" href="mi.McBride2006.html#8306" class="Record">Kit</a> <a id="13788" href="mi.McBride2006.html#13766" class="Bound Operator">_◆_</a><a id="13791" class="Symbol">)</a> <a id="13793" class="Symbol">(</a><a id="13794" href="mi.McBride2006.html#13794" class="Bound">τ</a> <a id="13796" class="Symbol">:</a> <a id="13798" class="Symbol">∀</a> <a id="13800" class="Symbol">{</a><a id="13801" href="mi.McBride2006.html#13801" class="Bound">X</a><a id="13802" class="Symbol">}</a> <a id="13804" class="Symbol">(</a><a id="13805" href="mi.McBride2006.html#13805" class="Bound">x</a> <a id="13807" class="Symbol">:</a> <a id="13809" href="mi.McBride2006.html#13770" class="Bound">Γ</a> <a id="13811" href="mi.McBride2006.html#4149" class="Datatype Operator">∋</a> <a id="13813" href="mi.McBride2006.html#13801" class="Bound">X</a><a id="13814" class="Symbol">)</a> <a id="13816" class="Symbol">→</a> <a id="13818" href="mi.McBride2006.html#13772" class="Bound">Δ</a> <a id="13820" href="mi.McBride2006.html#13766" class="Bound Operator">◆</a> <a id="13822" href="mi.McBride2006.html#13801" class="Bound">X</a><a id="13823" class="Symbol">)</a>
           <a id="13836" class="Symbol">(</a><a id="13837" href="mi.McBride2006.html#13837" class="Bound">x</a> <a id="13839" class="Symbol">:</a> <a id="13841" class="Symbol">(</a><a id="13842" href="mi.McBride2006.html#13770" class="Bound">Γ</a> <a id="13844" href="mi.McBride2006.html#4106" class="InductiveConstructor Operator">∷</a> <a id="13846" href="mi.McBride2006.html#13774" class="Bound">S</a><a id="13847" class="Symbol">)</a> <a id="13849" href="mi.McBride2006.html#4149" class="Datatype Operator">∋</a> <a id="13851" href="mi.McBride2006.html#13776" class="Bound">T</a><a id="13852" class="Symbol">)</a> <a id="13854" class="Symbol">→</a> <a id="13856" class="Symbol">(</a><a id="13857" href="mi.McBride2006.html#13772" class="Bound">Δ</a> <a id="13859" href="mi.McBride2006.html#4106" class="InductiveConstructor Operator">∷</a> <a id="13861" href="mi.McBride2006.html#13774" class="Bound">S</a><a id="13862" class="Symbol">)</a> <a id="13864" href="mi.McBride2006.html#13766" class="Bound Operator">◆</a> <a id="13866" href="mi.McBride2006.html#13776" class="Bound">T</a>
  <a id="13870" href="mi.McBride2006.html#13756" class="Function">lift</a> <a id="13875" class="Symbol">(</a><a id="13876" href="mi.McBride2006.html#8360" class="InductiveConstructor">kit</a> <a id="13880" href="mi.McBride2006.html#13880" class="Bound">vr</a> <a id="13883" href="mi.McBride2006.html#13883" class="Bound">tm</a> <a id="13886" href="mi.McBride2006.html#13886" class="Bound">wk</a><a id="13888" class="Symbol">)</a> <a id="13890" class="Symbol">_</a> <a id="13892" href="mi.McBride2006.html#4179" class="InductiveConstructor">vz</a>     <a id="13899" class="Symbol">=</a> <a id="13901" href="mi.McBride2006.html#13880" class="Bound">vr</a> <a id="13904" href="mi.McBride2006.html#4179" class="InductiveConstructor">vz</a>
  <a id="13909" href="mi.McBride2006.html#13756" class="Function">lift</a> <a id="13914" class="Symbol">(</a><a id="13915" href="mi.McBride2006.html#8360" class="InductiveConstructor">kit</a> <a id="13919" href="mi.McBride2006.html#13919" class="Bound">vr</a> <a id="13922" href="mi.McBride2006.html#13922" class="Bound">tm</a> <a id="13925" href="mi.McBride2006.html#13925" class="Bound">wk</a><a id="13927" class="Symbol">)</a> <a id="13929" href="mi.McBride2006.html#13929" class="Bound">τ</a> <a id="13931" class="Symbol">(</a><a id="13932" href="mi.McBride2006.html#4209" class="InductiveConstructor">vs</a> <a id="13935" href="mi.McBride2006.html#13935" class="Bound">x</a><a id="13936" class="Symbol">)</a> <a id="13938" class="Symbol">=</a> <a id="13940" href="mi.McBride2006.html#13925" class="Bound">wk</a> <a id="13943" class="Symbol">(</a><a id="13944" href="mi.McBride2006.html#13929" class="Bound">τ</a> <a id="13946" href="mi.McBride2006.html#13935" class="Bound">x</a><a id="13947" class="Symbol">)</a>
</pre>
</div>
<p>From here, renaming and substitution are easy! We just need to construct the kits for ‘<span class="math inline">\ni</span>’ and ‘<span class="math inline">\blacktriangleright</span>’ respectively.</p>
<div class="align-top">
<p><span class="math display">
\begin{aligned}
  &amp;\underline{\textrm{let}}
    &amp;&amp;\frac{Γ, Δ\quad
            \frac{x\ :\ Γ\ ∋\ X}{ϱ\ x\ :\ Δ\ ∋\ X}\quad
            t : Γ \blacktriangleright T}
           {\textbf{rename}\ ϱ\ t\ : Δ \blacktriangleright T}\\[11pt]
  &amp;&amp;&amp;\textbf{rename}\ ϱ\ t ⇒
    \textbf{trav}\ (\textsf{kit}\ \textbf{id}\ \textsf{var}\ \textsf{vs})\ ϱ\ t
\end{aligned}
</span></p>
<pre class="Agda"><a id="rename"></a><a id="14480" href="mi.McBride2006.html#14480" class="Function">rename</a> <a id="14487" class="Symbol">:</a> <a id="14489" class="Symbol">∀</a> <a id="14491" class="Symbol">{</a><a id="14492" href="mi.McBride2006.html#14492" class="Bound">Γ</a> <a id="14494" href="mi.McBride2006.html#14494" class="Bound">Δ</a> <a id="14496" href="mi.McBride2006.html#14496" class="Bound">T</a><a id="14497" class="Symbol">}</a> <a id="14499" class="Symbol">(</a><a id="14500" href="mi.McBride2006.html#14500" class="Bound">ϱ</a> <a id="14502" class="Symbol">:</a> <a id="14504" class="Symbol">∀</a> <a id="14506" class="Symbol">{</a><a id="14507" href="mi.McBride2006.html#14507" class="Bound">X</a><a id="14508" class="Symbol">}</a> <a id="14510" class="Symbol">(</a><a id="14511" href="mi.McBride2006.html#14511" class="Bound">x</a> <a id="14513" class="Symbol">:</a> <a id="14515" href="mi.McBride2006.html#14492" class="Bound">Γ</a> <a id="14517" href="mi.McBride2006.html#4149" class="Datatype Operator">∋</a> <a id="14519" href="mi.McBride2006.html#14507" class="Bound">X</a><a id="14520" class="Symbol">)</a> <a id="14522" class="Symbol">→</a> <a id="14524" href="mi.McBride2006.html#14494" class="Bound">Δ</a> <a id="14526" href="mi.McBride2006.html#4149" class="Datatype Operator">∋</a> <a id="14528" href="mi.McBride2006.html#14507" class="Bound">X</a><a id="14529" class="Symbol">)</a> <a id="14531" class="Symbol">(</a><a id="14532" href="mi.McBride2006.html#14532" class="Bound">t</a> <a id="14534" class="Symbol">:</a> <a id="14536" href="mi.McBride2006.html#14492" class="Bound">Γ</a> <a id="14538" href="mi.McBride2006.html#4257" class="Datatype Operator">▶︎</a> <a id="14541" href="mi.McBride2006.html#14496" class="Bound">T</a><a id="14542" class="Symbol">)</a> <a id="14544" class="Symbol">→</a> <a id="14546" href="mi.McBride2006.html#14494" class="Bound">Δ</a> <a id="14548" href="mi.McBride2006.html#4257" class="Datatype Operator">▶︎</a> <a id="14551" href="mi.McBride2006.html#14496" class="Bound">T</a>
<a id="14553" href="mi.McBride2006.html#14480" class="Function">rename</a> <a id="14560" href="mi.McBride2006.html#14560" class="Bound">ϱ</a> <a id="14562" href="mi.McBride2006.html#14562" class="Bound">t</a> <a id="14564" class="Symbol">=</a> <a id="14566" href="mi.McBride2006.html#10719" class="Function">trav</a> <a id="14571" class="Symbol">(</a><a id="14572" href="mi.McBride2006.html#8360" class="InductiveConstructor">kit</a> <a id="14576" href="mi.McBride2006.html#447" class="Function">id</a> <a id="14579" href="mi.McBride2006.html#4292" class="InductiveConstructor">var</a> <a id="14583" href="mi.McBride2006.html#4209" class="InductiveConstructor">vs</a><a id="14585" class="Symbol">)</a> <a id="14587" href="mi.McBride2006.html#14560" class="Bound">ϱ</a> <a id="14589" href="mi.McBride2006.html#14562" class="Bound">t</a>
</pre>
</div>
<p>The identity function makes variables from variables; the <span class="math inline">\textsf{var}</span> constructor takes variables to terms; the <span class="math inline">\textsf{vs}</span> constructor weakens each variable into an extended context. Meanwhile, substitution goes like this:</p>
<div class="align-top">
<p><span class="math display">
\begin{aligned}
  &amp;\underline{\textrm{let}}
    &amp;&amp;\frac{Γ, Δ\quad
            \frac{x\ :\ Γ\ ∋\ X}{σ\ x\ :\ Δ\ \blacktriangleright\ X}\quad
            t : Γ \blacktriangleright T}
           {\textbf{subst}\ σ\ t\ : Δ \blacktriangleright T}\\[11pt]
  &amp;&amp;&amp;\textbf{subst}\ σ\ t ⇒
    \textbf{trav}\ (\textsf{kit}\ \textsf{var}\ \textbf{id}\ (\textbf{rename}\ \textsf{vs}))\ σ\ t
\end{aligned}
</span></p>
<pre class="Agda"><a id="subst"></a><a id="15250" href="mi.McBride2006.html#15250" class="Function">subst</a> <a id="15256" class="Symbol">:</a> <a id="15258" class="Symbol">∀</a> <a id="15260" class="Symbol">{</a><a id="15261" href="mi.McBride2006.html#15261" class="Bound">Γ</a> <a id="15263" href="mi.McBride2006.html#15263" class="Bound">Δ</a> <a id="15265" href="mi.McBride2006.html#15265" class="Bound">T</a><a id="15266" class="Symbol">}</a> <a id="15268" class="Symbol">(</a><a id="15269" href="mi.McBride2006.html#15269" class="Bound">σ</a> <a id="15271" class="Symbol">:</a> <a id="15273" class="Symbol">∀</a> <a id="15275" class="Symbol">{</a><a id="15276" href="mi.McBride2006.html#15276" class="Bound">X</a><a id="15277" class="Symbol">}</a> <a id="15279" class="Symbol">(</a><a id="15280" href="mi.McBride2006.html#15280" class="Bound">x</a> <a id="15282" class="Symbol">:</a> <a id="15284" href="mi.McBride2006.html#15261" class="Bound">Γ</a> <a id="15286" href="mi.McBride2006.html#4149" class="Datatype Operator">∋</a> <a id="15288" href="mi.McBride2006.html#15276" class="Bound">X</a><a id="15289" class="Symbol">)</a> <a id="15291" class="Symbol">→</a> <a id="15293" href="mi.McBride2006.html#15263" class="Bound">Δ</a> <a id="15295" href="mi.McBride2006.html#4257" class="Datatype Operator">▶︎</a> <a id="15298" href="mi.McBride2006.html#15276" class="Bound">X</a><a id="15299" class="Symbol">)</a> <a id="15301" class="Symbol">(</a><a id="15302" href="mi.McBride2006.html#15302" class="Bound">t</a> <a id="15304" class="Symbol">:</a> <a id="15306" href="mi.McBride2006.html#15261" class="Bound">Γ</a> <a id="15308" href="mi.McBride2006.html#4257" class="Datatype Operator">▶︎</a> <a id="15311" href="mi.McBride2006.html#15265" class="Bound">T</a><a id="15312" class="Symbol">)</a> <a id="15314" class="Symbol">→</a> <a id="15316" href="mi.McBride2006.html#15263" class="Bound">Δ</a> <a id="15318" href="mi.McBride2006.html#4257" class="Datatype Operator">▶︎</a> <a id="15321" href="mi.McBride2006.html#15265" class="Bound">T</a>
<a id="15323" href="mi.McBride2006.html#15250" class="Function">subst</a> <a id="15329" href="mi.McBride2006.html#15329" class="Bound">σ</a> <a id="15331" href="mi.McBride2006.html#15331" class="Bound">t</a> <a id="15333" class="Symbol">=</a> <a id="15335" href="mi.McBride2006.html#10719" class="Function">trav</a> <a id="15340" class="Symbol">(</a><a id="15341" href="mi.McBride2006.html#8360" class="InductiveConstructor">kit</a> <a id="15345" href="mi.McBride2006.html#4292" class="InductiveConstructor">var</a> <a id="15349" href="mi.McBride2006.html#447" class="Function">id</a> <a id="15352" class="Symbol">(</a><a id="15353" href="mi.McBride2006.html#14480" class="Function">rename</a> <a id="15360" href="mi.McBride2006.html#4209" class="InductiveConstructor">vs</a><a id="15362" class="Symbol">))</a> <a id="15365" href="mi.McBride2006.html#15329" class="Bound">σ</a> <a id="15367" href="mi.McBride2006.html#15331" class="Bound">t</a>
</pre>
</div>
<p>That is, <span class="math inline">\textsf{var}</span> makes terms from variables, <span class="math inline">\textbf{id}</span> takes terms into terms, and a term is weakened by <em>renaming</em> with <span class="math inline">\textsf{vs}.</span></p>
<h2 id="references">References</h2>
<div class="references">
<ol type="1">
<li><div id="r1">
<p>T. Altenkirch and B. Reus (1999) <a href="https://sci-hub.st/10.1007/3-540-48168-0_32">Monadic presentations of lambda terms using generalized inductive types</a>, <em>Comp. Sci. Logic</em>, <em>Lecture Notes Comp. Sci.</em>, Vol. 1683, Edited by J. Flum and M. Rodriguez-Artalejo, Springer, Berlin, pp. 453–468. <a href="#rr1" class="rb">↩︎</a> <a href="#rr1-1" class="rb">↩︎</a></p>
</div></li>
<li><div id="r2">
<p>L. Damas and R. Milner (1982) <a href="https://sci-hub.st/10.1145/582153.582176">Principal type-schemes for functional programs</a>, <em>Proc. Symp. Princ. Prog. Lang. (POPL ’82)</em>, Association for Computing Machinery, New York, pp. 207–212. <a href="#rr2" class="rb">↩︎</a></p>
</div></li>
<li><div id="r3">
<p>N. G. de Bruijn (1972) <a href="https://sci-hub.st/10.1016/1385-7258(72)90034-0">Lambda calculus notation with nameless dummies: A tool for automatic formula manipulation, with application to the Church-Rosser theorem</a>, <em>Indagationes Mathematicae</em>, Vol. 75(5), pp. 381–392. <a href="#rr3" class="rb">↩︎</a></p>
</div></li>
<li><div id="r4">
<p>P. Dybjer (1991) <a href="https://sci-hub.st/10.1017/cbo9780511569807.012">Inductive sets and families in Martin-Löf’s type theory</a>, <em>Logical Frameworks</em>, Edited by G. Huet and G. Plotkin, Cambridge University Press, pp. 280–306. <a href="#rr4" class="rb">↩︎</a></p>
</div></li>
<li><div id="r5">
<p>C. McBride and J. McKinna (2004) <a href="https://sci-hub.st/10.1017/S0956796803004829">The view from the left</a>, <em>J. Func. Prog.</em>, Vol. 14(1), pp. 69–111. <a href="#rr5" class="rb">↩︎</a> <a href="#rr5-1" class="rb">↩︎</a> <a href="#rr5-2" class="rb">↩︎</a></p>
</div></li>
</ol>
</div>
<div id="card">
<hr>
  <p>C. McBride (2006)</p>
  <p><a href="http://strictlypositive.org/ren-sub.pdf">Type-preserving renaming and substitution</a></p>
  <p>Manuscript.</p>
</div>
</main>
<nav id="foot">
<p><a href="mi.index.html">Machine Intuitionist</a></p>
</nav>
</body>
</html>
