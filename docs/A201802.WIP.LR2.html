<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>A201802.WIP.LR2</title><link rel="stylesheet" href="mi-common.css"></head><body><pre class="Agda"><a id="1" class="Symbol">{-#</a> <a id="5" class="Keyword">OPTIONS</a> <a id="13" class="Pragma">--rewriting</a> <a id="25" class="Symbol">#-}</a>

<a id="30" class="Keyword">module</a> <a id="37" href="A201802.WIP.LR2.html" class="Module">A201802.WIP.LR2</a> <a id="53" class="Keyword">where</a>

<a id="60" class="Keyword">open</a> <a id="65" class="Keyword">import</a> <a id="72" href="A201801.Prelude.html" class="Module">A201801.Prelude</a>
<a id="88" class="Keyword">open</a> <a id="93" class="Keyword">import</a> <a id="100" href="A201801.Category.html" class="Module">A201801.Category</a>
<a id="117" class="Keyword">open</a> <a id="122" class="Keyword">import</a> <a id="129" href="A201801.Fin.html" class="Module">A201801.Fin</a>
<a id="141" class="Keyword">open</a> <a id="146" class="Keyword">import</a> <a id="153" href="A201801.FinLemmas.html" class="Module">A201801.FinLemmas</a>
<a id="171" class="Keyword">open</a> <a id="176" class="Keyword">import</a> <a id="183" href="A201801.Vec.html" class="Module">A201801.Vec</a>
<a id="195" class="Keyword">open</a> <a id="200" class="Keyword">import</a> <a id="207" href="A201801.VecLemmas.html" class="Module">A201801.VecLemmas</a>
<a id="225" class="Keyword">open</a> <a id="230" class="Keyword">import</a> <a id="237" href="A201801.AllVec.html" class="Module">A201801.AllVec</a>

<a id="253" class="Keyword">open</a> <a id="258" class="Keyword">import</a> <a id="265" href="A201802.LR0.html" class="Module">A201802.LR0</a>
<a id="277" class="Keyword">open</a> <a id="282" class="Keyword">import</a> <a id="289" href="A201802.LR0Lemmas.html" class="Module">A201802.LR0Lemmas</a>
<a id="307" class="Keyword">open</a> <a id="312" class="Keyword">import</a> <a id="319" href="A201802.LR1.html" class="Module">A201802.LR1</a>


<a id="333" class="Comment">--------------------------------------------------------------------------------</a>


<a id="416" class="Comment">-- `Val M` says that the term `M` is a value.</a>
<a id="462" class="Keyword">data</a> <a id="Val"></a><a id="467" href="A201802.WIP.LR2.html#467" class="Datatype">Val</a> <a id="471" class="Symbol">{</a><a id="472" href="A201802.WIP.LR2.html#472" class="Bound">g</a><a id="473" class="Symbol">}</a> <a id="475" class="Symbol">:</a> <a id="477" href="A201802.LR0.html#576" class="Datatype">Term</a> <a id="482" href="A201802.WIP.LR2.html#472" class="Bound">g</a> <a id="484" class="Symbol">→</a> <a id="486" href="Agda.Primitive.html#388" class="Primitive">Set</a>
  <a id="492" class="Keyword">where</a>
    <a id="502" class="Keyword">instance</a>
      <a id="Val.val-lam"></a><a id="517" href="A201802.WIP.LR2.html#517" class="InductiveConstructor">val-lam</a>   <a id="527" class="Symbol">:</a> <a id="529" class="Symbol">∀</a> <a id="531" class="Symbol">{</a><a id="532" href="A201802.WIP.LR2.html#532" class="Bound">M</a><a id="533" class="Symbol">}</a> <a id="535" class="Symbol">→</a> <a id="537" href="A201802.WIP.LR2.html#467" class="Datatype">Val</a> <a id="541" class="Symbol">(</a><a id="542" href="A201802.LR0.html#636" class="InductiveConstructor">LAM</a> <a id="546" href="A201802.WIP.LR2.html#532" class="Bound">M</a><a id="547" class="Symbol">)</a>
      <a id="Val.val-pair"></a><a id="555" href="A201802.WIP.LR2.html#555" class="InductiveConstructor">val-pair</a>  <a id="565" class="Symbol">:</a> <a id="567" class="Symbol">∀</a> <a id="569" class="Symbol">{</a><a id="570" href="A201802.WIP.LR2.html#570" class="Bound">M</a> <a id="572" href="A201802.WIP.LR2.html#572" class="Bound">N</a><a id="573" class="Symbol">}</a> <a id="575" class="Symbol">→</a> <a id="577" class="Symbol">{{</a><a id="579" href="A201802.WIP.LR2.html#579" class="Bound">_</a> <a id="581" class="Symbol">:</a> <a id="583" href="A201802.WIP.LR2.html#467" class="Datatype">Val</a> <a id="587" href="A201802.WIP.LR2.html#570" class="Bound">M</a><a id="588" class="Symbol">}}</a> <a id="591" class="Symbol">{{</a><a id="593" href="A201802.WIP.LR2.html#593" class="Bound">_</a> <a id="595" class="Symbol">:</a> <a id="597" href="A201802.WIP.LR2.html#467" class="Datatype">Val</a> <a id="601" href="A201802.WIP.LR2.html#572" class="Bound">N</a><a id="602" class="Symbol">}}</a> <a id="605" class="Symbol">→</a> <a id="607" href="A201802.WIP.LR2.html#467" class="Datatype">Val</a> <a id="611" class="Symbol">(</a><a id="612" href="A201802.LR0.html#707" class="InductiveConstructor">PAIR</a> <a id="617" href="A201802.WIP.LR2.html#570" class="Bound">M</a> <a id="619" href="A201802.WIP.LR2.html#572" class="Bound">N</a><a id="620" class="Symbol">)</a>
      <a id="Val.val-unit"></a><a id="628" href="A201802.WIP.LR2.html#628" class="InductiveConstructor">val-unit</a>  <a id="638" class="Symbol">:</a> <a id="640" href="A201802.WIP.LR2.html#467" class="Datatype">Val</a> <a id="644" href="A201802.LR0.html#800" class="InductiveConstructor">UNIT</a>
      <a id="Val.val-left"></a><a id="655" href="A201802.WIP.LR2.html#655" class="InductiveConstructor">val-left</a>  <a id="665" class="Symbol">:</a> <a id="667" class="Symbol">∀</a> <a id="669" class="Symbol">{</a><a id="670" href="A201802.WIP.LR2.html#670" class="Bound">M</a><a id="671" class="Symbol">}</a> <a id="673" class="Symbol">→</a> <a id="675" class="Symbol">{{</a><a id="677" href="A201802.WIP.LR2.html#677" class="Bound">_</a> <a id="679" class="Symbol">:</a> <a id="681" href="A201802.WIP.LR2.html#467" class="Datatype">Val</a> <a id="685" href="A201802.WIP.LR2.html#670" class="Bound">M</a><a id="686" class="Symbol">}}</a> <a id="689" class="Symbol">→</a> <a id="691" href="A201802.WIP.LR2.html#467" class="Datatype">Val</a> <a id="695" class="Symbol">(</a><a id="696" href="A201802.LR0.html#847" class="InductiveConstructor">LEFT</a> <a id="701" href="A201802.WIP.LR2.html#670" class="Bound">M</a><a id="702" class="Symbol">)</a>
      <a id="Val.val-right"></a><a id="710" href="A201802.WIP.LR2.html#710" class="InductiveConstructor">val-right</a> <a id="720" class="Symbol">:</a> <a id="722" class="Symbol">∀</a> <a id="724" class="Symbol">{</a><a id="725" href="A201802.WIP.LR2.html#725" class="Bound">M</a><a id="726" class="Symbol">}</a> <a id="728" class="Symbol">→</a> <a id="730" class="Symbol">{{</a><a id="732" href="A201802.WIP.LR2.html#732" class="Bound">_</a> <a id="734" class="Symbol">:</a> <a id="736" href="A201802.WIP.LR2.html#467" class="Datatype">Val</a> <a id="740" href="A201802.WIP.LR2.html#725" class="Bound">M</a><a id="741" class="Symbol">}}</a> <a id="744" class="Symbol">→</a> <a id="746" href="A201802.WIP.LR2.html#467" class="Datatype">Val</a> <a id="750" class="Symbol">(</a><a id="751" href="A201802.LR0.html#875" class="InductiveConstructor">RIGHT</a> <a id="757" href="A201802.WIP.LR2.html#725" class="Bound">M</a><a id="758" class="Symbol">)</a>
      <a id="Val.val-true"></a><a id="766" href="A201802.WIP.LR2.html#766" class="InductiveConstructor">val-true</a>  <a id="776" class="Symbol">:</a> <a id="778" href="A201802.WIP.LR2.html#467" class="Datatype">Val</a> <a id="782" href="A201802.LR0.html#961" class="InductiveConstructor">TRUE</a>
      <a id="Val.val-false"></a><a id="793" href="A201802.WIP.LR2.html#793" class="InductiveConstructor">val-false</a> <a id="803" class="Symbol">:</a> <a id="805" href="A201802.WIP.LR2.html#467" class="Datatype">Val</a> <a id="809" href="A201802.LR0.html#980" class="InductiveConstructor">FALSE</a>


<a id="817" class="Comment">-- `Vals τ` says that all terms `τ` are values.</a>
<a id="865" class="Keyword">data</a> <a id="Vals"></a><a id="870" href="A201802.WIP.LR2.html#870" class="Datatype">Vals</a> <a id="875" class="Symbol">{</a><a id="876" href="A201802.WIP.LR2.html#876" class="Bound">g</a><a id="877" class="Symbol">}</a> <a id="879" class="Symbol">:</a> <a id="881" class="Symbol">∀</a> <a id="883" class="Symbol">{</a><a id="884" href="A201802.WIP.LR2.html#884" class="Bound">n</a><a id="885" class="Symbol">}</a> <a id="887" class="Symbol">→</a> <a id="889" href="A201802.LR0.html#1043" class="Function">Terms</a> <a id="895" href="A201802.WIP.LR2.html#876" class="Bound">g</a> <a id="897" href="A201802.WIP.LR2.html#884" class="Bound">n</a> <a id="899" class="Symbol">→</a> <a id="901" href="Agda.Primitive.html#388" class="Primitive">Set</a>
  <a id="907" class="Keyword">where</a>
    <a id="917" class="Keyword">instance</a>
      <a id="Vals.∙"></a><a id="932" href="A201802.WIP.LR2.html#932" class="InductiveConstructor">∙</a>   <a id="936" class="Symbol">:</a> <a id="938" href="A201802.WIP.LR2.html#870" class="Datatype">Vals</a> <a id="943" href="A201801.Vec.html#295" class="InductiveConstructor">∙</a>
    <a id="Vals._,_"></a><a id="949" href="A201802.WIP.LR2.html#949" class="InductiveConstructor Operator">_,_</a> <a id="953" class="Symbol">:</a> <a id="955" class="Symbol">∀</a> <a id="957" class="Symbol">{</a><a id="958" href="A201802.WIP.LR2.html#958" class="Bound">n</a> <a id="960" href="A201802.WIP.LR2.html#960" class="Bound">M</a><a id="961" class="Symbol">}</a> <a id="963" class="Symbol">→</a> <a id="965" class="Symbol">{</a><a id="966" href="A201802.WIP.LR2.html#966" class="Bound">τ</a> <a id="968" class="Symbol">:</a> <a id="970" href="A201802.LR0.html#1043" class="Function">Terms</a> <a id="976" href="A201802.WIP.LR2.html#876" class="Bound">g</a> <a id="978" href="A201802.WIP.LR2.html#958" class="Bound">n</a><a id="979" class="Symbol">}</a> <a id="981" class="Symbol">→</a> <a id="983" href="A201802.WIP.LR2.html#870" class="Datatype">Vals</a> <a id="988" href="A201802.WIP.LR2.html#966" class="Bound">τ</a> <a id="990" class="Symbol">→</a> <a id="992" href="A201802.WIP.LR2.html#467" class="Datatype">Val</a> <a id="996" href="A201802.WIP.LR2.html#960" class="Bound">M</a> <a id="998" class="Symbol">→</a> <a id="1000" href="A201802.WIP.LR2.html#870" class="Datatype">Vals</a> <a id="1005" class="Symbol">(</a><a id="1006" href="A201802.WIP.LR2.html#966" class="Bound">τ</a> <a id="1008" href="A201801.Vec.html#316" class="InductiveConstructor Operator">,</a> <a id="1010" href="A201802.WIP.LR2.html#960" class="Bound">M</a><a id="1011" class="Symbol">)</a>



<a id="hm"></a><a id="1016" href="A201802.WIP.LR2.html#1016" class="Function">hm</a> <a id="1019" class="Symbol">:</a> <a id="1021" class="Symbol">(</a><a id="1022" href="A201802.WIP.LR2.html#1022" class="Bound">M</a> <a id="1024" class="Symbol">:</a> <a id="1026" href="A201802.LR0.html#576" class="Datatype">Term</a> <a id="1031" class="Number">0</a><a id="1032" class="Symbol">)</a> <a id="1034" class="Symbol">(</a><a id="1035" href="A201802.WIP.LR2.html#1035" class="Bound">VM</a> <a id="1038" class="Symbol">:</a> <a id="1040" href="A201802.WIP.LR2.html#467" class="Datatype">Val</a> <a id="1044" href="A201802.WIP.LR2.html#1022" class="Bound">M</a><a id="1045" class="Symbol">)</a> <a id="1047" class="Symbol">→</a> <a id="1049" href="A201801.Prelude.html#1191" class="Function Operator">¬</a> <a id="1051" class="Symbol">(</a><a id="1052" class="InductiveConstructor">∙</a> <a id="1054" href="A201802.LR1.html#377" class="Datatype Operator">⊢</a> <a id="1056" href="A201802.WIP.LR2.html#1022" class="Bound">M</a> <a id="1058" href="A201802.LR1.html#377" class="Datatype Operator">⦂</a> <a id="1060" href="A201802.LR0.html#361" class="InductiveConstructor">𝟘</a><a id="1061" class="Symbol">)</a>
<a id="1063" href="A201802.WIP.LR2.html#1016" class="Function">hm</a> <a id="1066" class="Symbol">(</a><a id="1067" href="A201802.LR0.html#609" class="InductiveConstructor">VAR</a> <a id="1071" href="A201802.WIP.LR2.html#1071" class="Bound">I</a><a id="1072" class="Symbol">)</a> <a id="1074" class="Symbol">()</a>
<a id="1077" href="A201802.WIP.LR2.html#1016" class="Function">hm</a> <a id="1080" class="Symbol">(</a><a id="1081" href="A201802.LR0.html#636" class="InductiveConstructor">LAM</a> <a id="1085" href="A201802.WIP.LR2.html#1085" class="Bound">M</a><a id="1086" class="Symbol">)</a> <a id="1088" href="A201802.WIP.LR2.html#517" class="InductiveConstructor">val-lam</a> <a id="1096" class="Symbol">=</a> <a id="1098" class="Symbol">λ</a> <a id="1100" class="Symbol">()</a>
<a id="1103" href="A201802.WIP.LR2.html#1016" class="Function">hm</a> <a id="1106" class="Symbol">(</a><a id="1107" href="A201802.LR0.html#670" class="InductiveConstructor">APP</a> <a id="1111" href="A201802.WIP.LR2.html#1111" class="Bound">M</a> <a id="1113" href="A201802.WIP.LR2.html#1113" class="Bound">N</a><a id="1114" class="Symbol">)</a> <a id="1116" class="Symbol">()</a>
<a id="1119" href="A201802.WIP.LR2.html#1016" class="Function">hm</a> <a id="1122" class="Symbol">(</a><a id="1123" href="A201802.LR0.html#707" class="InductiveConstructor">PAIR</a> <a id="1128" href="A201802.WIP.LR2.html#1128" class="Bound">M</a> <a id="1130" href="A201802.WIP.LR2.html#1130" class="Bound">N</a><a id="1131" class="Symbol">)</a> <a id="1133" class="Symbol">(</a><a id="1134" href="A201802.WIP.LR2.html#555" class="InductiveConstructor">val-pair</a><a id="1142" class="Symbol">)</a> <a id="1144" class="Symbol">=</a> <a id="1146" class="Symbol">λ</a> <a id="1148" class="Symbol">()</a>
<a id="1151" href="A201802.WIP.LR2.html#1016" class="Function">hm</a> <a id="1154" class="Symbol">(</a><a id="1155" href="A201802.LR0.html#744" class="InductiveConstructor">FST</a> <a id="1159" href="A201802.WIP.LR2.html#1159" class="Bound">M</a><a id="1160" class="Symbol">)</a> <a id="1162" class="Symbol">()</a>
<a id="1165" href="A201802.WIP.LR2.html#1016" class="Function">hm</a> <a id="1168" class="Symbol">(</a><a id="1169" href="A201802.LR0.html#772" class="InductiveConstructor">SND</a> <a id="1173" href="A201802.WIP.LR2.html#1173" class="Bound">M</a><a id="1174" class="Symbol">)</a> <a id="1176" class="Symbol">()</a>
<a id="1179" href="A201802.WIP.LR2.html#1016" class="Function">hm</a> <a id="1182" href="A201802.LR0.html#800" class="InductiveConstructor">UNIT</a> <a id="1187" href="A201802.WIP.LR2.html#628" class="InductiveConstructor">val-unit</a> <a id="1196" class="Symbol">=</a> <a id="1198" class="Symbol">λ</a> <a id="1200" class="Symbol">()</a>
<a id="1203" href="A201802.WIP.LR2.html#1016" class="Function">hm</a> <a id="1206" class="Symbol">(</a><a id="1207" href="A201802.LR0.html#819" class="InductiveConstructor">ABORT</a> <a id="1213" href="A201802.WIP.LR2.html#1213" class="Bound">M</a><a id="1214" class="Symbol">)</a> <a id="1216" class="Symbol">()</a>
<a id="1219" href="A201802.WIP.LR2.html#1016" class="Function">hm</a> <a id="1222" class="Symbol">(</a><a id="1223" href="A201802.LR0.html#847" class="InductiveConstructor">LEFT</a> <a id="1228" href="A201802.WIP.LR2.html#1228" class="Bound">M</a><a id="1229" class="Symbol">)</a> <a id="1231" class="Symbol">(</a><a id="1232" href="A201802.WIP.LR2.html#655" class="InductiveConstructor">val-left</a> <a id="1241" class="Symbol">{{</a><a id="1243" href="A201802.WIP.LR2.html#1243" class="Bound">VM</a><a id="1245" class="Symbol">}})</a> <a id="1249" class="Symbol">=</a> <a id="1251" class="Symbol">λ</a> <a id="1253" class="Symbol">()</a>
<a id="1256" href="A201802.WIP.LR2.html#1016" class="Function">hm</a> <a id="1259" class="Symbol">(</a><a id="1260" href="A201802.LR0.html#875" class="InductiveConstructor">RIGHT</a> <a id="1266" href="A201802.WIP.LR2.html#1266" class="Bound">M</a><a id="1267" class="Symbol">)</a> <a id="1269" class="Symbol">(</a><a id="1270" href="A201802.WIP.LR2.html#710" class="InductiveConstructor">val-right</a> <a id="1280" class="Symbol">{{</a><a id="1282" href="A201802.WIP.LR2.html#1282" class="Bound">VN</a><a id="1284" class="Symbol">}})</a> <a id="1288" class="Symbol">=</a> <a id="1290" class="Symbol">λ</a> <a id="1292" class="Symbol">()</a>
<a id="1295" href="A201802.WIP.LR2.html#1016" class="Function">hm</a> <a id="1298" class="Symbol">(</a><a id="1299" href="A201802.LR0.html#903" class="InductiveConstructor">CASE</a> <a id="1304" href="A201802.WIP.LR2.html#1304" class="Bound">M</a> <a id="1306" href="A201802.WIP.LR2.html#1306" class="Bound">N</a> <a id="1308" href="A201802.WIP.LR2.html#1308" class="Bound">O</a><a id="1309" class="Symbol">)</a> <a id="1311" class="Symbol">()</a>
<a id="1314" href="A201802.WIP.LR2.html#1016" class="Function">hm</a> <a id="1317" href="A201802.LR0.html#961" class="InductiveConstructor">TRUE</a> <a id="1322" href="A201802.WIP.LR2.html#766" class="InductiveConstructor">val-true</a> <a id="1331" class="Symbol">=</a> <a id="1333" class="Symbol">λ</a> <a id="1335" class="Symbol">()</a>
<a id="1338" href="A201802.WIP.LR2.html#1016" class="Function">hm</a> <a id="1341" href="A201802.LR0.html#980" class="InductiveConstructor">FALSE</a> <a id="1347" href="A201802.WIP.LR2.html#793" class="InductiveConstructor">val-false</a> <a id="1357" class="Symbol">=</a> <a id="1359" class="Symbol">λ</a> <a id="1361" class="Symbol">()</a>
<a id="1364" href="A201802.WIP.LR2.html#1016" class="Function">hm</a> <a id="1367" class="Symbol">(</a><a id="1368" href="A201802.LR0.html#999" class="InductiveConstructor">IF</a> <a id="1371" href="A201802.WIP.LR2.html#1371" class="Bound">M</a> <a id="1373" href="A201802.WIP.LR2.html#1373" class="Bound">N</a> <a id="1375" href="A201802.WIP.LR2.html#1375" class="Bound">O</a><a id="1376" class="Symbol">)</a> <a id="1378" class="Symbol">()</a>


<a id="1383" class="Comment">-- --------------------------------------------------------------------------------</a>


<a id="1469" class="Comment">-- -- `_⤠_` is the CBV computation relation.</a>
<a id="1514" class="Comment">-- infix 3 _⤠_</a>
<a id="1529" class="Comment">-- data _⤠_ {g} : Term g → Term g → Set</a>
<a id="1569" class="Comment">--   where</a>
<a id="1580" class="Comment">--     app-lam    : ∀ {M N} → {{_ : Val N}} → APP (LAM M) N ⤠ CUT N M</a>
<a id="1650" class="Comment">--     fst-pair   : ∀ {M N} → {{_ : Val M}} {{_ : Val N}} → FST (PAIR M N) ⤠ M</a>
<a id="1729" class="Comment">--     snd-pair   : ∀ {M N} → {{_ : Val M}} {{_ : Val N}} → SND (PAIR M N) ⤠ N</a>
<a id="1808" class="Comment">--     case-left  : ∀ {M N O} → {{_ : Val M}} → CASE (LEFT M) N O ⤠ CUT M N</a>
<a id="1884" class="Comment">--     case-right : ∀ {M N O} → {{_ : Val M}} → CASE (RIGHT M) N O ⤠ CUT M O</a>
<a id="1961" class="Comment">--     if-true    : ∀ {N O} → IF TRUE N O ⤠ N</a>
<a id="2007" class="Comment">--     if-false   : ∀ {N O} → IF FALSE N O ⤠ O</a>


<a id="2056" class="Comment">-- -- Values do not compute.</a>
<a id="2085" class="Comment">-- ¬val⤠ : ∀ {g} → {M M′ : Term g} → {{_ : Val M}}</a>
<a id="2136" class="Comment">--                → ¬ (M ⤠ M′)</a>
<a id="2167" class="Comment">-- ¬val⤠ {{val-lam}}   ()</a>
<a id="2193" class="Comment">-- ¬val⤠ {{val-pair}}  ()</a>
<a id="2219" class="Comment">-- ¬val⤠ {{val-unit}}  ()</a>
<a id="2245" class="Comment">-- ¬val⤠ {{val-left}}  ()</a>
<a id="2271" class="Comment">-- ¬val⤠ {{val-right}} ()</a>
<a id="2297" class="Comment">-- ¬val⤠ {{val-true}}  ()</a>
<a id="2323" class="Comment">-- ¬val⤠ {{val-false}} ()</a>


<a id="2351" class="Comment">-- -- Computation is deterministic.</a>
<a id="2387" class="Comment">-- det⤠ : ∀ {g} → {M M′₁ M′₂ : Term g}</a>
<a id="2426" class="Comment">--               → M ⤠ M′₁ → M ⤠ M′₂</a>
<a id="2463" class="Comment">--               → M′₁ ≡ M′₂</a>
<a id="2492" class="Comment">-- det⤠ app-lam    app-lam    = refl</a>
<a id="2529" class="Comment">-- det⤠ fst-pair   fst-pair   = refl</a>
<a id="2566" class="Comment">-- det⤠ snd-pair   snd-pair   = refl</a>
<a id="2603" class="Comment">-- det⤠ case-left  case-left  = refl</a>
<a id="2640" class="Comment">-- det⤠ case-right case-right = refl</a>
<a id="2677" class="Comment">-- det⤠ if-true    if-true    = refl</a>
<a id="2714" class="Comment">-- det⤠ if-false   if-false   = refl</a>


<a id="2753" class="Comment">-- -- Computation is type-preserving.</a>
<a id="2791" class="Comment">-- tp⤠ : ∀ {g M M′ A} → {Γ : Types g}</a>
<a id="2829" class="Comment">--                     → M ⤠ M′ → Γ ⊢ M ⦂ A</a>
<a id="2873" class="Comment">--                     → Γ ⊢ M′ ⦂ A</a>
<a id="2909" class="Comment">-- tp⤠ app-lam    (app (lam 𝒟) ℰ)      = cut ℰ 𝒟</a>
<a id="2958" class="Comment">-- tp⤠ fst-pair   (fst (pair 𝒟 ℰ))     = 𝒟</a>
<a id="3001" class="Comment">-- tp⤠ snd-pair   (snd (pair 𝒟 ℰ))     = ℰ</a>
<a id="3044" class="Comment">-- tp⤠ case-left  (case (left 𝒟) ℰ ℱ)  = cut 𝒟 ℰ</a>
<a id="3093" class="Comment">-- tp⤠ case-right (case (right 𝒟) ℰ ℱ) = cut 𝒟 ℱ</a>
<a id="3142" class="Comment">-- tp⤠ if-true    (if 𝒟 ℰ ℱ)           = ℰ</a>
<a id="3185" class="Comment">-- tp⤠ if-false   (if 𝒟 ℰ ℱ)           = ℱ</a>


<a id="3230" class="Comment">-- --------------------------------------------------------------------------------</a>


<a id="3316" class="Comment">-- -- `_↦_` is the CBV small-step reduction relation.</a>
<a id="3370" class="Comment">-- infix 3 _↦_</a>
<a id="3385" class="Comment">-- data _↦_ {g} : Term g → Term g → Set</a>
<a id="3425" class="Comment">--   where</a>
<a id="3436" class="Comment">--     red : ∀ {M M′} → M ⤠ M′</a>
<a id="3467" class="Comment">--                    → M ↦ M′</a>

<a id="3499" class="Comment">--     cong-app₁ : ∀ {M M′ N} → M ↦ M′</a>
<a id="3538" class="Comment">--                            → APP M N ↦ APP M′ N</a>

<a id="3590" class="Comment">--     cong-app₂ : ∀ {M N N′} → {{_ : Val M}}</a>
<a id="3636" class="Comment">--                            → N ↦ N′</a>
<a id="3675" class="Comment">--                            → APP M N ↦ APP M N′</a>

<a id="3727" class="Comment">--     cong-pair₁ : ∀ {M M′ N} → M ↦ M′</a>
<a id="3767" class="Comment">--                             → PAIR M N ↦ PAIR M′ N</a>

<a id="3822" class="Comment">--     cong-pair₂ : ∀ {M N N′} → {{_ : Val M}}</a>
<a id="3869" class="Comment">--                             → N ↦ N′</a>
<a id="3909" class="Comment">--                             → PAIR M N ↦ PAIR M N′</a>

<a id="3964" class="Comment">--     cong-fst : ∀ {M M′} → M ↦ M′</a>
<a id="4000" class="Comment">--                         → FST M ↦ FST M′</a>

<a id="4045" class="Comment">--     cong-snd : ∀ {M M′} → M ↦ M′</a>
<a id="4081" class="Comment">--                         → SND M ↦ SND M′</a>

<a id="4126" class="Comment">--     cong-abort : ∀ {M M′} → M ↦ M′</a>
<a id="4164" class="Comment">--                           → ABORT M ↦ ABORT M′</a>

<a id="4215" class="Comment">--     cong-left : ∀ {M M′} → M ↦ M′</a>
<a id="4252" class="Comment">--                          → LEFT M ↦ LEFT M′</a>

<a id="4300" class="Comment">--     cong-right : ∀ {M M′} → M ↦ M′</a>
<a id="4338" class="Comment">--                           → RIGHT M ↦ RIGHT M′</a>

<a id="4389" class="Comment">--     cong-case : ∀ {M M′ N O} → M ↦ M′</a>
<a id="4430" class="Comment">--                              → CASE M N O ↦ CASE M′ N O</a>

<a id="4490" class="Comment">--     cong-if : ∀ {M M′ N O} → M ↦ M′</a>
<a id="4529" class="Comment">--                            → IF M N O ↦ IF M′ N O</a>


<a id="4584" class="Comment">-- -- Values do not reduce.</a>
<a id="4612" class="Comment">-- ¬val↦ : ∀ {g} → {M M′ : Term g} → {{_ : Val M}}</a>
<a id="4663" class="Comment">--                → ¬ (M ↦ M′)</a>
<a id="4694" class="Comment">-- ¬val↦ {{val-lam}}   (red ())</a>
<a id="4726" class="Comment">-- ¬val↦ {{val-pair}}  (red ())</a>
<a id="4758" class="Comment">-- ¬val↦ {{val-pair}}  (cong-pair₁ M↦M′) = M↦M′ ↯ ¬val↦</a>
<a id="4814" class="Comment">-- ¬val↦ {{val-pair}}  (cong-pair₂ N↦N′) = N↦N′ ↯ ¬val↦</a>
<a id="4870" class="Comment">-- ¬val↦ {{val-unit}}  (red ())</a>
<a id="4902" class="Comment">-- ¬val↦ {{val-left}}  (red ())</a>
<a id="4934" class="Comment">-- ¬val↦ {{val-left}}  (cong-left M↦M′)  = M↦M′ ↯ ¬val↦</a>
<a id="4990" class="Comment">-- ¬val↦ {{val-right}} (red ())</a>
<a id="5022" class="Comment">-- ¬val↦ {{val-right}} (cong-right M↦M′) = M↦M′ ↯ ¬val↦</a>
<a id="5078" class="Comment">-- ¬val↦ {{val-true}}  (red ())</a>
<a id="5110" class="Comment">-- ¬val↦ {{val-false}} (red ())</a>


<a id="5144" class="Comment">-- -- Computation determines small-step reduction.</a>
<a id="5195" class="Comment">-- red-det↦ : ∀ {g} → {M M′₁ M′₂ : Term g}</a>
<a id="5238" class="Comment">--                   → M ⤠ M′₁ → M ↦ M′₂</a>
<a id="5279" class="Comment">--                   → M′₁ ≡ M′₂</a>
<a id="5312" class="Comment">-- red-det↦ M⤠M′₁     (red M⤠M′₂)       = det⤠ M⤠M′₁ M⤠M′₂</a>
<a id="5371" class="Comment">-- red-det↦ app-lam    (cong-app₁ M↦M′₂) = M↦M′₂ ↯ ¬val↦</a>
<a id="5428" class="Comment">-- red-det↦ app-lam    (cong-app₂ M↦M′₂) = M↦M′₂ ↯ ¬val↦</a>
<a id="5485" class="Comment">-- red-det↦ fst-pair   (cong-fst M↦M′₂)  = M↦M′₂ ↯ ¬val↦</a>
<a id="5542" class="Comment">-- red-det↦ snd-pair   (cong-snd M↦M′₂)  = M↦M′₂ ↯ ¬val↦</a>
<a id="5599" class="Comment">-- red-det↦ case-left  (cong-case M↦M′₂) = M↦M′₂ ↯ ¬val↦</a>
<a id="5656" class="Comment">-- red-det↦ case-right (cong-case M↦M′₂) = M↦M′₂ ↯ ¬val↦</a>
<a id="5713" class="Comment">-- red-det↦ if-true    (cong-if M↦M′₂)   = M↦M′₂ ↯ ¬val↦</a>
<a id="5770" class="Comment">-- red-det↦ if-false   (cong-if M↦M′₂)   = M↦M′₂ ↯ ¬val↦</a>
<a id="5827" class="Comment">-- red-det↦ ()         (cong-pair₁ _)</a>
<a id="5865" class="Comment">-- red-det↦ ()         (cong-pair₂ _)</a>
<a id="5903" class="Comment">-- red-det↦ ()         (cong-abort _)</a>
<a id="5941" class="Comment">-- red-det↦ ()         (cong-left _)</a>
<a id="5978" class="Comment">-- red-det↦ ()         (cong-right _)</a>


<a id="6018" class="Comment">-- -- Small-step reduction is deterministic.</a>
<a id="6063" class="Comment">-- det↦ : ∀ {g} → {M M′₁ M′₂ : Term g}</a>
<a id="6102" class="Comment">--               → M ↦ M′₁ → M ↦ M′₂</a>
<a id="6139" class="Comment">--               → M′₁ ≡ M′₂</a>
<a id="6168" class="Comment">-- det↦ (red M⤠M′₁)        M↦M′₂              = red-det↦ M⤠M′₁ M↦M′₂</a>
<a id="6237" class="Comment">-- det↦ (cong-app₁ M↦M′₁)  (cong-app₁ M↦M′₂)  = (\ M′ → APP M′ _) &amp; det↦ M↦M′₁ M↦M′₂</a>
<a id="6322" class="Comment">-- det↦ (cong-app₁ M↦M′₁)  (cong-app₂ _)       = M↦M′₁ ↯ ¬val↦</a>
<a id="6385" class="Comment">-- det↦ (cong-app₂ _)       (cong-app₁ M↦M′₂)  = M↦M′₂ ↯ ¬val↦</a>
<a id="6448" class="Comment">-- det↦ (cong-app₂ N↦N′₁)  (cong-app₂ N↦N′₂)  = (\ N′ → APP _ N′) &amp; det↦ N↦N′₁ N↦N′₂</a>
<a id="6533" class="Comment">-- det↦ (cong-pair₁ M↦M′₁) (cong-pair₁ M↦M′₂) = (\ M′ → PAIR M′ _) &amp; det↦ M↦M′₁ M↦M′₂</a>
<a id="6619" class="Comment">-- det↦ (cong-pair₁ M↦M′₁) (cong-pair₂ _)      = M↦M′₁ ↯ ¬val↦</a>
<a id="6682" class="Comment">-- det↦ (cong-pair₂ _)      (cong-pair₁ M↦M′₂) = M↦M′₂ ↯ ¬val↦</a>
<a id="6745" class="Comment">-- det↦ (cong-pair₂ N↦N′₁) (cong-pair₂ N↦N′₂) = (\ N′ → PAIR _ N′) &amp; det↦ N↦N′₁ N↦N′₂</a>
<a id="6831" class="Comment">-- det↦ (cong-fst M↦M′₁)   (cong-fst M↦M′₂)   = FST &amp; det↦ M↦M′₁ M↦M′₂</a>
<a id="6902" class="Comment">-- det↦ (cong-snd M↦M′₁)   (cong-snd M↦M′₂)   = SND &amp; det↦ M↦M′₁ M↦M′₂</a>
<a id="6973" class="Comment">-- det↦ (cong-abort M↦M′₁) (cong-abort M↦M′₂) = ABORT &amp; det↦ M↦M′₁ M↦M′₂</a>
<a id="7046" class="Comment">-- det↦ (cong-left M↦M′₁)  (cong-left M↦M′₂)  = LEFT &amp; det↦ M↦M′₁ M↦M′₂</a>
<a id="7118" class="Comment">-- det↦ (cong-right M↦M′₁) (cong-right M↦M′₂) = RIGHT &amp; det↦ M↦M′₁ M↦M′₂</a>
<a id="7191" class="Comment">-- det↦ (cong-case M↦M′₁)  (cong-case M↦M′₂)  = (\ M′ → CASE M′ _ _) &amp; det↦ M↦M′₁ M↦M′₂</a>
<a id="7279" class="Comment">-- det↦ (cong-if M↦M′₁)    (cong-if M↦M′₂)    = (\ M′ → IF M′ _ _) &amp; det↦ M↦M′₁ M↦M′₂</a>
<a id="7365" class="Comment">-- det↦ M↦M′₁              (red M⤠M′₂)        = red-det↦ M⤠M′₂ M↦M′₁ ⁻¹</a>


<a id="7439" class="Comment">-- -- Small-step reduction is type-preserving.</a>
<a id="7486" class="Comment">-- tp↦ : ∀ {g M M′ A} → {Γ : Types g}</a>
<a id="7524" class="Comment">--                     → M ↦ M′ → Γ ⊢ M ⦂ A</a>
<a id="7568" class="Comment">--                     → Γ ⊢ M′ ⦂ A</a>
<a id="7604" class="Comment">-- tp↦ (red M⤠M′)        𝒟            = tp⤠ M⤠M′ 𝒟</a>
<a id="7655" class="Comment">-- tp↦ (cong-app₁ M↦M′)  (app 𝒟 ℰ)    = app (tp↦ M↦M′ 𝒟) ℰ</a>
<a id="7714" class="Comment">-- tp↦ (cong-app₂ M↦M′)  (app 𝒟 ℰ)    = app 𝒟 (tp↦ M↦M′ ℰ)</a>
<a id="7773" class="Comment">-- tp↦ (cong-pair₁ M↦M′) (pair 𝒟 ℰ)   = pair (tp↦ M↦M′ 𝒟) ℰ</a>
<a id="7833" class="Comment">-- tp↦ (cong-pair₂ N↦N′) (pair 𝒟 ℰ)   = pair 𝒟 (tp↦ N↦N′ ℰ)</a>
<a id="7893" class="Comment">-- tp↦ (cong-fst M↦M′)   (fst 𝒟)      = fst (tp↦ M↦M′ 𝒟)</a>
<a id="7950" class="Comment">-- tp↦ (cong-snd M↦M′)   (snd 𝒟)      = snd (tp↦ M↦M′ 𝒟)</a>
<a id="8007" class="Comment">-- tp↦ (cong-abort M↦M′) (abort 𝒟)    = abort (tp↦ M↦M′ 𝒟)</a>
<a id="8066" class="Comment">-- tp↦ (cong-left M↦M′)  (left 𝒟)     = left (tp↦ M↦M′ 𝒟)</a>
<a id="8124" class="Comment">-- tp↦ (cong-right M↦M′) (right 𝒟)    = right (tp↦ M↦M′ 𝒟)</a>
<a id="8183" class="Comment">-- tp↦ (cong-case M↦M′)  (case 𝒟 ℰ ℱ) = case (tp↦ M↦M′ 𝒟) ℰ ℱ</a>
<a id="8245" class="Comment">-- tp↦ (cong-if M↦M′)    (if 𝒟 ℰ ℱ)   = if (tp↦ M↦M′ 𝒟) ℰ ℱ</a>


<a id="8307" class="Comment">-- --------------------------------------------------------------------------------</a>


<a id="8393" class="Comment">-- -- `_⤅_` is the iterated small-step reduction relation.</a>
<a id="8452" class="Comment">-- infix 3 _⤅_</a>
<a id="8467" class="Comment">-- data _⤅_ {g} : Term g → Term g → Set</a>
<a id="8507" class="Comment">--   where</a>
<a id="8518" class="Comment">--     -- Iterated small-step reduction is reflexive.</a>
<a id="8572" class="Comment">--     done : ∀ {M} → M ⤅ M</a>

<a id="8601" class="Comment">--     -- Small-step reduction IN REVERSE preserves iterated small-step reduction.</a>
<a id="8684" class="Comment">--     step : ∀ {M M′ M″} → M ↦ M′ → M′ ⤅ M″</a>
<a id="8729" class="Comment">--                        → M ⤅ M″</a>


<a id="8766" class="Comment">-- -- Iterated small-step reduction is transitive.</a>
<a id="8817" class="Comment">-- -- Iterated small-step reduction IN REVERSE preserves iterated small-step reduction.</a>
<a id="8905" class="Comment">-- steps : ∀ {g} → {M M′ M″ : Term g}</a>
<a id="8943" class="Comment">--               → M ⤅ M′ → M′ ⤅ M″</a>
<a id="8979" class="Comment">--               → M ⤅ M″</a>
<a id="9005" class="Comment">-- steps done                M⤅M″  = M⤅M″</a>
<a id="9047" class="Comment">-- steps (step M↦M‴ M‴⤅M′) M′⤅M″ = step M↦M‴ (steps M‴⤅M′ M′⤅M″)</a>


<a id="9114" class="Comment">-- -- When reducing down to a value, the initial small step determines the subsequent small steps.</a>
<a id="9213" class="Comment">-- -- Small-step reduction preserves iterated small-step reduction down to a value.</a>
<a id="9297" class="Comment">-- unstep : ∀ {g} → {M M′ M″ : Term g} → {{_ : Val M″}}</a>
<a id="9353" class="Comment">--                → M ↦ M′ → M ⤅ M″</a>
<a id="9389" class="Comment">--                → M′ ⤅ M″</a>
<a id="9417" class="Comment">-- unstep M↦M′₁ (step M↦M′₂ M′₂⤅M″) with det↦ M↦M′₁ M↦M′₂</a>
<a id="9475" class="Comment">-- unstep M↦M′  (step _      M′⤅M″)  | refl = M′⤅M″</a>
<a id="9527" class="Comment">-- unstep M↦M′  done                  = M↦M′ ↯ ¬val↦</a>


<a id="9582" class="Comment">-- -- When reducing down to a value, iterated small-step reduction is deterministic.</a>
<a id="9667" class="Comment">-- det⤅ : ∀ {g} → {M M′₁ M′₂ : Term g} → {{_ : Val M′₁}} {{_ : Val M′₂}}</a>
<a id="9740" class="Comment">--               → M ⤅ M′₁ → M ⤅ M′₂</a>
<a id="9777" class="Comment">--               → M′₁ ≡ M′₂</a>
<a id="9806" class="Comment">-- det⤅ done                   done                = refl</a>
<a id="9864" class="Comment">-- det⤅ done                   (step M↦M″ M″⤅M′) = M↦M″ ↯ ¬val↦</a>
<a id="9928" class="Comment">-- det⤅ (step M↦M″₁ M″₁⤅M′₁) M⤅M′₂              = det⤅ M″₁⤅M′₁ (unstep M↦M″₁ M⤅M′₂)</a>


<a id="10014" class="Comment">-- -- Iterated small-step reduction is type-preserving.</a>
<a id="10070" class="Comment">-- tp⤅ : ∀ {g M M′ A} → {Γ : Types g}</a>
<a id="10108" class="Comment">--                     → M ⤅ M′ → Γ ⊢ M ⦂ A</a>
<a id="10152" class="Comment">--                     → Γ ⊢ M′ ⦂ A</a>
<a id="10188" class="Comment">-- tp⤅ done                𝒟 = 𝒟</a>
<a id="10221" class="Comment">-- tp⤅ (step M↦M″ M″⤅M′) 𝒟 = tp⤅ M″⤅M′ (tp↦ M↦M″ 𝒟)</a>


<a id="10275" class="Comment">-- -- If `M` reduces to `M′`, then `APP M N` reduces to `APP M′ N`.</a>
<a id="10343" class="Comment">-- congs-app₁ : ∀ {g} → {M M′ N : Term g}</a>
<a id="10385" class="Comment">--                    → M ⤅ M′</a>
<a id="10416" class="Comment">--                    → APP M N ⤅ APP M′ N</a>
<a id="10459" class="Comment">-- congs-app₁ done                = done</a>
<a id="10500" class="Comment">-- congs-app₁ (step M↦M″ M″⤅M′) = step (cong-app₁ M↦M″) (congs-app₁ M″⤅M′)</a>


<a id="10577" class="Comment">-- -- If `N` reduces to `N′`, then `APP (LAM M) N` reduces to `APP (LAM M) N′`.</a>
<a id="10657" class="Comment">-- congs-app₂ : ∀ {g} → {M : Term (suc g)} {N N′ : Term g}</a>
<a id="10716" class="Comment">--                    → N ⤅ N′</a>
<a id="10747" class="Comment">--                    → APP (LAM M) N ⤅ APP (LAM M) N′</a>
<a id="10802" class="Comment">-- congs-app₂ done                = done</a>
<a id="10843" class="Comment">-- congs-app₂ (step M↦M″ M″⤅M′) = step (cong-app₂ M↦M″) (congs-app₂ M″⤅M′)</a>


<a id="10920" class="Comment">-- -- If `M` reduces to `M′` and `N` reduces to `N′`, then `PAIR M N` reduces to `PAIR M′ N′`.</a>
<a id="11015" class="Comment">-- congs-pair : ∀ {g} → {M M′ N N′ : Term g} → {{_ : Val M′}} {{_ : Val N′}}</a>
<a id="11092" class="Comment">--                    → M ⤅ M′ → N ⤅ N′</a>
<a id="11132" class="Comment">--                    → PAIR M N ⤅ PAIR M′ N′</a>
<a id="11178" class="Comment">-- congs-pair done                done                = done</a>
<a id="11239" class="Comment">-- congs-pair done                (step N↦N″ N″⤅N′) = step (cong-pair₂ N↦N″) (congs-pair done N″⤅N′)</a>
<a id="11340" class="Comment">-- congs-pair (step M↦M″ M″⤅M′) N⤅N′               = step (cong-pair₁ M↦M″) (congs-pair M″⤅M′ N⤅N′)</a>


<a id="11442" class="Comment">-- -- If `M` reduces to `M′`, then `FST M` reduces to `FST M′`.</a>
<a id="11506" class="Comment">-- congs-fst : ∀ {g} → {M M′ : Term g}</a>
<a id="11545" class="Comment">--                   → M ⤅ M′</a>
<a id="11575" class="Comment">--                   → FST M ⤅ FST M′</a>
<a id="11613" class="Comment">-- congs-fst done                = done</a>
<a id="11653" class="Comment">-- congs-fst (step M↦M″ M″⤅M′) = step (cong-fst M↦M″) (congs-fst M″⤅M′)</a>


<a id="11727" class="Comment">-- -- If `M` reduces to `M′`, then `SND M` reduces to `SND M′`.</a>
<a id="11791" class="Comment">-- congs-snd : ∀ {g} → {M M′ : Term g}</a>
<a id="11830" class="Comment">--                   → M ⤅ M′</a>
<a id="11860" class="Comment">--                   → SND M ⤅ SND M′</a>
<a id="11898" class="Comment">-- congs-snd done                = done</a>
<a id="11938" class="Comment">-- congs-snd (step M↦M″ M″⤅M′) = step (cong-snd M↦M″) (congs-snd M″⤅M′)</a>


<a id="12012" class="Comment">-- -- If `M` reduces to `M′`, then `LEFT M` reduces to `LEFT M′`.</a>
<a id="12078" class="Comment">-- congs-left : ∀ {g} → {M M′ : Term g} → {{_ : Val M′}}</a>
<a id="12135" class="Comment">--                    → M ⤅ M′</a>
<a id="12166" class="Comment">--                    → LEFT M ⤅ LEFT M′</a>
<a id="12207" class="Comment">-- congs-left done                = done</a>
<a id="12248" class="Comment">-- congs-left (step M↦M″ M″⤅M′) = step (cong-left M↦M″) (congs-left M″⤅M′)</a>


<a id="12325" class="Comment">-- -- If `M` reduces to `M′`, then `RIGHT M` reduces to `RIGHT M′`.</a>
<a id="12393" class="Comment">-- congs-right : ∀ {g} → {M M′ : Term g} → {{_ : Val M′}}</a>
<a id="12451" class="Comment">--                     → M ⤅ M′</a>
<a id="12483" class="Comment">--                     → RIGHT M ⤅ RIGHT M′</a>
<a id="12527" class="Comment">-- congs-right done                = done</a>
<a id="12569" class="Comment">-- congs-right (step M↦M″ M″⤅M′) = step (cong-right M↦M″) (congs-right M″⤅M′)</a>


<a id="12649" class="Comment">-- -- If `M` reduces to `M′`, then `CASE M N O` reduces to `CASE M′ N O`.</a>
<a id="12723" class="Comment">-- congs-case : ∀ {g} → {M M′ : Term g} {N O : Term (suc g)}</a>
<a id="12784" class="Comment">--                    → M ⤅ M′</a>
<a id="12815" class="Comment">--                    → CASE M N O ⤅ CASE M′ N O</a>
<a id="12864" class="Comment">-- congs-case done                = done</a>
<a id="12905" class="Comment">-- congs-case (step M↦M″ M″⤅M′) = step (cong-case M↦M″) (congs-case M″⤅M′)</a>


<a id="12982" class="Comment">-- -- If `M` reduces to `M′`, then `IF M N O` reduces to `IF M′ N O`.</a>
<a id="13052" class="Comment">-- congs-if : ∀ {g} → {M M′ N O : Term g}</a>
<a id="13094" class="Comment">--                  → M ⤅ M′</a>
<a id="13123" class="Comment">--                  → IF M N O ⤅ IF M′ N O</a>
<a id="13166" class="Comment">-- congs-if done                = done</a>
<a id="13205" class="Comment">-- congs-if (step M↦M″ M″⤅M′) = step (cong-if M↦M″) (congs-if M″⤅M′)</a>


<a id="13276" class="Comment">-- -- If `M` reduces to `PAIR M′ N′`, then `FST M` reduces to `M′`.</a>
<a id="13344" class="Comment">-- reds-fst-pair : ∀ {g} → {M M′ N′ : Term g} → {{_ : Val M′}} {{_ : Val N′}}</a>
<a id="13422" class="Comment">--                       → M ⤅ PAIR M′ N′</a>
<a id="13464" class="Comment">--                       → FST M ⤅ M′</a>
<a id="13502" class="Comment">-- reds-fst-pair M⤅PAIR = steps (congs-fst M⤅PAIR) (step (red fst-pair) done)</a>


<a id="13582" class="Comment">-- -- If `M` reduces to `PAIR M′ N′`, then `SND M` reduces to `N′`.</a>
<a id="13650" class="Comment">-- reds-snd-pair : ∀ {g} → {M M′ N′ : Term g} → {{_ : Val M′}} {{_ : Val N′}}</a>
<a id="13728" class="Comment">--                       → M ⤅ PAIR M′ N′</a>
<a id="13770" class="Comment">--                       → SND M ⤅ N′</a>
<a id="13808" class="Comment">-- reds-snd-pair M⤅PAIR = steps (congs-snd M⤅PAIR) (step (red snd-pair) done)</a>


<a id="13888" class="Comment">-- -- If `M` reduces to `TRUE` and `N` reduces to `N′`, then `IF M N O` reduces to `N′`.</a>
<a id="13977" class="Comment">-- reds-if-true : ∀ {g} → {M N N′ O : Term g}</a>
<a id="14023" class="Comment">--                      → M ⤅ TRUE → N ⤅ N′</a>
<a id="14067" class="Comment">--                      → IF M N O ⤅ N′</a>
<a id="14107" class="Comment">-- reds-if-true M⤅TRUE N⤅N′ = steps (congs-if M⤅TRUE) (step (red if-true) N⤅N′)</a>


<a id="14189" class="Comment">-- -- If `M` reduces to `FALSE` and `O` reduces to `O′`, then `IF M N O` reduces to `O′`.</a>
<a id="14279" class="Comment">-- reds-if-false : ∀ {g} → {M N O O′ : Term g}</a>
<a id="14326" class="Comment">--                       → M ⤅ FALSE → O ⤅ O′</a>
<a id="14372" class="Comment">--                       → IF M N O ⤅ O′</a>
<a id="14413" class="Comment">-- reds-if-false M⤅FALSE N⤅N′ = steps (congs-if M⤅FALSE) (step (red if-false) N⤅N′)</a>


<a id="14499" class="Comment">-- --------------------------------------------------------------------------------</a>


<a id="14585" class="Comment">-- -- `_⇓_` is the big-step reduction relation.</a>
<a id="14633" class="Comment">-- infix 3 _⇓_</a>
<a id="14648" class="Comment">-- _⇓_ : ∀ {g} → Term g → Term g → Set</a>
<a id="14687" class="Comment">-- M ⇓ M′ = M ⤅ M′ × Val M′</a>


<a id="14717" class="Comment">-- -- A big step can be extended with an initial small step.</a>
<a id="14778" class="Comment">-- -- Small-step reduction IN REVERSE preserves big-step reduction.</a>
<a id="14846" class="Comment">-- big-step : ∀ {g} → {M M′ M″ : Term g}</a>
<a id="14887" class="Comment">--                  → M ↦ M′ → M′ ⇓ M″</a>
<a id="14926" class="Comment">--                  → M ⇓ M″</a>
<a id="14955" class="Comment">-- big-step M↦M′ (M′⤅M″ , VM″) = step M↦M′ M′⤅M″ , VM″</a>


<a id="15012" class="Comment">-- -- The initial small step determines the subsequent big step.</a>
<a id="15077" class="Comment">-- -- Small-step reduction preserves big-step reduction.</a>
<a id="15134" class="Comment">-- big-unstep : ∀ {g} → {M M′ M″ : Term g}</a>
<a id="15177" class="Comment">--                    → M ↦ M′ → M ⇓ M″</a>
<a id="15217" class="Comment">--                    → M′ ⇓ M″</a>
<a id="15249" class="Comment">-- big-unstep M↦M′ (M′⤅M″ , VM″) = unstep {{VM″}} M↦M′ M′⤅M″ , VM″</a>


<a id="15318" class="Comment">-- -- Big-step reduction is deterministic.</a>
<a id="15361" class="Comment">-- det⇓ : ∀ {g} → {M M′₁ M′₂ : Term g}</a>
<a id="15400" class="Comment">--              → M ⇓ M′₁ → M ⇓ M′₂</a>
<a id="15436" class="Comment">--              → M′₁ ≡ M′₂</a>
<a id="15464" class="Comment">-- det⇓ (M⤅M′₁ , VM′₁) (M⤅M′₂ , VM′₂) = det⤅ {{VM′₁}} {{VM′₂}} M⤅M′₁ M⤅M′₂</a>


<a id="15541" class="Comment">-- -- If `M` reduces to `M′` and `N` reduces to `N′`, then `PAIR M N` reduces to `PAIR M′ N′`.</a>
<a id="15636" class="Comment">-- big-red-pair : ∀ {g} → {M M′ N N′ : Term g}</a>
<a id="15683" class="Comment">--                      → M ⇓ M′ → N ⇓ N′</a>
<a id="15725" class="Comment">--                      → PAIR M N ⇓ PAIR M′ N′</a>
<a id="15773" class="Comment">-- big-red-pair (M⤅M′ , VM′) (N⤅N′ , VN′) = congs-pair {{VM′}} {{VN′}} M⤅M′ N⤅N′ , val-pair {{VM′}} {{VN′}}</a>


<a id="15883" class="Comment">-- -- If `M` reduces to `PAIR M′ N′`, then `FST M` reduces to `M′`.</a>
<a id="15951" class="Comment">-- big-red-fst-pair : ∀ {g} → {M M′ N′ : Term g} → {{_ : Val M′}} {{_ : Val N′}}</a>
<a id="16032" class="Comment">--                          → M ⤅ PAIR M′ N′</a>
<a id="16077" class="Comment">--                          → FST M ⇓ M′</a>
<a id="16118" class="Comment">-- big-red-fst-pair {{VM′}} M⤅PAIR = reds-fst-pair M⤅PAIR , VM′</a>


<a id="16184" class="Comment">-- -- If `M` reduces to `PAIR M′ N′`, then `SND M` reduces to `N′`.</a>
<a id="16252" class="Comment">-- big-red-snd-pair : ∀ {g} → {M M′ N′ : Term g} → {{_ : Val M′}} {{_ : Val N′}}</a>
<a id="16333" class="Comment">--                          → M ⤅ PAIR M′ N′</a>
<a id="16378" class="Comment">--                          → SND M ⇓ N′</a>
<a id="16419" class="Comment">-- big-red-snd-pair {{_}} {{VN′}} M⤅PAIR = reds-snd-pair M⤅PAIR , VN′</a>


<a id="16491" class="Comment">-- -- If `M` reduces to `M′`, then `LEFT M` reduces to `LEFT M′`.</a>
<a id="16557" class="Comment">-- big-red-left : ∀ {g} → {M M′ : Term g}</a>
<a id="16599" class="Comment">--                      → M ⇓ M′</a>
<a id="16632" class="Comment">--                      → LEFT M ⇓ LEFT M′</a>
<a id="16675" class="Comment">-- big-red-left (M⤅M′ , VM′) = congs-left {{VM′}} M⤅M′ , val-left {{VM′}}</a>


<a id="16751" class="Comment">-- -- If `M` reduces to `M′`, then `RIGHT M` reduces to `RIGHT M′`.</a>
<a id="16819" class="Comment">-- big-red-right : ∀ {g} → {M M′ : Term g}</a>
<a id="16862" class="Comment">--                       → M ⇓ M′</a>
<a id="16896" class="Comment">--                       → RIGHT M ⇓ RIGHT M′</a>
<a id="16942" class="Comment">-- big-red-right (M⤅M′ , VM′) = congs-right {{VM′}} M⤅M′ , val-right {{VM′}}</a>


<a id="17021" class="Comment">-- -- If `M` reduces to `TRUE` and `N` reduces to `N′`, then `IF M N O` reduces to `N′`.</a>
<a id="17110" class="Comment">-- big-red-if-true : ∀ {g} → {M N N′ O : Term g}</a>
<a id="17159" class="Comment">--                         → M ⤅ TRUE → N ⇓ N′</a>
<a id="17206" class="Comment">--                         → IF M N O ⇓ N′</a>
<a id="17249" class="Comment">-- big-red-if-true M⤅TRUE (N⤅N′ , VN′) = reds-if-true M⤅TRUE N⤅N′ , VN′</a>


<a id="17323" class="Comment">-- -- If `M` reduces to `FALSE` and `O` reduces to `O′`, then `IF M N O` reduces to `O′`.</a>
<a id="17413" class="Comment">-- big-red-if-false : ∀ {g} → {M N O O′ : Term g}</a>
<a id="17463" class="Comment">--                          → M ⤅ FALSE → O ⇓ O′</a>
<a id="17512" class="Comment">--                          → IF M N O ⇓ O′</a>
<a id="17556" class="Comment">-- big-red-if-false M⤅FALSE (O⤅O′ , VO′) = reds-if-false M⤅FALSE O⤅O′ , VO′</a>


<a id="17634" class="Comment">-- --------------------------------------------------------------------------------</a>


<a id="17720" class="Comment">-- -- `_⇓` is the CBV termination relation.</a>
<a id="17764" class="Comment">-- _⇓ : ∀ {g} → Term g → Set</a>
<a id="17793" class="Comment">-- M ⇓ = Σ (Term _) (\ M′ → M ⇓ M′)</a>


<a id="17831" class="Comment">-- -- Small-step reduction IN REVERSE preserves termination.</a>
<a id="17892" class="Comment">-- -- Reversed small-step reduction is halt-preserving.</a>
<a id="17948" class="Comment">-- hpr↦ : ∀ {g} → {M M′ : Term g}</a>
<a id="17982" class="Comment">--               → M ↦ M′ → M′ ⇓</a>
<a id="18015" class="Comment">--               → M ⇓</a>
<a id="18038" class="Comment">-- hpr↦ M↦M′ (M″ , M′⇓M″) = M″ , big-step M↦M′ M′⇓M″</a>


<a id="18093" class="Comment">-- -- Small-step reduction preserves termination.</a>
<a id="18143" class="Comment">-- -- Small-step reduction is halt-preserving.</a>
<a id="18190" class="Comment">-- hp↦ : ∀ {g} → {M M′ : Term g}</a>
<a id="18223" class="Comment">--              → M ↦ M′ → M ⇓</a>
<a id="18254" class="Comment">--              → M′ ⇓</a>
<a id="18277" class="Comment">-- hp↦ M↦M′ (M″ , M′⇓M″) = M″ , big-unstep M↦M′ M′⇓M″</a>


<a id="18333" class="Comment">-- -- If `M` terminates and `N` terminates, then `PAIR M N` terminates.</a>
<a id="18405" class="Comment">-- halt-pair : ∀ {g} → {M N : Term g}</a>
<a id="18443" class="Comment">--                   → M ⇓ → N ⇓</a>
<a id="18476" class="Comment">--                   → PAIR M N ⇓</a>
<a id="18510" class="Comment">-- halt-pair (M′ , M⇓M′) (N′ , N⇓N′) = PAIR M′ N′ , big-red-pair M⇓M′ N⇓N′</a>


<a id="18587" class="Comment">-- -- If `M` reduces to `PAIR M′ N′`, then `FST M` terminates.</a>
<a id="18650" class="Comment">-- halt-fst-pair : ∀ {g} → {M M′ N′ : Term g} → {{_ : Val M′}} {{_ : Val N′}}</a>
<a id="18728" class="Comment">--                       → M ⤅ PAIR M′ N′</a>
<a id="18770" class="Comment">--                       → FST M ⇓</a>
<a id="18805" class="Comment">-- halt-fst-pair {M′ = M′} M⤅PAIR = M′ , big-red-fst-pair M⤅PAIR</a>


<a id="18872" class="Comment">-- -- If `M` reduces to `PAIR M′ N′`, then `SND M` terminates.</a>
<a id="18935" class="Comment">-- halt-snd-pair : ∀ {g} → {M M′ N′ : Term g} → {{_ : Val M′}} {{_ : Val N′}}</a>
<a id="19013" class="Comment">--                       → M ⤅ PAIR M′ N′</a>
<a id="19055" class="Comment">--                       → SND M ⇓</a>
<a id="19090" class="Comment">-- halt-snd-pair {N′ = N′} M⤅PAIR = N′ , big-red-snd-pair M⤅PAIR</a>


<a id="19157" class="Comment">-- -- If `M` terminates, then `FST M` terminates.</a>
<a id="19207" class="Comment">-- halt-fst : ∀ {g M A B} → {Γ : Types g}</a>
<a id="19249" class="Comment">--                        → Γ ⊢ M ⦂ A ∧ B → M ⇓</a>
<a id="19297" class="Comment">--                        → FST M ⇓</a>
<a id="19333" class="Comment">-- halt-fst 𝒟 (M′       , M⤅M′   , VM′)       with tp⤅ M⤅M′ 𝒟</a>
<a id="19395" class="Comment">-- halt-fst 𝒟 (LAM _    , _       , val-lam)   | ()</a>
<a id="19447" class="Comment">-- halt-fst 𝒟 (PAIR _ _ , M⤅PAIR , val-pair)  | pair _ _ = halt-fst-pair M⤅PAIR</a>
<a id="19527" class="Comment">-- halt-fst 𝒟 (UNIT     , _       , val-unit)  | ()</a>
<a id="19579" class="Comment">-- halt-fst 𝒟 (LEFT _   , _       , val-left)  | ()</a>
<a id="19631" class="Comment">-- halt-fst 𝒟 (RIGHT _  , _       , val-right) | ()</a>
<a id="19683" class="Comment">-- halt-fst 𝒟 (TRUE     , _       , val-true)  | ()</a>
<a id="19735" class="Comment">-- halt-fst 𝒟 (FALSE    , _       , val-false) | ()</a>


<a id="19789" class="Comment">-- -- If `M` terminates, then `SND M` terminates.</a>
<a id="19839" class="Comment">-- halt-snd : ∀ {g M A B} → {Γ : Types g}</a>
<a id="19881" class="Comment">--                        → Γ ⊢ M ⦂ A ∧ B → M ⇓</a>
<a id="19929" class="Comment">--                        → SND M ⇓</a>
<a id="19965" class="Comment">-- halt-snd 𝒟 (M′       , M⤅M′   , VM′)       with tp⤅ M⤅M′ 𝒟</a>
<a id="20027" class="Comment">-- halt-snd 𝒟 (LAM _    , _       , val-lam)   | ()</a>
<a id="20079" class="Comment">-- halt-snd 𝒟 (PAIR _ _ , M⤅PAIR , val-pair)  | pair _ _ = halt-snd-pair M⤅PAIR</a>
<a id="20159" class="Comment">-- halt-snd 𝒟 (UNIT     , _       , val-unit)  | ()</a>
<a id="20211" class="Comment">-- halt-snd 𝒟 (LEFT _   , _       , val-left)  | ()</a>
<a id="20263" class="Comment">-- halt-snd 𝒟 (RIGHT _  , _       , val-right) | ()</a>
<a id="20315" class="Comment">-- halt-snd 𝒟 (TRUE     , _       , val-true)  | ()</a>
<a id="20367" class="Comment">-- halt-snd 𝒟 (FALSE    , _       , val-false) | ()</a>


<a id="20421" class="Comment">-- -- If `M` terminates, then `ABORT M` terminates.</a>
<a id="20473" class="Comment">-- halt-abort : ∀ {g M} → {Γ : Types g}</a>
<a id="20513" class="Comment">--                      → Γ ⊢ M ⦂ 𝟘 → M ⇓</a>
<a id="20555" class="Comment">--                      → ABORT M ⇓</a>
<a id="20591" class="Comment">-- halt-abort 𝒟 (M′       , M⤅M′ , VM′)       with tp⤅ M⤅M′ 𝒟</a>
<a id="20653" class="Comment">-- halt-abort 𝒟 (LAM _    , _     , val-lam)   | ()</a>
<a id="20705" class="Comment">-- halt-abort 𝒟 (PAIR _ _ , _     , val-pair)  | ()</a>
<a id="20757" class="Comment">-- halt-abort 𝒟 (UNIT     , _     , val-unit)  | ()</a>
<a id="20809" class="Comment">-- halt-abort 𝒟 (LEFT _   , _     , val-left)  | ()</a>
<a id="20861" class="Comment">-- halt-abort 𝒟 (RIGHT _  , _     , val-right) | ()</a>
<a id="20913" class="Comment">-- halt-abort 𝒟 (TRUE     , _     , val-true)  | ()</a>
<a id="20965" class="Comment">-- halt-abort 𝒟 (FALSE    , _     , val-false) | ()</a>


<a id="21019" class="Comment">-- -- If `M` terminates, then `LEFT M` terminates.</a>
<a id="21070" class="Comment">-- halt-left : ∀ {g} → {M : Term g}</a>
<a id="21106" class="Comment">--                   → M ⇓</a>
<a id="21133" class="Comment">--                   → LEFT M ⇓</a>
<a id="21165" class="Comment">-- halt-left (M′ , M⇓M′) = LEFT M′ , big-red-left M⇓M′</a>


<a id="21222" class="Comment">-- -- If `M` terminates, then `RIGHT M` terminates.</a>
<a id="21274" class="Comment">-- halt-right : ∀ {g} → {M : Term g}</a>
<a id="21311" class="Comment">--                    → M ⇓</a>
<a id="21339" class="Comment">--                    → RIGHT M ⇓</a>
<a id="21373" class="Comment">-- halt-right (M′ , M⇓M′) = RIGHT M′ , big-red-right M⇓M′</a>


<a id="21433" class="Comment">-- -- If `M` reduces to `TRUE` and `N` terminates, then `IF M N O` terminates.</a>
<a id="21512" class="Comment">-- halt-if-true : ∀ {g} → {M N O : Term g}</a>
<a id="21555" class="Comment">--                      → M ⤅ TRUE → N ⇓</a>
<a id="21596" class="Comment">--                      → IF M N O ⇓</a>
<a id="21633" class="Comment">-- halt-if-true M⤅TRUE (N′ , N⇓N′) = N′ , big-red-if-true M⤅TRUE N⇓N′</a>


<a id="21705" class="Comment">-- -- If `M` reduces to `FALSE` and `O` terminates, then `IF M N O` terminates.</a>
<a id="21785" class="Comment">-- halt-if-false : ∀ {g} → {M N O : Term g}</a>
<a id="21829" class="Comment">--                       → M ⤅ FALSE → O ⇓</a>
<a id="21872" class="Comment">--                       → IF M N O ⇓</a>
<a id="21910" class="Comment">-- halt-if-false M⤅FALSE (O′ , O⇓O′) = O′ , big-red-if-false M⤅FALSE O⇓O′</a>


<a id="21986" class="Comment">-- -- If `M` terminates and `N` terminates and `O` terminates, then `IF M N O` terminates.</a>
<a id="22077" class="Comment">-- halt-if : ∀ {g M N O} → {Γ : Types g}</a>
<a id="22118" class="Comment">--                       → Γ ⊢ M ⦂ 𝔹 → M ⇓ → N ⇓ → O ⇓</a>
<a id="22173" class="Comment">--                       → IF M N O ⇓</a>
<a id="22211" class="Comment">-- halt-if 𝒟 (M′       , M⤅M′    , VM′)       N⇓ O⇓ with tp⤅ M⤅M′ 𝒟</a>
<a id="22279" class="Comment">-- halt-if 𝒟 (LAM _    , _        , val-lam)   N⇓ O⇓ | ()</a>
<a id="22337" class="Comment">-- halt-if 𝒟 (PAIR _ _ , _        , val-pair)  N⇓ O⇓ | ()</a>
<a id="22395" class="Comment">-- halt-if 𝒟 (UNIT     , _        , val-unit)  N⇓ O⇓ | ()</a>
<a id="22453" class="Comment">-- halt-if 𝒟 (LEFT _   , _        , val-left)  N⇓ O⇓ | ()</a>
<a id="22511" class="Comment">-- halt-if 𝒟 (RIGHT _  , _        , val-right) N⇓ O⇓ | ()</a>
<a id="22569" class="Comment">-- halt-if 𝒟 (TRUE     , M⤅TRUE  , val-true)  N⇓ O⇓ | true  = halt-if-true M⤅TRUE N⇓</a>
<a id="22654" class="Comment">-- halt-if 𝒟 (FALSE    , M⤅FALSE , val-false) N⇓ O⇓ | false = halt-if-false M⤅FALSE O⇓</a>


<a id="22743" class="Comment">-- -- Every well-typed term terminates.</a>
<a id="22783" class="Comment">-- -- Impossible without a stronger induction hypothesis.</a>
<a id="22841" class="Comment">-- {-</a>
<a id="22847" class="Comment">-- halt : ∀ {M A} → ∙ ⊢ M ⦂ A</a>
<a id="22877" class="Comment">--                → M ⇓</a>
<a id="22901" class="Comment">-- halt (var ())</a>
<a id="22918" class="Comment">-- halt (lam 𝒟)      = LAM _ , done , val-lam</a>
<a id="22964" class="Comment">-- halt (app 𝒟 ℰ)    = {!!}</a>
<a id="22992" class="Comment">-- halt (pair 𝒟 ℰ)   = halt-pair (halt 𝒟) (halt ℰ)</a>
<a id="23043" class="Comment">-- halt (fst 𝒟)      = halt-fst 𝒟 (halt 𝒟)</a>
<a id="23086" class="Comment">-- halt (snd 𝒟)      = halt-snd 𝒟 (halt 𝒟)</a>
<a id="23129" class="Comment">-- halt unit         = UNIT , done , val-unit</a>
<a id="23175" class="Comment">-- halt (abort 𝒟)    = halt-abort 𝒟 (halt 𝒟)</a>
<a id="23220" class="Comment">-- halt (left 𝒟)     = halt-left (halt 𝒟)</a>
<a id="23262" class="Comment">-- halt (right 𝒟)    = halt-right (halt 𝒟)</a>
<a id="23305" class="Comment">-- halt (case 𝒟 ℰ ℱ) = {!!}</a>
<a id="23333" class="Comment">-- halt true         = TRUE , done , val-true</a>
<a id="23379" class="Comment">-- halt false        = FALSE , done , val-false</a>
<a id="23427" class="Comment">-- halt (if 𝒟 ℰ ℱ)   = halt-if 𝒟 (halt 𝒟) (halt ℰ) (halt ℱ)</a>
<a id="23487" class="Comment">-- -}</a>


<a id="23495" class="Comment">-- --------------------------------------------------------------------------------</a>


<a id="23581" class="Comment">-- red-app-lam : ∀ {g n M N} → {τ : Terms g n} → {{_ : Val N}}</a>
<a id="23644" class="Comment">--                           → APP (LAM (SUB (LIFTS τ) M)) N ↦ SUB (τ , N) M</a>
<a id="23721" class="Comment">-- red-app-lam {M = M} {N} {τ} rewrite simp-CUT-SUB N τ M ⁻¹ = red app-lam</a>


<a id="23798" class="Comment">-- big-red-app-lam : ∀ {g n M M′ N} → {τ : Terms g n} → {{_ : Val N}}</a>
<a id="23868" class="Comment">--                                  → SUB (τ , N) M ⇓ M′</a>
<a id="23925" class="Comment">--                                  → APP (LAM (SUB (LIFTS τ) M)) N ⇓ M′</a>
<a id="23998" class="Comment">-- big-red-app-lam {M = M} (SUB⤅M′ , VM′) = step (red-app-lam {M = M}) SUB⤅M′ , VM′</a>


<a id="24084" class="Comment">-- halt-app-lam : ∀ {g n M N} → {τ : Terms g n} → {{_ : Val N}}</a>
<a id="24148" class="Comment">--                            → SUB (τ , N) M ⇓</a>
<a id="24196" class="Comment">--                            → APP (LAM (SUB (LIFTS τ) M)) N ⇓</a>
<a id="24260" class="Comment">-- halt-app-lam {M = M} (M′ , SUB⇓M′) = M′ , big-red-app-lam {M = M} SUB⇓M′</a>


<a id="24338" class="Comment">-- --------------------------------------------------------------------------------</a>


<a id="24424" class="Comment">-- red-case-left : ∀ {g n M N O} → {τ : Terms g n} → {{_ : Val M}}</a>
<a id="24491" class="Comment">--                               → CASE (LEFT M) (SUB (LIFTS τ) N) (SUB (LIFTS τ) O) ↦ SUB (τ , M) N</a>
<a id="24592" class="Comment">-- red-case-left {M = M} {N} {τ = τ} rewrite simp-CUT-SUB M τ N ⁻¹ = red case-left</a>


<a id="24677" class="Comment">-- big-red-case-left : ∀ {g n M N N′ O} → {τ : Terms g n} → {{_ : Val M}}</a>
<a id="24751" class="Comment">--                                      → SUB (τ , M) N ⇓ N′</a>
<a id="24812" class="Comment">--                                      → CASE (LEFT M) (SUB (LIFTS τ) N) (SUB (LIFTS τ) O) ⇓ N′</a>
<a id="24909" class="Comment">-- big-red-case-left {N = N} {O = O} (SUB⤅N′ , VN′) = step (red-case-left {N = N} {O}) SUB⤅N′ , VN′</a>


<a id="25011" class="Comment">-- halt-case-left : ∀ {g n M N O} → {τ : Terms g n} → {{_ : Val M}}</a>
<a id="25079" class="Comment">--                                → SUB (τ , M) N ⇓</a>
<a id="25131" class="Comment">--                                → CASE (LEFT M) (SUB (LIFTS τ) N) (SUB (LIFTS τ) O) ⇓</a>
<a id="25219" class="Comment">-- halt-case-left {N = N} {O} (N′ , SUB⇓N′) = N′ , big-red-case-left {N = N} {O = O} SUB⇓N′</a>


<a id="25313" class="Comment">-- --------------------------------------------------------------------------------</a>


<a id="25399" class="Comment">-- red-case-right : ∀ {g n M N O} → {τ : Terms g n} → {{_ : Val M}}</a>
<a id="25467" class="Comment">--                                → CASE (RIGHT M) (SUB (LIFTS τ) N) (SUB (LIFTS τ) O) ↦ SUB (τ , M) O</a>
<a id="25570" class="Comment">-- red-case-right {M = M} {O = O} {τ} rewrite simp-CUT-SUB M τ O ⁻¹ = red case-right</a>


<a id="25657" class="Comment">-- big-red-case-right : ∀ {g n M N O O′} → {τ : Terms g n} → {{_ : Val M}}</a>
<a id="25732" class="Comment">--                                       → SUB (τ , M) O ⇓ O′</a>
<a id="25794" class="Comment">--                                       → CASE (RIGHT M) (SUB (LIFTS τ) N) (SUB (LIFTS τ) O) ⇓ O′</a>
<a id="25893" class="Comment">-- big-red-case-right {N = N} {O} (SUB⤅O′ , VO′) = step (red-case-right {N = N} {O}) SUB⤅O′ , VO′</a>


<a id="25993" class="Comment">-- halt-case-right : ∀ {g n M N O} → {τ : Terms g n} → {{_ : Val M}}</a>
<a id="26062" class="Comment">--                                 → SUB (τ , M) O ⇓</a>
<a id="26115" class="Comment">--                                 → CASE (RIGHT M) (SUB (LIFTS τ) N) (SUB (LIFTS τ) O) ⇓</a>
<a id="26205" class="Comment">-- halt-case-right {N = N} {O} (O′ , SUB⇓O′) = O′ , big-red-case-right {N = N} {O} SUB⇓O′</a>


<a id="26297" class="Comment">-- --------------------------------------------------------------------------------</a>
</pre></body></html>