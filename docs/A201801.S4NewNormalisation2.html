<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>A201801.S4NewNormalisation2</title><link rel="stylesheet" href="mi-common.css"></head><body><pre class="Agda"><a id="1" class="Symbol">{-#</a> <a id="5" class="Keyword">OPTIONS</a> <a id="13" class="Pragma">--rewriting</a> <a id="25" class="Symbol">#-}</a>

<a id="30" class="Keyword">module</a> <a id="37" href="A201801.S4NewNormalisation2.html" class="Module">A201801.S4NewNormalisation2</a> <a id="65" class="Keyword">where</a>

<a id="72" class="Keyword">open</a> <a id="77" class="Keyword">import</a> <a id="84" href="A201801.Prelude.html" class="Module">A201801.Prelude</a>
<a id="100" class="Keyword">open</a> <a id="105" class="Keyword">import</a> <a id="112" href="A201801.Category.html" class="Module">A201801.Category</a>
<a id="129" class="Keyword">open</a> <a id="134" class="Keyword">import</a> <a id="141" href="A201801.List.html" class="Module">A201801.List</a>
<a id="154" class="Keyword">open</a> <a id="159" href="A201801.List.html#3023" class="Module">ListÂ²</a>
<a id="165" class="Keyword">open</a> <a id="170" class="Keyword">import</a> <a id="177" href="A201801.ListLemmas.html" class="Module">A201801.ListLemmas</a>
<a id="196" class="Keyword">open</a> <a id="201" class="Keyword">import</a> <a id="208" href="A201801.AllList.html" class="Module">A201801.AllList</a>
<a id="224" class="Keyword">open</a> <a id="229" class="Keyword">import</a> <a id="236" href="A201801.S4Propositions.html" class="Module">A201801.S4Propositions</a>
<a id="259" class="Keyword">open</a> <a id="264" class="Keyword">import</a> <a id="271" href="A201801.S4StandardDerivations.html" class="Module">A201801.S4StandardDerivations</a>
<a id="301" class="Keyword">open</a> <a id="306" class="Keyword">import</a> <a id="313" href="A201801.S4NewBidirectionalDerivationsForNormalisation.html" class="Module">A201801.S4NewBidirectionalDerivationsForNormalisation</a>
<a id="367" class="Keyword">import</a> <a id="374" href="A201801.S4EmbeddingOfIPL.html" class="Module">A201801.S4EmbeddingOfIPL</a> <a id="399" class="Symbol">as</a> <a id="402" class="Module">OfIPL</a>
<a id="408" class="Keyword">import</a> <a id="415" href="A201801.S4ProjectionToIPL.html" class="Module">A201801.S4ProjectionToIPL</a> <a id="441" class="Symbol">as</a> <a id="444" class="Module">ToIPL</a>
<a id="450" class="Keyword">import</a> <a id="457" href="A201801.IPLPropositions.html" class="Module">A201801.IPLPropositions</a> <a id="481" class="Symbol">as</a> <a id="484" class="Module">IPL</a>
<a id="488" class="Keyword">import</a> <a id="495" href="A201801.IPLStandardDerivations.html" class="Module">A201801.IPLStandardDerivations</a> <a id="526" class="Symbol">as</a> <a id="529" class="Module">IPL</a>
<a id="533" class="Keyword">import</a> <a id="540" href="A201801.IPLStandardNormalisation.html" class="Module">A201801.IPLStandardNormalisation</a>


<a id="575" class="Comment">--------------------------------------------------------------------------------</a>


<a id="658" class="Comment">-- TODO: unfinished</a>
<a id="678" class="Comment">-- open IPLNormalisation using (Model ; World ; Ground ; Explode ; _â‰¥_ ; idâ‰¥ ; _âˆ˜â‰¥_ ; relG)</a>

<a id="771" class="Comment">-- -- record Model : Setâ‚</a>
<a id="797" class="Comment">-- --   where</a>
<a id="811" class="Comment">-- --     field</a>
<a id="827" class="Comment">-- --       World : Set</a>
<a id="851" class="Comment">-- --</a>
<a id="857" class="Comment">-- --       -- TODO: Better name</a>
<a id="890" class="Comment">-- --       Ground : World â†’ String â†’ Set</a>
<a id="932" class="Comment">-- --</a>
<a id="938" class="Comment">-- --       -- TODO: Better name</a>
<a id="971" class="Comment">-- --       Explode : World â†’ Prop â†’ Set</a>
<a id="1012" class="Comment">-- --</a>
<a id="1018" class="Comment">-- --       _â‰¥_ : World â†’ World â†’ Set</a>
<a id="1056" class="Comment">-- --</a>
<a id="1062" class="Comment">-- --       idâ‰¥ : âˆ€ {W} â†’ W â‰¥ W</a>
<a id="1094" class="Comment">-- --</a>
<a id="1100" class="Comment">-- --       _âˆ˜â‰¥_ : âˆ€ {W Wâ€² Wâ€³} â†’ Wâ€² â‰¥ W â†’ Wâ€³ â‰¥ Wâ€²</a>
<a id="1150" class="Comment">-- --                          â†’ Wâ€³ â‰¥ W</a>
<a id="1190" class="Comment">-- --</a>
<a id="1196" class="Comment">-- --       relG : âˆ€ {P W Wâ€²} â†’ Wâ€² â‰¥ W â†’ Ground W P</a>
<a id="1248" class="Comment">-- --                         â†’ Ground Wâ€² P</a>
<a id="1292" class="Comment">-- --</a>
<a id="1298" class="Comment">-- -- open Model {{...}}</a>


<a id="1325" class="Comment">-- --------------------------------------------------------------------------------</a>


<a id="1411" class="Comment">-- mutual</a>
<a id="1421" class="Comment">--   infix 3 _âŠ©_value</a>
<a id="1443" class="Comment">--   _âŠ©_value : âˆ€ {{_ : Model}} â†’ World â†’ Prop â†’ Set</a>
<a id="1496" class="Comment">--   W âŠ© Î¹ P value   = Ground W P</a>
<a id="1530" class="Comment">--   W âŠ© A âŠƒ B value = âˆ€ {Wâ€²} â†’ Wâ€² â‰¥ W â†’ Wâ€² âŠ© A thunk</a>
<a id="1584" class="Comment">--                             â†’ Wâ€² âŠ© B thunk</a>
<a id="1630" class="Comment">--   W âŠ© â–¡ A value   = W âŠ© âŸªâŠ« A âŸ« chunk</a>

<a id="1671" class="Comment">--   infix 3 _âŠ©_thunk</a>
<a id="1693" class="Comment">--   _âŠ©_thunk : âˆ€ {{_ : Model}} â†’ World â†’ Prop â†’ Set</a>
<a id="1746" class="Comment">--   W âŠ© A thunk = âˆ€ {B Wâ€²} â†’ Wâ€² â‰¥ W â†’ (âˆ€ {Wâ€³} â†’ Wâ€³ â‰¥ Wâ€² â†’ Wâ€³ âŠ© A value</a>
<a id="1818" class="Comment">--                                                â†’ Explode Wâ€³ B)</a>
<a id="1884" class="Comment">--                           â†’ Explode Wâ€² B</a>

<a id="1929" class="Comment">--   infix 3 _âŠ©_chunk</a>
<a id="1951" class="Comment">--   _âŠ©_chunk : âˆ€ {{_ : Model}} â†’ World â†’ Assert â†’ Set</a>
<a id="2006" class="Comment">--   W âŠ© âŸªâŠ« A âŸ« chunk = âˆ™ IPL.âŠ¢ ToIPL.â†“â‚š A true Ã— W IPL.âŠ© (ToIPL.â†“â‚š A) value</a>


<a id="2085" class="Comment">-- infix 3 _âŠ©_allthunk</a>
<a id="2108" class="Comment">-- _âŠ©_allthunk : âˆ€ {{_ : Model}} â†’ World â†’ List Prop â†’ Set</a>
<a id="2167" class="Comment">-- W âŠ© Î“ allthunk = All (W âŠ©_thunk) Î“</a>


<a id="2207" class="Comment">-- infix 3 _âŠ©_allchunk</a>
<a id="2230" class="Comment">-- _âŠ©_allchunk : âˆ€ {{_ : Model}} â†’ World â†’ List Assert â†’ Set</a>
<a id="2291" class="Comment">-- W âŠ© Î” allchunk = All (W âŠ©_chunk) Î”</a>


<a id="2331" class="Comment">-- --------------------------------------------------------------------------------</a>


<a id="2417" class="Comment">-- syn : âˆ€ {{_ : Model}} {A W} â†’ W âŠ© âŸªâŠ« A âŸ« chunk</a>
<a id="2467" class="Comment">--                             â†’ âˆ™ IPL.âŠ¢ ToIPL.â†“â‚š A true</a>
<a id="2524" class="Comment">-- syn (ğ’Ÿ , k) = ğ’Ÿ</a>


<a id="2545" class="Comment">-- syns : âˆ€ {{_ : Model}} {Î” W} â†’ W âŠ© Î” allchunk</a>
<a id="2594" class="Comment">--                              â†’ âˆ™ IPL.âŠ¢ ToIPL.â†“â‚â‚› Î” alltrue</a>
<a id="2656" class="Comment">-- syns âˆ™                       = âˆ™</a>
<a id="2692" class="Comment">-- syns (_,_ {A = âŸªâŠ« A âŸ«} Î´ c) = syns Î´ , syn {A} c</a>


<a id="2746" class="Comment">-- sem : âˆ€ {{_ : Model}} {A W} â†’ W âŠ© âŸªâŠ« A âŸ« chunk</a>
<a id="2796" class="Comment">--                             â†’ W IPL.âŠ© ToIPL.â†“â‚š A value</a>
<a id="2854" class="Comment">-- sem (ğ’Ÿ , k) = k</a>


<a id="2875" class="Comment">-- --------------------------------------------------------------------------------</a>


<a id="2961" class="Comment">-- mutual</a>
<a id="2971" class="Comment">--   rel : âˆ€ {{_ : Model}} {A W Wâ€²} â†’ Wâ€² â‰¥ W â†’ W âŠ© A value</a>
<a id="3030" class="Comment">--                                  â†’ Wâ€² âŠ© A value</a>
<a id="3081" class="Comment">--   rel {Î¹ P}   Î· ğ’Ÿ = relG Î· ğ’Ÿ</a>
<a id="3113" class="Comment">--   rel {A âŠƒ B} Î· f = \ Î·â€² k â†’ f (Î· âˆ˜â‰¥ Î·â€²) k</a>
<a id="3159" class="Comment">--   rel {â–¡ A}   Î· c = chrel {âŸªâŠ« A âŸ«} Î· c</a>

<a id="3202" class="Comment">--   threl : âˆ€ {{_ : Model}} {A W Wâ€²} â†’ Wâ€² â‰¥ W â†’ W âŠ© A thunk</a>
<a id="3263" class="Comment">--                                    â†’ Wâ€² âŠ© A thunk</a>
<a id="3316" class="Comment">--   threl Î· k = \ Î·â€² f â†’ k (Î· âˆ˜â‰¥ Î·â€²) f</a>

<a id="3357" class="Comment">--   chrel : âˆ€ {{_ : Model}} {A W Wâ€²} â†’ Wâ€² â‰¥ W â†’ W âŠ© A chunk</a>
<a id="3418" class="Comment">--                                    â†’ Wâ€² âŠ© A chunk</a>
<a id="3471" class="Comment">--   chrel {âŸªâŠ« A âŸ«} Î· c = syn {A} c , IPL.rel {ToIPL.â†“â‚š A} Î· (sem {A} c)</a>


<a id="3546" class="Comment">-- threls : âˆ€ {{_ : Model}} {Î“ W Wâ€²} â†’ Wâ€² â‰¥ W â†’ W âŠ© Î“ allthunk</a>
<a id="3609" class="Comment">--                                   â†’ Wâ€² âŠ© Î“ allthunk</a>
<a id="3664" class="Comment">-- threls Î· Î³ = maps (\ {A} k {B} {Wâ€²} â†’ threl {A} Î· (\ {C} {Wâ€³} â†’ k {C} {Wâ€³})) Î³  -- NOTE: Annoying</a>


<a id="3767" class="Comment">-- chrels : âˆ€ {{_ : Model}} {Î” W Wâ€²} â†’ Wâ€² â‰¥ W â†’ W âŠ© Î” allchunk</a>
<a id="3830" class="Comment">--                                   â†’ Wâ€² âŠ© Î” allchunk</a>
<a id="3885" class="Comment">-- chrels Î· Î´ = maps (\ {A} c â†’ chrel {A} Î· c) Î´</a>


<a id="3936" class="Comment">-- --------------------------------------------------------------------------------</a>


<a id="4022" class="Comment">-- return : âˆ€ {{_ : Model}} {A W} â†’ W âŠ© A value</a>
<a id="4070" class="Comment">--                                â†’ W âŠ© A thunk</a>
<a id="4118" class="Comment">-- return {A} a = \ Î· f â†’ f idâ‰¥ (rel {A} Î· a)</a>


<a id="4166" class="Comment">-- bind : âˆ€ {{_ : Model}} {A B W} â†’ W âŠ© A thunk â†’ (âˆ€ {Wâ€²} â†’ Wâ€² â‰¥ W â†’ Wâ€² âŠ© A value</a>
<a id="4248" class="Comment">--                                                           â†’ Wâ€² âŠ© B thunk)</a>
<a id="4325" class="Comment">--                                â†’ W âŠ© B thunk</a>
<a id="4373" class="Comment">-- bind k f = \ Î· fâ€² â†’</a>
<a id="4396" class="Comment">--              k Î· (\ Î·â€² a â†’</a>
<a id="4426" class="Comment">--                f (Î· âˆ˜â‰¥ Î·â€²) a idâ‰¥ (\ Î·â€³ b â†’</a>
<a id="4472" class="Comment">--                  fâ€² (Î·â€² âˆ˜â‰¥ Î·â€³) b))</a>


<a id="4512" class="Comment">-- --------------------------------------------------------------------------------</a>


<a id="4598" class="Comment">-- infix 3 _âŠ¨_valid[_]</a>
<a id="4621" class="Comment">-- _âŠ¨_valid[_] : List Assert â†’ Prop â†’ List Prop â†’ Setâ‚</a>
<a id="4676" class="Comment">-- Î” âŠ¨ A valid[ Î“ ] = âˆ€ {{_ : Model}} {W} â†’ W âŠ© Î” allchunk â†’ W âŠ© Î“ allthunk</a>
<a id="4752" class="Comment">--                                         â†’ W âŠ© A thunk</a>


<a id="4811" class="Comment">-- â†“ : âˆ€ {Î” Î“ A} â†’ Î” âŠ¢ A valid[ Î“ ]</a>
<a id="4847" class="Comment">--               â†’ Î” âŠ¨ A valid[ Î“ ]</a>
<a id="4883" class="Comment">-- â†“ (var i)              Î´ Î³ = get Î³ i</a>
<a id="4923" class="Comment">-- â†“ (lam {A} {B} ğ’Ÿ)      Î´ Î³ = return {A âŠƒ B} (\ Î· k â†’</a>
<a id="4979" class="Comment">--                                â†“ ğ’Ÿ (chrels Î· Î´) (threls Î· Î³ , k))</a>
<a id="5048" class="Comment">-- â†“ (app {A} {B} ğ’Ÿ â„°)    Î´ Î³ = bind {A âŠƒ B} {B} (â†“ ğ’Ÿ Î´ Î³) (\ Î· f â†’</a>
<a id="5116" class="Comment">--                                f idâ‰¥ (â†“ â„° (chrels Î· Î´) (threls Î· Î³)))</a>
<a id="5189" class="Comment">-- â†“ (mvar {A} i)         Î´ Î³ = {!sem {A} (get Î´ i)!}</a>
<a id="5243" class="Comment">-- â†“ (box {A} ğ’Ÿ)          Î´ Î³ = {!!} -- return {â–¡ A} (IPL.sub (syns Î´) (ToIPL.â†“ ğ’Ÿ) , â†“ ğ’Ÿ Î´ âˆ™)</a>
<a id="5337" class="Comment">-- â†“ (letbox {A} {B} ğ’Ÿ â„°) Î´ Î³ = bind {â–¡ A} {B} (â†“ ğ’Ÿ Î´ Î³) (\ Î· c â†’</a>
<a id="5403" class="Comment">--                                â†“ â„° (chrels Î· Î´ , c) (threls Î· Î³))</a>


<a id="5474" class="Comment">-- --------------------------------------------------------------------------------</a>


<a id="5560" class="Comment">-- -- renÂ² : âˆ€ {Î” Î”â€² Î“ Î“â€² A} â†’ Î”â€² â¨¾ Î“â€² âŠ‡Â² Î” â¨¾ Î“ â†’ Î” âŠ¢ A neutral[ Î“ ]</a>
<a id="5629" class="Comment">-- --                        â†’ Î”â€² âŠ¢ A neutral[ Î“â€² ]</a>
<a id="5681" class="Comment">-- -- renÂ² (Î·â‚ , Î·â‚‚) ğ’Ÿ = mrenáµ£ Î·â‚ (renáµ£ Î·â‚‚ ğ’Ÿ)</a>


<a id="5729" class="Comment">-- -- instance</a>
<a id="5744" class="Comment">-- --   canon : Model</a>
<a id="5766" class="Comment">-- --   canon = record</a>
<a id="5789" class="Comment">-- --             { World   = ListÂ² Assert Prop</a>
<a id="5837" class="Comment">-- --             ; Ground  = \ { (Î” â¨¾ Î“) P â†’ Î” âŠ¢ Î¹ P neutral[ Î“ ] }</a>
<a id="5906" class="Comment">-- --             ; Explode = \ { (Î” â¨¾ Î“) A â†’ Î” âŠ¢ A normal[ Î“ ] }</a>
<a id="5972" class="Comment">-- --             ; _â‰¥_     = _âŠ‡Â²_</a>
<a id="6007" class="Comment">-- --             ; idâ‰¥     = id</a>
<a id="6040" class="Comment">-- --             ; _âˆ˜â‰¥_    = _âˆ˜_</a>
<a id="6074" class="Comment">-- --             ; relG    = renÂ²</a>
<a id="6109" class="Comment">-- --             }</a>


<a id="6131" class="Comment">-- -- mutual</a>
<a id="6144" class="Comment">-- --   â‡“ : âˆ€ {A Î” Î“} â†’ Î” âŠ¢ A neutral[ Î“ ]</a>
<a id="6187" class="Comment">-- --                 â†’ Î” â¨¾ Î“ âŠ© A thunk</a>
<a id="6227" class="Comment">-- --   â‡“ {Î¹ P}   ğ’Ÿ = return {Î¹ P} ğ’Ÿ</a>
<a id="6264" class="Comment">-- --   â‡“ {A âŠƒ B} ğ’Ÿ = return {A âŠƒ B} (\ Î· k â†’ â‡“ (app (renÂ² Î· ğ’Ÿ) (â‡‘ k)))</a>
<a id="6336" class="Comment">-- --   â‡“ {â–¡ A}   ğ’Ÿ = \ Î· f â†’ {!!}</a>
<a id="6371" class="Comment">-- --   -- letbox (renÂ² Î· ğ’Ÿ) (f (dropâ‚ id) (mvz , â‡“ mvzáµ£))</a>

<a id="6431" class="Comment">-- --   â‡‘ : âˆ€ {A Î” Î“} â†’ Î” â¨¾ Î“ âŠ© A thunk</a>
<a id="6471" class="Comment">-- --                 â†’ Î” âŠ¢ A normal[ Î“ ]</a>
<a id="6513" class="Comment">-- --   â‡‘ {Î¹ P}   k = k id (\ Î· ğ’Ÿ â†’ use ğ’Ÿ)</a>
<a id="6556" class="Comment">-- --   â‡‘ {A âŠƒ B} k = k id (\ Î· f â†’ lam (â‡‘ (f (dropâ‚‚ id) (â‡“ vzáµ£))))</a>
<a id="6624" class="Comment">-- --   â‡‘ {â–¡ A}   k = k id (\ Î· c â†’ {!box (syn {A} c)!})</a>


<a id="6683" class="Comment">-- -- --------------------------------------------------------------------------------</a>


<a id="6772" class="Comment">-- -- swks : âˆ€ {A Î” Î“ Î} â†’ Î” â¨¾ Î“ âŠ© Î allthunk</a>
<a id="6818" class="Comment">-- --                    â†’ Î” â¨¾ Î“ , A âŠ© Î allthunk</a>
<a id="6868" class="Comment">-- -- swks Î¾ = threls (dropâ‚‚ id) Î¾</a>


<a id="6905" class="Comment">-- -- slifts : âˆ€ {A Î” Î“ Î} â†’ Î” â¨¾ Î“ âŠ© Î allthunk</a>
<a id="6953" class="Comment">-- --                      â†’ Î” â¨¾ Î“ , A âŠ© Î , A allthunk</a>
<a id="7009" class="Comment">-- -- slifts Î¾ = swks Î¾ , â‡“ vzáµ£</a>


<a id="7043" class="Comment">-- -- svars : âˆ€ {Î” Î“ Î“â€²} â†’ Î“â€² âŠ‡ Î“</a>
<a id="7077" class="Comment">-- --                    â†’ Î” â¨¾ Î“â€² âŠ© Î“ allthunk</a>
<a id="7124" class="Comment">-- -- svars done     = âˆ™</a>
<a id="7149" class="Comment">-- -- svars (drop Î·) = swks (svars Î·)</a>
<a id="7187" class="Comment">-- -- svars (keep Î·) = slifts (svars Î·)</a>


<a id="7229" class="Comment">-- -- sids : âˆ€ {Î” Î“} â†’ Î” â¨¾ Î“ âŠ© Î“ allthunk</a>
<a id="7271" class="Comment">-- -- sids = svars id</a>


<a id="7295" class="Comment">-- -- --------------------------------------------------------------------------------</a>


<a id="7384" class="Comment">-- -- smwks : âˆ€ {A Î” Î“ Î} â†’ Î” â¨¾ Î“ âŠ© Î allchunk</a>
<a id="7431" class="Comment">-- --                     â†’ Î” , A â¨¾ Î“ âŠ© Î allchunk</a>
<a id="7482" class="Comment">-- -- smwks Î¾ = chrels (dropâ‚ id) Î¾</a>


<a id="7520" class="Comment">-- -- smlifts : âˆ€ {A Î” Î“ Î} â†’ Î” â¨¾ Î“ âŠ© Î allchunk</a>
<a id="7569" class="Comment">-- --                       â†’ Î” , A â¨¾ Î“ âŠ© Î , A allchunk</a>
<a id="7626" class="Comment">-- -- smlifts Î¾ = {!!} -- smwks Î¾ , (mvz , â‡“ mvzáµ£)</a>


<a id="7679" class="Comment">-- -- smvars : âˆ€ {Î” Î”â€² Î“} â†’ Î”â€² âŠ‡ Î”</a>
<a id="7714" class="Comment">-- --                     â†’ Î”â€² â¨¾ Î“ âŠ© Î” allchunk</a>
<a id="7762" class="Comment">-- -- smvars done     = âˆ™</a>
<a id="7788" class="Comment">-- -- smvars (drop Î·) = smwks (smvars Î·)</a>
<a id="7829" class="Comment">-- -- smvars (keep Î·) = smlifts (smvars Î·)</a>


<a id="7874" class="Comment">-- -- smids : âˆ€ {Î” Î“} â†’ Î” â¨¾ Î“ âŠ© Î” allchunk</a>
<a id="7917" class="Comment">-- -- smids = smvars id</a>


<a id="7943" class="Comment">-- -- --------------------------------------------------------------------------------</a>


<a id="8032" class="Comment">-- -- â†‘ : âˆ€ {Î” Î“ A} â†’ Î” âŠ¨ A valid[ Î“ ]</a>
<a id="8071" class="Comment">-- --               â†’ Î” âŠ¢ A normal[ Î“ ]</a>
<a id="8111" class="Comment">-- -- â†‘ f = â‡‘ (f smids sids)</a>


<a id="8142" class="Comment">-- -- nm : âˆ€ {Î” Î“ A} â†’ Î” âŠ¢ A valid[ Î“ ]</a>
<a id="8182" class="Comment">-- --                â†’ Î” âŠ¢ A normal[ Î“ ]</a>
<a id="8223" class="Comment">-- -- nm ğ’Ÿ = â†‘ (â†“ ğ’Ÿ)</a>


<a id="8246" class="Comment">-- -- --------------------------------------------------------------------------------</a>
</pre></body></html>