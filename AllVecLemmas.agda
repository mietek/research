{-# OPTIONS --rewriting #-}

module AllVecLemmas where

open import Prelude
open import Category
open import Fin
open import FinLemmas
open import Vec
open import VecLemmas
open import AllVec


--------------------------------------------------------------------------------
{-
                      get (gets Î¾ Î·) i â‰¡ (get Î¾ âˆ˜ renâˆ‹ Î·) i                     comp-get-renâˆ‹

                            gets Î¾ idâŠ‡ â‰¡ Î¾                                      id-gets
                      gets Î¾ (Î·â‚ âˆ˜ Î·â‚‚) â‰¡ gets (gets Î¾ Î·â‚‚) Î·â‚                    comp-gets
                                                                                ğ ğğ­ğ¬

                            idâŠ‡â—‡ âˆ˜âŠ‡â—‡ ğœ‚ â‰¡ ğœ‚                                      lidâˆ˜âŠ‡â—‡
                            ğœ‚ âˆ˜âŠ‡â—‡ idâŠ‡â—‡ â‰¡ ğœ‚                                      ridâˆ˜âŠ‡â—‡
                    (ğœ‚â‚ âˆ˜âŠ‡â—‡ ğœ‚â‚‚) âˆ˜âŠ‡â—‡ ğœ‚â‚ƒ â‰¡ ğœ‚â‚ âˆ˜âŠ‡â—‡ (ğœ‚â‚‚ âˆ˜âŠ‡â—‡ ğœ‚â‚ƒ)                     assocâˆ˜âŠ‡â—‡
                                                                                ğğğ„â—‡

                          renâˆ‹â—‡ idâŠ‡â—‡ ğ‘– â‰¡ ğ‘–                                      id-renâˆ‹â—‡
                   renâˆ‹â—‡ (ğœ‚â‚ âˆ˜âŠ‡â—‡ ğœ‚â‚‚) ğ‘– â‰¡ (renâˆ‹â—‡ ğœ‚â‚‚ âˆ˜ renâˆ‹â—‡ ğœ‚â‚) ğ‘–                comp-renâˆ‹â—‡
                                                                                ğ«ğğ§âˆ‹â—‡
-}
--------------------------------------------------------------------------------


comp-get-renâˆ‹ : âˆ€ {X P A n nâ€²} â†’ {Î : Vec X n} {Îâ€² : Vec X nâ€²} {e : nâ€² â‰¥ n} {I : Fin n}
                               â†’ (Î¾ : All P Îâ€²) (Î· : Îâ€² âŠ‡âŸ¨ e âŸ© Î) (i : Î âˆ‹âŸ¨ I âŸ© A)
                               â†’ get (gets Î¾ Î·) i â‰¡ (get Î¾ âˆ˜ renâˆ‹ Î·) i
comp-get-renâˆ‹ âˆ™       done     ()
comp-get-renâˆ‹ (Î¾ , b) (drop Î·) i       = comp-get-renâˆ‹ Î¾ Î· i
comp-get-renâˆ‹ (Î¾ , a) (keep Î·) zero    = refl
comp-get-renâˆ‹ (Î¾ , b) (keep Î·) (suc i) = comp-get-renâˆ‹ Î¾ Î· i


--------------------------------------------------------------------------------


id-gets : âˆ€ {X P n} â†’ {Î : Vec X n}
                    â†’ (Î¾ : All P Î)
                    â†’ gets Î¾ idâŠ‡ â‰¡ Î¾
id-gets âˆ™       = refl
id-gets (Î¾ , a) = (_, a) & id-gets Î¾


comp-gets : âˆ€ {X P n nâ€² nâ€³ eâ‚ eâ‚‚} â†’ {Î : Vec X n} {Îâ€² : Vec X nâ€²} {Îâ€³ : Vec X nâ€³}
                                  â†’ (Î¾ : All P Îâ€³) (Î·â‚ : Îâ€² âŠ‡âŸ¨ eâ‚ âŸ© Î) (Î·â‚‚ : Îâ€³ âŠ‡âŸ¨ eâ‚‚ âŸ© Îâ€²)
                                  â†’ gets Î¾ (Î·â‚ âˆ˜âŠ‡ Î·â‚‚) â‰¡ gets (gets Î¾ Î·â‚‚) Î·â‚
comp-gets âˆ™       Î·â‚        done      = refl
comp-gets (Î¾ , b) Î·â‚        (drop Î·â‚‚) = comp-gets Î¾ Î·â‚ Î·â‚‚
comp-gets (Î¾ , b) (drop Î·â‚) (keep Î·â‚‚) = comp-gets Î¾ Î·â‚ Î·â‚‚
comp-gets (Î¾ , a) (keep Î·â‚) (keep Î·â‚‚) = (_, a) & comp-gets Î¾ Î·â‚ Î·â‚‚


ğ ğğ­ğ¬ : âˆ€ {X P} â†’ Presheaf (Opposite (ğğğ„ {X}))
                           (\ { (n , Î) â†’ All P Î })
ğ ğğ­ğ¬ = record
         { â„±     = \ { (e , Î·) Î¾ â†’ gets Î¾ Î· }
         ; idâ„±   = funext! id-gets
         ; compâ„± = \ { (eâ‚ , Î·â‚) (eâ‚‚ , Î·â‚‚) â†’ funext! (\ Î¾ â†’ comp-gets Î¾ Î·â‚‚ Î·â‚) }
         }


--------------------------------------------------------------------------------


{-# REWRITE lidâˆ˜âŠ‡ #-}
lidâˆ˜âŠ‡â—‡ : âˆ€ {X P n nâ€² e} â†’ {Î : Vec X n} {Îâ€² : Vec X nâ€²} {Î· : Îâ€² âŠ‡âŸ¨ e âŸ© Î}
                           {Î¾ : All P Î} {Î¾â€² : All P Îâ€²}
                        â†’ (ğœ‚ : Î¾â€² âŠ‡â—‡âŸ¨ Î· âŸ© Î¾)
                        â†’ idâŠ‡â—‡ âˆ˜âŠ‡â—‡ ğœ‚ â‰¡ ğœ‚
lidâˆ˜âŠ‡â—‡ done     = refl
lidâˆ˜âŠ‡â—‡ (drop ğœ‚) = drop & lidâˆ˜âŠ‡â—‡ ğœ‚
lidâˆ˜âŠ‡â—‡ (keep ğœ‚) = keep & lidâˆ˜âŠ‡â—‡ ğœ‚


{-# REWRITE ridâˆ˜âŠ‡ #-}
ridâˆ˜âŠ‡â—‡ : âˆ€ {X P n nâ€² e} â†’ {Î : Vec X n} {Îâ€² : Vec X nâ€²} {Î· : Îâ€² âŠ‡âŸ¨ e âŸ© Î}
                           {Î¾ : All P Î} {Î¾â€² : All P Îâ€²}
                        â†’ (ğœ‚ : Î¾â€² âŠ‡â—‡âŸ¨ Î· âŸ© Î¾)
                        â†’ ğœ‚ âˆ˜âŠ‡â—‡ idâŠ‡â—‡ â‰¡ ğœ‚
ridâˆ˜âŠ‡â—‡ done     = refl
ridâˆ˜âŠ‡â—‡ (drop ğœ‚) = drop & ridâˆ˜âŠ‡â—‡ ğœ‚
ridâˆ˜âŠ‡â—‡ (keep ğœ‚) = keep & ridâˆ˜âŠ‡â—‡ ğœ‚


{-# REWRITE assocâˆ˜âŠ‡ #-}
assocâˆ˜âŠ‡â—‡ : âˆ€ {X P n nâ€² nâ€³ nâ€´ eâ‚ eâ‚‚ eâ‚ƒ} â†’ {Î : Vec X n} {Îâ€² : Vec X nâ€²} {Îâ€³ : Vec X nâ€³} {Îâ€´ : Vec X nâ€´}
                                          {Î·â‚ : Îâ€² âŠ‡âŸ¨ eâ‚ âŸ© Î} {Î·â‚‚ : Îâ€³ âŠ‡âŸ¨ eâ‚‚ âŸ© Îâ€²} {Î·â‚ƒ : Îâ€´ âŠ‡âŸ¨ eâ‚ƒ âŸ© Îâ€³}
                                          {Î¾ : All P Î} {Î¾â€² : All P Îâ€²} {Î¾â€³ : All P Îâ€³} {Î¾â€´ : All P Îâ€´}
                                       â†’ (ğœ‚â‚ : Î¾â€² âŠ‡â—‡âŸ¨ Î·â‚ âŸ© Î¾) (ğœ‚â‚‚ : Î¾â€³ âŠ‡â—‡âŸ¨ Î·â‚‚ âŸ© Î¾â€²) (ğœ‚â‚ƒ : Î¾â€´ âŠ‡â—‡âŸ¨ Î·â‚ƒ âŸ© Î¾â€³)
                                       â†’ (ğœ‚â‚ âˆ˜âŠ‡â—‡ ğœ‚â‚‚) âˆ˜âŠ‡â—‡ ğœ‚â‚ƒ â‰¡ ğœ‚â‚ âˆ˜âŠ‡â—‡ (ğœ‚â‚‚ âˆ˜âŠ‡â—‡ ğœ‚â‚ƒ)
assocâˆ˜âŠ‡â—‡ ğœ‚â‚        ğœ‚â‚‚        done      = refl
assocâˆ˜âŠ‡â—‡ ğœ‚â‚        ğœ‚â‚‚        (drop ğœ‚â‚ƒ) = drop & assocâˆ˜âŠ‡â—‡ ğœ‚â‚ ğœ‚â‚‚ ğœ‚â‚ƒ
assocâˆ˜âŠ‡â—‡ ğœ‚â‚        (drop ğœ‚â‚‚) (keep ğœ‚â‚ƒ) = drop & assocâˆ˜âŠ‡â—‡ ğœ‚â‚ ğœ‚â‚‚ ğœ‚â‚ƒ
assocâˆ˜âŠ‡â—‡ (drop ğœ‚â‚) (keep ğœ‚â‚‚) (keep ğœ‚â‚ƒ) = drop & assocâˆ˜âŠ‡â—‡ ğœ‚â‚ ğœ‚â‚‚ ğœ‚â‚ƒ
assocâˆ˜âŠ‡â—‡ (keep ğœ‚â‚) (keep ğœ‚â‚‚) (keep ğœ‚â‚ƒ) = keep & assocâˆ˜âŠ‡â—‡ ğœ‚â‚ ğœ‚â‚‚ ğœ‚â‚ƒ


instance
  ğğğ„â—‡ : âˆ€ {X P} â†’ Category (Î£ Nat (\ n â†’ Î£ (Vec X n) (All P)))
                             (\ { (nâ€² , (Îâ€² , Î¾â€²)) (n , (Î , Î¾)) â†’
                               Î£ (nâ€² â‰¥ n) (\ e â†’
                                 Î£ (Îâ€² âŠ‡âŸ¨ e âŸ© Î) (\ Î· â†’ Î¾â€² âŠ‡â—‡âŸ¨ Î· âŸ© Î¾)) })
  ğğğ„â—‡ = record
           { id     = id , (idâŠ‡ , idâŠ‡â—‡)
           ; _âˆ˜_    = \ { (eâ‚ , (Î·â‚ , ğœ‚â‚)) (eâ‚‚ , (Î·â‚‚ , ğœ‚â‚‚)) â†’ eâ‚ âˆ˜ eâ‚‚ , (Î·â‚ âˆ˜âŠ‡ Î·â‚‚ , ğœ‚â‚ âˆ˜âŠ‡â—‡ ğœ‚â‚‚) }
           ; lidâˆ˜   = \ { (e , (Î· , ğœ‚)) â†’ (\ ğœ‚â€² â†’ e , (Î· , ğœ‚â€²)) & lidâˆ˜âŠ‡â—‡ ğœ‚ }
           ; ridâˆ˜   = \ { (e , (Î· , ğœ‚)) â†’ (\ ğœ‚â€² â†’ e , (Î· , ğœ‚â€²)) & ridâˆ˜âŠ‡â—‡ ğœ‚ }
           ; assocâˆ˜ = \ { (eâ‚ , (Î·â‚ , ğœ‚â‚)) (eâ‚‚ , (Î·â‚‚ , ğœ‚â‚‚)) (eâ‚ƒ , (Î·â‚ƒ , ğœ‚â‚ƒ)) â†’
                        ((\ ğœ‚â€² â†’ (eâ‚ âˆ˜ eâ‚‚) âˆ˜ eâ‚ƒ , (((Î·â‚ âˆ˜âŠ‡ Î·â‚‚) âˆ˜âŠ‡ Î·â‚ƒ) , ğœ‚â€²))) & assocâˆ˜âŠ‡â—‡ ğœ‚â‚ ğœ‚â‚‚ ğœ‚â‚ƒ }
           }


--------------------------------------------------------------------------------


{-# REWRITE id-renâˆ‹ #-}
id-renâˆ‹â—‡ : âˆ€ {X P A n I} â†’ {Î : Vec X n} {i : Î âˆ‹âŸ¨ I âŸ© A} {a : P A} {Î¾ : All P Î}
                         â†’ (ğ‘– : Î¾ âˆ‹â—‡âŸ¨ i âŸ© a)
                         â†’ renâˆ‹â—‡ idâŠ‡â—‡ ğ‘– â‰¡ ğ‘–
id-renâˆ‹â—‡ zero    = refl
id-renâˆ‹â—‡ (suc ğ‘–) = suc & id-renâˆ‹â—‡ ğ‘–


{-# REWRITE comp-renâˆ‹ #-}
comp-renâˆ‹â—‡ : âˆ€ {X P A n nâ€² nâ€³ eâ‚ eâ‚‚ I} â†’ {Î : Vec X n} {Îâ€² : Vec X nâ€²} {Îâ€³ : Vec X nâ€³}
                                          {Î·â‚ : Îâ€² âŠ‡âŸ¨ eâ‚ âŸ© Î} {Î·â‚‚ : Îâ€³ âŠ‡âŸ¨ eâ‚‚ âŸ© Îâ€²} {i : Î âˆ‹âŸ¨ I âŸ© A}
                                          {a : P A} {Î¾ : All P Î} {Î¾â€² : All P Îâ€²} {Î¾â€³ : All P Îâ€³}
                                       â†’ (ğœ‚â‚ : Î¾â€² âŠ‡â—‡âŸ¨ Î·â‚ âŸ© Î¾) (ğœ‚â‚‚ : Î¾â€³ âŠ‡â—‡âŸ¨ Î·â‚‚ âŸ© Î¾â€²) (ğ‘– : Î¾ âˆ‹â—‡âŸ¨ i âŸ© a)
                                       â†’ renâˆ‹â—‡ (ğœ‚â‚ âˆ˜âŠ‡â—‡ ğœ‚â‚‚) ğ‘– â‰¡ (renâˆ‹â—‡ ğœ‚â‚‚ âˆ˜ renâˆ‹â—‡ ğœ‚â‚) ğ‘–
comp-renâˆ‹â—‡ ğœ‚â‚        done      ğ‘–       = refl
comp-renâˆ‹â—‡ ğœ‚â‚        (drop ğœ‚â‚‚) ğ‘–       = suc & comp-renâˆ‹â—‡ ğœ‚â‚ ğœ‚â‚‚ ğ‘–
comp-renâˆ‹â—‡ (drop ğœ‚â‚) (keep ğœ‚â‚‚) ğ‘–       = suc & comp-renâˆ‹â—‡ ğœ‚â‚ ğœ‚â‚‚ ğ‘–
comp-renâˆ‹â—‡ (keep ğœ‚â‚) (keep ğœ‚â‚‚) zero    = refl
comp-renâˆ‹â—‡ (keep ğœ‚â‚) (keep ğœ‚â‚‚) (suc ğ‘–) = suc & comp-renâˆ‹â—‡ ğœ‚â‚ ğœ‚â‚‚ ğ‘–


ğ«ğğ§âˆ‹â—‡ : âˆ€ {X P A} â†’ {a : P A}
                  â†’ Presheaf (ğğğ„â—‡ {X} {P})
                              (\ { (n , (Î , Î¾)) â†’
                                Î£ (Fin n) (\ I â†’
                                  Î£ (Î âˆ‹âŸ¨ I âŸ© A) (\ i â†’ Î¾ âˆ‹â—‡âŸ¨ i âŸ© a)) })
ğ«ğğ§âˆ‹â—‡ = record
           { â„±     = \ { (e , (Î· , ğœ‚)) (I , (i , ğ‘–)) â†’ RENâˆ‹ e I , (renâˆ‹ Î· i , renâˆ‹â—‡ ğœ‚ ğ‘–) }
           ; idâ„±   = funext! (\ { (I , (i , ğ‘–)) â†’ ((_ ,_) âˆ˜ (_ ,_)) & id-renâˆ‹â—‡ ğ‘– })
           ; compâ„± = \ { (eâ‚ , (Î·â‚ , ğœ‚â‚)) (eâ‚‚ , (Î·â‚‚ , ğœ‚â‚‚)) â†’
                       funext! (\ { (I , (i , ğ‘–)) â†’ ((_ ,_) âˆ˜ (_ ,_)) & comp-renâˆ‹â—‡ ğœ‚â‚ ğœ‚â‚‚ ğ‘– }) }
           }


--------------------------------------------------------------------------------
