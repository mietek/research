{-# OPTIONS --rewriting #-}

module AllVecLemmas where

open import Prelude
open import Category
open import Fin
open import FinLemmas
open import Vec
open import VecLemmas
open import AllVec


--------------------------------------------------------------------------------
{-
                      get (gets Î¾ Î·) ğ’¾ â‰¡ (get Î¾ âˆ˜ renâˆ‹ Î·) ğ’¾                     comp-get-renâˆ‹

                            gets Î¾ idâŠ‡ â‰¡ Î¾                                      id-gets   â± ğ ğğ­ğ¬
                      gets Î¾ (Î·â‚ âˆ˜ Î·â‚‚) â‰¡ gets (gets Î¾ Î·â‚‚) Î·â‚                    comp-gets â°

                            idâŠ‡â—‡ âˆ˜âŠ‡â—‡ ğ›ˆ â‰¡ ğ›ˆ                                      lidâˆ˜âŠ‡â—‡   â«
                            ğ›ˆ âˆ˜âŠ‡â—‡ idâŠ‡â—‡ â‰¡ ğ›ˆ                                      ridâˆ˜âŠ‡â—‡   â¬ ğğğ„â€²
                    (ğ›ˆâ‚ âˆ˜âŠ‡â—‡ ğ›ˆâ‚‚) âˆ˜âŠ‡â—‡ ğ›ˆâ‚ƒ â‰¡ ğ›ˆâ‚ âˆ˜âŠ‡â—‡ (ğ›ˆâ‚‚ âˆ˜âŠ‡â—‡ ğ›ˆâ‚ƒ)                     assocâˆ˜âŠ‡â—‡ â­

                          renâˆ‹â—‡ idâŠ‡â—‡ ğ“² â‰¡ ğ“²                                      id-renâˆ‹â—‡   â± ğ«ğğ§âˆ‹â—‡
                   renâˆ‹â—‡ (ğ›ˆâ‚ âˆ˜âŠ‡â—‡ ğ›ˆâ‚‚) ğ“² â‰¡ (renâˆ‹â—‡ ğ›ˆâ‚‚ âˆ˜ renâˆ‹â—‡ ğ›ˆâ‚) ğ“²                comp-renâˆ‹â—‡ â°
-}
--------------------------------------------------------------------------------


comp-get-renâˆ‹ : âˆ€ {X P A n nâ€²} â†’ {Î : Vec X n} {Îâ€² : Vec X nâ€²} {e : nâ€² â‰¥ n} {i : Fin n}
                               â†’ (Î¾ : All P Îâ€²) (Î· : Îâ€² âŠ‡âŸ¨ e âŸ© Î) (ğ’¾ : Î âˆ‹âŸ¨ i âŸ© A)
                               â†’ get (gets Î¾ Î·) ğ’¾ â‰¡ (get Î¾ âˆ˜ renâˆ‹ Î·) ğ’¾
comp-get-renâˆ‹ âˆ™       done     ()
comp-get-renâˆ‹ (Î¾ , b) (drop Î·) ğ’¾       = comp-get-renâˆ‹ Î¾ Î· ğ’¾
comp-get-renâˆ‹ (Î¾ , a) (keep Î·) zero    = refl
comp-get-renâˆ‹ (Î¾ , b) (keep Î·) (suc ğ’¾) = comp-get-renâˆ‹ Î¾ Î· ğ’¾


--------------------------------------------------------------------------------


id-gets : âˆ€ {X P n} â†’ {Î : Vec X n}
                    â†’ (Î¾ : All P Î)
                    â†’ gets Î¾ idâŠ‡ â‰¡ Î¾
id-gets âˆ™       = refl
id-gets (Î¾ , a) = (_, a) & id-gets Î¾


comp-gets : âˆ€ {X P n nâ€² nâ€³ eâ‚ eâ‚‚} â†’ {Î : Vec X n} {Îâ€² : Vec X nâ€²} {Îâ€³ : Vec X nâ€³}
                                  â†’ (Î¾ : All P Îâ€³) (Î·â‚ : Îâ€² âŠ‡âŸ¨ eâ‚ âŸ© Î) (Î·â‚‚ : Îâ€³ âŠ‡âŸ¨ eâ‚‚ âŸ© Îâ€²)
                                  â†’ gets Î¾ (Î·â‚ âˆ˜âŠ‡ Î·â‚‚) â‰¡ gets (gets Î¾ Î·â‚‚) Î·â‚
comp-gets âˆ™       Î·â‚        done      = refl
comp-gets (Î¾ , b) Î·â‚        (drop Î·â‚‚) = comp-gets Î¾ Î·â‚ Î·â‚‚
comp-gets (Î¾ , b) (drop Î·â‚) (keep Î·â‚‚) = comp-gets Î¾ Î·â‚ Î·â‚‚
comp-gets (Î¾ , a) (keep Î·â‚) (keep Î·â‚‚) = (_, a) & comp-gets Î¾ Î·â‚ Î·â‚‚


ğ ğğ­ğ¬ : âˆ€ {X P} â†’ Presheaf (Opposite (ğğğ„ {X}))
                           (\ { (n , Î) â†’ All P Î })
ğ ğğ­ğ¬ = record
         { â„±     = \ { (e , Î·) Î¾ â†’ gets Î¾ Î· }
         ; idâ„±   = funext! id-gets
         ; compâ„± = \ { (eâ‚ , Î·â‚) (eâ‚‚ , Î·â‚‚) â†’ funext! (\ Î¾ â†’ comp-gets Î¾ Î·â‚‚ Î·â‚) }
         }


--------------------------------------------------------------------------------


{-# REWRITE lidâˆ˜âŠ‡ #-}
lidâˆ˜âŠ‡â—‡ : âˆ€ {X P n nâ€² e} â†’ {Î : Vec X n} {Îâ€² : Vec X nâ€²} {Î· : Îâ€² âŠ‡âŸ¨ e âŸ© Î}
                           {Î¾ : All P Î} {Î¾â€² : All P Îâ€²}
                        â†’ (ğ›ˆ : Î¾â€² âŠ‡â—‡âŸ¨ Î· âŸ© Î¾)
                        â†’ idâŠ‡â—‡ âˆ˜âŠ‡â—‡ ğ›ˆ â‰¡ ğ›ˆ
lidâˆ˜âŠ‡â—‡ done     = refl
lidâˆ˜âŠ‡â—‡ (drop ğ›ˆ) = drop & lidâˆ˜âŠ‡â—‡ ğ›ˆ
lidâˆ˜âŠ‡â—‡ (keep ğ›ˆ) = keep & lidâˆ˜âŠ‡â—‡ ğ›ˆ


{-# REWRITE ridâˆ˜âŠ‡ #-}
ridâˆ˜âŠ‡â—‡ : âˆ€ {X P n nâ€² e} â†’ {Î : Vec X n} {Îâ€² : Vec X nâ€²} {Î· : Îâ€² âŠ‡âŸ¨ e âŸ© Î}
                           {Î¾ : All P Î} {Î¾â€² : All P Îâ€²}
                        â†’ (ğ›ˆ : Î¾â€² âŠ‡â—‡âŸ¨ Î· âŸ© Î¾)
                        â†’ ğ›ˆ âˆ˜âŠ‡â—‡ idâŠ‡â—‡ â‰¡ ğ›ˆ
ridâˆ˜âŠ‡â—‡ done     = refl
ridâˆ˜âŠ‡â—‡ (drop ğ›ˆ) = drop & ridâˆ˜âŠ‡â—‡ ğ›ˆ
ridâˆ˜âŠ‡â—‡ (keep ğ›ˆ) = keep & ridâˆ˜âŠ‡â—‡ ğ›ˆ


{-# REWRITE assocâˆ˜âŠ‡ #-}
assocâˆ˜âŠ‡â—‡ : âˆ€ {X P n nâ€² nâ€³ nâ€´ eâ‚ eâ‚‚ eâ‚ƒ} â†’ {Î : Vec X n} {Îâ€² : Vec X nâ€²} {Îâ€³ : Vec X nâ€³} {Îâ€´ : Vec X nâ€´}
                                          {Î·â‚ : Îâ€² âŠ‡âŸ¨ eâ‚ âŸ© Î} {Î·â‚‚ : Îâ€³ âŠ‡âŸ¨ eâ‚‚ âŸ© Îâ€²} {Î·â‚ƒ : Îâ€´ âŠ‡âŸ¨ eâ‚ƒ âŸ© Îâ€³}
                                          {Î¾ : All P Î} {Î¾â€² : All P Îâ€²} {Î¾â€³ : All P Îâ€³} {Î¾â€´ : All P Îâ€´}
                                       â†’ (ğ›ˆâ‚ : Î¾â€² âŠ‡â—‡âŸ¨ Î·â‚ âŸ© Î¾) (ğ›ˆâ‚‚ : Î¾â€³ âŠ‡â—‡âŸ¨ Î·â‚‚ âŸ© Î¾â€²) (ğ›ˆâ‚ƒ : Î¾â€´ âŠ‡â—‡âŸ¨ Î·â‚ƒ âŸ© Î¾â€³)
                                       â†’ (ğ›ˆâ‚ âˆ˜âŠ‡â—‡ ğ›ˆâ‚‚) âˆ˜âŠ‡â—‡ ğ›ˆâ‚ƒ â‰¡ ğ›ˆâ‚ âˆ˜âŠ‡â—‡ (ğ›ˆâ‚‚ âˆ˜âŠ‡â—‡ ğ›ˆâ‚ƒ)
assocâˆ˜âŠ‡â—‡ ğ›ˆâ‚        ğ›ˆâ‚‚        done      = refl
assocâˆ˜âŠ‡â—‡ ğ›ˆâ‚        ğ›ˆâ‚‚        (drop ğ›ˆâ‚ƒ) = drop & assocâˆ˜âŠ‡â—‡ ğ›ˆâ‚ ğ›ˆâ‚‚ ğ›ˆâ‚ƒ
assocâˆ˜âŠ‡â—‡ ğ›ˆâ‚        (drop ğ›ˆâ‚‚) (keep ğ›ˆâ‚ƒ) = drop & assocâˆ˜âŠ‡â—‡ ğ›ˆâ‚ ğ›ˆâ‚‚ ğ›ˆâ‚ƒ
assocâˆ˜âŠ‡â—‡ (drop ğ›ˆâ‚) (keep ğ›ˆâ‚‚) (keep ğ›ˆâ‚ƒ) = drop & assocâˆ˜âŠ‡â—‡ ğ›ˆâ‚ ğ›ˆâ‚‚ ğ›ˆâ‚ƒ
assocâˆ˜âŠ‡â—‡ (keep ğ›ˆâ‚) (keep ğ›ˆâ‚‚) (keep ğ›ˆâ‚ƒ) = keep & assocâˆ˜âŠ‡â—‡ ğ›ˆâ‚ ğ›ˆâ‚‚ ğ›ˆâ‚ƒ


instance
  ğğğ„â€² : âˆ€ {X P} â†’ Category (Î£ Nat (\ n â†’ Î£ (Vec X n) (All P)))
                             (\ { (nâ€² , (Îâ€² , Î¾â€²)) (n , (Î , Î¾)) â†’
                               Î£ (nâ€² â‰¥ n) (\ e â†’
                                 Î£ (Îâ€² âŠ‡âŸ¨ e âŸ© Î) (\ Î· â†’ Î¾â€² âŠ‡â—‡âŸ¨ Î· âŸ© Î¾)) })
  ğğğ„â€² = record
           { id     = id , (idâŠ‡ , idâŠ‡â—‡)
           ; _âˆ˜_    = \ { (eâ‚ , (Î·â‚ , ğ›ˆâ‚)) (eâ‚‚ , (Î·â‚‚ , ğ›ˆâ‚‚)) â†’ eâ‚ âˆ˜ eâ‚‚ , (Î·â‚ âˆ˜âŠ‡ Î·â‚‚ , ğ›ˆâ‚ âˆ˜âŠ‡â—‡ ğ›ˆâ‚‚) }
           ; lidâˆ˜   = \ { (e , (Î· , ğ›ˆ)) â†’ (\ ğ›ˆâ€² â†’ e , (Î· , ğ›ˆâ€²)) & lidâˆ˜âŠ‡â—‡ ğ›ˆ }
           ; ridâˆ˜   = \ { (e , (Î· , ğ›ˆ)) â†’ (\ ğ›ˆâ€² â†’ e , (Î· , ğ›ˆâ€²)) & ridâˆ˜âŠ‡â—‡ ğ›ˆ }
           ; assocâˆ˜ = \ { (eâ‚ , (Î·â‚ , ğ›ˆâ‚)) (eâ‚‚ , (Î·â‚‚ , ğ›ˆâ‚‚)) (eâ‚ƒ , (Î·â‚ƒ , ğ›ˆâ‚ƒ)) â†’
                        ((\ ğ›ˆâ€² â†’ (eâ‚ âˆ˜ eâ‚‚) âˆ˜ eâ‚ƒ , (((Î·â‚ âˆ˜âŠ‡ Î·â‚‚) âˆ˜âŠ‡ Î·â‚ƒ) , ğ›ˆâ€²))) & assocâˆ˜âŠ‡â—‡ ğ›ˆâ‚ ğ›ˆâ‚‚ ğ›ˆâ‚ƒ }
           }


--------------------------------------------------------------------------------


{-# REWRITE id-renâˆ‹ #-}
id-renâˆ‹â—‡ : âˆ€ {X P A n i} â†’ {Î : Vec X n} {ğ’¾ : Î âˆ‹âŸ¨ i âŸ© A} {a : P A} {Î¾ : All P Î}
                         â†’ (ğ“² : Î¾ âˆ‹â—‡âŸ¨ ğ’¾ âŸ© a)
                         â†’ renâˆ‹â—‡ idâŠ‡â—‡ ğ“² â‰¡ ğ“²
id-renâˆ‹â—‡ zero    = refl
id-renâˆ‹â—‡ (suc ğ“²) = suc & id-renâˆ‹â—‡ ğ“²


{-# REWRITE comp-renâˆ‹ #-}
comp-renâˆ‹â—‡ : âˆ€ {X P A n nâ€² nâ€³ eâ‚ eâ‚‚ i} â†’ {Î : Vec X n} {Îâ€² : Vec X nâ€²} {Îâ€³ : Vec X nâ€³}
                                          {Î·â‚ : Îâ€² âŠ‡âŸ¨ eâ‚ âŸ© Î} {Î·â‚‚ : Îâ€³ âŠ‡âŸ¨ eâ‚‚ âŸ© Îâ€²} {ğ’¾ : Î âˆ‹âŸ¨ i âŸ© A}
                                          {a : P A} {Î¾ : All P Î} {Î¾â€² : All P Îâ€²} {Î¾â€³ : All P Îâ€³}
                                       â†’ (ğ›ˆâ‚ : Î¾â€² âŠ‡â—‡âŸ¨ Î·â‚ âŸ© Î¾) (ğ›ˆâ‚‚ : Î¾â€³ âŠ‡â—‡âŸ¨ Î·â‚‚ âŸ© Î¾â€²) (ğ“² : Î¾ âˆ‹â—‡âŸ¨ ğ’¾ âŸ© a)
                                       â†’ renâˆ‹â—‡ (ğ›ˆâ‚ âˆ˜âŠ‡â—‡ ğ›ˆâ‚‚) ğ“² â‰¡ (renâˆ‹â—‡ ğ›ˆâ‚‚ âˆ˜ renâˆ‹â—‡ ğ›ˆâ‚) ğ“²
comp-renâˆ‹â—‡ ğ›ˆâ‚        done      ğ“²       = refl
comp-renâˆ‹â—‡ ğ›ˆâ‚        (drop ğ›ˆâ‚‚) ğ“²       = suc & comp-renâˆ‹â—‡ ğ›ˆâ‚ ğ›ˆâ‚‚ ğ“²
comp-renâˆ‹â—‡ (drop ğ›ˆâ‚) (keep ğ›ˆâ‚‚) ğ“²       = suc & comp-renâˆ‹â—‡ ğ›ˆâ‚ ğ›ˆâ‚‚ ğ“²
comp-renâˆ‹â—‡ (keep ğ›ˆâ‚) (keep ğ›ˆâ‚‚) zero    = refl
comp-renâˆ‹â—‡ (keep ğ›ˆâ‚) (keep ğ›ˆâ‚‚) (suc ğ“²) = suc & comp-renâˆ‹â—‡ ğ›ˆâ‚ ğ›ˆâ‚‚ ğ“²


ğ«ğğ§âˆ‹â—‡ : âˆ€ {X P A} â†’ {a : P A}
                  â†’ Presheaf (ğğğ„â€² {X} {P})
                              (\ { (n , (Î , Î¾)) â†’
                                Î£ (Fin n) (\ i â†’
                                  Î£ (Î âˆ‹âŸ¨ i âŸ© A) (\ ğ’¾ â†’ Î¾ âˆ‹â—‡âŸ¨ ğ’¾ âŸ© a)) })
ğ«ğğ§âˆ‹â—‡ = record
           { â„±     = \ { (e , (Î· , ğ›ˆ)) (i , (ğ’¾ , ğ“²)) â†’ RENâˆ‹ e i , (renâˆ‹ Î· ğ’¾ , renâˆ‹â—‡ ğ›ˆ ğ“²) }
           ; idâ„±   = funext! (\ { (i , (ğ’¾ , ğ“²)) â†’
                       (\ ğ“²â€² â†’ RENâˆ‹ id i , (renâˆ‹ idâŠ‡ ğ’¾ , ğ“²â€²)) & id-renâˆ‹â—‡ ğ“² })
           ; compâ„± = \ { (eâ‚ , (Î·â‚ , ğ›ˆâ‚)) (eâ‚‚ , (Î·â‚‚ , ğ›ˆâ‚‚)) â†’
                       funext! (\ { (i , (ğ’¾ , ğ“²)) â†’
                         (\ ğ“²â€² â†’ RENâˆ‹ (eâ‚ âˆ˜ eâ‚‚) i , (renâˆ‹ (Î·â‚ âˆ˜âŠ‡ Î·â‚‚) ğ’¾ , ğ“²â€²)) & comp-renâˆ‹â—‡ ğ›ˆâ‚ ğ›ˆâ‚‚ ğ“² }) }
           }


--------------------------------------------------------------------------------
