{-# OPTIONS --rewriting #-}

module AllVecLemmas where

open import Prelude
open import Category
open import Fin
open import Vec
open import VecLemmas
open import AllVec
open GetAllVec


--------------------------------------------------------------------------------
{-
                      get (gets Î¾ Î·) ğ’¾ â‰¡ (get Î¾ âˆ˜ renâˆ‹ Î·) ğ’¾                     comp-ren-getâˆ‹

                            idâŠ‡âº âˆ˜âŠ‡âº ğ›ˆ â‰¡ ğ›ˆ                                      lidâˆ˜âŠ‡âº
                            ğ›ˆ âˆ˜âŠ‡âº idâŠ‡âº â‰¡ ğ›ˆ                                      ridâˆ˜âŠ‡âº
                    (ğ›ˆâ‚ âˆ˜âŠ‡âº ğ›ˆâ‚‚) âˆ˜âŠ‡âº ğ›ˆâ‚ƒ â‰¡ ğ›ˆâ‚ âˆ˜âŠ‡âº (ğ›ˆâ‚‚ âˆ˜âŠ‡âº ğ›ˆâ‚ƒ)                     assocâˆ˜âŠ‡âº

                          renâˆ‹âº idâŠ‡âº ğ“² â‰¡ ğ“²                                      id-renâˆ‹âº
                   renâˆ‹âº (ğ›ˆâ‚ âˆ˜âŠ‡âº ğ›ˆâ‚‚) ğ“² â‰¡ (renâˆ‹âº ğ›ˆâ‚‚ âˆ˜ renâˆ‹âº ğ›ˆâ‚) ğ“²                comp-renâˆ‹âº
-}
--------------------------------------------------------------------------------


comp-get-renâˆ‹ : âˆ€ {X P A n nâ€²} â†’ {Î : Vec X n} {Îâ€² : Vec X nâ€²} {e : nâ€² â‰¥ n} {i : Fin n}
                               â†’ (Î¾ : All P Îâ€²) (Î· : Îâ€² âŠ‡âŸ¨ e âŸ© Î) (ğ’¾ : Î âˆ‹âŸ¨ i âŸ© A)
                               â†’ get (gets Î¾ Î·) ğ’¾ â‰¡ (get Î¾ âˆ˜ renâˆ‹ Î·) ğ’¾
comp-get-renâˆ‹ âˆ™       done     ()
comp-get-renâˆ‹ (Î¾ , b) (drop Î·) ğ’¾       = comp-get-renâˆ‹ Î¾ Î· ğ’¾
comp-get-renâˆ‹ (Î¾ , a) (keep Î·) zero    = refl
comp-get-renâˆ‹ (Î¾ , b) (keep Î·) (suc ğ’¾) = comp-get-renâˆ‹ Î¾ Î· ğ’¾


--------------------------------------------------------------------------------


{-# REWRITE lidâˆ˜âŠ‡ #-}
lidâˆ˜âŠ‡â€² : âˆ€ {X P n nâ€² e} â†’ {Î : Vec X n} {Îâ€² : Vec X nâ€²} {Î· : Îâ€² âŠ‡âŸ¨ e âŸ© Î}
                           {Î¾ : All P Î} {Î¾â€² : All P Îâ€²}
                        â†’ (ğ›ˆ : Î¾â€² âŠ‡â€²âŸ¨ Î· âŸ© Î¾)
                        â†’ idâŠ‡â€² âˆ˜âŠ‡â€² ğ›ˆ â‰¡ ğ›ˆ
lidâˆ˜âŠ‡â€² done     = refl
lidâˆ˜âŠ‡â€² (drop ğ›ˆ) = drop & lidâˆ˜âŠ‡â€² ğ›ˆ
lidâˆ˜âŠ‡â€² (keep ğ›ˆ) = keep & lidâˆ˜âŠ‡â€² ğ›ˆ


{-# REWRITE ridâˆ˜âŠ‡ #-}
ridâˆ˜âŠ‡â€² : âˆ€ {X P n nâ€² e} â†’ {Î : Vec X n} {Îâ€² : Vec X nâ€²} {Î· : Îâ€² âŠ‡âŸ¨ e âŸ© Î}
                           {Î¾ : All P Î} {Î¾â€² : All P Îâ€²}
                        â†’ (ğ›ˆ : Î¾â€² âŠ‡â€²âŸ¨ Î· âŸ© Î¾)
                        â†’ ğ›ˆ âˆ˜âŠ‡â€² idâŠ‡â€² â‰¡ ğ›ˆ
ridâˆ˜âŠ‡â€² done     = refl
ridâˆ˜âŠ‡â€² (drop ğ›ˆ) = drop & ridâˆ˜âŠ‡â€² ğ›ˆ
ridâˆ˜âŠ‡â€² (keep ğ›ˆ) = keep & ridâˆ˜âŠ‡â€² ğ›ˆ


{-# REWRITE assocâˆ˜âŠ‡ #-}
assocâˆ˜âŠ‡â€² : âˆ€ {X P n nâ€² nâ€³ nâ€´ eâ‚ eâ‚‚ eâ‚ƒ} â†’ {Î : Vec X n} {Îâ€² : Vec X nâ€²} {Îâ€³ : Vec X nâ€³} {Îâ€´ : Vec X nâ€´}
                                          {Î·â‚ : Îâ€² âŠ‡âŸ¨ eâ‚ âŸ© Î} {Î·â‚‚ : Îâ€³ âŠ‡âŸ¨ eâ‚‚ âŸ© Îâ€²} {Î·â‚ƒ : Îâ€´ âŠ‡âŸ¨ eâ‚ƒ âŸ© Îâ€³}
                                          {Î¾ : All P Î} {Î¾â€² : All P Îâ€²} {Î¾â€³ : All P Îâ€³} {Î¾â€´ : All P Îâ€´}
                                       â†’ (ğ›ˆâ‚ : Î¾â€² âŠ‡â€²âŸ¨ Î·â‚ âŸ© Î¾) (ğ›ˆâ‚‚ : Î¾â€³ âŠ‡â€²âŸ¨ Î·â‚‚ âŸ© Î¾â€²) (ğ›ˆâ‚ƒ : Î¾â€´ âŠ‡â€²âŸ¨ Î·â‚ƒ âŸ© Î¾â€³)
                                       â†’ (ğ›ˆâ‚ âˆ˜âŠ‡â€² ğ›ˆâ‚‚) âˆ˜âŠ‡â€² ğ›ˆâ‚ƒ â‰¡ ğ›ˆâ‚ âˆ˜âŠ‡â€² (ğ›ˆâ‚‚ âˆ˜âŠ‡â€² ğ›ˆâ‚ƒ)
assocâˆ˜âŠ‡â€² ğ›ˆâ‚        ğ›ˆâ‚‚        done      = refl
assocâˆ˜âŠ‡â€² ğ›ˆâ‚        ğ›ˆâ‚‚        (drop ğ›ˆâ‚ƒ) = drop & assocâˆ˜âŠ‡â€² ğ›ˆâ‚ ğ›ˆâ‚‚ ğ›ˆâ‚ƒ
assocâˆ˜âŠ‡â€² ğ›ˆâ‚        (drop ğ›ˆâ‚‚) (keep ğ›ˆâ‚ƒ) = drop & assocâˆ˜âŠ‡â€² ğ›ˆâ‚ ğ›ˆâ‚‚ ğ›ˆâ‚ƒ
assocâˆ˜âŠ‡â€² (drop ğ›ˆâ‚) (keep ğ›ˆâ‚‚) (keep ğ›ˆâ‚ƒ) = drop & assocâˆ˜âŠ‡â€² ğ›ˆâ‚ ğ›ˆâ‚‚ ğ›ˆâ‚ƒ
assocâˆ˜âŠ‡â€² (keep ğ›ˆâ‚) (keep ğ›ˆâ‚‚) (keep ğ›ˆâ‚ƒ) = keep & assocâˆ˜âŠ‡â€² ğ›ˆâ‚ ğ›ˆâ‚‚ ğ›ˆâ‚ƒ


instance
  OPEâ€² : âˆ€ {X P} â†’ Category (Î£ Nat (\ n â†’ Î£ (Vec X n) (All P)))
                             (\ { (nâ€² , (Îâ€² , Î¾â€²)) (n , (Î , Î¾)) â†’
                               Î£ (nâ€² â‰¥ n) (\ e â†’
                                 Î£ (Îâ€² âŠ‡âŸ¨ e âŸ© Î) (\ Î· â†’ Î¾â€² âŠ‡â€²âŸ¨ Î· âŸ© Î¾)) })
  OPEâ€² = record
           { id     = idâ‰¥ , (idâŠ‡ , idâŠ‡â€²)
           ; _âˆ˜_    = \ { (eâ‚ , (Î·â‚ , ğ›ˆâ‚)) (eâ‚‚ , (Î·â‚‚ , ğ›ˆâ‚‚)) â†’ eâ‚ âˆ˜â‰¥ eâ‚‚ , (Î·â‚ âˆ˜âŠ‡ Î·â‚‚ , ğ›ˆâ‚ âˆ˜âŠ‡â€² ğ›ˆâ‚‚) }
           ; lidâˆ˜   = \ { (e , (Î· , ğ›ˆ)) â†’ (\ ğ›ˆâ€² â†’ e , (Î· , ğ›ˆâ€²)) & lidâˆ˜âŠ‡â€² ğ›ˆ }
           ; ridâˆ˜   = \ { (e , (Î· , ğ›ˆ)) â†’ (\ ğ›ˆâ€² â†’ e , (Î· , ğ›ˆâ€²)) & ridâˆ˜âŠ‡â€² ğ›ˆ }
           ; assocâˆ˜ = \ { (eâ‚ , (Î·â‚ , ğ›ˆâ‚)) (eâ‚‚ , (Î·â‚‚ , ğ›ˆâ‚‚)) (eâ‚ƒ , (Î·â‚ƒ , ğ›ˆâ‚ƒ)) â†’
                        ((\ ğ›ˆâ€² â†’ (eâ‚ âˆ˜â‰¥ eâ‚‚) âˆ˜â‰¥ eâ‚ƒ , (((Î·â‚ âˆ˜âŠ‡ Î·â‚‚) âˆ˜âŠ‡ Î·â‚ƒ) , ğ›ˆâ€²))) & assocâˆ˜âŠ‡â€² ğ›ˆâ‚ ğ›ˆâ‚‚ ğ›ˆâ‚ƒ }
           }


--------------------------------------------------------------------------------


{-# REWRITE id-renâˆ‹ #-}
id-renâˆ‹â€² : âˆ€ {X P A n i} â†’ {Î : Vec X n} {ğ’¾ : Î âˆ‹âŸ¨ i âŸ© A} {a : P A} {Î¾ : All P Î}
                         â†’ (ğ“² : Î¾ âˆ‹â€²âŸ¨ ğ’¾ âŸ© a)
                         â†’ renâˆ‹â€² idâŠ‡â€² ğ“² â‰¡ ğ“²
id-renâˆ‹â€² zero    = refl
id-renâˆ‹â€² (suc ğ“²) = suc & id-renâˆ‹â€² ğ“²


{-# REWRITE comp-renâˆ‹ #-}
comp-renâˆ‹â€² : âˆ€ {X P A n nâ€² nâ€³ eâ‚ eâ‚‚ i} â†’ {Î : Vec X n} {Îâ€² : Vec X nâ€²} {Îâ€³ : Vec X nâ€³}
                                          {Î·â‚ : Îâ€² âŠ‡âŸ¨ eâ‚ âŸ© Î} {Î·â‚‚ : Îâ€³ âŠ‡âŸ¨ eâ‚‚ âŸ© Îâ€²} {ğ’¾ : Î âˆ‹âŸ¨ i âŸ© A}
                                          {a : P A} {Î¾ : All P Î} {Î¾â€² : All P Îâ€²} {Î¾â€³ : All P Îâ€³}
                                       â†’ (ğ›ˆâ‚ : Î¾â€² âŠ‡â€²âŸ¨ Î·â‚ âŸ© Î¾) (ğ›ˆâ‚‚ : Î¾â€³ âŠ‡â€²âŸ¨ Î·â‚‚ âŸ© Î¾â€²) (ğ“² : Î¾ âˆ‹â€²âŸ¨ ğ’¾ âŸ© a)
                                       â†’ renâˆ‹â€² (ğ›ˆâ‚ âˆ˜âŠ‡â€² ğ›ˆâ‚‚) ğ“² â‰¡ (renâˆ‹â€² ğ›ˆâ‚‚ âˆ˜ renâˆ‹â€² ğ›ˆâ‚) ğ“²
comp-renâˆ‹â€² ğ›ˆâ‚        done      ğ“²       = refl
comp-renâˆ‹â€² ğ›ˆâ‚        (drop ğ›ˆâ‚‚) ğ“²       = suc & comp-renâˆ‹â€² ğ›ˆâ‚ ğ›ˆâ‚‚ ğ“²
comp-renâˆ‹â€² (drop ğ›ˆâ‚) (keep ğ›ˆâ‚‚) ğ“²       = suc & comp-renâˆ‹â€² ğ›ˆâ‚ ğ›ˆâ‚‚ ğ“²
comp-renâˆ‹â€² (keep ğ›ˆâ‚) (keep ğ›ˆâ‚‚) zero    = refl
comp-renâˆ‹â€² (keep ğ›ˆâ‚) (keep ğ›ˆâ‚‚) (suc ğ“²) = suc & comp-renâˆ‹â€² ğ›ˆâ‚ ğ›ˆâ‚‚ ğ“²


Renâˆ‹â€² : âˆ€ {X P A} â†’ {a : P A}
                  â†’ Presheaf {{OPEâ€² {X} {P}}}
                              (\ { (n , (Î , Î¾)) â†’
                                Î£ (Fin n) (\ i â†’
                                  Î£ (Î âˆ‹âŸ¨ i âŸ© A) (\ ğ’¾ â†’ Î¾ âˆ‹â€²âŸ¨ ğ’¾ âŸ© a)) })
                              (\ { (e , (Î· , ğ›ˆ)) (i , (ğ’¾ , ğ“²)) â†’ renF e i , (renâˆ‹ Î· ğ’¾ , renâˆ‹â€² ğ›ˆ ğ“²) })
Renâˆ‹â€² = record
           { idâ„±   = funext! (\ { (i , (ğ’¾ , ğ“²)) â†’
                       (\ ğ“²â€² â†’ renF idâ‰¥ i , (renâˆ‹ idâŠ‡ ğ’¾ , ğ“²â€²)) & id-renâˆ‹â€² ğ“² })
           ; compâ„± = \ { (eâ‚ , (Î·â‚ , ğ›ˆâ‚)) (eâ‚‚ , (Î·â‚‚ , ğ›ˆâ‚‚)) â†’
                       funext! (\ { (i , (ğ’¾ , ğ“²)) â†’
                         (\ ğ“²â€² â†’ renF (eâ‚ âˆ˜â‰¥ eâ‚‚) i , (renâˆ‹ (Î·â‚ âˆ˜âŠ‡ Î·â‚‚) ğ’¾ , ğ“²â€²)) & comp-renâˆ‹â€² ğ›ˆâ‚ ğ›ˆâ‚‚ ğ“² }) }
           }


--------------------------------------------------------------------------------
