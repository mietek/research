{-# OPTIONS --rewriting #-}

module IMCMLSyntaxNoTerms where

open import IMCML public
open IMCMLList public


-- Contexts.

Cx : Set
Cx = BoxTyâ‹† âˆ§ Tyâ‹†


-- Derivations.

mutual
  infix 3 _âŠ¢_
  data _âŠ¢_ : Cx â†’ Ty â†’ Set where
    var   : âˆ€ {Î” Î“ A} â†’
              Î“ âˆ‹ A â†’
              Î” â Î“ âŠ¢ A
    mvar  : âˆ€ {Î” Î“ Î¦ A} â†’
              Î” â âˆ… âŠ¢â§† Î¦ â†’ Î” âˆ‹ [ Î¦ ] A â†’
              Î” â Î“ âŠ¢ A
    lam   : âˆ€ {Î” Î“ A B} â†’
              Î” â Î“ , A âŠ¢ B â†’
              Î” â Î“ âŠ¢ A â‡’ B
    app   : âˆ€ {Î” Î“ A B} â†’
              Î” â Î“ âŠ¢ A â‡’ B â†’ Î” â Î“ âŠ¢ A â†’
              Î” â Î“ âŠ¢ B
    box   : âˆ€ {Î” Î“ Î¦ A} â†’
              Î¦ â âˆ… âŠ¢ A â†’
              Î” â Î“ âŠ¢ [ Î¦ ] A
    unbox : âˆ€ {Î” Î“ Î¦ A C} â†’
              Î” â Î“ âŠ¢ [ Î¦ ] A â†’ Î” , [ Î¦ ] A â Î“ âŠ¢ C â†’
              Î” â Î“ âŠ¢ C

  infix 3 _âŠ¢â§†_
  data _âŠ¢â§†_ : Cx â†’ BoxTyâ‹† â†’ Set where
    âˆ…   : âˆ€ {Î” Î“} â†’
            Î” â Î“ âŠ¢â§† âˆ…
    _,_ : âˆ€ {Î” Î“ Î¦ Î A} â†’
            Î” â Î“ âŠ¢â§† Î â†’ Î” â Î“ âŠ¢ [ Î¦ ] A â†’
            Î” â Î“ âŠ¢â§† Î , [ Î¦ ] A

infix 3 _âŠ¢â‹†_
_âŠ¢â‹†_ : Cx â†’ Tyâ‹† â†’ Set
Î” â Î“ âŠ¢â‹† Î = All (Î” â Î“ âŠ¢_) Î

mutual
  monoâŠ¢ : âˆ€ {Î” Î“ Î”â€² Î“â€² A} â†’ Î”â€² âŠ‡ Î” â†’ Î“â€² âŠ‡ Î“ â†’ Î” â Î“ âŠ¢ A â†’ Î”â€² â Î“â€² âŠ¢ A
  monoâŠ¢ Î¶ Î· (var ğ’¾)     = var (monoâˆ‹ Î· ğ’¾)
  monoâŠ¢ Î¶ Î· (mvar Ï† ğ’¾)  = mvar (monoâŠ¢â§† Î¶ done Ï†) (monoâˆ‹ Î¶ ğ’¾)
  monoâŠ¢ Î¶ Î· (lam ğ’Ÿ)     = lam (monoâŠ¢ Î¶ (lift Î·) ğ’Ÿ)
  monoâŠ¢ Î¶ Î· (app ğ’Ÿ â„°)   = app (monoâŠ¢ Î¶ Î· ğ’Ÿ) (monoâŠ¢ Î¶ Î· â„°)
  monoâŠ¢ Î¶ Î· (box ğ’Ÿ)     = box ğ’Ÿ
  monoâŠ¢ Î¶ Î· (unbox ğ’Ÿ â„°) = unbox (monoâŠ¢ Î¶ Î· ğ’Ÿ) (monoâŠ¢ (lift Î¶) Î· â„°)

  monoâŠ¢â§† : âˆ€ {Î” Î“ Î”â€² Î“â€² Î} â†’ Î”â€² âŠ‡ Î” â†’ Î“â€² âŠ‡ Î“ â†’ Î” â Î“ âŠ¢â§† Î â†’ Î”â€² â Î“â€² âŠ¢â§† Î
  monoâŠ¢â§† Î¶ Î· âˆ…       = âˆ…
  monoâŠ¢â§† Î¶ Î· (Î¾ , ğ’Ÿ) = monoâŠ¢â§† Î¶ Î· Î¾ , monoâŠ¢ Î¶ Î· ğ’Ÿ

monoâŠ¢â‹† : âˆ€ {Î” Î“ Î”â€² Î“â€² Î} â†’ Î”â€² âŠ‡ Î” â†’ Î“â€² âŠ‡ Î“ â†’ Î” â Î“ âŠ¢â‹† Î â†’ Î”â€² â Î“â€² âŠ¢â‹† Î
monoâŠ¢â‹† Î¶ Î· âˆ…       = âˆ…
monoâŠ¢â‹† Î¶ Î· (Î¾ , ğ’Ÿ) = monoâŠ¢â‹† Î¶ Î· Î¾ , monoâŠ¢ Î¶ Î· ğ’Ÿ
-- NOTE: Equivalent, but does not pass termination check.
-- monoâŠ¢â‹† Î¶ Î· Î¾ = mapAll (monoâŠ¢ Î¶ Î·) Î¾

mutual
  idmonoâŠ¢ : âˆ€ {Î” Î“ A} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢ A) â†’ monoâŠ¢ reflâŠ‡ reflâŠ‡ ğ’Ÿ â‰¡ ğ’Ÿ
  idmonoâŠ¢ (var ğ’¾)     = cong var (idmonoâˆ‹ ğ’¾)
  idmonoâŠ¢ (mvar Ï† ğ’¾)  = congÂ² mvar (idmonoâŠ¢â§† Ï†) (idmonoâˆ‹ ğ’¾)
  idmonoâŠ¢ (lam ğ’Ÿ)     = cong lam (idmonoâŠ¢ ğ’Ÿ)
  idmonoâŠ¢ (app ğ’Ÿ â„°)   = congÂ² app (idmonoâŠ¢ ğ’Ÿ) (idmonoâŠ¢ â„°)
  idmonoâŠ¢ (box ğ’Ÿ)     = refl
  idmonoâŠ¢ (unbox ğ’Ÿ â„°) = congÂ² unbox (idmonoâŠ¢ ğ’Ÿ) (idmonoâŠ¢ â„°)

  idmonoâŠ¢â§† : âˆ€ {Î” Î“ Î} â†’ (Î¾ : Î” â Î“ âŠ¢â§† Î) â†’ monoâŠ¢â§† reflâŠ‡ reflâŠ‡ Î¾ â‰¡ Î¾
  idmonoâŠ¢â§† âˆ…       = refl
  idmonoâŠ¢â§† (Î¾ , ğ’Ÿ) = congÂ² _,_ (idmonoâŠ¢â§† Î¾) (idmonoâŠ¢ ğ’Ÿ)

-- NOTE: Needs {-# REWRITE idtransâŠ‡â‚ #-}.
mutual
  assocmonoâŠ¢ : âˆ€ {Î” Î“ Î”â€² Î“â€² Î“â€³ Î”â€³ A} â†’
                  (Î¶â€² : Î”â€³ âŠ‡ Î”â€²) (Î·â€² : Î“â€³ âŠ‡ Î“â€²) (Î¶ : Î”â€² âŠ‡ Î”) (Î· : Î“â€² âŠ‡ Î“) (ğ’Ÿ : Î” â Î“ âŠ¢ A) â†’
                  monoâŠ¢ Î¶â€² Î·â€² (monoâŠ¢ Î¶ Î· ğ’Ÿ) â‰¡ monoâŠ¢ (transâŠ‡ Î¶â€² Î¶) (transâŠ‡ Î·â€² Î·) ğ’Ÿ
  assocmonoâŠ¢ Î¶â€² Î·â€² Î¶ Î· (var ğ’¾)     = cong var (assocmonoâˆ‹ Î·â€² Î· ğ’¾)
  assocmonoâŠ¢ Î¶â€² Î·â€² Î¶ Î· (mvar Ï† ğ’¾)  = congÂ² mvar (assocmonoâŠ¢â§† Î¶â€² done Î¶ done Ï†) (assocmonoâˆ‹ Î¶â€² Î¶ ğ’¾)
  assocmonoâŠ¢ Î¶â€² Î·â€² Î¶ Î· (lam ğ’Ÿ)     = cong lam (assocmonoâŠ¢ Î¶â€² (lift Î·â€²) Î¶ (lift Î·) ğ’Ÿ)
  assocmonoâŠ¢ Î¶â€² Î·â€² Î¶ Î· (app ğ’Ÿ â„°)   = congÂ² app (assocmonoâŠ¢ Î¶â€² Î·â€² Î¶ Î· ğ’Ÿ) (assocmonoâŠ¢ Î¶â€² Î·â€² Î¶ Î· â„°)
  assocmonoâŠ¢ Î¶â€² Î·â€² Î¶ Î· (box ğ’Ÿ)     = refl
  assocmonoâŠ¢ Î¶â€² Î·â€² Î¶ Î· (unbox ğ’Ÿ â„°) = congÂ² unbox (assocmonoâŠ¢ Î¶â€² Î·â€² Î¶ Î· ğ’Ÿ) (assocmonoâŠ¢ (lift Î¶â€²) Î·â€² (lift Î¶) Î· â„°)

  assocmonoâŠ¢â§† : âˆ€ {Î” Î“ Î”â€² Î“â€² Î“â€³ Î”â€³ Î} â†’
                   (Î¶â€² : Î”â€³ âŠ‡ Î”â€²) (Î·â€² : Î“â€³ âŠ‡ Î“â€²) (Î¶ : Î”â€² âŠ‡ Î”) (Î· : Î“â€² âŠ‡ Î“) (Î¾ : Î” â Î“ âŠ¢â§† Î) â†’
                   monoâŠ¢â§† Î¶â€² Î·â€² (monoâŠ¢â§† Î¶ Î· Î¾) â‰¡ monoâŠ¢â§† (transâŠ‡ Î¶â€² Î¶) (transâŠ‡ Î·â€² Î·) Î¾
  assocmonoâŠ¢â§† Î¶â€² Î·â€² Î¶ Î· âˆ…       = refl
  assocmonoâŠ¢â§† Î¶â€² Î·â€² Î¶ Î· (Î¾ , ğ’Ÿ) = congÂ² _,_ (assocmonoâŠ¢â§† Î¶â€² Î·â€² Î¶ Î· Î¾) (assocmonoâŠ¢ Î¶â€² Î·â€² Î¶ Î· ğ’Ÿ)

reflâŠ¢â‹† : âˆ€ {Î” Î“} â†’ Î” â Î“ âŠ¢â‹† Î“
reflâŠ¢â‹† {Î“ = âˆ…}     = âˆ…
reflâŠ¢â‹† {Î“ = Î“ , A} = monoâŠ¢â‹† reflâŠ‡ (weak reflâŠ‡) reflâŠ¢â‹† , var zero

-- TODO: Should Telescopic Î” always be required?
Telescopic : BoxTyâ‹† â†’ Set
Telescopic âˆ…             = âŠ¤
Telescopic (Î” , [ Î¦ ] A) = Telescopic Î” âˆ§ Î” â âˆ… âŠ¢â§† Î¦

-- -- TODO: How did this go wrong?
-- postulate
--   oops : âˆ€ {Î” Î“ Î¦ A} â†’ Î” , [ Î¦ ] A â Î“ âŠ¢ [ Î” , [ Î¦ ] A ] A â†’
--                         Î” , [ Î¦ ] A â Î“ âŠ¢ [ Î¦ ] A
--
-- -- TODO: What is going on here?
-- -- Goal: Î” , [ Î¦ ] A â Î“ âŠ¢ [ Î¦ ] A
-- -- Have: Î” , [ Î¦ ] A â Î“ âŠ¢ [ Î” , [ Î¦ ] A ] A
-- mreflâŠ¢â§† : âˆ€ {Î” Î“} â†’ Telescopic Î” â†’ Î” â Î“ âŠ¢â§† Î”
-- mreflâŠ¢â§† {âˆ…}           {Î“} âˆ…       = âˆ…
-- mreflâŠ¢â§† {Î” , [ Î¦ ] A} {Î“} (Ï„ , Ï†) =
--   monoâŠ¢â§† (weak reflâŠ‡) reflâŠ‡ (mreflâŠ¢â§† Ï„) ,
--   oops
--     (box {Î” , [ Î¦ ] A} {Î“}
--       (mvar {Î” , [ Î¦ ] A} (monoâŠ¢â§† (weak reflâŠ‡) done Ï†) zero))

lookupâŠ¢ : âˆ€ {Î” Î“ Î A} â†’ Î” â Î“ âŠ¢â‹† Î â†’ Î âˆ‹ A â†’ Î” â Î“ âŠ¢ A
lookupâŠ¢ Î¾ ğ’¾ = lookupAll Î¾ ğ’¾

mlookupâŠ¢ : âˆ€ {Î” Î“ Î Î¨ A} â†’ Î” â Î“ âŠ¢â§† Î â†’ Î âˆ‹ [ Î¨ ] A â†’ Î” â Î“ âŠ¢ [ Î¨ ] A
mlookupâŠ¢ (Î¾ , ğ’Ÿ) zero    = ğ’Ÿ
mlookupâŠ¢ (Î¾ , â„°) (suc ğ’¾) = mlookupâŠ¢ Î¾ ğ’¾

graftâŠ¢ : âˆ€ {Î” Î“ Î¨ A} â†’ Î” â Î“ âŠ¢â‹† Î¨ â†’ Î” â Î¨ âŠ¢ A â†’ Î” â Î“ âŠ¢ A
graftâŠ¢ Ïˆ (var ğ’¾)     = lookupâŠ¢ Ïˆ ğ’¾
graftâŠ¢ Ïˆ (mvar Ï† ğ’¾)  = mvar Ï† ğ’¾
graftâŠ¢ Ïˆ (lam ğ’Ÿ)     = lam (graftâŠ¢ (monoâŠ¢â‹† reflâŠ‡ (weak reflâŠ‡) Ïˆ , var zero) ğ’Ÿ)
graftâŠ¢ Ïˆ (app ğ’Ÿ â„°)   = app (graftâŠ¢ Ïˆ ğ’Ÿ) (graftâŠ¢ Ïˆ â„°)
graftâŠ¢ Ïˆ (box ğ’Ÿ)     = box (graftâŠ¢ âˆ… ğ’Ÿ)
graftâŠ¢ Ïˆ (unbox ğ’Ÿ â„°) = unbox (graftâŠ¢ Ïˆ ğ’Ÿ) (graftâŠ¢ (monoâŠ¢â‹† (weak reflâŠ‡) reflâŠ‡ Ïˆ) â„°)

graftâŠ¢â‹† : âˆ€ {Î” Î“ Î¨ Î} â†’ Î” â Î“ âŠ¢â‹† Î¨ â†’ Î” â Î¨ âŠ¢â‹† Î â†’ Î” â Î“ âŠ¢â‹† Î
graftâŠ¢â‹† Ïˆ âˆ…       = âˆ…
graftâŠ¢â‹† Ïˆ (Î¾ , ğ’Ÿ) = graftâŠ¢â‹† Ïˆ Î¾ , graftâŠ¢ Ïˆ ğ’Ÿ

transâŠ¢â‹† : âˆ€ {Î” Î“ Î“â€² Î“â€³} â†’ Î” â Î“â€³ âŠ¢â‹† Î“â€² â†’ Î” â Î“â€² âŠ¢â‹† Î“ â†’ Î” â Î“â€³ âŠ¢â‹† Î“
transâŠ¢â‹† = graftâŠ¢â‹†

-- -- TODO: What is going on here?
-- -- Goal:    Î” , [ Î¦ ] A â âˆ… âŠ¢ [ Î¦ ] A
-- -- Have:    Î” , [ Î¦ ] A â âˆ… âŠ¢ [ Î” , [ Î¦ ] A ] A
-- -- Subgoal: Î” , [ Î¦ ] A â âˆ… âŠ¢â§† Î¦
-- mutual
--   mgraftâŠ¢ : âˆ€ {Î” Î“ Î¦ A} â†’ Î” â âˆ… âŠ¢â§† Î¦ â†’ Î¦ â Î“ âŠ¢ A â†’ Î” â Î“ âŠ¢ A
--   mgraftâŠ¢ Ï† (var ğ’¾)     = var ğ’¾
--   mgraftâŠ¢ Ï† (mvar Ï†â€² ğ’¾) = unbox (monoâŠ¢ reflâŠ‡ infâŠ‡ (mlookupâŠ¢ Ï† ğ’¾))
--                                  (mvar (mgraftâŠ¢â§† (monoâŠ¢â§† (weak reflâŠ‡) reflâŠ‡ Ï†) Ï†â€²) zero)
--   mgraftâŠ¢ Ï† (lam ğ’Ÿ)     = lam (mgraftâŠ¢ Ï† ğ’Ÿ)
--   mgraftâŠ¢ Ï† (app ğ’Ÿ â„°)   = app (mgraftâŠ¢ Ï† ğ’Ÿ) (mgraftâŠ¢ Ï† â„°)
--   mgraftâŠ¢ Ï† (box ğ’Ÿ)     = box ğ’Ÿ
--   mgraftâŠ¢ {Î”} {Î“} {Î} Ï† (unbox {Î¦ = Î¦} {A} ğ’Ÿ â„°) =
--     unbox (mgraftâŠ¢ Ï† ğ’Ÿ)
--           (mgraftâŠ¢ (monoâŠ¢â§† (weak reflâŠ‡) reflâŠ‡ Ï† ,
--                      oops
--                        (box {Î” , [ Î¦ ] A} {âˆ…}
--                          (mvar {Î” , [ Î¦ ] A} {!!} zero)) â„°)
--
--   mgraftâŠ¢â§† : âˆ€ {Î” Î“ Î¦ Î} â†’ Î” â âˆ… âŠ¢â§† Î¦ â†’ Î¦ â Î“ âŠ¢â§† Î â†’ Î” â Î“ âŠ¢â§† Î
--   mgraftâŠ¢â§† Ï† âˆ…       = âˆ…
--   mgraftâŠ¢â§† Ï† (Î¾ , ğ’Ÿ) = mgraftâŠ¢â§† Ï† Î¾ , mgraftâŠ¢ Ï† ğ’Ÿ
--
-- mtransâŠ¢â§† : âˆ€ {Î” Î”â€² Î”â€³} â†’ Î”â€³ â âˆ… âŠ¢â§† Î”â€² â†’ Î”â€² â âˆ… âŠ¢â§† Î” â†’ Î”â€³ â âˆ… âŠ¢â§† Î”
-- mtransâŠ¢â§† = mgraftâŠ¢â§†


-- Normal forms.

mutual
  infix 3 _âŠ¢â¿á¶ _
  data _âŠ¢â¿á¶ _ : Cx â†’ Ty â†’ Set where
    lamâ¿á¶    : âˆ€ {Î” Î“ A B} â†’
                Î” â Î“ , A âŠ¢â¿á¶  B â†’
                Î” â Î“ âŠ¢â¿á¶  A â‡’ B
    boxâ¿á¶    : âˆ€ {Î” Î“ Î¦ A} â†’
                Î¦ â âˆ… âŠ¢ A â†’
                Î” â Î“ âŠ¢â¿á¶  [ Î¦ ] A
    neâ¿á¶     : âˆ€ {Î” Î“ A} â†’
                Î” â Î“ âŠ¢â¿áµ‰ A â†’
                Î” â Î“ âŠ¢â¿á¶  A

  infix 3 _âŠ¢â¿áµ‰_
  data _âŠ¢â¿áµ‰_ : Cx â†’ Ty â†’ Set where
    varâ¿áµ‰   : âˆ€ {Î” Î“ A} â†’
                Î“ âˆ‹ A â†’
                Î” â Î“ âŠ¢â¿áµ‰ A
    mvarâ¿áµ‰  : âˆ€ {Î” Î“ Î¦ A} â†’
                Î” â âˆ… âŠ¢â§† Î¦ â†’ Î” âˆ‹ [ Î¦ ] A â†’
                Î” â Î“ âŠ¢â¿áµ‰ A
    appâ¿áµ‰   : âˆ€ {Î” Î“ A B} â†’
                Î” â Î“ âŠ¢â¿áµ‰ A â‡’ B â†’ Î” â Î“ âŠ¢â¿á¶  A â†’
                Î” â Î“ âŠ¢â¿áµ‰ B
    unboxâ¿áµ‰ : âˆ€ {Î” Î“ Î¦ A C} â†’
                Î” â Î“ âŠ¢â¿áµ‰ [ Î¦ ] A â†’ Î” , [ Î¦ ] A â Î“ âŠ¢â¿á¶  C â†’
                Î” â Î“ âŠ¢â¿áµ‰ C

infix 3 _âŠ¢â‹†â¿áµ‰_
_âŠ¢â‹†â¿áµ‰_ : Cx â†’ Tyâ‹† â†’ Set
Î” â Î“ âŠ¢â‹†â¿áµ‰ Î = All (Î” â Î“ âŠ¢â¿áµ‰_) Î

mutual
  monoâŠ¢â¿á¶  : âˆ€ {Î” Î“ Î”â€² Î“â€² A} â†’ Î”â€² âŠ‡ Î” â†’ Î“â€² âŠ‡ Î“ â†’ Î” â Î“ âŠ¢â¿á¶  A â†’ Î”â€² â Î“â€² âŠ¢â¿á¶  A
  monoâŠ¢â¿á¶  Î¶ Î· (lamâ¿á¶  ğ’Ÿ)     = lamâ¿á¶  (monoâŠ¢â¿á¶  Î¶ (lift Î·) ğ’Ÿ)
  monoâŠ¢â¿á¶  Î¶ Î· (boxâ¿á¶  ğ’Ÿ)     = boxâ¿á¶  ğ’Ÿ
  monoâŠ¢â¿á¶  Î¶ Î· (neâ¿á¶  ğ’Ÿ)      = neâ¿á¶  (monoâŠ¢â¿áµ‰ Î¶ Î· ğ’Ÿ)

  monoâŠ¢â¿áµ‰ : âˆ€ {Î” Î“ Î”â€² Î“â€² A} â†’ Î”â€² âŠ‡ Î” â†’ Î“â€² âŠ‡ Î“ â†’ Î” â Î“ âŠ¢â¿áµ‰ A â†’ Î”â€² â Î“â€² âŠ¢â¿áµ‰ A
  monoâŠ¢â¿áµ‰ Î¶ Î· (varâ¿áµ‰ ğ’¾)     = varâ¿áµ‰ (monoâˆ‹ Î· ğ’¾)
  monoâŠ¢â¿áµ‰ Î¶ Î· (mvarâ¿áµ‰ Ï† ğ’¾)  = mvarâ¿áµ‰ (monoâŠ¢â§† Î¶ done Ï†) (monoâˆ‹ Î¶ ğ’¾)
  monoâŠ¢â¿áµ‰ Î¶ Î· (appâ¿áµ‰ ğ’Ÿ â„°)   = appâ¿áµ‰ (monoâŠ¢â¿áµ‰ Î¶ Î· ğ’Ÿ) (monoâŠ¢â¿á¶  Î¶ Î· â„°)
  monoâŠ¢â¿áµ‰ Î¶ Î· (unboxâ¿áµ‰ ğ’Ÿ â„°) = unboxâ¿áµ‰ (monoâŠ¢â¿áµ‰ Î¶ Î· ğ’Ÿ) (monoâŠ¢â¿á¶  (lift Î¶) Î· â„°)

monoâŠ¢â‹†â¿áµ‰ : âˆ€ {Î” Î“ Î”â€² Î“â€² Î} â†’ Î”â€² âŠ‡ Î” â†’ Î“â€² âŠ‡ Î“ â†’ Î” â Î“ âŠ¢â‹†â¿áµ‰ Î â†’ Î”â€² â Î“â€² âŠ¢â‹†â¿áµ‰ Î
monoâŠ¢â‹†â¿áµ‰ Î¶ Î· Î¾ = mapAll (monoâŠ¢â¿áµ‰ Î¶ Î·) Î¾

mutual
  idmonoâŠ¢â¿á¶  : âˆ€ {Î” Î“ A} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢â¿á¶  A) â†’ monoâŠ¢â¿á¶  reflâŠ‡ reflâŠ‡ ğ’Ÿ â‰¡ ğ’Ÿ
  idmonoâŠ¢â¿á¶  (lamâ¿á¶  ğ’Ÿ)     = cong lamâ¿á¶  (idmonoâŠ¢â¿á¶  ğ’Ÿ)
  idmonoâŠ¢â¿á¶  (boxâ¿á¶  ğ’Ÿ)     = refl
  idmonoâŠ¢â¿á¶  (neâ¿á¶  ğ’Ÿ)      = cong neâ¿á¶  (idmonoâŠ¢â¿áµ‰ ğ’Ÿ)

  idmonoâŠ¢â¿áµ‰ : âˆ€ {Î” Î“ A} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢â¿áµ‰ A) â†’ monoâŠ¢â¿áµ‰ reflâŠ‡ reflâŠ‡ ğ’Ÿ â‰¡ ğ’Ÿ
  idmonoâŠ¢â¿áµ‰ (varâ¿áµ‰ ğ’¾)     = cong varâ¿áµ‰ (idmonoâˆ‹ ğ’¾)
  idmonoâŠ¢â¿áµ‰ (mvarâ¿áµ‰ Ï† ğ’¾)  = congÂ² mvarâ¿áµ‰ (idmonoâŠ¢â§† Ï†) (idmonoâˆ‹ ğ’¾)
  idmonoâŠ¢â¿áµ‰ (appâ¿áµ‰ ğ’Ÿ â„°)   = congÂ² appâ¿áµ‰ (idmonoâŠ¢â¿áµ‰ ğ’Ÿ) (idmonoâŠ¢â¿á¶  â„°)
  idmonoâŠ¢â¿áµ‰ (unboxâ¿áµ‰ ğ’Ÿ â„°) = congÂ² unboxâ¿áµ‰ (idmonoâŠ¢â¿áµ‰ ğ’Ÿ) (idmonoâŠ¢â¿á¶  â„°)

mutual
  assocmonoâŠ¢â¿á¶  : âˆ€ {Î” Î“ Î”â€² Î“â€² Î“â€³ Î”â€³ A} â†’
                    (Î¶â€² : Î”â€³ âŠ‡ Î”â€²) (Î·â€² : Î“â€³ âŠ‡ Î“â€²) (Î¶ : Î”â€² âŠ‡ Î”) (Î· : Î“â€² âŠ‡ Î“) (ğ’Ÿ : Î” â Î“ âŠ¢â¿á¶  A) â†’
                    monoâŠ¢â¿á¶  Î¶â€² Î·â€² (monoâŠ¢â¿á¶  Î¶ Î· ğ’Ÿ) â‰¡ monoâŠ¢â¿á¶  (transâŠ‡ Î¶â€² Î¶) (transâŠ‡ Î·â€² Î·) ğ’Ÿ
  assocmonoâŠ¢â¿á¶  Î¶â€² Î·â€² Î¶ Î· (lamâ¿á¶  ğ’Ÿ)     = cong lamâ¿á¶  (assocmonoâŠ¢â¿á¶  Î¶â€² (lift Î·â€²) Î¶ (lift Î·) ğ’Ÿ)
  assocmonoâŠ¢â¿á¶  Î¶â€² Î·â€² Î¶ Î· (boxâ¿á¶  ğ’Ÿ)     = refl
  assocmonoâŠ¢â¿á¶  Î¶â€² Î·â€² Î¶ Î· (neâ¿á¶  ğ’Ÿ)      = cong neâ¿á¶  (assocmonoâŠ¢â¿áµ‰ Î¶â€² Î·â€² Î¶ Î· ğ’Ÿ)

  assocmonoâŠ¢â¿áµ‰ : âˆ€ {Î” Î“ Î”â€² Î“â€² Î“â€³ Î”â€³ A} â†’
                    (Î¶â€² : Î”â€³ âŠ‡ Î”â€²) (Î·â€² : Î“â€³ âŠ‡ Î“â€²) (Î¶ : Î”â€² âŠ‡ Î”) (Î· : Î“â€² âŠ‡ Î“) (ğ’Ÿ : Î” â Î“ âŠ¢â¿áµ‰ A) â†’
                    monoâŠ¢â¿áµ‰ Î¶â€² Î·â€² (monoâŠ¢â¿áµ‰ Î¶ Î· ğ’Ÿ) â‰¡ monoâŠ¢â¿áµ‰ (transâŠ‡ Î¶â€² Î¶) (transâŠ‡ Î·â€² Î·) ğ’Ÿ
  assocmonoâŠ¢â¿áµ‰ Î¶â€² Î·â€² Î¶ Î· (varâ¿áµ‰ ğ’¾)     = cong varâ¿áµ‰ (assocmonoâˆ‹ Î·â€² Î· ğ’¾)
  assocmonoâŠ¢â¿áµ‰ Î¶â€² Î·â€² Î¶ Î· (mvarâ¿áµ‰ Ï† ğ’¾)  = congÂ² mvarâ¿áµ‰ (assocmonoâŠ¢â§† Î¶â€² done Î¶ done Ï†) (assocmonoâˆ‹ Î¶â€² Î¶ ğ’¾)
  assocmonoâŠ¢â¿áµ‰ Î¶â€² Î·â€² Î¶ Î· (appâ¿áµ‰ ğ’Ÿ â„°)   = congÂ² appâ¿áµ‰ (assocmonoâŠ¢â¿áµ‰ Î¶â€² Î·â€² Î¶ Î· ğ’Ÿ) (assocmonoâŠ¢â¿á¶  Î¶â€² Î·â€² Î¶ Î· â„°)
  assocmonoâŠ¢â¿áµ‰ Î¶â€² Î·â€² Î¶ Î· (unboxâ¿áµ‰ ğ’Ÿ â„°) = congÂ² unboxâ¿áµ‰ (assocmonoâŠ¢â¿áµ‰ Î¶â€² Î·â€² Î¶ Î· ğ’Ÿ) (assocmonoâŠ¢â¿á¶  (lift Î¶â€²) Î·â€² (lift Î¶) Î· â„°)

idmonoâŠ¢â‹†â¿áµ‰ : âˆ€ {Î” Î“ Î} â†’ (Î¾ : Î” â Î“ âŠ¢â‹†â¿áµ‰ Î) â†’ monoâŠ¢â‹†â¿áµ‰ reflâŠ‡ reflâŠ‡ Î¾ â‰¡ Î¾
idmonoâŠ¢â‹†â¿áµ‰ âˆ…       = refl
idmonoâŠ¢â‹†â¿áµ‰ (Î¾ , ğ’Ÿ) = congÂ² _,_ (idmonoâŠ¢â‹†â¿áµ‰ Î¾) (idmonoâŠ¢â¿áµ‰ ğ’Ÿ)

assocmonoâŠ¢â‹†â¿áµ‰ : âˆ€ {Î” Î“ Î”â€² Î“â€² Î“â€³ Î”â€³ Î} â†’
                   (Î¶â€² : Î”â€³ âŠ‡ Î”â€²) (Î·â€² : Î“â€³ âŠ‡ Î“â€²) (Î¶ : Î”â€² âŠ‡ Î”) (Î· : Î“â€² âŠ‡ Î“) (Î¾ : Î” â Î“ âŠ¢â‹†â¿áµ‰ Î) â†’
                   monoâŠ¢â‹†â¿áµ‰ Î¶â€² Î·â€² (monoâŠ¢â‹†â¿áµ‰ Î¶ Î· Î¾) â‰¡ monoâŠ¢â‹†â¿áµ‰ (transâŠ‡ Î¶â€² Î¶) (transâŠ‡ Î·â€² Î·) Î¾
assocmonoâŠ¢â‹†â¿áµ‰ Î¶â€² Î·â€² Î¶ Î· âˆ…       = refl
assocmonoâŠ¢â‹†â¿áµ‰ Î¶â€² Î·â€² Î¶ Î· (Î¾ , ğ’Ÿ) = congÂ² _,_ (assocmonoâŠ¢â‹†â¿áµ‰ Î¶â€² Î·â€² Î¶ Î· Î¾) (assocmonoâŠ¢â¿áµ‰ Î¶â€² Î·â€² Î¶ Î· ğ’Ÿ)


-- Example derivations.

vâ‚€ : âˆ€ {Î” Î“ A} â†’
       Î” â Î“ , A âŠ¢ A
vâ‚€ = var zero

vâ‚ : âˆ€ {Î” Î“ A B} â†’
       Î” â Î“ , A , B âŠ¢ A
vâ‚ = var (suc zero)

vâ‚‚ : âˆ€ {Î” Î“ A B C} â†’
       Î” â Î“ , A , B , C âŠ¢ A
vâ‚‚ = var (suc (suc zero))

mvâ‚€ : âˆ€ {Î” Î“ Î¦ A} â†’
        Î” , [ Î¦ ] A â âˆ… âŠ¢â§† Î¦ â†’
        Î” , [ Î¦ ] A â Î“ âŠ¢ A
mvâ‚€ Ï† = mvar Ï† zero

mvâ‚ : âˆ€ {Î” Î“ Î¦ Î¦â€² A B} â†’
        Î” , [ Î¦ ] A , [ Î¦â€² ] B â âˆ… âŠ¢â§† Î¦ â†’
        Î” , [ Î¦ ] A , [ Î¦â€² ] B â Î“ âŠ¢ A
mvâ‚ Ï† = mvar Ï† (suc zero)

mvâ‚‚ : âˆ€ {Î” Î“ Î¦ Î¦â€² Î¦â€³ A B C} â†’
        Î” , [ Î¦ ] A , [ Î¦â€² ] B , [ Î¦â€³ ] C â âˆ… âŠ¢â§† Î¦ â†’
        Î” , [ Î¦ ] A , [ Î¦â€² ] B , [ Î¦â€³ ] C â Î“ âŠ¢ A
mvâ‚‚ Ï† = mvar Ï† (suc (suc zero))

iá¶œ : âˆ€ {Î” Î“ A} â†’
       Î” â Î“ âŠ¢ A â‡’ A
iá¶œ = lam vâ‚€

ká¶œ : âˆ€ {Î” Î“ A B} â†’
       Î” â Î“ âŠ¢ A â‡’ B â‡’ A
ká¶œ = lam (lam vâ‚)

sá¶œ : âˆ€ {Î” Î“ A B C} â†’
       Î” â Î“ âŠ¢ (A â‡’ B â‡’ C) â‡’ (A â‡’ B) â‡’ A â‡’ C
sá¶œ = lam (lam (lam
       (app (app vâ‚‚ vâ‚€) (app vâ‚ vâ‚€))))

cá¶œ : âˆ€ {Î” Î“ A B C} â†’
       Î” â Î“ âŠ¢ (A â‡’ B â‡’ C) â‡’ B â‡’ A â‡’ C
cá¶œ = lam (lam (lam
       (app (app vâ‚‚ vâ‚€) vâ‚)))

bá¶œ : âˆ€ {Î” Î“ A B C} â†’
       Î” â Î“ âŠ¢ (B â‡’ C) â‡’ (A â‡’ B) â‡’ A â‡’ C
bá¶œ = lam (lam (lam
       (app vâ‚‚ (app vâ‚ vâ‚€))))

aá¶œ : âˆ€ {Î” Î“ A B} â†’
       Î” â Î“ âŠ¢ (A â‡’ A â‡’ B) â‡’ A â‡’ B
aá¶œ = lam (lam
       (app (app vâ‚ vâ‚€) vâ‚€))

-- -- NOTE: Needs mreflâŠ¢â§†.
-- dá¶œ : âˆ€ {Î” Î“ Î¦ Î¦â€² A B} â†’
--        Telescopic Î” â†’
--        Î” â Î“ âŠ¢ [ Î¦ ] (A â‡’ B) â‡’ [ Î¦â€² ] A â‡’
--                 [ Î” , [ Î” ] (A â‡’ B) , [ Î” ] A ] B
-- dá¶œ Ï„ = lam (lam (unbox vâ‚ (unbox vâ‚€
--          (box (app (mvâ‚ (monoâŠ¢â§† (weak (weak reflâŠ‡)) reflâŠ‡ (mreflâŠ¢â§† Ï„)))
--                    (mvâ‚€ (monoâŠ¢â§† (weak (weak reflâŠ‡)) reflâŠ‡ (mreflâŠ¢â§† Ï„))))))))
--
-- 4á¶œ : âˆ€ {Î” Î“ Î¦ Î¦â€² A} â†’
--        Telescopic Î” â†’
--        Î” â Î“ âŠ¢ [ Î¦ ] A â‡’
--                 [ Î¦â€² ] [ Î” , [ Î” ] A ] A
-- 4á¶œ Ï„ = lam (unbox vâ‚€
--          (box (box
--            (mvâ‚€ (monoâŠ¢â§† (weak reflâŠ‡) reflâŠ‡ (mreflâŠ¢â§† Ï„))))))
--
-- tá¶œ : âˆ€ {Î” Î“ A} â†’ Telescopic Î” â†’ Î” â Î“ âŠ¢ [ Î” ] A â‡’ A
-- tá¶œ Ï„ = lam (unbox vâ‚€
--          (mvâ‚€ (monoâŠ¢â§† (weak reflâŠ‡) reflâŠ‡ (mreflâŠ¢â§† Ï„))))


-- Example inference rules on derivations.

exch : âˆ€ {Î” Î“ A B C} â†’
         Î” â Î“ âŠ¢ A â‡’ B â‡’ C â†’
         Î” â Î“ âŠ¢ B â‡’ A â‡’ C
exch ğ’Ÿ = app cá¶œ ğ’Ÿ

comp : âˆ€ {Î” Î“ A B C} â†’
         Î” â Î“ âŠ¢ B â‡’ C â†’ Î” â Î“ âŠ¢ A â‡’ B â†’
         Î” â Î“ âŠ¢ A â‡’ C
comp ğ’Ÿ â„° = app (app bá¶œ ğ’Ÿ) â„°

cont : âˆ€ {Î” Î“ A B} â†’
         Î” â Î“ âŠ¢ A â‡’ A â‡’ B â†’
         Î” â Î“ âŠ¢ A â‡’ B
cont ğ’Ÿ = app aá¶œ ğ’Ÿ

det : âˆ€ {Î” Î“ A B} â†’
        Î” â Î“ âŠ¢ A â‡’ B â†’
        Î” â Î“ , A âŠ¢ B
det ğ’Ÿ = app (monoâŠ¢ reflâŠ‡ (weak reflâŠ‡) ğ’Ÿ) vâ‚€

-- -- TODO: What is going on here?
-- -- Goal:    Î” , [ Î¦ ] A â Î“ âŠ¢ [ Î¦ ] A
-- -- Have:    Î” , [ Î¦ ] A â Î“ âŠ¢ [ Î” , [ Î¦ ] A ] A
-- -- Subgoal: Î” , [ Î¦ ] A â âˆ… âŠ¢â§† Î¦
-- mdet : âˆ€ {Î” Î“ Î¦ A B} â†’
--          Î” â Î“ âŠ¢ [ Î¦ ] A â‡’ B â†’
--          Î” , [ Î¦ ] A â Î“ âŠ¢ B
-- mdet {Î”} {Î“} {Î¦} {A} {B} ğ’Ÿ =
--   app (monoâŠ¢ (weak reflâŠ‡) reflâŠ‡ ğ’Ÿ)
--     (oops (box {Î” , [ Î¦ ] A} {Î“} (mvâ‚€ {Î”} {âˆ…} {Î¦} {A} {!!})))
--
-- -- NOTE: Needs example derivations.
-- dist : âˆ€ {Î” Î“ Î¦ Î¦â€² A B} â†’
--          Telescopic Î” â†’
--          Î” â Î“ âŠ¢ [ Î¦ ] (A â‡’ B) â†’ Î” â Î“ âŠ¢ [ Î¦â€² ] A â†’
--          Î” â Î“ âŠ¢ [ Î” , [ Î” ] (A â‡’ B) , [ Î” ] A ] B
-- dist Ï„ ğ’Ÿ â„° = app (app (dá¶œ Ï„) ğ’Ÿ) â„°
--
-- wrap : âˆ€ {Î” Î“ Î¦ Î¦â€² A} â†’
--          Telescopic Î” â†’
--          Î” â Î“ âŠ¢ [ Î¦ ] A â†’
--          Î” â Î“ âŠ¢ [ Î¦â€² ] [ Î” , [ Î” ] A ] A
-- wrap Ï„ ğ’Ÿ = app (4á¶œ Ï„) ğ’Ÿ
--
-- eval : âˆ€ {Î” Î“ A} â†’
--          Telescopic Î” â†’
--          Î” â Î“ âŠ¢ [ Î” ] A â†’
--          Î” â Î“ âŠ¢ A
-- eval Ï„ ğ’Ÿ = app (tá¶œ Ï„) ğ’Ÿ
