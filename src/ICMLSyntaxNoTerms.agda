{-# OPTIONS --rewriting #-}

module ICMLSyntaxNoTerms where

open import ICML public
open ICMLList public


-- Contexts.

Cx : Set
Cx = BoxTyâ‹† âˆ§ Tyâ‹†


-- Derivations.

mutual
  infix 3 _âŠ¢_
  data _âŠ¢_ : Cx â†’ Ty â†’ Set where
    var   : âˆ€ {Î” Î“ A} â†’
              Î“ âˆ‹ A â†’
              Î” â Î“ âŠ¢ A
    mvar  : âˆ€ {Î” Î“ Î¨ A} â†’
              Î” â Î“ âŠ¢â‹† Î¨ â†’ Î” âˆ‹ [ Î¨ ] A â†’
              Î” â Î“ âŠ¢ A
    lam   : âˆ€ {Î” Î“ A B} â†’
              Î” â Î“ , A âŠ¢ B â†’
              Î” â Î“ âŠ¢ A â‡’ B
    app   : âˆ€ {Î” Î“ A B} â†’
              Î” â Î“ âŠ¢ A â‡’ B â†’ Î” â Î“ âŠ¢ A â†’
              Î” â Î“ âŠ¢ B
    box   : âˆ€ {Î” Î“ Î¨ A} â†’
              Î” â Î¨ âŠ¢ A â†’
              Î” â Î“ âŠ¢ [ Î¨ ] A
    unbox : âˆ€ {Î” Î“ Î¨ A C} â†’
              Î” â Î“ âŠ¢ [ Î¨ ] A â†’ Î” , [ Î¨ ] A â Î“ âŠ¢ C â†’
              Î” â Î“ âŠ¢ C

  infix 3 _âŠ¢â‹†_
  _âŠ¢â‹†_ : Cx â†’ Tyâ‹† â†’ Set
  Î” â Î“ âŠ¢â‹† Î = All (Î” â Î“ âŠ¢_) Î

infix 3 _âŠ¢â§†_
data _âŠ¢â§†_ : Cx â†’ BoxTyâ‹† â†’ Set where
  âˆ…   : âˆ€ {Î” Î“}       â†’ Î” â Î“ âŠ¢â§† âˆ…
  _,_ : âˆ€ {Î” Î“ Î¨ Î A} â†’
          Î” â Î“ âŠ¢â§† Î â†’ Î” â Î“ âŠ¢ [ Î¨ ] A â†’
          Î” â Î“ âŠ¢â§† Î , [ Î¨ ] A

mutual
  monoâŠ¢ : âˆ€ {Î” Î“ Î”â€² Î“â€² A} â†’ Î”â€² âŠ‡ Î” â†’ Î“â€² âŠ‡ Î“ â†’ Î” â Î“ âŠ¢ A â†’ Î”â€² â Î“â€² âŠ¢ A
  monoâŠ¢ Î¶ Î· (var ğ’¾)     = var (monoâˆ‹ Î· ğ’¾)
  monoâŠ¢ Î¶ Î· (mvar Ïˆ ğ’¾)  = mvar (monoâŠ¢â‹† Î¶ Î· Ïˆ) (monoâˆ‹ Î¶ ğ’¾)
  monoâŠ¢ Î¶ Î· (lam ğ’Ÿ)     = lam (monoâŠ¢ Î¶ (lift Î·) ğ’Ÿ)
  monoâŠ¢ Î¶ Î· (app ğ’Ÿ â„°)   = app (monoâŠ¢ Î¶ Î· ğ’Ÿ) (monoâŠ¢ Î¶ Î· â„°)
  monoâŠ¢ Î¶ Î· (box ğ’Ÿ)     = box (monoâŠ¢ Î¶ reflâŠ‡ ğ’Ÿ)
  monoâŠ¢ Î¶ Î· (unbox ğ’Ÿ â„°) = unbox (monoâŠ¢ Î¶ Î· ğ’Ÿ) (monoâŠ¢ (lift Î¶) Î· â„°)

  monoâŠ¢â‹† : âˆ€ {Î” Î“ Î”â€² Î“â€² Î} â†’ Î”â€² âŠ‡ Î” â†’ Î“â€² âŠ‡ Î“ â†’ Î” â Î“ âŠ¢â‹† Î â†’ Î”â€² â Î“â€² âŠ¢â‹† Î
  monoâŠ¢â‹† Î¶ Î· âˆ…       = âˆ…
  monoâŠ¢â‹† Î¶ Î· (Î¾ , ğ’Ÿ) = monoâŠ¢â‹† Î¶ Î· Î¾ , monoâŠ¢ Î¶ Î· ğ’Ÿ
  -- NOTE: Equivalent, but does not pass termination check.
  -- monoâŠ¢â‹† Î¶ Î· Î¾ = mapAll (monoâŠ¢ Î¶ Î·) Î¾

monoâŠ¢â§† : âˆ€ {Î” Î“ Î”â€² Î“â€² Î} â†’ Î”â€² âŠ‡ Î” â†’ Î“â€² âŠ‡ Î“ â†’ Î” â Î“ âŠ¢â§† Î â†’ Î”â€² â Î“â€² âŠ¢â§† Î
monoâŠ¢â§† Î¶ Î· âˆ…       = âˆ…
monoâŠ¢â§† Î¶ Î· (Î¾ , ğ’Ÿ) = monoâŠ¢â§† Î¶ Î· Î¾ , monoâŠ¢ Î¶ Î· ğ’Ÿ

mutual
  idmonoâŠ¢ : âˆ€ {Î” Î“ A} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢ A) â†’ monoâŠ¢ reflâŠ‡ reflâŠ‡ ğ’Ÿ â‰¡ ğ’Ÿ
  idmonoâŠ¢ (var ğ’¾)     = cong var (idmonoâˆ‹ ğ’¾)
  idmonoâŠ¢ (mvar Ïˆ ğ’¾)  = congÂ² mvar (idmonoâŠ¢â‹† Ïˆ) (idmonoâˆ‹ ğ’¾)
  idmonoâŠ¢ (lam ğ’Ÿ)     = cong lam (idmonoâŠ¢ ğ’Ÿ)
  idmonoâŠ¢ (app ğ’Ÿ â„°)   = congÂ² app (idmonoâŠ¢ ğ’Ÿ) (idmonoâŠ¢ â„°)
  idmonoâŠ¢ (box ğ’Ÿ)     = cong box (idmonoâŠ¢ ğ’Ÿ)
  idmonoâŠ¢ (unbox ğ’Ÿ â„°) = congÂ² unbox (idmonoâŠ¢ ğ’Ÿ) (idmonoâŠ¢ â„°)

  idmonoâŠ¢â‹† : âˆ€ {Î” Î“ Î} â†’ (Î¾ : Î” â Î“ âŠ¢â‹† Î) â†’ monoâŠ¢â‹† reflâŠ‡ reflâŠ‡ Î¾ â‰¡ Î¾
  idmonoâŠ¢â‹† âˆ…       = refl
  idmonoâŠ¢â‹† (Î¾ , ğ’Ÿ) = congÂ² _,_ (idmonoâŠ¢â‹† Î¾) (idmonoâŠ¢ ğ’Ÿ)

-- NOTE: Needs {-# REWRITE idtransâŠ‡â‚ #-}.
mutual
  assocmonoâŠ¢ : âˆ€ {Î” Î“ Î”â€² Î“â€² Î“â€³ Î”â€³ A} â†’
                  (Î¶â€² : Î”â€³ âŠ‡ Î”â€²) (Î·â€² : Î“â€³ âŠ‡ Î“â€²) (Î¶ : Î”â€² âŠ‡ Î”) (Î· : Î“â€² âŠ‡ Î“) (ğ’Ÿ : Î” â Î“ âŠ¢ A) â†’
                  monoâŠ¢ Î¶â€² Î·â€² (monoâŠ¢ Î¶ Î· ğ’Ÿ) â‰¡ monoâŠ¢ (transâŠ‡ Î¶â€² Î¶) (transâŠ‡ Î·â€² Î·) ğ’Ÿ
  assocmonoâŠ¢ Î¶â€² Î·â€² Î¶ Î· (var ğ’¾)     = cong var (assocmonoâˆ‹ Î·â€² Î· ğ’¾)
  assocmonoâŠ¢ Î¶â€² Î·â€² Î¶ Î· (mvar Ïˆ ğ’¾)  = congÂ² mvar (assocmonoâŠ¢â‹† Î¶â€² Î·â€² Î¶ Î· Ïˆ) (assocmonoâˆ‹ Î¶â€² Î¶ ğ’¾)
  assocmonoâŠ¢ Î¶â€² Î·â€² Î¶ Î· (lam ğ’Ÿ)     = cong lam (assocmonoâŠ¢ Î¶â€² (lift Î·â€²) Î¶ (lift Î·) ğ’Ÿ)
  assocmonoâŠ¢ Î¶â€² Î·â€² Î¶ Î· (app ğ’Ÿ â„°)   = congÂ² app (assocmonoâŠ¢ Î¶â€² Î·â€² Î¶ Î· ğ’Ÿ) (assocmonoâŠ¢ Î¶â€² Î·â€² Î¶ Î· â„°)
  assocmonoâŠ¢ Î¶â€² Î·â€² Î¶ Î· (box ğ’Ÿ)     = cong box (assocmonoâŠ¢ Î¶â€² reflâŠ‡ Î¶ reflâŠ‡ ğ’Ÿ)
  assocmonoâŠ¢ Î¶â€² Î·â€² Î¶ Î· (unbox ğ’Ÿ â„°) = congÂ² unbox (assocmonoâŠ¢ Î¶â€² Î·â€² Î¶ Î· ğ’Ÿ) (assocmonoâŠ¢ (lift Î¶â€²) Î·â€² (lift Î¶) Î· â„°)

  assocmonoâŠ¢â‹† : âˆ€ {Î” Î“ Î”â€² Î“â€² Î“â€³ Î”â€³ Î} â†’
                   (Î¶â€² : Î”â€³ âŠ‡ Î”â€²) (Î·â€² : Î“â€³ âŠ‡ Î“â€²) (Î¶ : Î”â€² âŠ‡ Î”) (Î· : Î“â€² âŠ‡ Î“) (Î¾ : Î” â Î“ âŠ¢â‹† Î) â†’
                   monoâŠ¢â‹† Î¶â€² Î·â€² (monoâŠ¢â‹† Î¶ Î· Î¾) â‰¡ monoâŠ¢â‹† (transâŠ‡ Î¶â€² Î¶) (transâŠ‡ Î·â€² Î·) Î¾
  assocmonoâŠ¢â‹† Î¶â€² Î·â€² Î¶ Î· âˆ…       = refl
  assocmonoâŠ¢â‹† Î¶â€² Î·â€² Î¶ Î· (Î¾ , ğ’Ÿ) = congÂ² _,_ (assocmonoâŠ¢â‹† Î¶â€² Î·â€² Î¶ Î· Î¾) (assocmonoâŠ¢ Î¶â€² Î·â€² Î¶ Î· ğ’Ÿ)

reflâŠ¢â‹† : âˆ€ {Î” Î“} â†’ Î” â Î“ âŠ¢â‹† Î“
reflâŠ¢â‹† {Î“ = âˆ…}     = âˆ…
reflâŠ¢â‹† {Î“ = Î“ , A} = monoâŠ¢â‹† reflâŠ‡ (weak reflâŠ‡) reflâŠ¢â‹† , var zero

mreflâŠ¢â§† : âˆ€ {Î” Î“} â†’ Î” â Î“ âŠ¢â§† Î”
mreflâŠ¢â§† {âˆ…}           = âˆ…
mreflâŠ¢â§† {Î” , [ Î¨ ] A} = monoâŠ¢â§† (weak reflâŠ‡) reflâŠ‡ mreflâŠ¢â§† , box (mvar reflâŠ¢â‹† zero)

lookupâŠ¢ : âˆ€ {Î” Î“ Î A} â†’ Î” â Î“ âŠ¢â‹† Î â†’ Î âˆ‹ A â†’ Î” â Î“ âŠ¢ A
lookupâŠ¢ Î¾ ğ’¾ = lookupAll Î¾ ğ’¾

mlookupâŠ¢ : âˆ€ {Î” Î“ Î Î¨ A} â†’ Î” â Î“ âŠ¢â§† Î â†’ Î âˆ‹ [ Î¨ ] A â†’ Î” â Î“ âŠ¢ [ Î¨ ] A
mlookupâŠ¢ (Î¾ , ğ’Ÿ) zero    = ğ’Ÿ
mlookupâŠ¢ (Î¾ , â„°) (suc ğ’¾) = mlookupâŠ¢ Î¾ ğ’¾

mutual
  graftâŠ¢ : âˆ€ {Î” Î“ Î¨ A} â†’ Î” â Î“ âŠ¢â‹† Î¨ â†’ Î” â Î¨ âŠ¢ A â†’ Î” â Î“ âŠ¢ A
  graftâŠ¢ Ïˆ (var ğ’¾)     = lookupâŠ¢ Ïˆ ğ’¾
  graftâŠ¢ Ïˆ (mvar Ïˆâ€² ğ’¾) = mvar (graftâŠ¢â‹† Ïˆ Ïˆâ€²) ğ’¾
  graftâŠ¢ Ïˆ (lam ğ’Ÿ)     = lam (graftâŠ¢ (monoâŠ¢â‹† reflâŠ‡ (weak reflâŠ‡) Ïˆ , var zero) ğ’Ÿ)
  graftâŠ¢ Ïˆ (app ğ’Ÿ â„°)   = app (graftâŠ¢ Ïˆ ğ’Ÿ) (graftâŠ¢ Ïˆ â„°)
  graftâŠ¢ Ïˆ (box ğ’Ÿ)     = box ğ’Ÿ
  graftâŠ¢ Ïˆ (unbox ğ’Ÿ â„°) = unbox (graftâŠ¢ Ïˆ ğ’Ÿ) (graftâŠ¢ (monoâŠ¢â‹† (weak reflâŠ‡) reflâŠ‡ Ïˆ) â„°)

  graftâŠ¢â‹† : âˆ€ {Î” Î“ Î¨ Î} â†’ Î” â Î“ âŠ¢â‹† Î¨ â†’ Î” â Î¨ âŠ¢â‹† Î â†’ Î” â Î“ âŠ¢â‹† Î
  graftâŠ¢â‹† Ïˆ âˆ…       = âˆ…
  graftâŠ¢â‹† Ïˆ (Î¾ , ğ’Ÿ) = graftâŠ¢â‹† Ïˆ Î¾ , graftâŠ¢ Ïˆ ğ’Ÿ
  -- NOTE: Equivalent, but does not pass termination check.
  -- graftâŠ¢â‹† Ïˆ Î¾ = mapAll (graftâŠ¢ Ïˆ) Î¾

transâŠ¢â‹† : âˆ€ {Î” Î“ Î“â€² Î“â€³} â†’ Î” â Î“â€³ âŠ¢â‹† Î“â€² â†’ Î” â Î“â€² âŠ¢â‹† Î“ â†’ Î” â Î“â€³ âŠ¢â‹† Î“
transâŠ¢â‹† = graftâŠ¢â‹†

mutual
  mgraftâŠ¢ : âˆ€ {Î” Î“ Î¦ A} â†’ Î” â âˆ… âŠ¢â§† Î¦ â†’ Î¦ â Î“ âŠ¢ A â†’ Î” â Î“ âŠ¢ A
  mgraftâŠ¢ Ï† (var ğ’¾)     = var ğ’¾
  mgraftâŠ¢ Ï† (mvar Ïˆ ğ’¾)  = unbox (monoâŠ¢ reflâŠ‡ infâŠ‡ (mlookupâŠ¢ Ï† ğ’¾))
                                 (mvar (mgraftâŠ¢â‹† (monoâŠ¢â§† (weak reflâŠ‡) reflâŠ‡ Ï†) Ïˆ) zero)
  mgraftâŠ¢ Ï† (lam ğ’Ÿ)     = lam (mgraftâŠ¢ Ï† ğ’Ÿ)
  mgraftâŠ¢ Ï† (app ğ’Ÿ â„°)   = app (mgraftâŠ¢ Ï† ğ’Ÿ) (mgraftâŠ¢ Ï† â„°)
  mgraftâŠ¢ Ï† (box ğ’Ÿ)     = box (mgraftâŠ¢ Ï† ğ’Ÿ)
  mgraftâŠ¢ Ï† (unbox ğ’Ÿ â„°) = unbox (mgraftâŠ¢ Ï† ğ’Ÿ)
                                 (mgraftâŠ¢ (monoâŠ¢â§† (weak reflâŠ‡) reflâŠ‡ Ï† , box (mvar reflâŠ¢â‹† zero)) â„°)

  mgraftâŠ¢â‹† : âˆ€ {Î” Î“ Î¦ Î} â†’ Î” â âˆ… âŠ¢â§† Î¦ â†’ Î¦ â Î“ âŠ¢â‹† Î â†’ Î” â Î“ âŠ¢â‹† Î
  mgraftâŠ¢â‹† Ï† âˆ…       = âˆ…
  mgraftâŠ¢â‹† Ï† (Î¾ , ğ’Ÿ) = mgraftâŠ¢â‹† Ï† Î¾ , mgraftâŠ¢ Ï† ğ’Ÿ
  -- NOTE: Equivalent, but does not pass termination check.
  -- mgraftâŠ¢â‹† Ï† Î¾ = mapAll (mgraftâŠ¢ Ï†) Î¾

mgraftâŠ¢â§† : âˆ€ {Î” Î“ Î¦ Î} â†’ Î” â âˆ… âŠ¢â§† Î¦ â†’ Î¦ â Î“ âŠ¢â§† Î â†’ Î” â Î“ âŠ¢â§† Î
mgraftâŠ¢â§† Ï† âˆ…       = âˆ…
mgraftâŠ¢â§† Ï† (Î¾ , ğ’Ÿ) = mgraftâŠ¢â§† Ï† Î¾ , mgraftâŠ¢ Ï† ğ’Ÿ

mtransâŠ¢â§† : âˆ€ {Î” Î”â€² Î”â€³} â†’ Î”â€³ â âˆ… âŠ¢â§† Î”â€² â†’ Î”â€² â âˆ… âŠ¢â§† Î” â†’ Î”â€³ â âˆ… âŠ¢â§† Î”
mtransâŠ¢â§† = mgraftâŠ¢â§†


-- Normal forms.

mutual
  infix 3 _âŠ¢â¿á¶ _
  data _âŠ¢â¿á¶ _ : Cx â†’ Ty â†’ Set where
    lamâ¿á¶    : âˆ€ {Î” Î“ A B} â†’
                Î” â Î“ , A âŠ¢â¿á¶  B â†’
                Î” â Î“ âŠ¢â¿á¶  A â‡’ B
    boxâ¿á¶    : âˆ€ {Î” Î“ Î¨ A} â†’
                Î” â Î¨ âŠ¢ A â†’
                Î” â Î“ âŠ¢â¿á¶  [ Î¨ ] A
    neâ¿á¶     : âˆ€ {Î” Î“ A} â†’
                Î” â Î“ âŠ¢â¿áµ‰ A â†’
                Î” â Î“ âŠ¢â¿á¶  A

  infix 3 _âŠ¢â¿áµ‰_
  data _âŠ¢â¿áµ‰_ : Cx â†’ Ty â†’ Set where
    varâ¿áµ‰   : âˆ€ {Î” Î“ A} â†’
                Î“ âˆ‹ A â†’
                Î” â Î“ âŠ¢â¿áµ‰ A
    mvarâ¿áµ‰  : âˆ€ {Î” Î“ Î¨ A} â†’
                Î” â Î“ âŠ¢â‹† Î¨ â†’ Î” âˆ‹ [ Î¨ ] A â†’
                Î” â Î“ âŠ¢â¿áµ‰ A
    appâ¿áµ‰   : âˆ€ {Î” Î“ A B} â†’
                Î” â Î“ âŠ¢â¿áµ‰ A â‡’ B â†’ Î” â Î“ âŠ¢â¿á¶  A â†’
                Î” â Î“ âŠ¢â¿áµ‰ B
    unboxâ¿áµ‰ : âˆ€ {Î” Î“ Î¨ A C} â†’
                Î” â Î“ âŠ¢â¿áµ‰ [ Î¨ ] A â†’ Î” , [ Î¨ ] A â Î“ âŠ¢â¿á¶  C â†’
                Î” â Î“ âŠ¢â¿áµ‰ C

infix 3 _âŠ¢â‹†â¿áµ‰_
_âŠ¢â‹†â¿áµ‰_ : Cx â†’ Tyâ‹† â†’ Set
Î” â Î“ âŠ¢â‹†â¿áµ‰ Î = All (Î” â Î“ âŠ¢â¿áµ‰_) Î

mutual
  monoâŠ¢â¿á¶  : âˆ€ {Î” Î“ Î”â€² Î“â€² A} â†’ Î”â€² âŠ‡ Î” â†’ Î“â€² âŠ‡ Î“ â†’ Î” â Î“ âŠ¢â¿á¶  A â†’ Î”â€² â Î“â€² âŠ¢â¿á¶  A
  monoâŠ¢â¿á¶  Î¶ Î· (lamâ¿á¶  ğ’Ÿ)     = lamâ¿á¶  (monoâŠ¢â¿á¶  Î¶ (lift Î·) ğ’Ÿ)
  monoâŠ¢â¿á¶  Î¶ Î· (boxâ¿á¶  ğ’Ÿ)     = boxâ¿á¶  (monoâŠ¢ Î¶ reflâŠ‡ ğ’Ÿ)
  monoâŠ¢â¿á¶  Î¶ Î· (neâ¿á¶  ğ’Ÿ)      = neâ¿á¶  (monoâŠ¢â¿áµ‰ Î¶ Î· ğ’Ÿ)

  monoâŠ¢â¿áµ‰ : âˆ€ {Î” Î“ Î”â€² Î“â€² A} â†’ Î”â€² âŠ‡ Î” â†’ Î“â€² âŠ‡ Î“ â†’ Î” â Î“ âŠ¢â¿áµ‰ A â†’ Î”â€² â Î“â€² âŠ¢â¿áµ‰ A
  monoâŠ¢â¿áµ‰ Î¶ Î· (varâ¿áµ‰ ğ’¾)     = varâ¿áµ‰ (monoâˆ‹ Î· ğ’¾)
  monoâŠ¢â¿áµ‰ Î¶ Î· (mvarâ¿áµ‰ Ïˆ ğ’¾)  = mvarâ¿áµ‰ (monoâŠ¢â‹† Î¶ Î· Ïˆ) (monoâˆ‹ Î¶ ğ’¾)
  monoâŠ¢â¿áµ‰ Î¶ Î· (appâ¿áµ‰ ğ’Ÿ â„°)   = appâ¿áµ‰ (monoâŠ¢â¿áµ‰ Î¶ Î· ğ’Ÿ) (monoâŠ¢â¿á¶  Î¶ Î· â„°)
  monoâŠ¢â¿áµ‰ Î¶ Î· (unboxâ¿áµ‰ ğ’Ÿ â„°) = unboxâ¿áµ‰ (monoâŠ¢â¿áµ‰ Î¶ Î· ğ’Ÿ) (monoâŠ¢â¿á¶  (lift Î¶) Î· â„°)

monoâŠ¢â‹†â¿áµ‰ : âˆ€ {Î” Î“ Î”â€² Î“â€² Î} â†’ Î”â€² âŠ‡ Î” â†’ Î“â€² âŠ‡ Î“ â†’ Î” â Î“ âŠ¢â‹†â¿áµ‰ Î â†’ Î”â€² â Î“â€² âŠ¢â‹†â¿áµ‰ Î
monoâŠ¢â‹†â¿áµ‰ Î¶ Î· Î¾ = mapAll (monoâŠ¢â¿áµ‰ Î¶ Î·) Î¾

mutual
  idmonoâŠ¢â¿á¶  : âˆ€ {Î” Î“ A} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢â¿á¶  A) â†’ monoâŠ¢â¿á¶  reflâŠ‡ reflâŠ‡ ğ’Ÿ â‰¡ ğ’Ÿ
  idmonoâŠ¢â¿á¶  (lamâ¿á¶  ğ’Ÿ)     = cong lamâ¿á¶  (idmonoâŠ¢â¿á¶  ğ’Ÿ)
  idmonoâŠ¢â¿á¶  (boxâ¿á¶  ğ’Ÿ)     = cong boxâ¿á¶  (idmonoâŠ¢ ğ’Ÿ)
  idmonoâŠ¢â¿á¶  (neâ¿á¶  ğ’Ÿ)      = cong neâ¿á¶  (idmonoâŠ¢â¿áµ‰ ğ’Ÿ)

  idmonoâŠ¢â¿áµ‰ : âˆ€ {Î” Î“ A} â†’ (ğ’Ÿ : Î” â Î“ âŠ¢â¿áµ‰ A) â†’ monoâŠ¢â¿áµ‰ reflâŠ‡ reflâŠ‡ ğ’Ÿ â‰¡ ğ’Ÿ
  idmonoâŠ¢â¿áµ‰ (varâ¿áµ‰ ğ’¾)     = cong varâ¿áµ‰ (idmonoâˆ‹ ğ’¾)
  idmonoâŠ¢â¿áµ‰ (mvarâ¿áµ‰ Ïˆ ğ’¾)  = congÂ² mvarâ¿áµ‰ (idmonoâŠ¢â‹† Ïˆ) (idmonoâˆ‹ ğ’¾)
  idmonoâŠ¢â¿áµ‰ (appâ¿áµ‰ ğ’Ÿ â„°)   = congÂ² appâ¿áµ‰ (idmonoâŠ¢â¿áµ‰ ğ’Ÿ) (idmonoâŠ¢â¿á¶  â„°)
  idmonoâŠ¢â¿áµ‰ (unboxâ¿áµ‰ ğ’Ÿ â„°) = congÂ² unboxâ¿áµ‰ (idmonoâŠ¢â¿áµ‰ ğ’Ÿ) (idmonoâŠ¢â¿á¶  â„°)

mutual
  assocmonoâŠ¢â¿á¶  : âˆ€ {Î” Î“ Î”â€² Î“â€² Î“â€³ Î”â€³ A} â†’
                    (Î¶â€² : Î”â€³ âŠ‡ Î”â€²) (Î·â€² : Î“â€³ âŠ‡ Î“â€²) (Î¶ : Î”â€² âŠ‡ Î”) (Î· : Î“â€² âŠ‡ Î“) (ğ’Ÿ : Î” â Î“ âŠ¢â¿á¶  A) â†’
                    monoâŠ¢â¿á¶  Î¶â€² Î·â€² (monoâŠ¢â¿á¶  Î¶ Î· ğ’Ÿ) â‰¡ monoâŠ¢â¿á¶  (transâŠ‡ Î¶â€² Î¶) (transâŠ‡ Î·â€² Î·) ğ’Ÿ
  assocmonoâŠ¢â¿á¶  Î¶â€² Î·â€² Î¶ Î· (lamâ¿á¶  ğ’Ÿ)     = cong lamâ¿á¶  (assocmonoâŠ¢â¿á¶  Î¶â€² (lift Î·â€²) Î¶ (lift Î·) ğ’Ÿ)
  assocmonoâŠ¢â¿á¶  Î¶â€² Î·â€² Î¶ Î· (boxâ¿á¶  ğ’Ÿ)     = cong boxâ¿á¶  (assocmonoâŠ¢ Î¶â€² reflâŠ‡ Î¶ reflâŠ‡ ğ’Ÿ)
  assocmonoâŠ¢â¿á¶  Î¶â€² Î·â€² Î¶ Î· (neâ¿á¶  ğ’Ÿ)      = cong neâ¿á¶  (assocmonoâŠ¢â¿áµ‰ Î¶â€² Î·â€² Î¶ Î· ğ’Ÿ)

  assocmonoâŠ¢â¿áµ‰ : âˆ€ {Î” Î“ Î”â€² Î“â€² Î“â€³ Î”â€³ A} â†’
                    (Î¶â€² : Î”â€³ âŠ‡ Î”â€²) (Î·â€² : Î“â€³ âŠ‡ Î“â€²) (Î¶ : Î”â€² âŠ‡ Î”) (Î· : Î“â€² âŠ‡ Î“) (ğ’Ÿ : Î” â Î“ âŠ¢â¿áµ‰ A) â†’
                    monoâŠ¢â¿áµ‰ Î¶â€² Î·â€² (monoâŠ¢â¿áµ‰ Î¶ Î· ğ’Ÿ) â‰¡ monoâŠ¢â¿áµ‰ (transâŠ‡ Î¶â€² Î¶) (transâŠ‡ Î·â€² Î·) ğ’Ÿ
  assocmonoâŠ¢â¿áµ‰ Î¶â€² Î·â€² Î¶ Î· (varâ¿áµ‰ ğ’¾)     = cong varâ¿áµ‰ (assocmonoâˆ‹ Î·â€² Î· ğ’¾)
  assocmonoâŠ¢â¿áµ‰ Î¶â€² Î·â€² Î¶ Î· (mvarâ¿áµ‰ Ïˆ ğ’¾)  = congÂ² mvarâ¿áµ‰ (assocmonoâŠ¢â‹† Î¶â€² Î·â€² Î¶ Î· Ïˆ) (assocmonoâˆ‹ Î¶â€² Î¶ ğ’¾)
  assocmonoâŠ¢â¿áµ‰ Î¶â€² Î·â€² Î¶ Î· (appâ¿áµ‰ ğ’Ÿ â„°)   = congÂ² appâ¿áµ‰ (assocmonoâŠ¢â¿áµ‰ Î¶â€² Î·â€² Î¶ Î· ğ’Ÿ) (assocmonoâŠ¢â¿á¶  Î¶â€² Î·â€² Î¶ Î· â„°)
  assocmonoâŠ¢â¿áµ‰ Î¶â€² Î·â€² Î¶ Î· (unboxâ¿áµ‰ ğ’Ÿ â„°) = congÂ² unboxâ¿áµ‰ (assocmonoâŠ¢â¿áµ‰ Î¶â€² Î·â€² Î¶ Î· ğ’Ÿ) (assocmonoâŠ¢â¿á¶  (lift Î¶â€²) Î·â€² (lift Î¶) Î· â„°)

idmonoâŠ¢â‹†â¿áµ‰ : âˆ€ {Î” Î“ Î} â†’ (Î¾ : Î” â Î“ âŠ¢â‹†â¿áµ‰ Î) â†’ monoâŠ¢â‹†â¿áµ‰ reflâŠ‡ reflâŠ‡ Î¾ â‰¡ Î¾
idmonoâŠ¢â‹†â¿áµ‰ âˆ…       = refl
idmonoâŠ¢â‹†â¿áµ‰ (Î¾ , ğ’Ÿ) = congÂ² _,_ (idmonoâŠ¢â‹†â¿áµ‰ Î¾) (idmonoâŠ¢â¿áµ‰ ğ’Ÿ)

assocmonoâŠ¢â‹†â¿áµ‰ : âˆ€ {Î” Î“ Î”â€² Î“â€² Î“â€³ Î”â€³ Î} â†’
                   (Î¶â€² : Î”â€³ âŠ‡ Î”â€²) (Î·â€² : Î“â€³ âŠ‡ Î“â€²) (Î¶ : Î”â€² âŠ‡ Î”) (Î· : Î“â€² âŠ‡ Î“) (Î¾ : Î” â Î“ âŠ¢â‹†â¿áµ‰ Î) â†’
                   monoâŠ¢â‹†â¿áµ‰ Î¶â€² Î·â€² (monoâŠ¢â‹†â¿áµ‰ Î¶ Î· Î¾) â‰¡ monoâŠ¢â‹†â¿áµ‰ (transâŠ‡ Î¶â€² Î¶) (transâŠ‡ Î·â€² Î·) Î¾
assocmonoâŠ¢â‹†â¿áµ‰ Î¶â€² Î·â€² Î¶ Î· âˆ…       = refl
assocmonoâŠ¢â‹†â¿áµ‰ Î¶â€² Î·â€² Î¶ Î· (Î¾ , ğ’Ÿ) = congÂ² _,_ (assocmonoâŠ¢â‹†â¿áµ‰ Î¶â€² Î·â€² Î¶ Î· Î¾) (assocmonoâŠ¢â¿áµ‰ Î¶â€² Î·â€² Î¶ Î· ğ’Ÿ)


-- Example derivations.

vâ‚€ : âˆ€ {Î” Î“ A} â†’
       Î” â Î“ , A âŠ¢ A
vâ‚€ = var zero

vâ‚ : âˆ€ {Î” Î“ A B} â†’
       Î” â Î“ , A , B âŠ¢ A
vâ‚ = var (suc zero)

vâ‚‚ : âˆ€ {Î” Î“ A B C} â†’
       Î” â Î“ , A , B , C âŠ¢ A
vâ‚‚ = var (suc (suc zero))

mvâ‚€ : âˆ€ {Î” Î“ Î¨ A} â†’
        Î” , [ Î¨ ] A â Î“ âŠ¢â‹† Î¨ â†’
        Î” , [ Î¨ ] A â Î“ âŠ¢ A
mvâ‚€ Ïˆ = mvar Ïˆ zero

mvâ‚ : âˆ€ {Î” Î“ Î¨ Î¨â€² A B} â†’
        Î” , [ Î¨ ] A , [ Î¨â€² ] B â Î“ âŠ¢â‹† Î¨ â†’
        Î” , [ Î¨ ] A , [ Î¨â€² ] B â Î“ âŠ¢ A
mvâ‚ Ïˆ = mvar Ïˆ (suc zero)

mvâ‚‚ : âˆ€ {Î” Î“ Î¨ Î¨â€² Î¨â€³ A B C} â†’
        Î” , [ Î¨ ] A , [ Î¨â€² ] B , [ Î¨â€³ ] C â Î“ âŠ¢â‹† Î¨ â†’
        Î” , [ Î¨ ] A , [ Î¨â€² ] B , [ Î¨â€³ ] C â Î“ âŠ¢ A
mvâ‚‚ Ïˆ = mvar Ïˆ (suc (suc zero))

iá¶œ : âˆ€ {Î” Î“ A} â†’
       Î” â Î“ âŠ¢ A â‡’ A
iá¶œ = lam vâ‚€

ká¶œ : âˆ€ {Î” Î“ A B} â†’
       Î” â Î“ âŠ¢ A â‡’ B â‡’ A
ká¶œ = lam (lam vâ‚)

sá¶œ : âˆ€ {Î” Î“ A B C} â†’
       Î” â Î“ âŠ¢ (A â‡’ B â‡’ C) â‡’ (A â‡’ B) â‡’ A â‡’ C
sá¶œ = lam (lam (lam
       (app (app vâ‚‚ vâ‚€) (app vâ‚ vâ‚€))))

cá¶œ : âˆ€ {Î” Î“ A B C} â†’
       Î” â Î“ âŠ¢ (A â‡’ B â‡’ C) â‡’ B â‡’ A â‡’ C
cá¶œ = lam (lam (lam
       (app (app vâ‚‚ vâ‚€) vâ‚)))

bá¶œ : âˆ€ {Î” Î“ A B C} â†’
       Î” â Î“ âŠ¢ (B â‡’ C) â‡’ (A â‡’ B) â‡’ A â‡’ C
bá¶œ = lam (lam (lam
       (app vâ‚‚ (app vâ‚ vâ‚€))))

aá¶œ : âˆ€ {Î” Î“ A B} â†’
       Î” â Î“ âŠ¢ (A â‡’ A â‡’ B) â‡’ A â‡’ B
aá¶œ = lam (lam
       (app (app vâ‚ vâ‚€) vâ‚€))

gendá¶œ : âˆ€ {Î” Î“ Î¨ Î¨â€² A B} â†’
          Î” â Î¨ âŠ¢â‹† Î¨â€² â†’
          Î” â Î“ âŠ¢ [ Î¨â€² ] (A â‡’ B) â‡’ [ Î¨â€² ] A â‡’
                   [ Î¨ ] B
gendá¶œ Ïˆ = lam (lam (unbox vâ‚ (unbox vâ‚€
              (box (app (mvâ‚ (monoâŠ¢â‹† (weak (weak reflâŠ‡)) reflâŠ‡ Ïˆ))
                        (mvâ‚€ (monoâŠ¢â‹† (weak (weak reflâŠ‡)) reflâŠ‡ Ïˆ)))))))

gen4á¶œ : âˆ€ {Î” Î“ Î¨ Î¨â€² Î¨â€³ A} â†’
          Î” â Î¨ âŠ¢â‹† Î¨â€² â†’
          Î” â Î“ âŠ¢ [ Î¨â€² ] A â‡’
                   [ Î¨â€³ ] [ Î¨ ] A
gen4á¶œ Ïˆ = lam (unbox vâ‚€
            (box (box (mvâ‚€ (monoâŠ¢â‹† (weak reflâŠ‡) reflâŠ‡ Ïˆ)))))

gentá¶œ : âˆ€ {Î” Î“ Î¨ A} â†’
          Î” â Î“ âŠ¢â‹† Î¨ â†’
          Î” â Î“ âŠ¢ [ Î¨ ] A â‡’ A
gentá¶œ Ïˆ = lam (unbox vâ‚€
            (mvâ‚€ (monoâŠ¢â‹† (weak reflâŠ‡) (weak reflâŠ‡) Ïˆ)))

dá¶œ : âˆ€ {Î” Î“ A B} â†’
       Î” â Î“ âŠ¢ [ âˆ… ] (A â‡’ B) â‡’ [ âˆ… ] A â‡’
                [ âˆ… ] B
dá¶œ = gendá¶œ âˆ…

4á¶œ : âˆ€ {Î” Î“ A} â†’
       Î” â Î“ âŠ¢ [ âˆ… ] A â‡’
                [ âˆ… ] [ âˆ… ] A
4á¶œ = gen4á¶œ âˆ…

tá¶œ : âˆ€ {Î” Î“ A} â†’
       Î” â Î“ âŠ¢ [ âˆ… ] A â‡’ A
tá¶œ = gentá¶œ âˆ…


-- Example inference rules on derivations.

exch : âˆ€ {Î” Î“ A B C} â†’
         Î” â Î“ âŠ¢ A â‡’ B â‡’ C â†’
         Î” â Î“ âŠ¢ B â‡’ A â‡’ C
exch ğ’Ÿ = app cá¶œ ğ’Ÿ

comp : âˆ€ {Î” Î“ A B C} â†’
         Î” â Î“ âŠ¢ B â‡’ C â†’ Î” â Î“ âŠ¢ A â‡’ B â†’
         Î” â Î“ âŠ¢ A â‡’ C
comp ğ’Ÿ â„° = app (app bá¶œ ğ’Ÿ) â„°

cont : âˆ€ {Î” Î“ A B} â†’
         Î” â Î“ âŠ¢ A â‡’ A â‡’ B â†’
         Î” â Î“ âŠ¢ A â‡’ B
cont ğ’Ÿ = app aá¶œ ğ’Ÿ

det : âˆ€ {Î” Î“ A B} â†’
        Î” â Î“ âŠ¢ A â‡’ B â†’
        Î” â Î“ , A âŠ¢ B
det ğ’Ÿ = app (monoâŠ¢ reflâŠ‡ (weak reflâŠ‡) ğ’Ÿ) vâ‚€

mdet : âˆ€ {Î” Î“ Î¨ A B} â†’
         Î” â Î“ âŠ¢ [ Î¨ ] A â‡’ B â†’
         Î” , [ Î¨ ] A â Î“ âŠ¢ B
mdet ğ’Ÿ = app (monoâŠ¢ (weak reflâŠ‡) reflâŠ‡ ğ’Ÿ) (box (mvâ‚€ reflâŠ¢â‹†))

dist : âˆ€ {Î” Î“ A B} â†’
         Î” â Î“ âŠ¢ [ âˆ… ] (A â‡’ B) â†’ Î” â Î“ âŠ¢ [ âˆ… ] A â†’
         Î” â Î“ âŠ¢ [ âˆ… ] B
dist ğ’Ÿ â„° = app (app dá¶œ ğ’Ÿ) â„°

wrap : âˆ€ {Î” Î“ A} â†’
         Î” â Î“ âŠ¢ [ âˆ… ] A â†’
         Î” â Î“ âŠ¢ [ âˆ… ] [ âˆ… ] A
wrap ğ’Ÿ = app 4á¶œ ğ’Ÿ

eval : âˆ€ {Î” Î“ A} â†’
         Î” â Î“ âŠ¢ [ âˆ… ] A â†’
         Î” â Î“ âŠ¢ A
eval ğ’Ÿ = app tá¶œ ğ’Ÿ


-- Additional example derivations.

module NanevskiPfenningPientka2007 where
  eâ‚ : âˆ€ {Î” Î“ A C D} â†’
         Î” â Î“ âŠ¢ [ âˆ… , C ] A â‡’
                  [ âˆ… , C , D ] A
  eâ‚ = lam (unbox vâ‚€
         (box (mvâ‚€ (âˆ… , vâ‚))))

  eâ‚‚ : âˆ€ {Î” Î“ A C} â†’
         Î” â Î“ âŠ¢ [ âˆ… , C , C ] A â‡’
                  [ âˆ… , C ] A
  eâ‚‚ = lam (unbox vâ‚€
         (box (mvâ‚€ (âˆ… , vâ‚€ , vâ‚€))))

  eâ‚ƒ : âˆ€ {Î” Î“ A} â†’
         Î” â Î“ âŠ¢ [ âˆ… , A ] A
  eâ‚ƒ = box vâ‚€

  eâ‚„ : âˆ€ {Î” Î“ A B C} â†’
         Î” â Î“ âŠ¢ [ âˆ… , A ] B â‡’
                  [ âˆ… , A ] [ âˆ… , B ] C â‡’
                  [ âˆ… , A ] C
  eâ‚„ = lam (lam (unbox vâ‚ (unbox vâ‚€
         (box (unbox
           (mvâ‚€ (âˆ… , vâ‚€)) (mvâ‚€ (âˆ… , mvâ‚‚ (âˆ… , vâ‚€))))))))

  eâ‚… : âˆ€ {Î” Î“ A} â†’
         Î” â Î“ âŠ¢ [ âˆ… ] A â‡’ A
  eâ‚… = lam (unbox vâ‚€ (mvâ‚€ âˆ…))

  eâ‚† : âˆ€ {Î” Î“ A C D} â†’
         Î” â Î“ âŠ¢ [ âˆ… , C ] A â‡’
                  [ âˆ… , D ] [ âˆ… , C ] A
  eâ‚† = lam (unbox vâ‚€
         (box (box (mvâ‚€ (âˆ… , vâ‚€)))))

  eâ‚‡ : âˆ€ {Î” Î“ A B C D} â†’
         Î” â Î“ âŠ¢ [ âˆ… , C ] (A â‡’ B) â‡’
                  [ âˆ… , D ] A â‡’
                  [ âˆ… , C , D ] B
  eâ‚‡ = lam (lam (unbox vâ‚ (unbox vâ‚€
         (box (app (mvâ‚ (âˆ… , vâ‚)) (mvâ‚€ (âˆ… , vâ‚€)))))))

  eâ‚ˆ : âˆ€ {Î” Î“ A B C} â†’
         Î” â Î“ âŠ¢ [ âˆ… , A ] (A â‡’ B) â‡’
                  [ âˆ… , B ] C â‡’
                  [ âˆ… , A ] C
  eâ‚ˆ = lam (lam (unbox vâ‚ (unbox vâ‚€
         (box (mvâ‚€ (âˆ… , app (mvâ‚ (âˆ… , vâ‚€)) vâ‚€))))))
