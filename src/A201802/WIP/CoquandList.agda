{-# OPTIONS --rewriting #-}

module A201802.WIP.CoquandList where

open import A201801.Prelude
open import A201801.Category

open import A201802.WIP.Bool
open import A201802.WIP.Name


--------------------------------------------------------------------------------


infix 6 _,_â¦‚_
mutual
  data List (ğ”„ : Set) : Set
    where
      âˆ™ : List ğ”„

      _,_â¦‚_ : (Î : List ğ”„) (x : Name) â†’ ğ”„ â†’ {{_ : T (fresh x Î)}}
                                      â†’ List ğ”„

  fresh : âˆ€ {ğ”„} â†’ Name â†’ List ğ”„ â†’ Bool
  fresh x âˆ™           = true
  fresh x (Î , y â¦‚ A) = and (x â‰  y) (fresh x Î)


--------------------------------------------------------------------------------


infix 4 _âˆ‹_â¦‚_
data _âˆ‹_â¦‚_ {ğ”„} : List ğ”„ â†’ Name â†’ ğ”„ â†’ Set
  where
    zero : âˆ€ {Î A x} â†’ {{_ : T (fresh x Î)}}
                     â†’ Î , x â¦‚ A âˆ‹ x â¦‚ A

    suc : âˆ€ {Î A B x y} â†’ {{_ : T (fresh y Î)}}
                        â†’ Î âˆ‹ x â¦‚ A
                        â†’ Î , y â¦‚ B âˆ‹ x â¦‚ A


notâˆ‹ : âˆ€ {ğ”„ A x} â†’ {Î : List ğ”„} {{_ : T (fresh x Î)}}
                 â†’ Â¬ (Î âˆ‹ x â¦‚ A)
notâˆ‹ {x = x} {{Ï†}}  zero             with x â‰Ÿ x
notâˆ‹ {x = x} {{()}} zero             | yes refl
notâˆ‹ {x = x} {{Ï†}}  zero             | no xâ‰¢x   = refl â†¯ xâ‰¢x
notâˆ‹ {x = x} {{Ï†}}  (suc {y = y}  i) with x â‰Ÿ y
notâˆ‹ {x = x} {{()}} (suc {y = .x} i) | yes refl
notâˆ‹ {x = x} {{Ï†}}  (suc {y = y}  i) | no xâ‰¢y   = i â†¯ notâˆ‹


uniqâˆ‹ : âˆ€ {ğ”„ A x} â†’ {Î : List ğ”„} (i j : Î âˆ‹ x â¦‚ A)
                  â†’ i â‰¡ j
uniqâˆ‹ zero    zero    = refl
uniqâˆ‹ zero    (suc j) = j â†¯ notâˆ‹
uniqâˆ‹ (suc i) zero    = i â†¯ notâˆ‹
uniqâˆ‹ (suc i) (suc j) = suc & uniqâˆ‹ i j


--------------------------------------------------------------------------------


infix 4 _âŠ‡_
data _âŠ‡_ {ğ”„} : List ğ”„ â†’ List ğ”„ â†’ Set
  where
    done : âˆ€ {Î} â†’ Î âŠ‡ âˆ™

    step : âˆ€ {Î Îâ€² A x} â†’ {{_ : T (fresh x Î)}}
                        â†’ Îâ€² âŠ‡ Î â†’ Îâ€² âˆ‹ x â¦‚ A
                        â†’ Îâ€² âŠ‡ Î , x â¦‚ A


putâŠ‡ : âˆ€ {ğ”„} â†’ {Î Îâ€² : List ğ”„}
             â†’ (âˆ€ {A x} â†’ Î âˆ‹ x â¦‚ A â†’ Îâ€² âˆ‹ x â¦‚ A)
             â†’ Îâ€² âŠ‡ Î
putâŠ‡ {Î = âˆ™}         f = done
putâŠ‡ {Î = Î , x â¦‚ A} f = step (putâŠ‡ (f âˆ˜ suc)) (f zero)


getâŠ‡ : âˆ€ {ğ”„ A x} â†’ {Î Îâ€² : List ğ”„}
                 â†’ Îâ€² âŠ‡ Î â†’ Î âˆ‹ x â¦‚ A
                 â†’ Îâ€² âˆ‹ x â¦‚ A
getâŠ‡ (step Î· i) zero    = i
getâŠ‡ (step Î· i) (suc j) = getâŠ‡ Î· j


uniqâŠ‡ : âˆ€ {ğ”„} â†’ {Î Îâ€² : List ğ”„}
              â†’ (Î·â‚ Î·â‚‚ : Îâ€² âŠ‡ Î)
              â†’ Î·â‚ â‰¡ Î·â‚‚
uniqâŠ‡ done       done        = refl
uniqâŠ‡ (step c i) (step câ€² j) = step & uniqâŠ‡ c câ€² âŠ— uniqâˆ‹ i j


dropâŠ‡ : âˆ€ {ğ”„ A x} â†’ {Î Îâ€² : List ğ”„} {{_ : T (fresh x Îâ€²)}}
                  â†’ Îâ€² âŠ‡ Î
                  â†’ Îâ€² , x â¦‚ A âŠ‡ Î
dropâŠ‡ done       = done
dropâŠ‡ (step Î· i) = step (dropâŠ‡ Î·) (suc i)


keepâŠ‡ : âˆ€ {ğ”„ A x} â†’ {Î Îâ€² : List ğ”„} {{_ : T (fresh x Îâ€²)}} {{_ : T (fresh x Î)}}
                  â†’ Îâ€² âŠ‡ Î
                  â†’ Îâ€² , x â¦‚ A âŠ‡ Î , x â¦‚ A
keepâŠ‡ Î· = step (dropâŠ‡ Î·) zero


idâŠ‡ : âˆ€ {ğ”„} â†’ {Î : List ğ”„}
            â†’ Î âŠ‡ Î
idâŠ‡ = putâŠ‡ id


_âˆ˜âŠ‡_ : âˆ€ {ğ”„} â†’ {Î Îâ€² Îâ€³ : List ğ”„}
             â†’ Îâ€² âŠ‡ Î â†’ Îâ€³ âŠ‡ Îâ€²
             â†’ Îâ€³ âŠ‡ Î
Î·â‚ âˆ˜âŠ‡ Î·â‚‚ = putâŠ‡ (getâŠ‡ Î·â‚‚ âˆ˜ getâŠ‡ Î·â‚)


--------------------------------------------------------------------------------


lidâˆ˜âŠ‡ : âˆ€ {X} â†’ {Î Îâ€² : List X}
              â†’ (Î· : Îâ€² âŠ‡ Î)
              â†’ idâŠ‡ âˆ˜âŠ‡ Î· â‰¡ Î·
lidâˆ˜âŠ‡ Î· = uniqâŠ‡ (idâŠ‡ âˆ˜âŠ‡ Î·) Î·


ridâˆ˜âŠ‡ : âˆ€ {X} â†’ {Î Îâ€² : List X}
              â†’ (Î· : Îâ€² âŠ‡ Î)
              â†’ Î· âˆ˜âŠ‡ idâŠ‡ â‰¡ Î·
ridâˆ˜âŠ‡ Î· = uniqâŠ‡ (Î· âˆ˜âŠ‡ idâŠ‡) Î·

assocâˆ˜âŠ‡ : âˆ€ {X} â†’ {Î Îâ€² Îâ€³ Îâ€´ : List X}
                â†’ (Î·â‚ : Îâ€² âŠ‡ Î) (Î·â‚‚ : Îâ€³ âŠ‡ Îâ€²) (Î·â‚ƒ : Îâ€´ âŠ‡ Îâ€³)
                â†’ (Î·â‚ âˆ˜âŠ‡ Î·â‚‚) âˆ˜âŠ‡ Î·â‚ƒ â‰¡ Î·â‚ âˆ˜âŠ‡ (Î·â‚‚ âˆ˜âŠ‡ Î·â‚ƒ)
assocâˆ˜âŠ‡ Î·â‚ Î·â‚‚ Î·â‚ƒ = uniqâŠ‡ ((Î·â‚ âˆ˜âŠ‡ Î·â‚‚) âˆ˜âŠ‡ Î·â‚ƒ) (Î·â‚ âˆ˜âŠ‡ (Î·â‚‚ âˆ˜âŠ‡ Î·â‚ƒ))


instance
  ğ‘ğğ§ : âˆ€ {ğ”„} â†’ Category (List ğ”„) _âŠ‡_
  ğ‘ğğ§ = record
          { id     = idâŠ‡
          ; _âˆ˜_    = _âˆ˜âŠ‡_
          ; lidâˆ˜   = lidâˆ˜âŠ‡
          ; ridâˆ˜   = ridâˆ˜âŠ‡
          ; assocâˆ˜ = assocâˆ˜âŠ‡
          }


--------------------------------------------------------------------------------


data All {ğ”„} (ğ”“ : ğ”„ â†’ Set) : List ğ”„ â†’ Set
  where
    âˆ™ : All ğ”“ âˆ™

    _,_ : âˆ€ {Î A x} â†’ All ğ”“ Î â†’ ğ”“ A â†’ {{_ : T (fresh x Î)}}
                    â†’ All ğ”“ (Î , x â¦‚ A)


get : âˆ€ {ğ”„ ğ”“ A x} â†’ {Î : List ğ”„}
                  â†’ All ğ”“ Î â†’ Î âˆ‹ x â¦‚ A
                  â†’ ğ”“ A
get (Î¾ , a) zero    = a
get (Î¾ , b) (suc i) = get Î¾ i


maps : âˆ€ {ğ”„ ğ”“ ğ””} â†’ {Î : List ğ”„}
                 â†’ (âˆ€ {A} â†’ ğ”“ A â†’ ğ”” A) â†’ All ğ”“ Î
                 â†’ All ğ”” Î
maps ğ”£ âˆ™       = âˆ™
maps ğ”£ (Î¾ , a) = maps ğ”£ Î¾ , ğ”£ a


--------------------------------------------------------------------------------
