{-# OPTIONS --allow-unsolved-metas #-}

module A201602.Try3 where

open import Data.Fin using (Fin; zero; suc; toâ„•)
open import Data.Nat using (â„•; zero; suc; _+_)
open import Data.Product using (Î£; _Ã—_; _,_)


data Vec (X : Set) : â„• â†’ Set where
  âˆ…   : Vec X zero
  _,_ : âˆ€{n} â†’ Vec X n â†’ X â†’ Vec X (suc n)

data _âˆˆ_ {X : Set} : âˆ€{n} â†’ X â†’ Vec X n â†’ Set where
  Z  : âˆ€{n x} {xs : Vec X n}
     â†’ x âˆˆ (xs , x)
  S_ : âˆ€{n x y} {xs : Vec X n}
     â†’ x âˆˆ xs
     â†’ x âˆˆ (xs , y)


infixl 4 _âˆ˜_ _âˆ˜Â²_ _âˆ˜Â³_
infixr 3 ğœ†_ ğœ†Â²_ ğœ†Â³_
infixl 2 _âˆ§_
infixr 1 _âŠƒ_
infixr 0 _âŠ¢_ _âŠ¢_âˆ·_ _âŠ¢_âˆ·_âˆ·_
infixr 0 âŠ©_ âŠ©_âˆ·_ âŠ©_âˆ·_âˆ·_
infixr 0 _FâŠ©_ _FâŠ©_âˆ·_ _FâŠ©_âˆ·_âˆ·_


Var : Set
Var = â„•

FCx : â„• â†’ Set
FCx = Vec Var


data Ty {k : â„•} (Î¦ : FCx k) : Set where
  fv_ : âˆ€{x} â†’ x âˆˆ Î¦ â†’ Ty Î¦
  _âŠƒ_ : Ty Î¦ â†’ Ty Î¦ â†’ Ty Î¦
  _âˆ§_ : Ty Î¦ â†’ Ty Î¦ â†’ Ty Î¦


Cx : {k : â„•} {Î¦ : FCx k} â†’ â„• â†’ Set
Cx {Î¦ = Î¦} n = Vec (Ty Î¦) n


data _âŠ¢_ {k n : â„•} {Î¦ : FCx k} (Î“ : Cx n) : Ty Î¦ â†’ Set where
  ğ‘£_     : âˆ€{A}
         â†’ A âˆˆ Î“
         â†’ Î“ âŠ¢ A
  ğœ†_     : âˆ€{A B}
         â†’ Î“ , A âŠ¢ B
         â†’ Î“ âŠ¢ A âŠƒ B
  _âˆ˜_    : âˆ€{A B}
         â†’ Î“ âŠ¢ A âŠƒ B    â†’ Î“ âŠ¢ A
         â†’ Î“ âŠ¢ B
  ğ‘âŸ¨_,_âŸ© : âˆ€{A B}
         â†’ Î“ âŠ¢ A        â†’ Î“ âŠ¢ B
         â†’ Î“ âŠ¢ A âˆ§ B
  ğœ‹â‚€_    : âˆ€{A B}
         â†’ Î“ âŠ¢ A âˆ§ B
         â†’ Î“ âŠ¢ A
  ğœ‹â‚_    : âˆ€{A B}
         â†’ Î“ âŠ¢ A âˆ§ B
         â†’ Î“ âŠ¢ B


âŠ©_ : Ty âˆ… â†’ Set
âŠ© A = âˆ€{n} {Î“ : Cx n} â†’ Î“ âŠ¢ A

_FâŠ©_ : âˆ€{k} (Î¦ : FCx k) â†’ Ty Î¦ â†’ Set
Î¦ FâŠ© A = âˆ€{n} {Î“ : Cx n} â†’ Î“ âŠ¢ A


tI : âˆ€{A} â†’ âŠ© A âŠƒ A
tI = ğœ† ğ‘£ Z

tK : âˆ€{A B} â†’ âŠ© A âŠƒ B âŠƒ A
tK = ğœ† ğœ† ğ‘£ S Z

tS : âˆ€{A B C} â†’ âŠ© (A âŠƒ B âŠƒ C) âŠƒ (A âŠƒ B) âŠƒ A âŠƒ C
tS = ğœ† ğœ† ğœ† (ğ‘£ S S Z âˆ˜ ğ‘£ Z) âˆ˜ (ğ‘£ S Z âˆ˜ ğ‘£ Z)

tJ : âˆ€{A} â†’ âˆ… , A FâŠ© fv Z âŠƒ fv Z
tJ = ğœ† ğ‘£ Z



data _âŠ¢_âˆ·_ {k n : â„•} {Î¦ : FCx k} (Î“ : Cx n) : (A : Ty Î¦) â†’ Î“ âŠ¢ A â†’ Set where
  ğ‘£Â²_     : âˆ€{A}
          â†’ (x : A âˆˆ Î“)
          â†’ Î“ âŠ¢ A âˆ· ğ‘£ x
  ğœ†Â²_     : âˆ€{A B t}
          â†’ Î“ , A âŠ¢ B âˆ· t
          â†’ Î“ âŠ¢ A âŠƒ B âˆ· ğœ† t
  _âˆ˜Â²_    : âˆ€{A B t s}
          â†’ Î“ âŠ¢ A âŠƒ B âˆ· t    â†’ Î“ âŠ¢ A âˆ· s
          â†’ Î“ âŠ¢ B âˆ· t âˆ˜ s
  ğ‘Â²âŸ¨_,_âŸ© : âˆ€{A B t s}
          â†’ Î“ âŠ¢ A âˆ· t        â†’ Î“ âŠ¢ B âˆ· s
          â†’ Î“ âŠ¢ A âˆ§ B âˆ· ğ‘âŸ¨ t , s âŸ©
  ğœ‹â‚€Â²_    : âˆ€{A B t}
          â†’ Î“ âŠ¢ A âˆ§ B âˆ· t
          â†’ Î“ âŠ¢ A âˆ· ğœ‹â‚€ t
  ğœ‹â‚Â²_    : âˆ€{A B t}
          â†’ Î“ âŠ¢ A âˆ§ B âˆ· t
          â†’ Î“ âŠ¢ B âˆ· ğœ‹â‚ t
  !_      : âˆ€{A t}
          â†’ Î“ âŠ¢ A âˆ· t
          â†’ Î“ âŠ¢ A âˆ· t


âŠ©_âˆ·_ : (A : Ty âˆ…) â†’ âŠ© A â†’ Set
âŠ© A âˆ· t = âˆ€{n} {Î“ : Cx n} â†’ Î“ âŠ¢ A âˆ· t

_FâŠ©_âˆ·_ : âˆ€{k} (Î¦ : FCx k) (A : Ty Î¦) â†’ Î¦ FâŠ© A â†’ Set
Î¦ FâŠ© A âˆ· t = âˆ€{n} {Î“ : Cx n} â†’ Î“ âŠ¢ A âˆ· t


tIÂ² : âˆ€{A} â†’ âŠ© A âŠƒ A
    âˆ· ğœ† ğ‘£ Z
tIÂ² = ğœ†Â² (ğ‘£Â² Z)

tKÂ² : âˆ€{A B} â†’ âŠ© A âŠƒ B âŠƒ A
    âˆ· ğœ† ğœ† ğ‘£ S Z
tKÂ² = ğœ†Â² ğœ†Â² ğ‘£Â² S Z

tSÂ² : âˆ€{A B C} â†’ âŠ© (A âŠƒ B âŠƒ C) âŠƒ (A âŠƒ B) âŠƒ A âŠƒ C
    âˆ· ğœ† ğœ† ğœ† (ğ‘£ S S Z âˆ˜ ğ‘£ Z) âˆ˜ (ğ‘£ S Z âˆ˜ ğ‘£ Z)
tSÂ² = ğœ†Â² ğœ†Â² ğœ†Â² (ğ‘£Â² S S Z âˆ˜Â² ğ‘£Â² Z) âˆ˜Â² (ğ‘£Â² S Z âˆ˜Â² ğ‘£Â² Z)


data _âŠ¢_âˆ·_âˆ·_ {k n : â„•} {Î¦ : FCx k} (Î“ : Cx n) : (A : Ty Î¦) â†’ (t : Î“ âŠ¢ A) â†’ Î“ âŠ¢ A âˆ· t â†’ Set where
  ğ‘£Â³_     : âˆ€{A}
          â†’ (x : A âˆˆ Î“)
          â†’ Î“ âŠ¢ A âˆ· ğ‘£ x âˆ· ğ‘£Â² x
  ğœ†Â³_     : âˆ€{A B t tâ‚‚}
          â†’ Î“ , A âŠ¢ B âˆ· t âˆ· tâ‚‚
          â†’ Î“ âŠ¢ A âŠƒ B âˆ· ğœ† t âˆ· ğœ†Â² tâ‚‚
  _âˆ˜Â³_    : âˆ€{A B t tâ‚‚ s sâ‚‚}
          â†’ Î“ âŠ¢ A âŠƒ B âˆ· t âˆ· tâ‚‚   â†’ Î“ âŠ¢ A âˆ· s âˆ· sâ‚‚
          â†’ Î“ âŠ¢ B âˆ· t âˆ˜ s âˆ· tâ‚‚ âˆ˜Â² sâ‚‚
  ğ‘Â³âŸ¨_,_âŸ© : âˆ€{A B t tâ‚‚ s sâ‚‚}
          â†’ Î“ âŠ¢ A âˆ· t âˆ· tâ‚‚       â†’ Î“ âŠ¢ B âˆ· s âˆ· sâ‚‚
          â†’ Î“ âŠ¢ A âˆ§ B âˆ· ğ‘âŸ¨ t , s âŸ© âˆ· ğ‘Â²âŸ¨ tâ‚‚ , sâ‚‚ âŸ©
  ğœ‹â‚€Â³_    : âˆ€{A B t tâ‚‚}
          â†’ Î“ âŠ¢ A âˆ§ B âˆ· t âˆ· tâ‚‚
          â†’ Î“ âŠ¢ A âˆ· ğœ‹â‚€ t âˆ· ğœ‹â‚€Â² tâ‚‚
  ğœ‹â‚Â³_    : âˆ€{A B t tâ‚‚}
          â†’ Î“ âŠ¢ A âˆ§ B âˆ· t âˆ· tâ‚‚
          â†’ Î“ âŠ¢ B âˆ· ğœ‹â‚ t âˆ· ğœ‹â‚Â² tâ‚‚
  !_      : âˆ€{A t tâ‚‚}
          â†’ Î“ âŠ¢ A âˆ· t âˆ· tâ‚‚
          â†’ Î“ âŠ¢ A âˆ· t âˆ· tâ‚‚

â‡‘_ : âˆ€{k n} {Î¦ : FCx k} {Î“ : Cx n} {A : Ty Î¦} {u : Î“ âŠ¢ A}
   â†’ (x : Î“ âŠ¢ A âˆ· u)
   â†’ Î“ âŠ¢ A âˆ· u âˆ· (! x)
â‡‘_ = {!!}

â‡“_ : âˆ€{k n} {Î¦ : FCx k} {Î“ : Cx n} {A : Ty Î¦} {u : Î“ âŠ¢ A}
   â†’ Î“ âŠ¢ A âˆ· u
   â†’ Î“ âŠ¢ A
â‡“_ {u = u} = Î» _ â†’ u

âŠ©_âˆ·_âˆ·_ : (A : Ty âˆ…) â†’ (t : âŠ© A) â†’ âŠ© A âˆ· t â†’ Set
âŠ© A âˆ· t âˆ· tâ‚‚ = âˆ€{n} {Î“ : Cx n} â†’ Î“ âŠ¢ A âˆ· t âˆ· tâ‚‚

_FâŠ©_âˆ·_âˆ·_ : âˆ€{k} (Î¦ : FCx k) (A : Ty Î¦) â†’ (t : Î¦ FâŠ© A) â†’ Î¦ FâŠ© A âˆ· t â†’ Set
Î¦ FâŠ© A âˆ· t âˆ· tâ‚‚ = âˆ€{n} {Î“ : Cx n} â†’ Î“ âŠ¢ A âˆ· t âˆ· tâ‚‚


tIÂ³ : âˆ€{A} â†’ âŠ© A âŠƒ A
    âˆ· ğœ† ğ‘£ Z
    âˆ· ğœ†Â² ğ‘£Â² Z
tIÂ³ = ğœ†Â³ ğ‘£Â³ Z

tKÂ³ : âˆ€{A B} â†’ âŠ© A âŠƒ B âŠƒ A
    âˆ· ğœ† ğœ† ğ‘£ S Z
    âˆ· ğœ†Â² ğœ†Â² ğ‘£Â² S Z
tKÂ³ = ğœ†Â³ ğœ†Â³ ğ‘£Â³ S Z

tSÂ³ : âˆ€{A B C} â†’ âŠ© (A âŠƒ B âŠƒ C) âŠƒ (A âŠƒ B) âŠƒ A âŠƒ C
    âˆ· ğœ† ğœ† ğœ† (ğ‘£ S S Z âˆ˜ ğ‘£ Z) âˆ˜ (ğ‘£ S Z âˆ˜ ğ‘£ Z)
    âˆ· ğœ†Â² ğœ†Â² ğœ†Â² (ğ‘£Â² S S Z âˆ˜Â² ğ‘£Â² Z) âˆ˜Â² (ğ‘£Â² S Z âˆ˜Â² ğ‘£Â² Z)
tSÂ³ = ğœ†Â³ ğœ†Â³ ğœ†Â³ (ğ‘£Â³ S S Z âˆ˜Â³ ğ‘£Â³ Z) âˆ˜Â³ (ğ‘£Â³ S Z âˆ˜Â³ ğ‘£Â³ Z)
