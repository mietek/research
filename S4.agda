{-

An implementation of the Pfenning-Davies reconstruction of S4
=============================================================

MiÃ«tek Bak  <mietek@bak.io>


Work in progress.  Checked with Agda 2.4.2.5.

For easy editing with Emacs agda-mode, add to your .emacs file:

'(agda-input-user-translations
   (quote
    (("i" "âŠƒ") ("ii" "â«—") ("e" "âŠ¢") ("ee" "âŠ©") ("n" "Â¬")
     ("b" "â–¡")
     ("mv" "ğ’—") ("ml" "ğ€")
     ("mo" "âˆ™")
     ("mp" "ğ’‘")
     ("mpi" "ğ…")
     ("mpi0" "ğ…â‚€")
     ("mpi1" "ğ…â‚")
     ("mb" "â– ") ("m*" "â˜…")
     ("mS" "ğ’") ("mZ" "ğ™")
     ("m0" "ğŸ") ("m1" "ğŸ") ("m2" "ğŸ") ("m3" "ğŸ‘") ("m4" "ğŸ’")
     ("C" "ğ’") ("D" "ğ’Ÿ")
     ("N" "â„•"))))


[1]: Pfenning, F., Davies, R. (2001) A judgmental reconstruction of modal logic.
     Mathematical Structures in Computer Science, vol. 11, no. 4, pp. 511â€“540.
     http://dx.doi.org/10.1017/S0960129501003322

-}

module S4 where

open import Data.Nat using (â„• ; zero ; suc)
open import Data.Product using (_Ã—_) renaming (_,_ to âŸ¨_,_âŸ©)

infixl 9 ğ’—_
infixl 8 ğ…â‚€_ ğ…â‚_
infixl 7 _âˆ™_
infixr 6 â– _ â€¼[_]_
infixr 5 ğ€_
infixr 4 â–¡_
infixr 3 Â¬_
infixl 3 _âˆ§_
infixl 2 _âˆ¨_ _,_
infixr 1 _âŠƒ_ _â«—_
infixr 0 _âˆ£_âŠ¢_ âŠ©_


-- --------------------------------------------------------------------------
--
-- Untyped syntax


-- Type constructors
data Ty : Set where
  -- Falsehood
  âŠ¥ : Ty

  -- Implication
  _âŠƒ_ : Ty â†’ Ty â†’ Ty

  -- Conjunction
  _âˆ§_ : Ty â†’ Ty â†’ Ty

  -- Implicit provability
  â–¡_ : Ty â†’ Ty


-- --------------------------------------------------------------------------
--
-- Example types


-- Truth
âŠ¤ : Ty
âŠ¤ = âŠ¥ âŠƒ âŠ¥

-- Negation
Â¬_ : Ty â†’ Ty
Â¬ A = A âŠƒ âŠ¥

-- Disjunction
_âˆ¨_ : Ty â†’ Ty â†’ Ty
A âˆ¨ B = Â¬ A âŠƒ B

-- Equivalence
_â«—_ : Ty â†’ Ty â†’ Ty
A â«— B = (A âŠƒ B) âˆ§ (B âŠƒ A)


-- --------------------------------------------------------------------------
--
-- Typed syntax


-- Contexts
data Cx : Set where
  âˆ…   : Cx
  _,_ : Cx â†’ Ty â†’ Cx


-- Context membership evidence
data _âˆˆ_ : Ty â†’ Cx â†’ Set where
  ğ™ : âˆ€{A Î“}
      â†’ A âˆˆ (Î“ , A)

  ğ’_ : âˆ€{A B Î“}
      â†’ A âˆˆ Î“
      â†’ A âˆˆ (Î“ , B)


-- Typed terms
data _âˆ£_âŠ¢_ (Î” Î“ : Cx) : Ty â†’ Set where
  -- Variable reference
  ğ’—_ : âˆ€{A}
      â†’ A âˆˆ Î“
      â†’ Î” âˆ£ Î“ âŠ¢ A

  -- Abstraction (âŠƒI)
  ğ€_ : âˆ€{A B}
      â†’ Î” âˆ£ Î“ , A âŠ¢ B
      â†’ Î” âˆ£ Î“ âŠ¢ A âŠƒ B

  -- Application (âŠƒE)
  _âˆ™_ : âˆ€{A B}
      â†’ Î” âˆ£ Î“ âŠ¢ A âŠƒ B    â†’ Î” âˆ£ Î“ âŠ¢ A
      â†’ Î” âˆ£ Î“ âŠ¢ B

  -- Pairing (âˆ§I)
  ğ’‘âŸ¨_,_âŸ© : âˆ€{A B}
      â†’ Î” âˆ£ Î“ âŠ¢ A        â†’ Î” âˆ£ Î“ âŠ¢ B
      â†’ Î” âˆ£ Î“ âŠ¢ A âˆ§ B

  -- 0th projection (âˆ§Eâ‚€)
  ğ…â‚€_ : âˆ€{A B}
      â†’ Î” âˆ£ Î“ âŠ¢ A âˆ§ B
      â†’ Î” âˆ£ Î“ âŠ¢ A

  -- 1st projection (âˆ§Eâ‚)
  ğ…â‚_ : âˆ€{A B}
      â†’ Î” âˆ£ Î“ âŠ¢ A âˆ§ B
      â†’ Î” âˆ£ Î“ âŠ¢ B

  -- Validity variable reference
  ğ’—*_ : âˆ€{A}
      â†’ A âˆˆ Î”
      â†’ Î” âˆ£ Î“ âŠ¢ A

  -- Boxing (â–¡I)
  â– _ : âˆ€{A}
      â†’ Î” âˆ£ âˆ… âŠ¢ A
      â†’ Î” âˆ£ Î“ âŠ¢ â–¡ A

  -- Unboxing (â–¡E)
  â€¼[_]_ : âˆ€{A C}
      â†’ Î” âˆ£ Î“ âŠ¢ â–¡ A      â†’ Î” , A âˆ£ Î“ âŠ¢ C
      â†’ Î” âˆ£ Î“ âŠ¢ C


âŠ©_ : Ty â†’ Set
âŠ© A = âˆ€{Î” Î“} â†’ Î” âˆ£ Î“ âŠ¢ A


-- --------------------------------------------------------------------------
--
-- Notation for context membership evidence


ğŸ : âˆ€{A Î“}
    â†’ A âˆˆ (Î“ , A)
ğŸ = ğ™

ğŸ : âˆ€{A B Î“}
    â†’ A âˆˆ (Î“ , A , B)
ğŸ = ğ’ ğŸ

ğŸ : âˆ€{A B C Î“}
    â†’ A âˆˆ (Î“ , A , B , C)
ğŸ = ğ’ ğŸ

ğŸ‘ : âˆ€{A B C D Î“}
    â†’ A âˆˆ (Î“ , A , B , C , D)
ğŸ‘ = ğ’ ğŸ

ğŸ’ : âˆ€{A B C D E Î“}
    â†’ A âˆˆ (Î“ , A , B , C , D , E)
ğŸ’ = ğ’ ğŸ‘


-- --------------------------------------------------------------------------
--
-- Some S4 theorems at levels 1, 2, and 3


module SKICombinators where
  I : âˆ€{A}
      â†’ âŠ© A âŠƒ A
  I = ğ€ ğ’— ğŸ

  IÂ² : âˆ€{A}
      â†’ âŠ© â–¡ (A âŠƒ A)
  IÂ² = â–  (ğ€ ğ’— ğŸ)

  IÂ³ : âˆ€{A}
      â†’ âŠ© â–¡ â–¡ (A âŠƒ A)
  IÂ³ = â–  â–  (ğ€ ğ’— ğŸ)


  K : âˆ€{A B}
      â†’ âŠ© A âŠƒ B âŠƒ A
  K = ğ€ ğ€ ğ’— ğŸ

  KÂ² : âˆ€{A B}
      â†’ âŠ© â–¡ (A âŠƒ B âŠƒ A)
  KÂ² = â–  (ğ€ ğ€ ğ’— ğŸ)

  KÂ³ : âˆ€{A B}
      â†’ âŠ© â–¡ â–¡ (A âŠƒ B âŠƒ A)
  KÂ³ = â–  â–  (ğ€ ğ€ ğ’— ğŸ)


  S : âˆ€{A B C}
      â†’ âŠ© (A âŠƒ B âŠƒ C) âŠƒ (A âŠƒ B) âŠƒ A âŠƒ C
  S = ğ€ ğ€ ğ€ (ğ’— ğŸ âˆ™ ğ’— ğŸ) âˆ™ (ğ’— ğŸ âˆ™ ğ’— ğŸ)

  SÂ² : âˆ€{A B C}
      â†’ âŠ© â–¡ ((A âŠƒ B âŠƒ C) âŠƒ (A âŠƒ B) âŠƒ A âŠƒ C)
  SÂ² = â–  (ğ€ ğ€ ğ€ (ğ’— ğŸ âˆ™ ğ’— ğŸ) âˆ™ (ğ’— ğŸ âˆ™ ğ’— ğŸ))

  SÂ³ : âˆ€{A B C}
      â†’ âŠ© â–¡ â–¡ ((A âŠƒ B âŠƒ C) âŠƒ (A âŠƒ B) âŠƒ A âŠƒ C)
  SÂ³ = â–  â–  (ğ€ ğ€ ğ€ (ğ’— ğŸ âˆ™ ğ’— ğŸ) âˆ™ (ğ’— ğŸ âˆ™ ğ’— ğŸ))


-- --------------------------------------------------------------------------
--
-- S4 axioms at levels 1 and 2


module S4Axioms where
  K : âˆ€{A B}
      â†’ âŠ© â–¡ (A âŠƒ B) âŠƒ â–¡ A âŠƒ â–¡ B
  K = ğ€ ğ€ â€¼[ ğ’— ğŸ ] â€¼[ ğ’— ğŸ ] â–  ğ’—* ğŸ âˆ™ ğ’—* ğŸ

  KÂ² : âˆ€{A B}
      â†’ âŠ© â–¡ (â–¡ (A âŠƒ B) âŠƒ â–¡ A âŠƒ â–¡ B)
  KÂ² = â–  (ğ€ ğ€ â€¼[ ğ’— ğŸ ] â€¼[ ğ’— ğŸ ] â–  ğ’—* ğŸ âˆ™ ğ’—* ğŸ)


  T : âˆ€{A}
      â†’ âŠ© â–¡ A âŠƒ A
  T = ğ€ â€¼[ ğ’— ğŸ ] ğ’—* ğŸ

  TÂ² : âˆ€{A}
      â†’ âŠ© â–¡ (â–¡ A âŠƒ A)
  TÂ² = â–  (ğ€ â€¼[ ğ’— ğŸ ] ğ’—* ğŸ)


  #4 : âˆ€{A}
      â†’ âŠ© â–¡ A âŠƒ â–¡ â–¡ A
  #4 = ğ€ â€¼[ ğ’— ğŸ ] â–  â–  ğ’—* ğŸ

  #4Â² : âˆ€{A}
      â†’ âŠ© â–¡ (â–¡ A âŠƒ â–¡ â–¡ A)
  #4Â² = â–  (ğ€ â€¼[ ğ’— ğŸ ] â–  â–  ğ’—* ğŸ)


-- --------------------------------------------------------------------------
--
-- Some more S4 theorems


module Example1 where
  E11 : âˆ€{A}
      â†’ âŠ© â–¡ (â–¡ A âŠƒ A)
  E11 = S4Axioms.TÂ²

  E12 : âˆ€{A}
      â†’ âŠ© â–¡ (â–¡ A âŠƒ â–¡ â–¡ A)
  E12 = S4Axioms.#4Â²

  E13 : âˆ€{A B}
      â†’ âŠ© â–¡ â–¡ (A âŠƒ B âŠƒ A âˆ§ B)
  E13 = â–  â–  (ğ€ ğ€ ğ’‘âŸ¨ ğ’— ğŸ , ğ’— ğŸ âŸ©)

  E14 : âˆ€{A B}
      â†’ âŠ© â–¡ (â–¡ A âŠƒ â–¡ B âŠƒ â–¡ â–¡ (A âˆ§ B))
  E14 = â–  (ğ€ ğ€ â€¼[ ğ’— ğŸ ] â€¼[ ğ’— ğŸ ] â–  â–  ğ’‘âŸ¨ ğ’—* ğŸ , ğ’—* ğŸ âŸ©)


module Example1a where
  E14a : âˆ€{A B}
      â†’ âŠ© â–¡ (â–¡ A âŠƒ â–¡ B âŠƒ â–¡ (A âˆ§ B))
  E14a = â–  (ğ€ ğ€ â€¼[ ğ’— ğŸ ] â€¼[ ğ’— ğŸ ] â–  ğ’‘âŸ¨ ğ’—* ğŸ , ğ’—* ğŸ âŸ©)

  E14b : âˆ€{A B}
      â†’ âŠ© â–¡ (â–¡ A âˆ§ â–¡ B âŠƒ â–¡ â–¡ (A âˆ§ B))
  E14b = â–  (ğ€ â€¼[ ğ…â‚€ ğ’— ğŸ ] â€¼[ ğ…â‚ ğ’— ğŸ ] â–  â–  ğ’‘âŸ¨ ğ’—* ğŸ , ğ’—* ğŸ âŸ©)

  E14c : âˆ€{A B}
      â†’ âŠ© â–¡ (â–¡ A âˆ§ â–¡ B âŠƒ â–¡ (A âˆ§ B))
  E14c = â–  (ğ€ â€¼[ ğ…â‚€ ğ’— ğŸ ] â€¼[ ğ…â‚ ğ’— ğŸ ] â–  ğ’‘âŸ¨ ğ’—* ğŸ , ğ’—* ğŸ âŸ©)


-- --------------------------------------------------------------------------
--
-- Non-constructive necessitation


nec : âˆ€{A}
    â†’ âŠ© A
    â†’ âŠ© â–¡ A
nec ğ’Ÿ = â–  ğ’Ÿ


-- --------------------------------------------------------------------------
--
-- Example necessitated terms at levels 2, 3, and 4


module NecExample where
  IÂ² : âˆ€{A}
      â†’ âŠ© â–¡ (A âŠƒ A)
  IÂ² = nec SKICombinators.I

  IÂ³ : âˆ€{A}
      â†’ âŠ© â–¡ â–¡ (A âŠƒ A)
  IÂ³ = nec IÂ²

  Iâ´ : âˆ€{A}
      â†’ âŠ© â–¡ â–¡ â–¡ (A âŠƒ A)
  Iâ´ = nec IÂ³


  KÂ² : âˆ€{A B}
      â†’ âŠ© â–¡ (A âŠƒ B âŠƒ A)
  KÂ² = nec SKICombinators.K

  KÂ³ : âˆ€{A B}
      â†’ âŠ© â–¡ â–¡ (A âŠƒ B âŠƒ A)
  KÂ³ = nec KÂ²

  Kâ´ : âˆ€{A B}
      â†’ âŠ© â–¡ â–¡ â–¡ (A âŠƒ B âŠƒ A)
  Kâ´ = nec KÂ³


  SÂ² : âˆ€{A B C}
      â†’ âŠ© â–¡ ((A âŠƒ B âŠƒ C) âŠƒ (A âŠƒ B) âŠƒ A âŠƒ C)
  SÂ² = nec SKICombinators.S

  SÂ³ : âˆ€{A B C}
      â†’ âŠ© â–¡ â–¡ ((A âŠƒ B âŠƒ C) âŠƒ (A âŠƒ B) âŠƒ A âŠƒ C)
  SÂ³ = nec SÂ²

  Sâ´ : âˆ€{A B C}
      â†’ âŠ© â–¡ â–¡ â–¡ ((A âŠƒ B âŠƒ C) âŠƒ (A âŠƒ B) âŠƒ A âŠƒ C)
  Sâ´ = nec SÂ³
