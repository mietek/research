module STLC-Naturals-Weak-NotEtaLong-AbstractNbE where

open import STLC-Naturals-Weak-NotEtaLong public


----------------------------------------------------------------------------------------------------

-- record Frame : Setâ‚ where
--   infix 4 _â‰¤_
--   field
--     World  : Set
--     _â‰¤_    : World â†’ World â†’ Set
--     reflâ‰¤  : âˆ€ {W} â†’ W â‰¤ W
--     transâ‰¤ : âˆ€ {W Wâ€² Wâ€³} â†’ W â‰¤ Wâ€² â†’ Wâ€² â‰¤ Wâ€³ â†’ W â‰¤ Wâ€³
--     âŸ¦â„•âŸ§    : World â†’ Set
--     âŸ¦renâ„•âŸ§ : âˆ€ {W Wâ€²} â†’ W â‰¤ Wâ€² â†’ âŸ¦â„•âŸ§ W â†’ âŸ¦â„•âŸ§ Wâ€²
--     âŸ¦zeroâŸ§ : âˆ€ {W} â†’ âŸ¦â„•âŸ§ W
--     âŸ¦sucâŸ§  : âˆ€ {W} â†’ âŸ¦â„•âŸ§ W â†’ âŸ¦â„•âŸ§ W

--   -- semantic values
--   infix 3 _âŠ©_
--   _âŠ©_ : World â†’ Ty â†’ Set
--   _âŠ©_ = Î» { W (A âŒœâŠƒâŒ B) â†’ âˆ€ {Wâ€²} â†’ W â‰¤ Wâ€² â†’ {!!} -- Wâ€² âŠ© A â†’ Wâ€² âŠ© B
--            ; W âŒœâ„•âŒ       â†’ âŸ¦â„•âŸ§ W
--            }

--   field
--     âŸ¦recâŸ§ : âˆ€ {W A} â†’ âŸ¦â„•âŸ§ W â†’ W âŠ© A â†’ (âˆ€ {Wâ€²} â†’ W â‰¤ Wâ€² â†’ âŸ¦â„•âŸ§ Wâ€² â†’ Wâ€² âŠ© A â†’ Wâ€² âŠ© A) â†’ W âŠ© A


-- -- record Model (â„± : Frame) : Set where
-- --   open Frame â„± public
-- --   field
-- --     âŸ¦recâŸ§ : âˆ€ {W A} â†’ âŸ¦â„•âŸ§ W â†’ W âŠ© A â†’ (âˆ€ {Wâ€²} â†’ W â‰¤ Wâ€² â†’ âŸ¦â„•âŸ§ Wâ€² â†’ Wâ€² âŠ© A â†’ Wâ€² âŠ© A) â†’ W âŠ© A

-- -- open Model public

-- -- module _ {â„±} {â„³ : Model â„±} where
-- --   private
-- --     module â„³ = Model â„³

-- --   renâŠ© : âˆ€ {W Wâ€² A} â†’ W â„³.â‰¤ Wâ€² â†’ W â„³.âŠ© A â†’ Wâ€² â„³.âŠ© A
-- --   renâŠ© {A = A âŒœâŠƒâŒ B} e v = Î» eâ€² â†’ v (â„³.transâ‰¤ e eâ€²)
-- --   renâŠ© {A = âŒœâ„•âŒ}     e v = â„³.âŸ¦renâ„•âŸ§ e v

-- --   -- semantic environments
-- --   infix 3 _âŠ©*_
-- --   data _âŠ©*_ (W : â„³.World) : Ctx â†’ Set where
-- --     []  : W âŠ©* []
-- --     _âˆ·_ : âˆ€ {Î” A} (v : W â„³.âŠ© A) (vs : W âŠ©* Î”) â†’ W âŠ©* A âˆ· Î”

-- --   renâŠ©* : âˆ€ {W Wâ€² Î”} â†’ W â„³.â‰¤ Wâ€² â†’ W âŠ©* Î” â†’ Wâ€² âŠ©* Î”
-- --   renâŠ©* e []                 = []
-- --   renâŠ©* e (_âˆ·_ {A = A} v vs) = renâŠ© {A = A} e v âˆ· renâŠ©* e vs

-- -- infix 3 _/_âŠ©_
-- -- _/_âŠ©_ : âˆ€ {â„±} (â„³ : Model â„±) (W : World â„³) â†’ Ty â†’ Set
-- -- â„³ / W âŠ© A = _âŠ©_ â„³ W A

-- -- infix 3 _/_âŠ©*_
-- -- _/_âŠ©*_ : âˆ€ {â„±} (â„³ : Model â„±) (W : World â„³) â†’ Ctx â†’ Set
-- -- â„³ / W âŠ©* Î” = {!_âŠ©*_!} -- _âŠ©*_ â„³ W Î”

-- -- -- infix 3 _âŠ¨_
-- -- -- _âŠ¨_ : Ctx â†’ Ty â†’ Setâ‚
-- -- -- Î“ âŠ¨ A = âˆ€ {â„³ : Model} {W : World â„³} â†’ â„³ / W âŠ©* Î“ â†’ â„³ / W âŠ© A


-- -- -- -- open AbstractKit (Î» {â„³} â†’ _â„³.âŠ©_ {â„³}) (Î» {_} {_} {_} {A} â†’ renâŠ© {_} {_} {_} {A}) public

-- -- -- -- -- reflection
-- -- -- -- âŸ¦_âŸ§ : âˆ€ {Î“ A} â†’ Î“ âŠ¢ A â†’ Î“ âŠ¨ A
-- -- -- -- âŸ¦ âŒœvâŒ i          âŸ§     vs = âŸ¦ i âŸ§âˆ‹ vs
-- -- -- -- âŸ¦ âŒœÎ»âŒ t          âŸ§     vs = Î» e v â†’ âŸ¦ t âŸ§ (v âˆ· renâŠ©* e vs)
-- -- -- -- âŸ¦ tâ‚ âŒœ$âŒ tâ‚‚      âŸ§ {â„³} vs = âŸ¦ tâ‚ âŸ§ vs (reflâ‰¤ â„³) $ âŸ¦ tâ‚‚ âŸ§ vs
-- -- -- -- âŸ¦ âŒœzeroâŒ         âŸ§ {â„³} vs = âŸ¦zeroâŸ§ â„³
-- -- -- -- âŸ¦ âŒœsucâŒ t        âŸ§ {â„³} vs = âŸ¦sucâŸ§ â„³ (âŸ¦ t âŸ§ vs)
-- -- -- -- âŸ¦ âŒœrecâŒ tâ‚™ tâ‚€ tâ‚› âŸ§ {â„³} vs = {!!}


-- -- -- -- ----------------------------------------------------------------------------------------------------

-- -- -- -- -- canonical model
-- -- -- -- ğ’ : Model
-- -- -- -- ğ’ = record
-- -- -- --       { World  = Ctx
-- -- -- --       ; _â‰¤_    = _âŠ†_
-- -- -- --       ; reflâ‰¤  = reflâŠ†
-- -- -- --       ; transâ‰¤ = transâŠ†
-- -- -- --       ; âŸ¦â„•âŸ§    = Î» Î“ â†’ Î£ (Î“ âŠ¢ âŒœâ„•âŒ) NF
-- -- -- --       ; âŸ¦renâ„•âŸ§ = Î» { e (t , p) â†’ ren e t , renNF e p }
-- -- -- --       ; âŸ¦zeroâŸ§ = âŒœzeroâŒ , âŒœzeroâŒ
-- -- -- --       ; âŸ¦sucâŸ§  = Î» { (t , p) â†’ âŒœsucâŒ t , âŒœsucâŒ p }
-- -- -- --       }

-- -- -- -- mutual
-- -- -- --   â†‘ : âˆ€ {Î“ A} â†’ Î£ (Î“ âŠ¢ A) NNF â†’ ğ’ / Î“ âŠ© A
-- -- -- --   â†‘ {A = A âŒœâŠƒâŒ B} (t , p) = Î» e v â†’ â†‘ (_ , renNNF e p âŒœ$âŒ projâ‚‚ (â†“ v))
-- -- -- --   â†‘ {A = âŒœâ„•âŒ}     (t , p) = t , nnf p

-- -- -- --   â†“ : âˆ€ {Î“ A} â†’ ğ’ / Î“ âŠ© A â†’ Î£ (Î“ âŠ¢ A) Î» t â†’ NF t
-- -- -- --   â†“ {A = A âŒœâŠƒâŒ B} v with â†“ (v wkâŠ† (â†‘ (âŒœvâŒ {A = A} zero , âŒœvâŒ-)))
-- -- -- --   ... | t , p         = âŒœÎ»âŒ t , âŒœÎ»âŒ-
-- -- -- --   â†“ {A = âŒœâ„•âŒ}     v = v

-- -- -- -- reflâŠ©* : âˆ€ {Î“} â†’ ğ’ / Î“ âŠ©* Î“
-- -- -- -- reflâŠ©* {[]}    = []
-- -- -- -- reflâŠ©* {A âˆ· Î“} = â†‘ (âŒœvâŒ {A = A} zero , âŒœvâŒ-) âˆ· renâŠ©* wkâŠ† reflâŠ©*

-- -- -- -- -- reification
-- -- -- -- âŸ¦_âŸ§â»Â¹ : âˆ€ {Î“ A} â†’ Î“ âŠ¨ A â†’ Î£ (Î“ âŠ¢ A) NF
-- -- -- -- âŸ¦ v âŸ§â»Â¹ = â†“ (v reflâŠ©*)

-- -- -- -- nbe : âˆ€ {Î“ A} â†’ Î“ âŠ¢ A â†’ Î£ (Î“ âŠ¢ A) NF
-- -- -- -- nbe = âŸ¦_âŸ§â»Â¹ âˆ˜ âŸ¦_âŸ§


-- -- -- -- ----------------------------------------------------------------------------------------------------
