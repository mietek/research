module STLC-Naturals-Weak-NotEtaLong-AbstractNbE where

open import STLC-Naturals-Weak-NotEtaLong public


----------------------------------------------------------------------------------------------------

record Model : Setâ‚ where
  infix 4 _â‰¤_
  field
    World  : Set
    Base   : World â†’ Set
    _â‰¤_    : World â†’ World â†’ Set
    reflâ‰¤  : âˆ€ {W} â†’ W â‰¤ W
    transâ‰¤ : âˆ€ {W Wâ€² Wâ€³} â†’ W â‰¤ Wâ€² â†’ Wâ€² â‰¤ Wâ€³ â†’ W â‰¤ Wâ€³

open Model public

module _ {â„³ : Model} where
  private
    module â„³ = Model â„³

  -- semantic values
  infix 3 _âŠ©_
  _âŠ©_ : â„³.World â†’ Ty â†’ Set
  W âŠ© A âŒœâŠƒâŒ B = âˆ€ {Wâ€²} â†’ W â„³.â‰¤ Wâ€² â†’ Wâ€² âŠ© A â†’ Wâ€² âŠ© B
  W âŠ© âŒœâ„•âŒ     = âˆ€ {Wâ€²} â†’ W â„³.â‰¤ Wâ€² â†’ â„³.Base Wâ€²

  renâŠ© : âˆ€ {W Wâ€² A} â†’ W â„³.â‰¤ Wâ€² â†’ W âŠ© A â†’ Wâ€² âŠ© A
  renâŠ© {A = A âŒœâŠƒâŒ B} e v = Î» eâ€² â†’ v (â„³.transâ‰¤ e eâ€²)
  renâŠ© {A = âŒœâ„•âŒ}     e v = Î» eâ€² â†’ v (â„³.transâ‰¤ e eâ€²)

open AbstractKit (Î» {â„³} â†’ _âŠ©_ {â„³}) (Î» {_} {_} {_} {A} â†’ renâŠ© {_} {_} {_} {A}) public


----------------------------------------------------------------------------------------------------

-- canonical model
ğ’ : Model
ğ’ = record
      { World   = Ctx
      ; Base    = Î» Î“ â†’ Î£ (Î“ âŠ¢ âŒœâ„•âŒ) NF
      ; _â‰¤_     = _âŠ†_
      ; reflâ‰¤   = reflâŠ†
      ; transâ‰¤  = transâŠ†
      }

mutual
  â†‘ : âˆ€ {Î“ A} â†’ Î£ (Î“ âŠ¢ A) NNF â†’ ğ’ / Î“ âŠ© A
  â†‘ {A = A âŒœâŠƒâŒ B} (t , p) = Î» e v â†’ â†‘ (_ , renNNF e p âŒœ$âŒ projâ‚‚ (â†“ v))
  â†‘ {A = âŒœâ„•âŒ}     (t , p) = Î» e â†’ _ , nnf (renNNF e p)

  â†“ : âˆ€ {Î“ A} â†’ ğ’ / Î“ âŠ© A â†’ Î£ (Î“ âŠ¢ A) Î» t â†’ NF t
  â†“ {A = A âŒœâŠƒâŒ B} v with â†“ (v wkâŠ† (â†‘ (âŒœvâŒ zero , âŒœvâŒ-)))
  ... | t , p         = âŒœÎ»âŒ t , âŒœÎ»âŒ-
  â†“ {A = âŒœâ„•âŒ}     v = v reflâŠ†

reflâŠ©* : âˆ€ {Î“} â†’ ğ’ / Î“ âŠ©* Î“
reflâŠ©* {[]}    = []
reflâŠ©* {A âˆ· Î“} = â†‘ (âŒœvâŒ zero , âŒœvâŒ-) âˆ· renâŠ©* wkâŠ† reflâŠ©*

-- reification
âŸ¦_âŸ§â»Â¹ : âˆ€ {Î“ A} â†’ Î“ âŠ¨ A â†’ Î£ (Î“ âŠ¢ A) NF
âŸ¦ v âŸ§â»Â¹ = â†“ (v reflâŠ©*)


----------------------------------------------------------------------------------------------------

-- TODO
-- -- reflection
-- âŸ¦_âŸ§ : âˆ€ {Î“ A} â†’ Î“ âŠ¢ A â†’ Î“ âŠ¨ A
-- âŸ¦ âŒœvâŒ i          âŸ§     vs = âŸ¦ i âŸ§âˆ‹ vs
-- âŸ¦ âŒœÎ»âŒ t          âŸ§     vs = Î» e v â†’ âŸ¦ t âŸ§ (v âˆ· renâŠ©* e vs)
-- âŸ¦ tâ‚ âŒœ$âŒ tâ‚‚      âŸ§ {â„³} vs = âŸ¦ tâ‚ âŸ§ vs (reflâ‰¤ â„³) $ âŸ¦ tâ‚‚ âŸ§ vs
-- âŸ¦ âŒœzeroâŒ         âŸ§     vs = Î» e â†’ {!!}
-- âŸ¦ âŒœsucâŒ t        âŸ§     vs = Î» e â†’ {!!}
-- âŸ¦ âŒœrecâŒ tâ‚ tâ‚‚ tâ‚ƒ âŸ§     vs = {! !}

-- nbe : âˆ€ {Î“ A} â†’ Î“ âŠ¢ A â†’ Î£ (Î“ âŠ¢ A) NF
-- nbe = âŸ¦_âŸ§â»Â¹ âˆ˜ âŸ¦_âŸ§


-- ----------------------------------------------------------------------------------------------------
