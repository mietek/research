----------------------------------------------------------------------------------------------------

-- order-preserving embeddings

module OPE {ğ“} {X : Set ğ“} where

open import DBI public


----------------------------------------------------------------------------------------------------

infix 3 _âŠ‘_
data _âŠ‘_ : Tsil X â†’ Tsil X â†’ Set ğ“ where
  stop  : âˆ™ âŠ‘ âˆ™
  wkâŠ‘   : âˆ€ {B Î“ Î“â€²} (Ï± : Î“ âŠ‘ Î“â€²) â†’ Î“ âŠ‘ Î“â€² , B
  liftâŠ‘ : âˆ€ {B Î“ Î“â€²} (Ï± : Î“ âŠ‘ Î“â€²) â†’ Î“ , B âŠ‘ Î“â€² , B

idâŠ‘ reflâŠ‘ : âˆ€ {Î“} â†’ Î“ âŠ‘ Î“
idâŠ‘ {âˆ™}     = stop
idâŠ‘ {Î“ , A} = liftâŠ‘ idâŠ‘
reflâŠ‘ = idâŠ‘

-- Kovacs: flip _âˆ˜â‚‘_
_âˆ˜âŠ‘_ : âˆ€ {Î“ Î“â€² Î“â€³} â†’ Î“â€² âŠ‘ Î“â€³ â†’ Î“ âŠ‘ Î“â€² â†’ Î“ âŠ‘ Î“â€³
stop     âˆ˜âŠ‘ Ï±       = Ï±
wkâŠ‘ Ï±â€²   âˆ˜âŠ‘ Ï±       = wkâŠ‘ (Ï±â€² âˆ˜âŠ‘ Ï±)
liftâŠ‘ Ï±â€² âˆ˜âŠ‘ wkâŠ‘ Ï±   = wkâŠ‘ (Ï±â€² âˆ˜âŠ‘ Ï±)
liftâŠ‘ Ï±â€² âˆ˜âŠ‘ liftâŠ‘ Ï± = liftâŠ‘ (Ï±â€² âˆ˜âŠ‘ Ï±)

transâŠ‘ _â—‹_ : âˆ€ {Î“ Î“â€² Î“â€³} â†’ Î“ âŠ‘ Î“â€² â†’ Î“â€² âŠ‘ Î“â€³ â†’ Î“ âŠ‘ Î“â€³
transâŠ‘ = flip _âˆ˜âŠ‘_
_â—‹_ = transâŠ‘

lidâŠ‘ : âˆ€ {Î“ Î“â€²} (Ï± : Î“ âŠ‘ Î“â€²) â†’ idâŠ‘ âˆ˜âŠ‘ Ï± â‰¡ Ï±
lidâŠ‘ stop      = refl
lidâŠ‘ (wkâŠ‘ Ï±)   = wkâŠ‘ & lidâŠ‘ Ï±
lidâŠ‘ (liftâŠ‘ Ï±) = liftâŠ‘ & lidâŠ‘ Ï±

ridâŠ‘ : âˆ€ {Î“ Î“â€²} (Ï± : Î“ âŠ‘ Î“â€²) â†’ Ï± âˆ˜âŠ‘ idâŠ‘ â‰¡ Ï±
ridâŠ‘ stop      = refl
ridâŠ‘ (wkâŠ‘ Ï±)   = wkâŠ‘ & ridâŠ‘ Ï±
ridâŠ‘ (liftâŠ‘ Ï±) = liftâŠ‘ & ridâŠ‘ Ï±

assâŠ‘ : âˆ€ {Î“ Î“â€² Î“â€³ Î“â€´} (Ï±â€³ : Î“â€³ âŠ‘ Î“â€´) (Ï±â€² : Î“â€² âŠ‘ Î“â€³) (Ï± : Î“ âŠ‘ Î“â€²) â†’
       Ï±â€³ âˆ˜âŠ‘ (Ï±â€² âˆ˜âŠ‘ Ï±) â‰¡ (Ï±â€³ âˆ˜âŠ‘ Ï±â€²) âˆ˜âŠ‘ Ï±
assâŠ‘ stop       Ï±â€²         Ï±         = refl
assâŠ‘ (wkâŠ‘ Ï±â€³)   Ï±â€²         Ï±         = wkâŠ‘ & assâŠ‘ Ï±â€³ Ï±â€² Ï±
assâŠ‘ (liftâŠ‘ Ï±â€³) (wkâŠ‘ Ï±â€²)   Ï±         = wkâŠ‘ & assâŠ‘ Ï±â€³ Ï±â€² Ï±
assâŠ‘ (liftâŠ‘ Ï±â€³) (liftâŠ‘ Ï±â€²) (wkâŠ‘ Ï±)   = wkâŠ‘ & assâŠ‘ Ï±â€³ Ï±â€² Ï±
assâŠ‘ (liftâŠ‘ Ï±â€³) (liftâŠ‘ Ï±â€²) (liftâŠ‘ Ï±) = liftâŠ‘ & assâŠ‘ Ï±â€³ Ï±â€² Ï±


----------------------------------------------------------------------------------------------------

renâˆ‹ : âˆ€ {Î“ Î“â€² A} â†’ Î“ âŠ‘ Î“â€² â†’ Î“ âˆ‹ A â†’ Î“â€² âˆ‹ A
renâˆ‹ stop      i       = i
renâˆ‹ (wkâŠ‘ Ï±)   i       = wkâˆ‹ (renâˆ‹ Ï± i)
renâˆ‹ (liftâŠ‘ Ï±) zero    = zero
renâˆ‹ (liftâŠ‘ Ï±) (wkâˆ‹ i) = wkâˆ‹ (renâˆ‹ Ï± i)

idrenâˆ‹ : âˆ€ {Î“ A} (i : Î“ âˆ‹ A) â†’ renâˆ‹ idâŠ‘ i â‰¡ i
idrenâˆ‹ zero    = refl
idrenâˆ‹ (wkâˆ‹ i) = wkâˆ‹ & idrenâˆ‹ i

comprenâˆ‹ : âˆ€ {Î“ Î“â€² Î“â€³ A} (Ï±â€² : Î“â€² âŠ‘ Î“â€³) (Ï± : Î“ âŠ‘ Î“â€²) (i : Î“ âˆ‹ A) â†’
           renâˆ‹ (Ï±â€² âˆ˜âŠ‘ Ï±) i â‰¡ (renâˆ‹ Ï±â€² âˆ˜ renâˆ‹ Ï±) i
comprenâˆ‹ stop       Ï±         i       = refl
comprenâˆ‹ (wkâŠ‘ Ï±â€²)   Ï±         i       = wkâˆ‹ & comprenâˆ‹ Ï±â€² Ï± i
comprenâˆ‹ (liftâŠ‘ Ï±â€²) (wkâŠ‘ Ï±)   i       = wkâˆ‹ & comprenâˆ‹ Ï±â€² Ï± i
comprenâˆ‹ (liftâŠ‘ Ï±â€²) (liftâŠ‘ Ï±) zero    = refl
comprenâˆ‹ (liftâŠ‘ Ï±â€²) (liftâŠ‘ Ï±) (wkâˆ‹ i) = wkâˆ‹ & comprenâˆ‹ Ï±â€² Ï± i


----------------------------------------------------------------------------------------------------

-- TODO: delete?

injrenâˆ‹ : âˆ€ {Î“ Î“â€² A} {Ï± : Î“ âŠ‘ Î“â€²} {i iâ€² : Î“ âˆ‹ A} â†’ renâˆ‹ Ï± i â‰¡ renâˆ‹ Ï± iâ€² â†’ i â‰¡ iâ€²
injrenâˆ‹ {Ï± = stop}    {i}     {iâ€²}     eq   = eq
injrenâˆ‹ {Ï± = wkâŠ‘ Ï±}   {i}     {iâ€²}     eq   = injrenâˆ‹ (injwkâˆ‹ eq)
injrenâˆ‹ {Ï± = liftâŠ‘ Ï±} {zero}  {zero}   refl = refl
injrenâˆ‹ {Ï± = liftâŠ‘ Ï±} {wkâˆ‹ i} {wkâˆ‹ iâ€²} eq   = wkâˆ‹ & (injrenâˆ‹ (injwkâˆ‹ eq))

unrenâˆ‹ : âˆ€ {Î“ Î“â€² A} (Ï± : Î“ âŠ‘ Î“â€²) (iâ€² : Î“â€² âˆ‹ A) â†’ Dec (Î£ (Î“ âˆ‹ A) Î» i â†’ iâ€² â‰¡ renâˆ‹ Ï± i)
unrenâˆ‹ stop      iâ€²       = yes (iâ€² , refl)
unrenâˆ‹ (wkâŠ‘ Ï±)   zero     = no Î» ()
unrenâˆ‹ (wkâŠ‘ Ï±)   (wkâˆ‹ iâ€²) with unrenâˆ‹ Ï± iâ€²
... | no Â¬p                 = no Î» { (i , refl) â†’ (i , refl) â†¯ Â¬p }
... | yes (i , refl)        = yes (i , refl)
unrenâˆ‹ (liftâŠ‘ Ï±) zero     = yes (zero , refl)
unrenâˆ‹ (liftâŠ‘ Ï±) (wkâˆ‹ iâ€²) with unrenâˆ‹ Ï± iâ€²
... | no Â¬p                 = no Î» { (wkâˆ‹ i , refl) â†’ (i , refl) â†¯ Â¬p }
... | yes (i , refl)        = yes (wkâˆ‹ i , refl)


----------------------------------------------------------------------------------------------------
