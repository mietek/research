{-# OPTIONS --rewriting #-}

module AllListLemmas where

open import Prelude
open import Category
open import List
open import ListLemmas
open import AllList


--------------------------------------------------------------------------------
{-
                      get (gets Î¾ Î·) ğ’¾ â‰¡ (get Î¾ âˆ˜ renâˆ‹ Î·) ğ’¾                     comp-get-renâˆ‹

                            gets Î¾ idâŠ‡ â‰¡ Î¾                                      id-gets
                      gets Î¾ (Î·â‚ âˆ˜ Î·â‚‚) â‰¡ gets (gets Î¾ Î·â‚‚) Î·â‚                    comp-gets

                            idâŠ‡â€² âˆ˜âŠ‡â€² ğ›ˆ â‰¡ ğ›ˆ                                      lidâˆ˜âŠ‡â€²
                            ğ›ˆ âˆ˜âŠ‡â€² idâŠ‡â€² â‰¡ ğ›ˆ                                      ridâˆ˜âŠ‡â€²
                    (ğ›ˆâ‚ âˆ˜âŠ‡â€² ğ›ˆâ‚‚) âˆ˜âŠ‡â€² ğ›ˆâ‚ƒ â‰¡ ğ›ˆâ‚ âˆ˜âŠ‡â€² (ğ›ˆâ‚‚ âˆ˜âŠ‡â€² ğ›ˆâ‚ƒ)                     assocâˆ˜âŠ‡â€²

                          renâˆ‹â€² idâŠ‡â€² ğ“² â‰¡ ğ“²                                      id-renâˆ‹â€²
                   renâˆ‹â€² (ğ›ˆâ‚ âˆ˜âŠ‡â€² ğ›ˆâ‚‚) ğ“² â‰¡ (renâˆ‹â€² ğ›ˆâ‚‚ âˆ˜ renâˆ‹â€² ğ›ˆâ‚) ğ“²                comp-renâˆ‹â€²
-}
--------------------------------------------------------------------------------


comp-get-renâˆ‹ : âˆ€ {X P A} â†’ {Î Îâ€² : List X}
                          â†’ (Î¾ : All P Îâ€²) (Î· : Îâ€² âŠ‡ Î) (ğ’¾ : Î âˆ‹ A)
                          â†’ get (gets Î¾ Î·) ğ’¾ â‰¡ (get Î¾ âˆ˜ renâˆ‹ Î·) ğ’¾
comp-get-renâˆ‹ âˆ™       done     ()
comp-get-renâˆ‹ (Î¾ , b) (drop Î·) ğ’¾       = comp-get-renâˆ‹ Î¾ Î· ğ’¾
comp-get-renâˆ‹ (Î¾ , a) (keep Î·) zero    = refl
comp-get-renâˆ‹ (Î¾ , b) (keep Î·) (suc ğ’¾) = comp-get-renâˆ‹ Î¾ Î· ğ’¾


--------------------------------------------------------------------------------


id-gets : âˆ€ {X P} â†’ {Î : List X}
                  â†’ (Î¾ : All P Î)
                  â†’ gets Î¾ idâŠ‡ â‰¡ Î¾
id-gets âˆ™       = refl
id-gets (Î¾ , a) = (_, a) & id-gets Î¾


comp-gets : âˆ€ {X P} â†’ {Î Îâ€² Îâ€³ : List X}
                    â†’ (Î¾ : All P Îâ€³) (Î·â‚ : Îâ€² âŠ‡ Î) (Î·â‚‚ : Îâ€³ âŠ‡ Îâ€²)
                    â†’ gets Î¾ (Î·â‚ âˆ˜ Î·â‚‚) â‰¡ gets (gets Î¾ Î·â‚‚) Î·â‚
comp-gets âˆ™       Î·â‚        done      = refl
comp-gets (Î¾ , b) Î·â‚        (drop Î·â‚‚) = comp-gets Î¾ Î·â‚ Î·â‚‚
comp-gets (Î¾ , b) (drop Î·â‚) (keep Î·â‚‚) = comp-gets Î¾ Î·â‚ Î·â‚‚
comp-gets (Î¾ , a) (keep Î·â‚) (keep Î·â‚‚) = (_, a) & comp-gets Î¾ Î·â‚ Î·â‚‚


ğ ğğ­ğ¬ : âˆ€ {X P} â†’ Presheaf {{Opposite (ğğğ„ {X})}} (All P) (flip gets)
ğ ğğ­ğ¬ = record
         { idâ„±   = funext! id-gets
         ; compâ„± = \ Î·â‚ Î·â‚‚ â†’ funext! (\ Î¾ â†’ comp-gets Î¾ Î·â‚‚ Î·â‚)
         }


--------------------------------------------------------------------------------


{-# REWRITE lidâˆ˜âŠ‡ #-}
lidâˆ˜âŠ‡â€² : âˆ€ {X P} â†’ {Î Îâ€² : List X} {Î· : Îâ€² âŠ‡ Î}
                    {Î¾ : All P Î} {Î¾â€² : All P Îâ€²}
                 â†’ (ğ›ˆ : Î¾â€² âŠ‡â€²âŸ¨ Î· âŸ© Î¾)
                 â†’ idâŠ‡â€² âˆ˜âŠ‡â€² ğ›ˆ â‰¡ ğ›ˆ
lidâˆ˜âŠ‡â€² done     = refl
lidâˆ˜âŠ‡â€² (drop ğ›ˆ) = drop & lidâˆ˜âŠ‡â€² ğ›ˆ
lidâˆ˜âŠ‡â€² (keep ğ›ˆ) = keep & lidâˆ˜âŠ‡â€² ğ›ˆ


{-# REWRITE ridâˆ˜âŠ‡ #-}
ridâˆ˜âŠ‡â€² : âˆ€ {X P} â†’ {Î Îâ€² : List X} {Î· : Îâ€² âŠ‡ Î} {Î¾ : All P Î} {Î¾â€² : All P Îâ€²}
                 â†’ (ğ›ˆ : Î¾â€² âŠ‡â€²âŸ¨ Î· âŸ© Î¾)
                 â†’ ğ›ˆ âˆ˜âŠ‡â€² idâŠ‡â€² â‰¡ ğ›ˆ
ridâˆ˜âŠ‡â€² done     = refl
ridâˆ˜âŠ‡â€² (drop ğ›ˆ) = drop & ridâˆ˜âŠ‡â€² ğ›ˆ
ridâˆ˜âŠ‡â€² (keep ğ›ˆ) = keep & ridâˆ˜âŠ‡â€² ğ›ˆ


{-# REWRITE assocâˆ˜âŠ‡ #-}
assocâˆ˜âŠ‡â€² : âˆ€ {X P} â†’ {Î Îâ€² Îâ€³ Îâ€´ : List X} {Î·â‚ : Îâ€² âŠ‡ Î} {Î·â‚‚ : Îâ€³ âŠ‡ Îâ€²} {Î·â‚ƒ : Îâ€´ âŠ‡ Îâ€³}
                      {Î¾ : All P Î} {Î¾â€² : All P Îâ€²} {Î¾â€³ : All P Îâ€³} {Î¾â€´ : All P Îâ€´}
                   â†’ (ğ›ˆâ‚ : Î¾â€² âŠ‡â€²âŸ¨ Î·â‚ âŸ© Î¾) (ğ›ˆâ‚‚ : Î¾â€³ âŠ‡â€²âŸ¨ Î·â‚‚ âŸ© Î¾â€²) (ğ›ˆâ‚ƒ : Î¾â€´ âŠ‡â€²âŸ¨ Î·â‚ƒ âŸ© Î¾â€³)
                   â†’ (ğ›ˆâ‚ âˆ˜âŠ‡â€² ğ›ˆâ‚‚) âˆ˜âŠ‡â€² ğ›ˆâ‚ƒ â‰¡ ğ›ˆâ‚ âˆ˜âŠ‡â€² (ğ›ˆâ‚‚ âˆ˜âŠ‡â€² ğ›ˆâ‚ƒ)
assocâˆ˜âŠ‡â€² ğ›ˆâ‚        ğ›ˆâ‚‚        done      = refl
assocâˆ˜âŠ‡â€² ğ›ˆâ‚        ğ›ˆâ‚‚        (drop ğ›ˆâ‚ƒ) = drop & assocâˆ˜âŠ‡â€² ğ›ˆâ‚ ğ›ˆâ‚‚ ğ›ˆâ‚ƒ
assocâˆ˜âŠ‡â€² ğ›ˆâ‚        (drop ğ›ˆâ‚‚) (keep ğ›ˆâ‚ƒ) = drop & assocâˆ˜âŠ‡â€² ğ›ˆâ‚ ğ›ˆâ‚‚ ğ›ˆâ‚ƒ
assocâˆ˜âŠ‡â€² (drop ğ›ˆâ‚) (keep ğ›ˆâ‚‚) (keep ğ›ˆâ‚ƒ) = drop & assocâˆ˜âŠ‡â€² ğ›ˆâ‚ ğ›ˆâ‚‚ ğ›ˆâ‚ƒ
assocâˆ˜âŠ‡â€² (keep ğ›ˆâ‚) (keep ğ›ˆâ‚‚) (keep ğ›ˆâ‚ƒ) = keep & assocâˆ˜âŠ‡â€² ğ›ˆâ‚ ğ›ˆâ‚‚ ğ›ˆâ‚ƒ


instance
  ğğğ„â€² : âˆ€ {X P} â†’ Category (Î£ (List X) (All P))
                             (\ { (Îâ€² , Î¾â€²) (Î , Î¾) â†’
                               Î£ (Îâ€² âŠ‡ Î) (\ Î· â†’ Î¾â€² âŠ‡â€²âŸ¨ Î· âŸ© Î¾) })
  ğğğ„â€² = record
           { id     = idâŠ‡ , idâŠ‡â€²
           ; _âˆ˜_    = \ { (Î·â‚ , ğ›ˆâ‚) (Î·â‚‚ , ğ›ˆâ‚‚) â†’ Î·â‚ âˆ˜âŠ‡ Î·â‚‚ , ğ›ˆâ‚ âˆ˜âŠ‡â€² ğ›ˆâ‚‚ }
           ; lidâˆ˜   = \ { (Î· , ğ›ˆ) â†’ (Î· ,_) & lidâˆ˜âŠ‡â€² ğ›ˆ }
           ; ridâˆ˜   = \ { (Î· , ğ›ˆ) â†’ (Î· ,_) & ridâˆ˜âŠ‡â€² ğ›ˆ }
           ; assocâˆ˜ = \ { (Î·â‚ , ğ›ˆâ‚) (Î·â‚‚ , ğ›ˆâ‚‚) (Î·â‚ƒ , ğ›ˆâ‚ƒ) â†’
                        ((Î·â‚ âˆ˜âŠ‡ Î·â‚‚) âˆ˜âŠ‡ Î·â‚ƒ ,_) & assocâˆ˜âŠ‡â€² ğ›ˆâ‚ ğ›ˆâ‚‚ ğ›ˆâ‚ƒ }
           }


--------------------------------------------------------------------------------


{-# REWRITE id-renâˆ‹ #-}
id-renâˆ‹â€² : âˆ€ {X P A} â†’ {Î : List X} {ğ’¾ : Î âˆ‹ A} {a : P A} {Î¾ : All P Î}
                     â†’ (ğ“² : Î¾ âˆ‹â€²âŸ¨ ğ’¾ âŸ© a)
                     â†’ renâˆ‹â€² idâŠ‡â€² ğ“² â‰¡ ğ“²
id-renâˆ‹â€² zero    = refl
id-renâˆ‹â€² (suc ğ“²) = suc & id-renâˆ‹â€² ğ“²


{-# REWRITE comp-renâˆ‹ #-}
comp-renâˆ‹â€² : âˆ€ {X P A} â†’ {Î Îâ€² Îâ€³ : List X} {Î·â‚ : Îâ€² âŠ‡ Î} {Î·â‚‚ : Îâ€³ âŠ‡ Îâ€²} {ğ’¾ : Î âˆ‹ A}
                          {a : P A} {Î¾ : All P Î} {Î¾â€² : All P Îâ€²} {Î¾â€³ : All P Îâ€³}
                       â†’ (ğ›ˆâ‚ : Î¾â€² âŠ‡â€²âŸ¨ Î·â‚ âŸ© Î¾) (ğ›ˆâ‚‚ : Î¾â€³ âŠ‡â€²âŸ¨ Î·â‚‚ âŸ© Î¾â€²) (ğ“² : Î¾ âˆ‹â€²âŸ¨ ğ’¾ âŸ© a)
                       â†’ renâˆ‹â€² (ğ›ˆâ‚ âˆ˜âŠ‡â€² ğ›ˆâ‚‚) ğ“² â‰¡ (renâˆ‹â€² ğ›ˆâ‚‚ âˆ˜ renâˆ‹â€² ğ›ˆâ‚) ğ“²
comp-renâˆ‹â€² ğ›ˆâ‚        done      ğ“²       = refl
comp-renâˆ‹â€² ğ›ˆâ‚        (drop ğ›ˆâ‚‚) ğ“²       = suc & comp-renâˆ‹â€² ğ›ˆâ‚ ğ›ˆâ‚‚ ğ“²
comp-renâˆ‹â€² (drop ğ›ˆâ‚) (keep ğ›ˆâ‚‚) ğ“²       = suc & comp-renâˆ‹â€² ğ›ˆâ‚ ğ›ˆâ‚‚ ğ“²
comp-renâˆ‹â€² (keep ğ›ˆâ‚) (keep ğ›ˆâ‚‚) zero    = refl
comp-renâˆ‹â€² (keep ğ›ˆâ‚) (keep ğ›ˆâ‚‚) (suc ğ“²) = suc & comp-renâˆ‹â€² ğ›ˆâ‚ ğ›ˆâ‚‚ ğ“²


ğ«ğğ§âˆ‹â€² : âˆ€ {X P A} â†’ {a : P A}
                  â†’ Presheaf {{ğğğ„â€² {X} {P}}}
                              (\ { (Î , Î¾) â†’
                                Î£ (Î âˆ‹ A) (\ ğ’¾ â†’ Î¾ âˆ‹â€²âŸ¨ ğ’¾ âŸ© a) })
                              (\ { (Î· , ğ›ˆ) (i , ğ“²) â†’ renâˆ‹ Î· i , renâˆ‹â€² ğ›ˆ ğ“² })
ğ«ğğ§âˆ‹â€² = record
          { idâ„±   = funext! (\ { (ğ’¾ , ğ“²) â†’
                      (renâˆ‹ idâŠ‡ ğ’¾ ,_) & id-renâˆ‹â€² ğ“² })
          ; compâ„± = \ { (Î·â‚ , ğ›ˆâ‚) (Î·â‚‚ , ğ›ˆâ‚‚) â†’
                      funext! (\ { (ğ’¾ , ğ“²) â†’
                        (renâˆ‹ (Î·â‚ âˆ˜âŠ‡ Î·â‚‚) ğ’¾ ,_) & comp-renâˆ‹â€² ğ›ˆâ‚ ğ›ˆâ‚‚ ğ“² }) }
          }


--------------------------------------------------------------------------------
