{-# OPTIONS --rewriting #-}

module AllListLemmas where

open import Prelude
open import Category
open import List
open import ListLemmas
open import AllList


--------------------------------------------------------------------------------
{-
                      get (gets Î¾ Î·) i â‰¡ (get Î¾ âˆ˜ renâˆ‹ Î·) i                     comp-get-renâˆ‹

                             gets Î¾ id â‰¡ Î¾                                      id-gets
                      gets Î¾ (Î·â‚ âˆ˜ Î·â‚‚) â‰¡ gets (gets Î¾ Î·â‚‚) Î·â‚                    comp-gets
                                                                                ğ ğğ­ğ¬

                            idâŠ‡â—‡ âˆ˜âŠ‡â—‡ ğœ‚ â‰¡ ğœ‚                                      lidâˆ˜âŠ‡â—‡
                            ğœ‚ âˆ˜âŠ‡â—‡ idâŠ‡â—‡ â‰¡ ğœ‚                                      ridâˆ˜âŠ‡â—‡
                    (ğœ‚â‚ âˆ˜âŠ‡â—‡ ğœ‚â‚‚) âˆ˜âŠ‡â—‡ ğœ‚â‚ƒ â‰¡ ğœ‚â‚ âˆ˜âŠ‡â—‡ (ğœ‚â‚‚ âˆ˜âŠ‡â—‡ ğœ‚â‚ƒ)                     assocâˆ˜âŠ‡â—‡
                                                                                ğğğ„â—‡

                          renâˆ‹â—‡ idâŠ‡â—‡ ğ‘– â‰¡ ğ‘–                                      id-renâˆ‹â—‡
                   renâˆ‹â—‡ (ğœ‚â‚ âˆ˜âŠ‡â—‡ ğœ‚â‚‚) ğ‘– â‰¡ (renâˆ‹â—‡ ğœ‚â‚‚ âˆ˜ renâˆ‹â—‡ ğœ‚â‚) ğ‘–                comp-renâˆ‹â—‡
                                                                                ğ«ğğ§âˆ‹â—‡
-}
--------------------------------------------------------------------------------


comp-get-renâˆ‹ : âˆ€ {X P A} â†’ {Î Îâ€² : List X}
                          â†’ (Î¾ : All P Îâ€²) (Î· : Îâ€² âŠ‡ Î) (i : Î âˆ‹ A)
                          â†’ get (gets Î¾ Î·) i â‰¡ (get Î¾ âˆ˜ renâˆ‹ Î·) i
comp-get-renâˆ‹ âˆ™       done     ()
comp-get-renâˆ‹ (Î¾ , b) (drop Î·) i       = comp-get-renâˆ‹ Î¾ Î· i
comp-get-renâˆ‹ (Î¾ , a) (keep Î·) zero    = refl
comp-get-renâˆ‹ (Î¾ , b) (keep Î·) (suc i) = comp-get-renâˆ‹ Î¾ Î· i


--------------------------------------------------------------------------------


id-gets : âˆ€ {X P} â†’ {Î : List X}
                  â†’ (Î¾ : All P Î)
                  â†’ gets Î¾ id â‰¡ Î¾
id-gets âˆ™       = refl
id-gets (Î¾ , a) = (_, a) & id-gets Î¾


comp-gets : âˆ€ {X P} â†’ {Î Îâ€² Îâ€³ : List X}
                    â†’ (Î¾ : All P Îâ€³) (Î·â‚ : Îâ€² âŠ‡ Î) (Î·â‚‚ : Îâ€³ âŠ‡ Îâ€²)
                    â†’ gets Î¾ (Î·â‚ âˆ˜ Î·â‚‚) â‰¡ gets (gets Î¾ Î·â‚‚) Î·â‚
comp-gets âˆ™       Î·â‚        done      = refl
comp-gets (Î¾ , b) Î·â‚        (drop Î·â‚‚) = comp-gets Î¾ Î·â‚ Î·â‚‚
comp-gets (Î¾ , b) (drop Î·â‚) (keep Î·â‚‚) = comp-gets Î¾ Î·â‚ Î·â‚‚
comp-gets (Î¾ , a) (keep Î·â‚) (keep Î·â‚‚) = (_, a) & comp-gets Î¾ Î·â‚ Î·â‚‚


ğ ğğ­ğ¬ : âˆ€ {X P} â†’ Presheaf (Opposite (ğğğ„ {X})) (All P)
ğ ğğ­ğ¬ = record
         { â„±     = flip gets
         ; idâ„±   = funext! id-gets
         ; compâ„± = \ Î·â‚ Î·â‚‚ â†’ funext! (\ Î¾ â†’ comp-gets Î¾ Î·â‚‚ Î·â‚)
         }


--------------------------------------------------------------------------------


{-# REWRITE lidâˆ˜âŠ‡ #-}
lidâˆ˜âŠ‡â—‡ : âˆ€ {X P} â†’ {Î Îâ€² : List X} {Î· : Îâ€² âŠ‡ Î}
                    {Î¾ : All P Î} {Î¾â€² : All P Îâ€²}
                 â†’ (ğœ‚ : Î¾â€² âŠ‡â—‡âŸ¨ Î· âŸ© Î¾)
                 â†’ idâŠ‡â—‡ âˆ˜âŠ‡â—‡ ğœ‚ â‰¡ ğœ‚
lidâˆ˜âŠ‡â—‡ done     = refl
lidâˆ˜âŠ‡â—‡ (drop ğœ‚) = drop & lidâˆ˜âŠ‡â—‡ ğœ‚
lidâˆ˜âŠ‡â—‡ (keep ğœ‚) = keep & lidâˆ˜âŠ‡â—‡ ğœ‚


{-# REWRITE ridâˆ˜âŠ‡ #-}
ridâˆ˜âŠ‡â—‡ : âˆ€ {X P} â†’ {Î Îâ€² : List X} {Î· : Îâ€² âŠ‡ Î} {Î¾ : All P Î} {Î¾â€² : All P Îâ€²}
                 â†’ (ğœ‚ : Î¾â€² âŠ‡â—‡âŸ¨ Î· âŸ© Î¾)
                 â†’ ğœ‚ âˆ˜âŠ‡â—‡ idâŠ‡â—‡ â‰¡ ğœ‚
ridâˆ˜âŠ‡â—‡ done     = refl
ridâˆ˜âŠ‡â—‡ (drop ğœ‚) = drop & ridâˆ˜âŠ‡â—‡ ğœ‚
ridâˆ˜âŠ‡â—‡ (keep ğœ‚) = keep & ridâˆ˜âŠ‡â—‡ ğœ‚


{-# REWRITE assocâˆ˜âŠ‡ #-}
assocâˆ˜âŠ‡â—‡ : âˆ€ {X P} â†’ {Î Îâ€² Îâ€³ Îâ€´ : List X} {Î·â‚ : Îâ€² âŠ‡ Î} {Î·â‚‚ : Îâ€³ âŠ‡ Îâ€²} {Î·â‚ƒ : Îâ€´ âŠ‡ Îâ€³}
                      {Î¾ : All P Î} {Î¾â€² : All P Îâ€²} {Î¾â€³ : All P Îâ€³} {Î¾â€´ : All P Îâ€´}
                   â†’ (ğœ‚â‚ : Î¾â€² âŠ‡â—‡âŸ¨ Î·â‚ âŸ© Î¾) (ğœ‚â‚‚ : Î¾â€³ âŠ‡â—‡âŸ¨ Î·â‚‚ âŸ© Î¾â€²) (ğœ‚â‚ƒ : Î¾â€´ âŠ‡â—‡âŸ¨ Î·â‚ƒ âŸ© Î¾â€³)
                   â†’ (ğœ‚â‚ âˆ˜âŠ‡â—‡ ğœ‚â‚‚) âˆ˜âŠ‡â—‡ ğœ‚â‚ƒ â‰¡ ğœ‚â‚ âˆ˜âŠ‡â—‡ (ğœ‚â‚‚ âˆ˜âŠ‡â—‡ ğœ‚â‚ƒ)
assocâˆ˜âŠ‡â—‡ ğœ‚â‚        ğœ‚â‚‚        done      = refl
assocâˆ˜âŠ‡â—‡ ğœ‚â‚        ğœ‚â‚‚        (drop ğœ‚â‚ƒ) = drop & assocâˆ˜âŠ‡â—‡ ğœ‚â‚ ğœ‚â‚‚ ğœ‚â‚ƒ
assocâˆ˜âŠ‡â—‡ ğœ‚â‚        (drop ğœ‚â‚‚) (keep ğœ‚â‚ƒ) = drop & assocâˆ˜âŠ‡â—‡ ğœ‚â‚ ğœ‚â‚‚ ğœ‚â‚ƒ
assocâˆ˜âŠ‡â—‡ (drop ğœ‚â‚) (keep ğœ‚â‚‚) (keep ğœ‚â‚ƒ) = drop & assocâˆ˜âŠ‡â—‡ ğœ‚â‚ ğœ‚â‚‚ ğœ‚â‚ƒ
assocâˆ˜âŠ‡â—‡ (keep ğœ‚â‚) (keep ğœ‚â‚‚) (keep ğœ‚â‚ƒ) = keep & assocâˆ˜âŠ‡â—‡ ğœ‚â‚ ğœ‚â‚‚ ğœ‚â‚ƒ


instance
  ğğğ„â—‡ : âˆ€ {X P} â†’ Category (Î£ (List X) (All P))
                             (\ { (Îâ€² , Î¾â€²) (Î , Î¾) â†’
                               Î£ (Îâ€² âŠ‡ Î) (\ Î· â†’ Î¾â€² âŠ‡â—‡âŸ¨ Î· âŸ© Î¾) })
  ğğğ„â—‡ = record
           { id     = id , idâŠ‡â—‡
           ; _âˆ˜_    = \ { (Î·â‚ , ğœ‚â‚) (Î·â‚‚ , ğœ‚â‚‚) â†’ Î·â‚ âˆ˜ Î·â‚‚ , ğœ‚â‚ âˆ˜âŠ‡â—‡ ğœ‚â‚‚ }
           ; lidâˆ˜   = \ { (Î· , ğœ‚) â†’ (Î· ,_) & lidâˆ˜âŠ‡â—‡ ğœ‚ }
           ; ridâˆ˜   = \ { (Î· , ğœ‚) â†’ (Î· ,_) & ridâˆ˜âŠ‡â—‡ ğœ‚ }
           ; assocâˆ˜ = \ { (Î·â‚ , ğœ‚â‚) (Î·â‚‚ , ğœ‚â‚‚) (Î·â‚ƒ , ğœ‚â‚ƒ) â†’
                        ((Î·â‚ âˆ˜ Î·â‚‚) âˆ˜ Î·â‚ƒ ,_) & assocâˆ˜âŠ‡â—‡ ğœ‚â‚ ğœ‚â‚‚ ğœ‚â‚ƒ }
           }


--------------------------------------------------------------------------------


{-# REWRITE id-renâˆ‹ #-}
id-renâˆ‹â—‡ : âˆ€ {X P A} â†’ {Î : List X} {i : Î âˆ‹ A} {a : P A} {Î¾ : All P Î}
                     â†’ (ğ‘– : Î¾ âˆ‹â—‡âŸ¨ i âŸ© a)
                     â†’ renâˆ‹â—‡ idâŠ‡â—‡ ğ‘– â‰¡ ğ‘–
id-renâˆ‹â—‡ zero    = refl
id-renâˆ‹â—‡ (suc ğ‘–) = suc & id-renâˆ‹â—‡ ğ‘–


{-# REWRITE comp-renâˆ‹ #-}
comp-renâˆ‹â—‡ : âˆ€ {X P A} â†’ {Î Îâ€² Îâ€³ : List X} {Î·â‚ : Îâ€² âŠ‡ Î} {Î·â‚‚ : Îâ€³ âŠ‡ Îâ€²} {i : Î âˆ‹ A}
                          {a : P A} {Î¾ : All P Î} {Î¾â€² : All P Îâ€²} {Î¾â€³ : All P Îâ€³}
                       â†’ (ğœ‚â‚ : Î¾â€² âŠ‡â—‡âŸ¨ Î·â‚ âŸ© Î¾) (ğœ‚â‚‚ : Î¾â€³ âŠ‡â—‡âŸ¨ Î·â‚‚ âŸ© Î¾â€²) (ğ‘– : Î¾ âˆ‹â—‡âŸ¨ i âŸ© a)
                       â†’ renâˆ‹â—‡ (ğœ‚â‚ âˆ˜âŠ‡â—‡ ğœ‚â‚‚) ğ‘– â‰¡ (renâˆ‹â—‡ ğœ‚â‚‚ âˆ˜ renâˆ‹â—‡ ğœ‚â‚) ğ‘–
comp-renâˆ‹â—‡ ğœ‚â‚        done      ğ‘–       = refl
comp-renâˆ‹â—‡ ğœ‚â‚        (drop ğœ‚â‚‚) ğ‘–       = suc & comp-renâˆ‹â—‡ ğœ‚â‚ ğœ‚â‚‚ ğ‘–
comp-renâˆ‹â—‡ (drop ğœ‚â‚) (keep ğœ‚â‚‚) ğ‘–       = suc & comp-renâˆ‹â—‡ ğœ‚â‚ ğœ‚â‚‚ ğ‘–
comp-renâˆ‹â—‡ (keep ğœ‚â‚) (keep ğœ‚â‚‚) zero    = refl
comp-renâˆ‹â—‡ (keep ğœ‚â‚) (keep ğœ‚â‚‚) (suc ğ‘–) = suc & comp-renâˆ‹â—‡ ğœ‚â‚ ğœ‚â‚‚ ğ‘–


ğ«ğğ§âˆ‹â—‡ : âˆ€ {X P A} â†’ {a : P A}
                  â†’ Presheaf (ğğğ„â—‡ {X} {P})
                              (\ { (Î , Î¾) â†’
                                Î£ (Î âˆ‹ A) (\ i â†’ Î¾ âˆ‹â—‡âŸ¨ i âŸ© a) })
ğ«ğğ§âˆ‹â—‡ = record
          { â„±     = \ { (Î· , ğœ‚) (i , ğ‘–) â†’ renâˆ‹ Î· i , renâˆ‹â—‡ ğœ‚ ğ‘– }
          ; idâ„±   = funext! (\ { (i , ğ‘–) â†’ (_ ListÂ².â¨¾_) & id-renâˆ‹â—‡ ğ‘– })
          ; compâ„± = \ { (Î·â‚ , ğœ‚â‚) (Î·â‚‚ , ğœ‚â‚‚) â†’
                      funext! (\ { (i , ğ‘–) â†’ (_ ListÂ².â¨¾_) & comp-renâˆ‹â—‡ ğœ‚â‚ ğœ‚â‚‚ ğ‘– }) }
          }


--------------------------------------------------------------------------------
