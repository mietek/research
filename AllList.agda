module AllList where

open import Prelude
open import List


--------------------------------------------------------------------------------


data All {X} (P : X â†’ Set) : List X â†’ Set
  where
    âˆ™   : All P âˆ™
    _,_ : âˆ€ {Î A} â†’ All P Î â†’ P A â†’ All P (Î , A)


maps : âˆ€ {X P Q} â†’ {Î : List X}
                 â†’ (âˆ€ {A} â†’ P A â†’ Q A) â†’ All P Î
                 â†’ All Q Î
maps f âˆ™       = âˆ™
maps f (Î¾ , a) = maps f Î¾ , f a


module GetAllList
  where
    get : âˆ€ {X P A} â†’ {Î : List X}
                    â†’ All P Î â†’ Î âˆ‹ A
                    â†’ P A
    get (Î¾ , a) zero    = a
    get (Î¾ , b) (suc ğ’¾) = get Î¾ ğ’¾


    gets : âˆ€ {X P} â†’ {Î Îâ€² : List X}
                   â†’ All P Îâ€² â†’ Îâ€² âŠ‡ Î
                   â†’ All P Î
    gets Î¾       done     = âˆ™
    gets (Î¾ , b) (drop Î·) = gets Î¾ Î·
    gets (Î¾ , a) (keep Î·) = gets Î¾ Î· , a


--------------------------------------------------------------------------------


infix 4 _âŠ‡â€²âŸ¨_âŸ©_
data _âŠ‡â€²âŸ¨_âŸ©_ {X P} : {Î Îâ€² : List X} â†’ All P Îâ€² â†’ Îâ€² âŠ‡ Î â†’ All P Î â†’ Set
  where
    done : âˆ™ âŠ‡â€²âŸ¨ done âŸ© âˆ™

    drop : âˆ€ {A Î Îâ€²} â†’ {Î· : Îâ€² âŠ‡ Î} {a : P A} {Î¾ : All P Î} {Î¾â€² : All P Îâ€²}
                      â†’ Î¾â€² âŠ‡â€²âŸ¨ Î· âŸ© Î¾
                      â†’ Î¾â€² , a âŠ‡â€²âŸ¨ drop Î· âŸ© Î¾

    keep : âˆ€ {A Î Îâ€²} â†’ {Î· : Îâ€² âŠ‡ Î} {a : P A} {Î¾ : All P Î} {Î¾â€² : All P Îâ€²}
                      â†’ Î¾â€² âŠ‡â€²âŸ¨ Î· âŸ© Î¾
                      â†’ Î¾â€² , a âŠ‡â€²âŸ¨ keep Î· âŸ© Î¾ , a


idâŠ‡â€² : âˆ€ {X P} â†’ {Î : List X} {Î¾ : All P Î}
               â†’ Î¾ âŠ‡â€²âŸ¨ idâŠ‡ âŸ© Î¾
idâŠ‡â€² {Î¾ = âˆ™}     = done
idâŠ‡â€² {Î¾ = Î¾ , a} = keep idâŠ‡â€²


_âˆ˜âŠ‡â€²_ : âˆ€ {X P} â†’ {Î Îâ€² Îâ€³ : List X} {Î·â‚ : Îâ€² âŠ‡ Î} {Î·â‚‚ : Îâ€³ âŠ‡ Îâ€²}
                   {Î¾ : All P Î} {Î¾â€² : All P Îâ€²} {Î¾â€³ : All P Îâ€³}
                â†’ Î¾â€² âŠ‡â€²âŸ¨ Î·â‚ âŸ© Î¾ â†’ Î¾â€³ âŠ‡â€²âŸ¨ Î·â‚‚ âŸ© Î¾â€²
                â†’ Î¾â€³ âŠ‡â€²âŸ¨ Î·â‚ âˆ˜âŠ‡ Î·â‚‚ âŸ© Î¾
ğ›ˆâ‚      âˆ˜âŠ‡â€² done    = ğ›ˆâ‚
ğ›ˆâ‚      âˆ˜âŠ‡â€² drop ğ›ˆâ‚‚ = drop (ğ›ˆâ‚ âˆ˜âŠ‡â€² ğ›ˆâ‚‚)
drop ğ›ˆâ‚ âˆ˜âŠ‡â€² keep ğ›ˆâ‚‚ = drop (ğ›ˆâ‚ âˆ˜âŠ‡â€² ğ›ˆâ‚‚)
keep ğ›ˆâ‚ âˆ˜âŠ‡â€² keep ğ›ˆâ‚‚ = keep (ğ›ˆâ‚ âˆ˜âŠ‡â€² ğ›ˆâ‚‚)


--------------------------------------------------------------------------------


infix 4 _âˆ‹â€²âŸ¨_âŸ©_
data _âˆ‹â€²âŸ¨_âŸ©_ {X P} : âˆ€ {A} â†’ {Î : List X} â†’ All P Î â†’ Î âˆ‹ A â†’ P A â†’ Set
  where
    zero : âˆ€ {A Î} â†’ {a : P A} {Î¾ : All P Î}
                   â†’ Î¾ , a âˆ‹â€²âŸ¨ zero âŸ© a

    suc : âˆ€ {A B Î} â†’ {ğ’¾ : Î âˆ‹ A} {a : P A} {b : P B} {Î¾ : All P Î}
                    â†’ Î¾ âˆ‹â€²âŸ¨ ğ’¾ âŸ© a
                    â†’ Î¾ , b âˆ‹â€²âŸ¨ suc ğ’¾ âŸ© a


renâˆ‹â€² : âˆ€ {X P A} â†’ {Î Îâ€² : List X} {Î· : Îâ€² âŠ‡ Î} {ğ’¾ : Î âˆ‹ A}
                     {a : P A} {Î¾ : All P Î} {Î¾â€² : All P Îâ€²}
                  â†’ Î¾â€² âŠ‡â€²âŸ¨ Î· âŸ© Î¾ â†’ Î¾ âˆ‹â€²âŸ¨ ğ’¾ âŸ© a
                  â†’ Î¾â€² âˆ‹â€²âŸ¨ renâˆ‹ Î· ğ’¾ âŸ© a
renâˆ‹â€² done     ğ“²       = ğ“²
renâˆ‹â€² (drop ğ›ˆ) ğ“²       = suc (renâˆ‹â€² ğ›ˆ ğ“²)
renâˆ‹â€² (keep ğ›ˆ) zero    = zero
renâˆ‹â€² (keep ğ›ˆ) (suc ğ“²) = suc (renâˆ‹â€² ğ›ˆ ğ“²)


--------------------------------------------------------------------------------
